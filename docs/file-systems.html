

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>File Systems &mdash; Storage Systems and Data Management Guide 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=f2a433a1"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Data Organization" href="data-organization.html" />
    <link rel="prev" title="Disk Management" href="disk-management.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Storage Systems and Data Management Guide
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Storage Fundamentals:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="storage-overview.html">Storage Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="disk-management.html">Disk Management</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">File Systems</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#understanding-file-systems">Understanding File Systems</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#what-is-a-file-system">What is a File System?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#file-system-components">File System Components</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#core-components">Core Components</a></li>
<li class="toctree-l4"><a class="reference internal" href="#file-system-structure">File System Structure</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#common-file-systems-in-ubuntu-22-04">Common File Systems in Ubuntu 22.04</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ext4-fourth-extended-filesystem">ext4 (Fourth Extended Filesystem)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#xfs-extended-file-system">XFS (eXtended File System)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#btrfs-b-tree-file-system">Btrfs (B-tree File System)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#zfs-zettabyte-file-system">ZFS (Zettabyte File System)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fat32-and-ntfs">FAT32 and NTFS</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#file-system-operations-in-ubuntu-22-04">File System Operations in Ubuntu 22.04</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#creating-file-systems">Creating File Systems</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mounting-file-systems">Mounting File Systems</a></li>
<li class="toctree-l4"><a class="reference internal" href="#checking-and-repairing-file-systems">Checking and Repairing File Systems</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#file-system-monitoring">File System Monitoring</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#monitoring-tools-and-commands">Monitoring Tools and Commands</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#frequently-asked-questions">Frequently Asked Questions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#q-which-filesystem-should-i-choose-for-ubuntu-22-04">Q: Which filesystem should I choose for Ubuntu 22.04?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#q-how-do-i-convert-between-filesystems">Q: How do I convert between filesystems?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#q-how-do-i-optimize-filesystem-performance">Q: How do I optimize filesystem performance?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#q-how-do-i-recover-deleted-files">Q: How do I recover deleted files?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#coding-examples">Coding Examples</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#python-filesystem-analyzer">Python Filesystem Analyzer</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bash-filesystem-management-script">Bash Filesystem Management Script</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#best-practices-for-file-systems">Best Practices for File Systems</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#choosing-the-right-filesystem">Choosing the Right Filesystem</a></li>
<li class="toctree-l4"><a class="reference internal" href="#performance-optimization">Performance Optimization</a></li>
<li class="toctree-l4"><a class="reference internal" href="#security-and-maintenance">Security and Maintenance</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="data-organization.html">Data Organization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced Storage Concepts:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="raid-systems.html">RAID Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="network-storage.html">Network Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="volume-management.html">Volume Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="storage-devices.html">Storage Devices</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Practical Implementation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="ubuntu-setup.html">Ubuntu 22.04 Setup and Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="coding-examples.html">Coding Examples and Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="best-practices.html">Best Practices and Guidelines</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Resources:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html#common-command-abbreviations">Common Command Abbreviations</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html#storage-unit-definitions">Storage Unit Definitions</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html#performance-metrics">Performance Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html#raid-levels-reference">RAID Levels Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html#network-storage-protocols">Network Storage Protocols</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html#file-system-features">File System Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="downloads.html">Downloads and Resources</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Storage Systems and Data Management Guide</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">File Systems</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/file-systems.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="file-systems">
<h1>File Systems<a class="headerlink" href="#file-systems" title="Link to this heading"></a></h1>
<section id="understanding-file-systems">
<h2>Understanding File Systems<a class="headerlink" href="#understanding-file-systems" title="Link to this heading"></a></h2>
<p>A file system is a method used by operating systems to store, organize, and manage files on storage devices. It defines how data is stored, accessed, and organized on disks.</p>
<section id="what-is-a-file-system">
<h3>What is a File System?<a class="headerlink" href="#what-is-a-file-system" title="Link to this heading"></a></h3>
<p>A file system provides:</p>
<ul class="simple">
<li><p><strong>File Organization</strong>: Hierarchical structure for organizing files and directories</p></li>
<li><p><strong>Metadata Management</strong>: Information about files (size, permissions, timestamps)</p></li>
<li><p><strong>Space Management</strong>: Allocation and deallocation of disk space</p></li>
<li><p><strong>Access Control</strong>: Security and permission mechanisms</p></li>
<li><p><strong>Data Integrity</strong>: Protection against data corruption</p></li>
</ul>
</section>
<section id="file-system-components">
<h3>File System Components<a class="headerlink" href="#file-system-components" title="Link to this heading"></a></h3>
<section id="core-components">
<h4>Core Components<a class="headerlink" href="#core-components" title="Link to this heading"></a></h4>
<ol class="arabic simple">
<li><p><strong>Superblock</strong>: Contains metadata about the filesystem</p></li>
<li><p><strong>Inode Table</strong>: Stores file metadata and pointers to data blocks</p></li>
<li><p><strong>Data Blocks</strong>: Actual file content storage</p></li>
<li><p><strong>Directory Structure</strong>: Hierarchical organization of files and folders</p></li>
<li><p><strong>Journal</strong>: Transaction log for filesystem changes (in journaling filesystems)</p></li>
</ol>
</section>
<section id="file-system-structure">
<h4>File System Structure<a class="headerlink" href="#file-system-structure" title="Link to this heading"></a></h4>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Filesystem Layout
├── Superblock (filesystem metadata)
├── Group Descriptors (block group information)
├── Block Bitmap (free/used block tracking)
├── Inode Bitmap (free/used inode tracking)
├── Inode Table (file metadata)
└── Data Blocks (actual file content)
</pre></div>
</div>
</section>
</section>
<section id="common-file-systems-in-ubuntu-22-04">
<h3>Common File Systems in Ubuntu 22.04<a class="headerlink" href="#common-file-systems-in-ubuntu-22-04" title="Link to this heading"></a></h3>
<section id="ext4-fourth-extended-filesystem">
<h4>ext4 (Fourth Extended Filesystem)<a class="headerlink" href="#ext4-fourth-extended-filesystem" title="Link to this heading"></a></h4>
<p>The default filesystem for Ubuntu 22.04:</p>
<p><strong>Features:</strong>
* Journaling for data integrity
* Large file and filesystem support (up to 1 EB)
* Backward compatibility with ext2/ext3
* Online defragmentation
* Delayed allocation</p>
<p><strong>Use Cases:</strong>
* General purpose computing
* Desktop and server installations
* Boot partitions
* Home directories</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create ext4 filesystem</span>
sudo<span class="w"> </span>mkfs.ext4<span class="w"> </span>/dev/sdb1

<span class="c1"># Check ext4 filesystem</span>
sudo<span class="w"> </span>fsck.ext4<span class="w"> </span>/dev/sdb1

<span class="c1"># Get ext4 filesystem information</span>
sudo<span class="w"> </span>tune2fs<span class="w"> </span>-l<span class="w"> </span>/dev/sdb1

<span class="c1"># Optimize ext4 filesystem</span>
sudo<span class="w"> </span>tune2fs<span class="w"> </span>-o<span class="w"> </span>journal_data_writeback<span class="w"> </span>/dev/sdb1
</pre></div>
</div>
</section>
<section id="xfs-extended-file-system">
<h4>XFS (eXtended File System)<a class="headerlink" href="#xfs-extended-file-system" title="Link to this heading"></a></h4>
<p>High-performance 64-bit journaling filesystem:</p>
<p><strong>Features:</strong>
* Excellent scalability
* Online resizing (grow only)
* Advanced quota management
* Allocation groups for parallel I/O
* Metadata journaling</p>
<p><strong>Use Cases:</strong>
* Large files and databases
* High-performance computing
* Video editing and media storage
* Enterprise storage systems</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create XFS filesystem</span>
sudo<span class="w"> </span>mkfs.xfs<span class="w"> </span>/dev/sdb1

<span class="c1"># Check XFS filesystem</span>
sudo<span class="w"> </span>xfs_check<span class="w"> </span>/dev/sdb1

<span class="c1"># Repair XFS filesystem</span>
sudo<span class="w"> </span>xfs_repair<span class="w"> </span>/dev/sdb1

<span class="c1"># Get XFS information</span>
sudo<span class="w"> </span>xfs_info<span class="w"> </span>/dev/sdb1

<span class="c1"># Resize XFS filesystem (grow only)</span>
sudo<span class="w"> </span>xfs_growfs<span class="w"> </span>/mnt/xfs
</pre></div>
</div>
</section>
<section id="btrfs-b-tree-file-system">
<h4>Btrfs (B-tree File System)<a class="headerlink" href="#btrfs-b-tree-file-system" title="Link to this heading"></a></h4>
<p>Modern copy-on-write filesystem:</p>
<p><strong>Features:</strong>
* Snapshots and cloning
* Built-in RAID support
* Compression (zlib, lzo, zstd)
* Checksumming for data integrity
* Online resizing (grow and shrink)</p>
<p><strong>Use Cases:</strong>
* System snapshots
* Development environments
* Data deduplication scenarios
* Advanced storage management</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create Btrfs filesystem</span>
sudo<span class="w"> </span>mkfs.btrfs<span class="w"> </span>/dev/sdb1

<span class="c1"># Mount with compression</span>
sudo<span class="w"> </span>mount<span class="w"> </span>-o<span class="w"> </span><span class="nv">compress</span><span class="o">=</span>zstd<span class="w"> </span>/dev/sdb1<span class="w"> </span>/mnt/btrfs

<span class="c1"># Create snapshot</span>
sudo<span class="w"> </span>btrfs<span class="w"> </span>subvolume<span class="w"> </span>snapshot<span class="w"> </span>/mnt/btrfs<span class="w"> </span>/mnt/btrfs/snapshot

<span class="c1"># List subvolumes</span>
sudo<span class="w"> </span>btrfs<span class="w"> </span>subvolume<span class="w"> </span>list<span class="w"> </span>/mnt/btrfs
</pre></div>
</div>
</section>
<section id="zfs-zettabyte-file-system">
<h4>ZFS (Zettabyte File System)<a class="headerlink" href="#zfs-zettabyte-file-system" title="Link to this heading"></a></h4>
<p>Advanced filesystem with built-in volume management:</p>
<p><strong>Features:</strong>
* Built-in RAID (RAID-Z)
* Snapshots and clones
* Data deduplication
* Compression
* End-to-end checksumming</p>
<p><strong>Installation and Use:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install ZFS on Ubuntu 22.04</span>
sudo<span class="w"> </span>apt<span class="w"> </span>update
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>zfsutils-linux

<span class="c1"># Create ZFS pool</span>
sudo<span class="w"> </span>zpool<span class="w"> </span>create<span class="w"> </span>mypool<span class="w"> </span>/dev/sdb

<span class="c1"># Create ZFS dataset</span>
sudo<span class="w"> </span>zfs<span class="w"> </span>create<span class="w"> </span>mypool/data

<span class="c1"># Enable compression</span>
sudo<span class="w"> </span>zfs<span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="nv">compression</span><span class="o">=</span>lz4<span class="w"> </span>mypool/data

<span class="c1"># Create snapshot</span>
sudo<span class="w"> </span>zfs<span class="w"> </span>snapshot<span class="w"> </span>mypool/data@snapshot1
</pre></div>
</div>
</section>
<section id="fat32-and-ntfs">
<h4>FAT32 and NTFS<a class="headerlink" href="#fat32-and-ntfs" title="Link to this heading"></a></h4>
<p><strong>FAT32</strong>: Universal compatibility, limited file size (4GB max)
<strong>NTFS</strong>: Windows filesystem with advanced features</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create FAT32 filesystem</span>
sudo<span class="w"> </span>mkfs.fat<span class="w"> </span>-F32<span class="w"> </span>/dev/sdb1

<span class="c1"># Create NTFS filesystem</span>
sudo<span class="w"> </span>mkfs.ntfs<span class="w"> </span>/dev/sdb1

<span class="c1"># Mount NTFS with full permissions</span>
sudo<span class="w"> </span>mount<span class="w"> </span>-t<span class="w"> </span>ntfs-3g<span class="w"> </span>/dev/sdb1<span class="w"> </span>/mnt/ntfs<span class="w"> </span>-o<span class="w"> </span>permissions
</pre></div>
</div>
</section>
</section>
<section id="file-system-operations-in-ubuntu-22-04">
<h3>File System Operations in Ubuntu 22.04<a class="headerlink" href="#file-system-operations-in-ubuntu-22-04" title="Link to this heading"></a></h3>
<section id="creating-file-systems">
<h4>Creating File Systems<a class="headerlink" href="#creating-file-systems" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># ext4 with custom options</span>
sudo<span class="w"> </span>mkfs.ext4<span class="w"> </span>-L<span class="w"> </span><span class="s2">&quot;MyData&quot;</span><span class="w"> </span>-m<span class="w"> </span><span class="m">1</span><span class="w"> </span>/dev/sdb1

<span class="c1"># XFS with custom block size</span>
sudo<span class="w"> </span>mkfs.xfs<span class="w"> </span>-f<span class="w"> </span>-b<span class="w"> </span><span class="nv">size</span><span class="o">=</span><span class="m">4096</span><span class="w"> </span>/dev/sdb1

<span class="c1"># Btrfs with multiple devices (RAID)</span>
sudo<span class="w"> </span>mkfs.btrfs<span class="w"> </span>-d<span class="w"> </span>raid1<span class="w"> </span>-m<span class="w"> </span>raid1<span class="w"> </span>/dev/sdb1<span class="w"> </span>/dev/sdc1

<span class="c1"># Set filesystem label</span>
sudo<span class="w"> </span>e2label<span class="w"> </span>/dev/sdb1<span class="w"> </span><span class="s2">&quot;DataDisk&quot;</span>
</pre></div>
</div>
</section>
<section id="mounting-file-systems">
<h4>Mounting File Systems<a class="headerlink" href="#mounting-file-systems" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Basic mounting</span>
sudo<span class="w"> </span>mount<span class="w"> </span>/dev/sdb1<span class="w"> </span>/mnt/data

<span class="c1"># Mount with specific options</span>
sudo<span class="w"> </span>mount<span class="w"> </span>-o<span class="w"> </span>rw,noatime,discard<span class="w"> </span>/dev/sdb1<span class="w"> </span>/mnt/data

<span class="c1"># Mount by UUID (preferred method)</span>
sudo<span class="w"> </span>mount<span class="w"> </span><span class="nv">UUID</span><span class="o">=</span><span class="m">12345678</span>-1234-1234-1234-123456789abc<span class="w"> </span>/mnt/data

<span class="c1"># Mount with user permissions</span>
sudo<span class="w"> </span>mount<span class="w"> </span>-o<span class="w"> </span><span class="nv">uid</span><span class="o">=</span><span class="m">1000</span>,gid<span class="o">=</span><span class="m">1000</span><span class="w"> </span>/dev/sdb1<span class="w"> </span>/mnt/data
</pre></div>
</div>
</section>
<section id="checking-and-repairing-file-systems">
<h4>Checking and Repairing File Systems<a class="headerlink" href="#checking-and-repairing-file-systems" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check filesystem (read-only)</span>
sudo<span class="w"> </span>fsck<span class="w"> </span>-n<span class="w"> </span>/dev/sdb1

<span class="c1"># Automatic repair</span>
sudo<span class="w"> </span>fsck<span class="w"> </span>-p<span class="w"> </span>/dev/sdb1

<span class="c1"># Force check and repair</span>
sudo<span class="w"> </span>fsck<span class="w"> </span>-f<span class="w"> </span>/dev/sdb1

<span class="c1"># Check specific filesystem types</span>
sudo<span class="w"> </span>fsck.ext4<span class="w"> </span>/dev/sdb1
sudo<span class="w"> </span>xfs_check<span class="w"> </span>/dev/sdb1
sudo<span class="w"> </span>btrfs<span class="w"> </span>check<span class="w"> </span>/dev/sdb1
</pre></div>
</div>
</section>
</section>
<section id="file-system-monitoring">
<h3>File System Monitoring<a class="headerlink" href="#file-system-monitoring" title="Link to this heading"></a></h3>
<section id="monitoring-tools-and-commands">
<h4>Monitoring Tools and Commands<a class="headerlink" href="#monitoring-tools-and-commands" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Real-time filesystem usage</span>
watch<span class="w"> </span>df<span class="w"> </span>-h

<span class="c1"># Inode usage</span>
df<span class="w"> </span>-i

<span class="c1"># Detailed filesystem information</span>
stat<span class="w"> </span>-f<span class="w"> </span>/

<span class="c1"># Monitor filesystem I/O</span>
sudo<span class="w"> </span>iotop<span class="w"> </span>-o

<span class="c1"># Check filesystem fragmentation (ext4)</span>
sudo<span class="w"> </span>e4defrag<span class="w"> </span>-c<span class="w"> </span>/dev/sdb1

<span class="c1"># Btrfs filesystem usage</span>
sudo<span class="w"> </span>btrfs<span class="w"> </span>filesystem<span class="w"> </span>usage<span class="w"> </span>/mnt/btrfs
</pre></div>
</div>
</section>
</section>
<section id="frequently-asked-questions">
<h3>Frequently Asked Questions<a class="headerlink" href="#frequently-asked-questions" title="Link to this heading"></a></h3>
<section id="q-which-filesystem-should-i-choose-for-ubuntu-22-04">
<h4>Q: Which filesystem should I choose for Ubuntu 22.04?<a class="headerlink" href="#q-which-filesystem-should-i-choose-for-ubuntu-22-04" title="Link to this heading"></a></h4>
<p><strong>A:</strong> Filesystem selection depends on your use case:</p>
<ul class="simple">
<li><p><strong>ext4</strong>: Best general-purpose choice, default for Ubuntu</p></li>
<li><p><strong>XFS</strong>: Large files, databases, high-performance needs</p></li>
<li><p><strong>Btrfs</strong>: Need snapshots, compression, or advanced features</p></li>
<li><p><strong>ZFS</strong>: Enterprise features, data integrity critical</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># For most users (recommended)</span>
sudo<span class="w"> </span>mkfs.ext4<span class="w"> </span>/dev/sdb1

<span class="c1"># For large files and databases</span>
sudo<span class="w"> </span>mkfs.xfs<span class="w"> </span>/dev/sdb1

<span class="c1"># For snapshots and modern features</span>
sudo<span class="w"> </span>mkfs.btrfs<span class="w"> </span>/dev/sdb1
</pre></div>
</div>
</section>
<section id="q-how-do-i-convert-between-filesystems">
<h4>Q: How do I convert between filesystems?<a class="headerlink" href="#q-how-do-i-convert-between-filesystems" title="Link to this heading"></a></h4>
<p><strong>A:</strong> Filesystem conversion requires backup and restore:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. Backup data</span>
sudo<span class="w"> </span>rsync<span class="w"> </span>-av<span class="w"> </span>/mnt/source/<span class="w"> </span>/backup/

<span class="c1"># 2. Unmount and recreate filesystem</span>
sudo<span class="w"> </span>umount<span class="w"> </span>/mnt/source
sudo<span class="w"> </span>mkfs.ext4<span class="w"> </span>/dev/sdb1

<span class="c1"># 3. Mount and restore data</span>
sudo<span class="w"> </span>mount<span class="w"> </span>/dev/sdb1<span class="w"> </span>/mnt/source
sudo<span class="w"> </span>rsync<span class="w"> </span>-av<span class="w"> </span>/backup/<span class="w"> </span>/mnt/source/
</pre></div>
</div>
</section>
<section id="q-how-do-i-optimize-filesystem-performance">
<h4>Q: How do I optimize filesystem performance?<a class="headerlink" href="#q-how-do-i-optimize-filesystem-performance" title="Link to this heading"></a></h4>
<p><strong>A:</strong> Several optimization techniques:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># For SSDs - enable TRIM</span>
sudo<span class="w"> </span>mount<span class="w"> </span>-o<span class="w"> </span>discard<span class="w"> </span>/dev/sdb1<span class="w"> </span>/mnt/data

<span class="c1"># Disable access time updates</span>
sudo<span class="w"> </span>mount<span class="w"> </span>-o<span class="w"> </span>noatime<span class="w"> </span>/dev/sdb1<span class="w"> </span>/mnt/data

<span class="c1"># For databases - use direct I/O</span>
sudo<span class="w"> </span>mount<span class="w"> </span>-o<span class="w"> </span><span class="nv">barrier</span><span class="o">=</span><span class="m">0</span><span class="w"> </span>/dev/sdb1<span class="w"> </span>/mnt/database

<span class="c1"># Optimize ext4 for SSDs</span>
sudo<span class="w"> </span>tune2fs<span class="w"> </span>-o<span class="w"> </span>discard<span class="w"> </span>/dev/sdb1
</pre></div>
</div>
</section>
<section id="q-how-do-i-recover-deleted-files">
<h4>Q: How do I recover deleted files?<a class="headerlink" href="#q-how-do-i-recover-deleted-files" title="Link to this heading"></a></h4>
<p><strong>A:</strong> Recovery methods depend on the filesystem:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install recovery tools</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>testdisk<span class="w"> </span>photorec<span class="w"> </span>extundelete

<span class="c1"># For ext4 filesystems</span>
sudo<span class="w"> </span>extundelete<span class="w"> </span>/dev/sdb1<span class="w"> </span>--restore-all

<span class="c1"># General purpose recovery</span>
sudo<span class="w"> </span>photorec<span class="w"> </span>/dev/sdb1

<span class="c1"># For immediate action after deletion</span>
sudo<span class="w"> </span>grep<span class="w"> </span>-a<span class="w"> </span>-B25<span class="w"> </span>-A25<span class="w"> </span><span class="s1">&#39;text from deleted file&#39;</span><span class="w"> </span>/dev/sdb1
</pre></div>
</div>
</section>
</section>
<section id="coding-examples">
<h3>Coding Examples<a class="headerlink" href="#coding-examples" title="Link to this heading"></a></h3>
<section id="python-filesystem-analyzer">
<h4>Python Filesystem Analyzer<a class="headerlink" href="#python-filesystem-analyzer" title="Link to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Filesystem analyzer for Ubuntu 22.04</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="k">class</span><span class="w"> </span><span class="nc">FilesystemAnalyzer</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mountpoints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mountpoints</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_mountpoints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all mounted filesystems&quot;&quot;&quot;</span>
        <span class="n">mountpoints</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/proc/mounts&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;/dev/&#39;</span><span class="p">):</span>
                        <span class="n">mountpoints</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                            <span class="s1">&#39;device&#39;</span><span class="p">:</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                            <span class="s1">&#39;mountpoint&#39;</span><span class="p">:</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                            <span class="s1">&#39;filesystem&#39;</span><span class="p">:</span> <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                            <span class="s1">&#39;options&#39;</span><span class="p">:</span> <span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                        <span class="p">})</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error reading mount points: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">mountpoints</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">analyze_filesystem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Analyze filesystem usage and characteristics&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Get basic filesystem statistics</span>
            <span class="n">statvfs</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">statvfs</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

            <span class="n">total_size</span> <span class="o">=</span> <span class="n">statvfs</span><span class="o">.</span><span class="n">f_frsize</span> <span class="o">*</span> <span class="n">statvfs</span><span class="o">.</span><span class="n">f_blocks</span>
            <span class="n">free_size</span> <span class="o">=</span> <span class="n">statvfs</span><span class="o">.</span><span class="n">f_frsize</span> <span class="o">*</span> <span class="n">statvfs</span><span class="o">.</span><span class="n">f_bavail</span>
            <span class="n">used_size</span> <span class="o">=</span> <span class="n">total_size</span> <span class="o">-</span> <span class="n">free_size</span>

            <span class="c1"># Get inode information</span>
            <span class="n">total_inodes</span> <span class="o">=</span> <span class="n">statvfs</span><span class="o">.</span><span class="n">f_files</span>
            <span class="n">free_inodes</span> <span class="o">=</span> <span class="n">statvfs</span><span class="o">.</span><span class="n">f_favail</span>
            <span class="n">used_inodes</span> <span class="o">=</span> <span class="n">total_inodes</span> <span class="o">-</span> <span class="n">free_inodes</span>

            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">path</span><span class="p">,</span>
                <span class="s1">&#39;total_size_gb&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">total_size</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>
                <span class="s1">&#39;used_size_gb&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">used_size</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>
                <span class="s1">&#39;free_size_gb&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">free_size</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>
                <span class="s1">&#39;usage_percent&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">((</span><span class="n">used_size</span> <span class="o">/</span> <span class="n">total_size</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                <span class="s1">&#39;total_inodes&#39;</span><span class="p">:</span> <span class="n">total_inodes</span><span class="p">,</span>
                <span class="s1">&#39;used_inodes&#39;</span><span class="p">:</span> <span class="n">used_inodes</span><span class="p">,</span>
                <span class="s1">&#39;free_inodes&#39;</span><span class="p">:</span> <span class="n">free_inodes</span><span class="p">,</span>
                <span class="s1">&#39;inode_usage_percent&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">((</span><span class="n">used_inodes</span> <span class="o">/</span> <span class="n">total_inodes</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">total_inodes</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="p">}</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_largest_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">min_size_mb</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find largest files in a directory tree&quot;&quot;&quot;</span>
        <span class="n">large_files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">min_size_bytes</span> <span class="o">=</span> <span class="n">min_size_mb</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="c1"># Skip certain directories to avoid permission errors</span>
                <span class="n">dirs</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dirs</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">d</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">d</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;proc&#39;</span><span class="p">,</span> <span class="s1">&#39;sys&#39;</span><span class="p">,</span> <span class="s1">&#39;dev&#39;</span><span class="p">]]</span>

                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
                        <span class="n">file_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">file_size</span> <span class="o">&gt;=</span> <span class="n">min_size_bytes</span><span class="p">:</span>
                            <span class="n">large_files</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                                <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">file_path</span><span class="p">,</span>
                                <span class="s1">&#39;size_mb&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">file_size</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>
                                <span class="s1">&#39;size_gb&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">file_size</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
                            <span class="p">})</span>
                    <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">IOError</span><span class="p">):</span>
                        <span class="k">continue</span>  <span class="c1"># Skip files we can&#39;t access</span>

            <span class="c1"># Sort by size and return top files</span>
            <span class="n">large_files</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;size_mb&#39;</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">large_files</span><span class="p">[:</span><span class="n">count</span><span class="p">]</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[{</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_directory_sizes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get sizes of directories&quot;&quot;&quot;</span>
        <span class="n">directory_sizes</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;du&#39;</span><span class="p">,</span> <span class="s1">&#39;-h&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;--max-depth=</span><span class="si">{</span><span class="n">max_depth</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">],</span>
                                  <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">n&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">t&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">size</span><span class="p">,</span> <span class="n">dir_path</span> <span class="o">=</span> <span class="n">parts</span>
                        <span class="n">directory_sizes</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                            <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">dir_path</span><span class="p">,</span>
                            <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">size</span>
                        <span class="p">})</span>

            <span class="k">return</span> <span class="n">directory_sizes</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[{</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_filesystem_health</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check filesystem health using fsck&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Run read-only check</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;fsck&#39;</span><span class="p">,</span> <span class="s1">&#39;-n&#39;</span><span class="p">,</span> <span class="n">device</span><span class="p">],</span>
                                  <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;device&#39;</span><span class="p">:</span> <span class="n">device</span><span class="p">,</span>
                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;clean&#39;</span> <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;errors_found&#39;</span><span class="p">,</span>
                <span class="s1">&#39;output&#39;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span>
                <span class="s1">&#39;errors&#39;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">stderr</span>
            <span class="p">}</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;device&#39;</span><span class="p">:</span> <span class="n">device</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">monitor_filesystem_performance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Monitor filesystem I/O performance&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Start iostat monitoring</span>
            <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s1">&#39;iostat&#39;</span><span class="p">,</span> <span class="s1">&#39;-x&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">duration</span><span class="p">)],</span>
                                     <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                                     <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                                     <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">output</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>

            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;duration&#39;</span><span class="p">:</span> <span class="n">duration</span><span class="p">,</span>
                <span class="s1">&#39;iostat_output&#39;</span><span class="p">:</span> <span class="n">output</span><span class="p">,</span>
                <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="n">error</span> <span class="k">if</span> <span class="n">error</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="p">}</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate comprehensive filesystem report&quot;&quot;&quot;</span>
        <span class="n">report</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">),</span>
            <span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">uname</span><span class="p">()</span><span class="o">.</span><span class="n">nodename</span><span class="p">,</span>
            <span class="s1">&#39;mountpoints&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mountpoints</span><span class="p">,</span>
            <span class="s1">&#39;filesystem_analysis&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;large_files&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;directory_sizes&#39;</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>

        <span class="c1"># Analyze each mounted filesystem</span>
        <span class="k">for</span> <span class="n">mount</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mountpoints</span><span class="p">:</span>
            <span class="n">analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_filesystem</span><span class="p">(</span><span class="n">mount</span><span class="p">[</span><span class="s1">&#39;mountpoint&#39;</span><span class="p">])</span>
            <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;device&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mount</span><span class="p">[</span><span class="s1">&#39;device&#39;</span><span class="p">]</span>
            <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;filesystem_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mount</span><span class="p">[</span><span class="s1">&#39;filesystem&#39;</span><span class="p">]</span>
            <span class="n">report</span><span class="p">[</span><span class="s1">&#39;filesystem_analysis&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">analysis</span><span class="p">)</span>

        <span class="c1"># Find large files in home and var directories</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;/home&#39;</span><span class="p">,</span> <span class="s1">&#39;/var&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="n">large_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_largest_files</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">min_size_mb</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
                <span class="n">report</span><span class="p">[</span><span class="s1">&#39;large_files&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">large_files</span><span class="p">)</span>

        <span class="c1"># Get directory sizes for common directories</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;/home&#39;</span><span class="p">,</span> <span class="s1">&#39;/var&#39;</span><span class="p">,</span> <span class="s1">&#39;/usr&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="n">dir_sizes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_directory_sizes</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">report</span><span class="p">[</span><span class="s1">&#39;directory_sizes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">dir_sizes</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">report</span>

<span class="c1"># Example usage</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">analyzer</span> <span class="o">=</span> <span class="n">FilesystemAnalyzer</span><span class="p">()</span>

    <span class="c1"># Generate and display report</span>
    <span class="n">report</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">generate_report</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">report</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

    <span class="c1"># Save report to file</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;/tmp/filesystem_report_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span><span class="si">}</span><span class="s1">.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">report</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="bash-filesystem-management-script">
<h4>Bash Filesystem Management Script<a class="headerlink" href="#bash-filesystem-management-script" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1"># filesystem_manager.sh - Comprehensive filesystem management for Ubuntu 22.04</span>

<span class="c1"># Configuration</span>
<span class="nv">BACKUP_DIR</span><span class="o">=</span><span class="s2">&quot;/backup&quot;</span>
<span class="nv">LOG_FILE</span><span class="o">=</span><span class="s2">&quot;/var/log/filesystem_manager.log&quot;</span>

<span class="c1"># Colors</span>
<span class="nv">RED</span><span class="o">=</span><span class="s1">&#39;\033[0;31m&#39;</span>
<span class="nv">GREEN</span><span class="o">=</span><span class="s1">&#39;\033[0;32m&#39;</span>
<span class="nv">YELLOW</span><span class="o">=</span><span class="s1">&#39;\033[1;33m&#39;</span>
<span class="nv">BLUE</span><span class="o">=</span><span class="s1">&#39;\033[0;34m&#39;</span>
<span class="nv">NC</span><span class="o">=</span><span class="s1">&#39;\033[0m&#39;</span>

<span class="c1"># Logging function</span>
log_message<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>date<span class="w"> </span><span class="s1">&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span class="k">)</span><span class="s2"> - </span><span class="nv">$1</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LOG_FILE</span><span class="s2">&quot;</span>
<span class="o">}</span>

<span class="c1"># Check if running as root</span>
check_root<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$EUID</span><span class="w"> </span>-ne<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">RED</span><span class="si">}</span><span class="s2">This script must be run as root</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>
<span class="o">}</span>

<span class="c1"># Display filesystem information</span>
show_filesystem_info<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BLUE</span><span class="si">}</span><span class="s2">=== Filesystem Information ===</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Mounted Filesystems:&quot;</span>
<span class="w">    </span>df<span class="w"> </span>-hT<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-v<span class="w"> </span>tmpfs
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Filesystem Types:&quot;</span>
<span class="w">    </span>lsblk<span class="w"> </span>-f
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Mount Points:&quot;</span>
<span class="w">    </span>mount<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;^/dev&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>column<span class="w"> </span>-t
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="o">}</span>

<span class="c1"># Create filesystem with optimal settings</span>
create_filesystem<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">device</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">fstype</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">label</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$3</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$fstype</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Usage: create_filesystem &lt;device&gt; &lt;filesystem_type&gt; [label]&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Supported types: ext4, xfs, btrfs&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">YELLOW</span><span class="si">}</span><span class="s2">Creating </span><span class="nv">$fstype</span><span class="s2"> filesystem on </span><span class="nv">$device</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$fstype</span><span class="s2">&quot;</span><span class="w"> </span><span class="k">in</span>
<span class="w">        </span><span class="s2">&quot;ext4&quot;</span><span class="o">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$label</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span>mkfs.ext4<span class="w"> </span>-L<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$label</span><span class="s2">&quot;</span><span class="w"> </span>-m<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">                </span>mkfs.ext4<span class="w"> </span>-m<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="k">fi</span>

<span class="w">            </span><span class="c1"># Optimize for SSD if detected</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="k">$(</span>cat<span class="w"> </span>/sys/block/<span class="k">$(</span>basename<span class="w"> </span><span class="nv">$device</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s1">&#39;s/[0-9]*$//&#39;</span><span class="k">)</span>/queue/rotational<span class="k">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span>tune2fs<span class="w"> </span>-o<span class="w"> </span>discard<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;SSD optimizations applied&quot;</span>
<span class="w">            </span><span class="k">fi</span>
<span class="w">            </span><span class="p">;;</span>

<span class="w">        </span><span class="s2">&quot;xfs&quot;</span><span class="o">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$label</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span>mkfs.xfs<span class="w"> </span>-f<span class="w"> </span>-L<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$label</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">                </span>mkfs.xfs<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="k">fi</span>
<span class="w">            </span><span class="p">;;</span>

<span class="w">        </span><span class="s2">&quot;btrfs&quot;</span><span class="o">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$label</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span>mkfs.btrfs<span class="w"> </span>-f<span class="w"> </span>-L<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$label</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">                </span>mkfs.btrfs<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="k">fi</span>
<span class="w">            </span><span class="p">;;</span>

<span class="w">        </span>*<span class="o">)</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">RED</span><span class="si">}</span><span class="s2">Unsupported filesystem type: </span><span class="nv">$fstype</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">    </span><span class="k">esac</span>

<span class="w">    </span>log_message<span class="w"> </span><span class="s2">&quot;Created </span><span class="nv">$fstype</span><span class="s2"> filesystem on </span><span class="nv">$device</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="s2">Filesystem created successfully</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="o">}</span>

<span class="c1"># Mount filesystem with optimal options</span>
mount_filesystem<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">device</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">mountpoint</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">fstype</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$3</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$mountpoint</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Usage: mount_filesystem &lt;device&gt; &lt;mountpoint&gt; [filesystem_type]&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="c1"># Create mountpoint if it doesn&#39;t exist</span>
<span class="w">    </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$mountpoint</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="c1"># Detect filesystem type if not provided</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$fstype</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nv">fstype</span><span class="o">=</span><span class="k">$(</span>blkid<span class="w"> </span>-o<span class="w"> </span>value<span class="w"> </span>-s<span class="w"> </span>TYPE<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="k">)</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="c1"># Set optimal mount options based on filesystem type</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$fstype</span><span class="s2">&quot;</span><span class="w"> </span><span class="k">in</span>
<span class="w">        </span><span class="s2">&quot;ext4&quot;</span><span class="o">)</span>
<span class="w">            </span><span class="nv">mount_options</span><span class="o">=</span><span class="s2">&quot;defaults,noatime&quot;</span>
<span class="w">            </span><span class="c1"># Add discard for SSDs</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="k">$(</span>cat<span class="w"> </span>/sys/block/<span class="k">$(</span>basename<span class="w"> </span><span class="nv">$device</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s1">&#39;s/[0-9]*$//&#39;</span><span class="k">)</span>/queue/rotational<span class="k">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span><span class="nv">mount_options</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$mount_options</span><span class="s2">,discard&quot;</span>
<span class="w">            </span><span class="k">fi</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">        </span><span class="s2">&quot;xfs&quot;</span><span class="o">)</span>
<span class="w">            </span><span class="nv">mount_options</span><span class="o">=</span><span class="s2">&quot;defaults,noatime&quot;</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">        </span><span class="s2">&quot;btrfs&quot;</span><span class="o">)</span>
<span class="w">            </span><span class="nv">mount_options</span><span class="o">=</span><span class="s2">&quot;defaults,noatime,compress=zstd&quot;</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">        </span>*<span class="o">)</span>
<span class="w">            </span><span class="nv">mount_options</span><span class="o">=</span><span class="s2">&quot;defaults&quot;</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">    </span><span class="k">esac</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">YELLOW</span><span class="si">}</span><span class="s2">Mounting </span><span class="nv">$device</span><span class="s2"> at </span><span class="nv">$mountpoint</span><span class="s2"> with options: </span><span class="nv">$mount_options</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span>mount<span class="w"> </span>-o<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$mount_options</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$mountpoint</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span>log_message<span class="w"> </span><span class="s2">&quot;Mounted </span><span class="nv">$device</span><span class="s2"> at </span><span class="nv">$mountpoint</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="s2">Filesystem mounted successfully</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="w">        </span><span class="c1"># Add to fstab for permanent mounting</span>
<span class="w">        </span><span class="nv">uuid</span><span class="o">=</span><span class="k">$(</span>blkid<span class="w"> </span>-o<span class="w"> </span>value<span class="w"> </span>-s<span class="w"> </span>UUID<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="k">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$uuid</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;UUID=</span><span class="nv">$uuid</span><span class="s2"> </span><span class="nv">$mountpoint</span><span class="s2"> </span><span class="nv">$fstype</span><span class="s2"> </span><span class="nv">$mount_options</span><span class="s2"> 0 2&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/fstab
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Added to /etc/fstab for automatic mounting&quot;</span>
<span class="w">        </span><span class="k">fi</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">RED</span><span class="si">}</span><span class="s2">Failed to mount filesystem</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>
<span class="o">}</span>

<span class="c1"># Check filesystem health</span>
check_filesystem_health<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">device</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Usage: check_filesystem_health &lt;device&gt;&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BLUE</span><span class="si">}</span><span class="s2">=== Checking filesystem health for </span><span class="nv">$device</span><span class="s2"> ===</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="c1"># Get filesystem type</span>
<span class="w">    </span><span class="nv">fstype</span><span class="o">=</span><span class="k">$(</span>blkid<span class="w"> </span>-o<span class="w"> </span>value<span class="w"> </span>-s<span class="w"> </span>TYPE<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="k">)</span>

<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$fstype</span><span class="s2">&quot;</span><span class="w"> </span><span class="k">in</span>
<span class="w">        </span><span class="s2">&quot;ext4&quot;</span><span class="p">|</span><span class="s2">&quot;ext3&quot;</span><span class="p">|</span><span class="s2">&quot;ext2&quot;</span><span class="o">)</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Running fsck for ext filesystem...&quot;</span>
<span class="w">            </span>fsck.ext4<span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">        </span><span class="s2">&quot;xfs&quot;</span><span class="o">)</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Running xfs_check...&quot;</span>
<span class="w">            </span>xfs_check<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">        </span><span class="s2">&quot;btrfs&quot;</span><span class="o">)</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Running btrfs check...&quot;</span>
<span class="w">            </span>btrfs<span class="w"> </span>check<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">        </span>*<span class="o">)</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Running generic fsck...&quot;</span>
<span class="w">            </span>fsck<span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">    </span><span class="k">esac</span>

<span class="w">    </span>log_message<span class="w"> </span><span class="s2">&quot;Filesystem health check completed for </span><span class="nv">$device</span><span class="s2">&quot;</span>
<span class="o">}</span>

<span class="c1"># Optimize filesystem performance</span>
optimize_filesystem<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">mountpoint</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$mountpoint</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Usage: optimize_filesystem &lt;mountpoint&gt;&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BLUE</span><span class="si">}</span><span class="s2">=== Optimizing filesystem at </span><span class="nv">$mountpoint</span><span class="s2"> ===</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="c1"># Get device and filesystem type</span>
<span class="w">    </span><span class="nv">device</span><span class="o">=</span><span class="k">$(</span>df<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$mountpoint</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-1<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $1}&#39;</span><span class="k">)</span>
<span class="w">    </span><span class="nv">fstype</span><span class="o">=</span><span class="k">$(</span>df<span class="w"> </span>-T<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$mountpoint</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-1<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $2}&#39;</span><span class="k">)</span>

<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$fstype</span><span class="s2">&quot;</span><span class="w"> </span><span class="k">in</span>
<span class="w">        </span><span class="s2">&quot;ext4&quot;</span><span class="o">)</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Optimizing ext4 filesystem...&quot;</span>

<span class="w">            </span><span class="c1"># Defragment if needed</span>
<span class="w">            </span>e4defrag<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$mountpoint</span><span class="s2">&quot;</span>

<span class="w">            </span><span class="c1"># Optimize inode allocation</span>
<span class="w">            </span>tune2fs<span class="w"> </span>-o<span class="w"> </span>journal_data_writeback<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span>

<span class="w">            </span><span class="c1"># Enable TRIM for SSDs</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="k">$(</span>cat<span class="w"> </span>/sys/block/<span class="k">$(</span>basename<span class="w"> </span><span class="nv">$device</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s1">&#39;s/[0-9]*$//&#39;</span><span class="k">)</span>/queue/rotational<span class="k">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span>tune2fs<span class="w"> </span>-o<span class="w"> </span>discard<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;SSD optimizations applied&quot;</span>
<span class="w">            </span><span class="k">fi</span>
<span class="w">            </span><span class="p">;;</span>

<span class="w">        </span><span class="s2">&quot;xfs&quot;</span><span class="o">)</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Optimizing XFS filesystem...&quot;</span>

<span class="w">            </span><span class="c1"># XFS is generally well-optimized by default</span>
<span class="w">            </span><span class="c1"># Check if online defragmentation is needed</span>
<span class="w">            </span>xfs_fsr<span class="w"> </span>-v<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$mountpoint</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="p">;;</span>

<span class="w">        </span><span class="s2">&quot;btrfs&quot;</span><span class="o">)</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Optimizing Btrfs filesystem...&quot;</span>

<span class="w">            </span><span class="c1"># Balance filesystem</span>
<span class="w">            </span>btrfs<span class="w"> </span>balance<span class="w"> </span>start<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$mountpoint</span><span class="s2">&quot;</span>

<span class="w">            </span><span class="c1"># Defragment</span>
<span class="w">            </span>btrfs<span class="w"> </span>filesystem<span class="w"> </span>defragment<span class="w"> </span>-r<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$mountpoint</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">    </span><span class="k">esac</span>

<span class="w">    </span>log_message<span class="w"> </span><span class="s2">&quot;Filesystem optimization completed for </span><span class="nv">$mountpoint</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="s2">Optimization completed</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="o">}</span>

<span class="c1"># Backup filesystem</span>
backup_filesystem<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">source</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">backup_name</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$source</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Usage: backup_filesystem &lt;source_mountpoint&gt; [backup_name]&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$backup_name</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nv">backup_name</span><span class="o">=</span><span class="s2">&quot;filesystem_backup_</span><span class="k">$(</span>date<span class="w"> </span>+%Y%m%d_%H%M%S<span class="k">)</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="nv">backup_path</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$BACKUP_DIR</span><span class="s2">/</span><span class="nv">$backup_name</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">YELLOW</span><span class="si">}</span><span class="s2">Creating backup of </span><span class="nv">$source</span><span class="s2"> to </span><span class="nv">$backup_path</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="c1"># Create backup directory</span>
<span class="w">    </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$backup_path</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="c1"># Use rsync for efficient backup</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span>rsync<span class="w"> </span>-avH<span class="w"> </span>--progress<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$source</span><span class="s2">/&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$backup_path</span><span class="s2">/&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span>log_message<span class="w"> </span><span class="s2">&quot;Backup created: </span><span class="nv">$source</span><span class="s2"> -&gt; </span><span class="nv">$backup_path</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="s2">Backup completed successfully</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="w">        </span><span class="c1"># Create metadata file</span>
<span class="w">        </span>cat<span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$backup_path</span><span class="s2">/.backup_info&quot;</span><span class="w"> </span><span class="s">&lt;&lt; EOF</span>
<span class="s">Source: $source</span>
<span class="s">Backup Date: $(date)</span>
<span class="s">Backup Size: $(du -sh &quot;$backup_path&quot; | cut -f1)</span>
<span class="s">EOF</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">RED</span><span class="si">}</span><span class="s2">Backup failed</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>
<span class="o">}</span>

<span class="c1"># Monitor filesystem usage</span>
monitor_filesystem<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BLUE</span><span class="si">}</span><span class="s2">=== Filesystem Usage Monitor ===</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="k">while</span><span class="w"> </span>true<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">        </span>clear
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Filesystem Usage (updated every 5 seconds) - Press Ctrl+C to exit&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;================================================================&quot;</span>

<span class="w">        </span>df<span class="w"> </span>-h<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;^Filesystem|^/dev&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>

<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;I/O Statistics:&quot;</span>
<span class="w">        </span>iostat<span class="w"> </span>-x<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-n<span class="w"> </span>+4
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>

<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Top 5 largest directories in /:&quot;</span>
<span class="w">        </span>du<span class="w"> </span>-h<span class="w"> </span>--max-depth<span class="o">=</span><span class="m">1</span><span class="w"> </span>/<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-hr<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-5

<span class="w">        </span>sleep<span class="w"> </span><span class="m">5</span>
<span class="w">    </span><span class="k">done</span>
<span class="o">}</span>

<span class="c1"># Main menu</span>
<span class="k">case</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">1</span><span class="k">:-</span><span class="nv">help</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="k">in</span>
<span class="w">    </span><span class="s2">&quot;info&quot;</span><span class="o">)</span>
<span class="w">        </span>show_filesystem_info
<span class="w">        </span><span class="p">;;</span>
<span class="w">    </span><span class="s2">&quot;create&quot;</span><span class="o">)</span>
<span class="w">        </span>check_root
<span class="w">        </span>create_filesystem<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$3</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$4</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="p">;;</span>
<span class="w">    </span><span class="s2">&quot;mount&quot;</span><span class="o">)</span>
<span class="w">        </span>check_root
<span class="w">        </span>mount_filesystem<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$3</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$4</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="p">;;</span>
<span class="w">    </span><span class="s2">&quot;check&quot;</span><span class="o">)</span>
<span class="w">        </span>check_root
<span class="w">        </span>check_filesystem_health<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="p">;;</span>
<span class="w">    </span><span class="s2">&quot;optimize&quot;</span><span class="o">)</span>
<span class="w">        </span>check_root
<span class="w">        </span>optimize_filesystem<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="p">;;</span>
<span class="w">    </span><span class="s2">&quot;backup&quot;</span><span class="o">)</span>
<span class="w">        </span>check_root
<span class="w">        </span>backup_filesystem<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$3</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="p">;;</span>
<span class="w">    </span><span class="s2">&quot;monitor&quot;</span><span class="o">)</span>
<span class="w">        </span>monitor_filesystem
<span class="w">        </span><span class="p">;;</span>
<span class="w">    </span><span class="s2">&quot;help&quot;</span><span class="p">|</span>*<span class="o">)</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Filesystem Manager for Ubuntu 22.04&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Usage: </span><span class="nv">$0</span><span class="s2"> [command] [options]&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Commands:&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  info                          - Show filesystem information&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  create &lt;device&gt; &lt;type&gt; [label] - Create filesystem&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  mount &lt;device&gt; &lt;mountpoint&gt;   - Mount filesystem with optimal options&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  check &lt;device&gt;                - Check filesystem health&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  optimize &lt;mountpoint&gt;         - Optimize filesystem performance&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  backup &lt;source&gt; [name]        - Backup filesystem&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  monitor                       - Monitor filesystem usage&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Supported filesystem types: ext4, xfs, btrfs&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Examples:&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  </span><span class="nv">$0</span><span class="s2"> create /dev/sdb1 ext4 MyData&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  </span><span class="nv">$0</span><span class="s2"> mount /dev/sdb1 /mnt/data&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  </span><span class="nv">$0</span><span class="s2"> check /dev/sdb1&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  </span><span class="nv">$0</span><span class="s2"> optimize /home&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  </span><span class="nv">$0</span><span class="s2"> backup /home home_backup&quot;</span>
<span class="w">        </span><span class="p">;;</span>
<span class="k">esac</span>
</pre></div>
</div>
</section>
</section>
<section id="best-practices-for-file-systems">
<h3>Best Practices for File Systems<a class="headerlink" href="#best-practices-for-file-systems" title="Link to this heading"></a></h3>
<section id="choosing-the-right-filesystem">
<h4>Choosing the Right Filesystem<a class="headerlink" href="#choosing-the-right-filesystem" title="Link to this heading"></a></h4>
<p><strong>Decision Matrix:</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Use Case                    | Recommended Filesystem
----------------------------|----------------------
General desktop/server      | ext4
Large files/databases       | XFS
Snapshots/modern features   | Btrfs
Maximum data integrity      | ZFS
Cross-platform compatibility| FAT32/NTFS
High-performance computing  | XFS or ext4
</pre></div>
</div>
</section>
<section id="performance-optimization">
<h4>Performance Optimization<a class="headerlink" href="#performance-optimization" title="Link to this heading"></a></h4>
<ol class="arabic">
<li><p><strong>Mount Options</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># For general use</span>
mount<span class="w"> </span>-o<span class="w"> </span>defaults,noatime<span class="w"> </span>/dev/sdb1<span class="w"> </span>/mnt/data

<span class="c1"># For SSDs</span>
mount<span class="w"> </span>-o<span class="w"> </span>defaults,noatime,discard<span class="w"> </span>/dev/sdb1<span class="w"> </span>/mnt/data

<span class="c1"># For databases</span>
mount<span class="w"> </span>-o<span class="w"> </span>defaults,noatime,barrier<span class="o">=</span><span class="m">0</span><span class="w"> </span>/dev/sdb1<span class="w"> </span>/mnt/database
</pre></div>
</div>
</li>
<li><p><strong>I/O Scheduler</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># For SSDs</span>
<span class="nb">echo</span><span class="w"> </span>none<span class="w"> </span>&gt;<span class="w"> </span>/sys/block/sda/queue/scheduler

<span class="c1"># For HDDs</span>
<span class="nb">echo</span><span class="w"> </span>mq-deadline<span class="w"> </span>&gt;<span class="w"> </span>/sys/block/sda/queue/scheduler
</pre></div>
</div>
</li>
<li><p><strong>Filesystem Tuning</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Optimize ext4 for SSDs</span>
tune2fs<span class="w"> </span>-o<span class="w"> </span>discard<span class="w"> </span>/dev/sda1

<span class="c1"># Reduce reserved space (ext4)</span>
tune2fs<span class="w"> </span>-m<span class="w"> </span><span class="m">1</span><span class="w"> </span>/dev/sda1
</pre></div>
</div>
</li>
</ol>
</section>
<section id="security-and-maintenance">
<h4>Security and Maintenance<a class="headerlink" href="#security-and-maintenance" title="Link to this heading"></a></h4>
<ol class="arabic">
<li><p><strong>Regular Checks</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Schedule regular filesystem checks</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;0 3 * * 0 /sbin/fsck -A -f&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/crontab
</pre></div>
</div>
</li>
<li><p><strong>Backup Strategy</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Automated backups</span>
rsync<span class="w"> </span>-avH<span class="w"> </span>/home/<span class="w"> </span>/backup/home/

<span class="c1"># Filesystem snapshots (Btrfs)</span>
btrfs<span class="w"> </span>subvolume<span class="w"> </span>snapshot<span class="w"> </span>/home<span class="w"> </span>/home/.snapshots/<span class="k">$(</span>date<span class="w"> </span>+%Y%m%d<span class="k">)</span>
</pre></div>
</div>
</li>
<li><p><strong>Monitoring</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set up disk usage alerts</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;df -h | awk &#39;NR&gt;1 {if(\$5+0 &gt; 85) print \$0}&#39; | mail -s &#39;Disk Alert&#39; admin@example.com&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>crontab<span class="w"> </span>-
</pre></div>
</div>
</li>
</ol>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="disk-management.html" class="btn btn-neutral float-left" title="Disk Management" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="data-organization.html" class="btn btn-neutral float-right" title="Data Organization" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Rameshkumar T S.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>