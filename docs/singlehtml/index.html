

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Storage Systems and Data Management Guide 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=e731e1b3"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="#" class="icon icon-home">
            Storage Systems and Data Management Guide
          </a>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Storage Fundamentals:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="#document-storage-overview">Storage Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-disk-management">Disk Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-file-systems">File Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-data-organization">Data Organization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced Storage Concepts:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="#document-raid-systems">RAID Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-network-storage">Network Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-volume-management">Volume Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-storage-devices">Storage Devices</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Practical Implementation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="#document-ubuntu-setup">Ubuntu 22.04 Setup and Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-coding-examples">Coding Examples and Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-troubleshooting">Troubleshooting Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-best-practices">Best Practices and Guidelines</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Resources:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="#document-glossary">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-glossary#common-command-abbreviations">Common Command Abbreviations</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-glossary#storage-unit-definitions">Storage Unit Definitions</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-glossary#performance-metrics">Performance Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-glossary#raid-levels-reference">RAID Levels Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-glossary#network-storage-protocols">Network Storage Protocols</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-glossary#file-system-features">File System Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-faq">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-downloads">Downloads and Resources</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">Storage Systems and Data Management Guide</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="#" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Storage Systems and Data Management Guide 1.0 documentation</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="storage-systems-and-data-management-guide">
<h1>Storage Systems and Data Management Guide<a class="headerlink" href="#storage-systems-and-data-management-guide" title="Link to this heading"></a></h1>
<p>Welcome to the comprehensive Storage Systems and Data Management Guide! This documentation covers everything you need to know about storage technologies, disk management, file systems, and data organization on Ubuntu 22.04 LTS.</p>
<div class="toctree-wrapper compound">
<span id="document-storage-overview"></span><section id="storage-overview">
<h2>Storage Overview<a class="headerlink" href="#storage-overview" title="Link to this heading"></a></h2>
<section id="introduction-to-storage-systems">
<h3>Introduction to Storage Systems<a class="headerlink" href="#introduction-to-storage-systems" title="Link to this heading"></a></h3>
<p>Storage systems are fundamental components of any computing environment. They provide persistent data storage, enabling programs and users to save, retrieve, and manage information efficiently.</p>
<section id="what-is-storage">
<h4>What is Storage?<a class="headerlink" href="#what-is-storage" title="Link to this heading"></a></h4>
<p>Storage refers to the various technologies and devices used to hold digital data persistently. Unlike volatile memory (RAM), storage retains data even when power is removed from the system.</p>
</section>
<section id="types-of-storage">
<h4>Types of Storage<a class="headerlink" href="#types-of-storage" title="Link to this heading"></a></h4>
<section id="primary-storage-categories">
<h5>Primary Storage Categories<a class="headerlink" href="#primary-storage-categories" title="Link to this heading"></a></h5>
<ol class="arabic simple">
<li><p><strong>Primary Storage</strong>: Direct access storage (RAM, Cache)</p></li>
<li><p><strong>Secondary Storage</strong>: Persistent storage (Hard drives, SSDs)</p></li>
<li><p><strong>Tertiary Storage</strong>: Archival storage (Tape drives, Optical storage)</p></li>
<li><p><strong>Network Storage</strong>: Remote storage accessed over networks</p></li>
</ol>
</section>
</section>
<section id="storage-hierarchy">
<h4>Storage Hierarchy<a class="headerlink" href="#storage-hierarchy" title="Link to this heading"></a></h4>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>CPU Registers (fastest, smallest)
↓
Cache Memory (L1, L2, L3)
↓
Main Memory (RAM)
↓
Secondary Storage (SSD, HDD)
↓
Network Storage (NAS, SAN)
↓
Archival Storage (slowest, largest)
</pre></div>
</div>
</section>
<section id="ubuntu-22-04-storage-commands">
<h4>Ubuntu 22.04 Storage Commands<a class="headerlink" href="#ubuntu-22-04-storage-commands" title="Link to this heading"></a></h4>
<section id="basic-storage-information-commands">
<h5>Basic Storage Information Commands<a class="headerlink" href="#basic-storage-information-commands" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check disk usage</span>
df<span class="w"> </span>-h

<span class="c1"># Display detailed disk usage</span>
du<span class="w"> </span>-sh<span class="w"> </span>/home/*

<span class="c1"># List block devices</span>
lsblk

<span class="c1"># Show partition table</span>
sudo<span class="w"> </span>fdisk<span class="w"> </span>-l

<span class="c1"># Display mounted filesystems</span>
mount<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;^/dev&quot;</span>

<span class="c1"># Check filesystem usage</span>
sudo<span class="w"> </span>du<span class="w"> </span>-h<span class="w"> </span>--max-depth<span class="o">=</span><span class="m">1</span><span class="w"> </span>/
</pre></div>
</div>
</section>
<section id="storage-performance-monitoring">
<h5>Storage Performance Monitoring<a class="headerlink" href="#storage-performance-monitoring" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Monitor I/O statistics</span>
iostat<span class="w"> </span>-x<span class="w"> </span><span class="m">1</span>

<span class="c1"># Watch disk activity</span>
sudo<span class="w"> </span>iotop

<span class="c1"># Check disk performance</span>
sudo<span class="w"> </span>hdparm<span class="w"> </span>-Tt<span class="w"> </span>/dev/sda

<span class="c1"># Monitor filesystem usage in real-time</span>
watch<span class="w"> </span>df<span class="w"> </span>-h
</pre></div>
</div>
</section>
</section>
<section id="frequently-asked-questions">
<h4>Frequently Asked Questions<a class="headerlink" href="#frequently-asked-questions" title="Link to this heading"></a></h4>
<section id="q-what-s-the-difference-between-storage-and-memory">
<h5>Q: What’s the difference between storage and memory?<a class="headerlink" href="#q-what-s-the-difference-between-storage-and-memory" title="Link to this heading"></a></h5>
<p><strong>A:</strong> Memory (RAM) is volatile and provides temporary storage for currently running programs. Storage is non-volatile and provides permanent data storage that persists when the system is powered off.</p>
</section>
<section id="q-how-do-i-check-available-storage-space-on-ubuntu-22-04">
<h5>Q: How do I check available storage space on Ubuntu 22.04?<a class="headerlink" href="#q-how-do-i-check-available-storage-space-on-ubuntu-22-04" title="Link to this heading"></a></h5>
<p><strong>A:</strong> Use the following commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Human-readable format</span>
df<span class="w"> </span>-h

<span class="c1"># Show inodes usage</span>
df<span class="w"> </span>-i

<span class="c1"># Specific filesystem</span>
df<span class="w"> </span>-h<span class="w"> </span>/home
</pre></div>
</div>
</section>
<section id="q-what-storage-types-are-best-for-different-use-cases">
<h5>Q: What storage types are best for different use cases?<a class="headerlink" href="#q-what-storage-types-are-best-for-different-use-cases" title="Link to this heading"></a></h5>
<p><strong>A:</strong></p>
<ul class="simple">
<li><p><strong>SSDs</strong>: Best for operating systems, applications, and frequently accessed data</p></li>
<li><p><strong>HDDs</strong>: Ideal for bulk storage, backups, and archival data</p></li>
<li><p><strong>NVMe SSDs</strong>: Perfect for high-performance applications and databases</p></li>
<li><p><strong>Network Storage</strong>: Suitable for shared data and centralized management</p></li>
</ul>
</section>
<section id="q-how-can-i-optimize-storage-performance-on-ubuntu">
<h5>Q: How can I optimize storage performance on Ubuntu?<a class="headerlink" href="#q-how-can-i-optimize-storage-performance-on-ubuntu" title="Link to this heading"></a></h5>
<p><strong>A:</strong> Several optimization techniques:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Enable TRIM for SSDs</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>fstrim.timer

<span class="c1"># Optimize filesystem for SSDs</span>
sudo<span class="w"> </span>tune2fs<span class="w"> </span>-o<span class="w"> </span>discard<span class="w"> </span>/dev/sda1

<span class="c1"># Mount with noatime option (in /etc/fstab)</span>
<span class="c1"># /dev/sda1 / ext4 defaults,noatime 0 1</span>

<span class="c1"># Use appropriate I/O scheduler</span>
<span class="nb">echo</span><span class="w"> </span>noop<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/sys/block/sda/queue/scheduler
</pre></div>
</div>
</section>
</section>
<section id="coding-examples">
<h4>Coding Examples<a class="headerlink" href="#coding-examples" title="Link to this heading"></a></h4>
<section id="python-storage-monitoring-script">
<h5>Python Storage Monitoring Script<a class="headerlink" href="#python-storage-monitoring-script" title="Link to this heading"></a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Storage monitoring script for Ubuntu 22.04</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_disk_usage</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get disk usage information&quot;&quot;&quot;</span>
    <span class="n">usage</span> <span class="o">=</span> <span class="n">shutil</span><span class="o">.</span><span class="n">disk_usage</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="n">total</span> <span class="o">=</span> <span class="n">usage</span><span class="o">.</span><span class="n">total</span>
    <span class="n">used</span> <span class="o">=</span> <span class="n">usage</span><span class="o">.</span><span class="n">used</span>
    <span class="n">free</span> <span class="o">=</span> <span class="n">usage</span><span class="o">.</span><span class="n">free</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;total_gb&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">total</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>
        <span class="s1">&#39;used_gb&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">used</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>
        <span class="s1">&#39;free_gb&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">free</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>
        <span class="s1">&#39;usage_percent&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">((</span><span class="n">used</span> <span class="o">/</span> <span class="n">total</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_mounted_filesystems</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get list of mounted filesystems&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;mount&#39;</span><span class="p">],</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">filesystems</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;/dev/&#39;</span><span class="p">):</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">filesystems</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;device&#39;</span><span class="p">:</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="s1">&#39;mountpoint&#39;</span><span class="p">:</span> <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                    <span class="s1">&#39;filesystem&#39;</span><span class="p">:</span> <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span> <span class="k">else</span> <span class="s1">&#39;unknown&#39;</span>
                <span class="p">})</span>

    <span class="k">return</span> <span class="n">filesystems</span>

<span class="k">def</span><span class="w"> </span><span class="nf">monitor_io</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Monitor I/O statistics&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;iostat&#39;</span><span class="p">,</span> <span class="s1">&#39;-x&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">],</span>
                              <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;iostat not available. Install with: sudo apt install sysstat&quot;</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Storage System Monitor ===&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Disk Usage: </span><span class="si">{</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">get_disk_usage</span><span class="p">(),</span><span class="w"> </span><span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mounted Filesystems: </span><span class="si">{</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">get_mounted_filesystems</span><span class="p">(),</span><span class="w"> </span><span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I/O Statistics:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">monitor_io</span><span class="p">())</span>
</pre></div>
</div>
</section>
<section id="bash-storage-management-script">
<h5>Bash Storage Management Script<a class="headerlink" href="#bash-storage-management-script" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1"># storage_manager.sh - Storage management utility for Ubuntu 22.04</span>

<span class="c1"># Colors for output</span>
<span class="nv">RED</span><span class="o">=</span><span class="s1">&#39;\033[0;31m&#39;</span>
<span class="nv">GREEN</span><span class="o">=</span><span class="s1">&#39;\033[0;32m&#39;</span>
<span class="nv">YELLOW</span><span class="o">=</span><span class="s1">&#39;\033[1;33m&#39;</span>
<span class="nv">NC</span><span class="o">=</span><span class="s1">&#39;\033[0m&#39;</span><span class="w"> </span><span class="c1"># No Color</span>

<span class="c1"># Function to display disk usage</span>
show_disk_usage<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="s2">=== Disk Usage Information ===</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">    </span>df<span class="w"> </span>-h<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;^/dev&quot;</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="o">}</span>

<span class="c1"># Function to show largest directories</span>
show_large_dirs<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="s2">=== Largest Directories ===</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">    </span>sudo<span class="w"> </span>du<span class="w"> </span>-h<span class="w"> </span>/home<span class="w"> </span>/var<span class="w"> </span>/usr<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-hr<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-10
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="o">}</span>

<span class="c1"># Function to check storage health</span>
check_storage_health<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="s2">=== Storage Health Check ===</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="c1"># Check for devices</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span>device<span class="w"> </span><span class="k">in</span><span class="w"> </span>/dev/sd<span class="o">[</span>a-z<span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-b<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Checking </span><span class="nv">$device</span><span class="s2">...&quot;</span>
<span class="w">            </span>sudo<span class="w"> </span>smartctl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;SMART not available for </span><span class="nv">$device</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="k">fi</span>
<span class="w">    </span><span class="k">done</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="o">}</span>

<span class="c1"># Function to clean temporary files</span>
clean_temp_files<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">YELLOW</span><span class="si">}</span><span class="s2">=== Cleaning Temporary Files ===</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="c1"># Clean apt cache</span>
<span class="w">    </span>sudo<span class="w"> </span>apt<span class="w"> </span>autoclean
<span class="w">    </span>sudo<span class="w"> </span>apt<span class="w"> </span>autoremove

<span class="w">    </span><span class="c1"># Clean user temp files</span>
<span class="w">    </span>rm<span class="w"> </span>-rf<span class="w"> </span>~/.cache/thumbnails/*
<span class="w">    </span>rm<span class="w"> </span>-rf<span class="w"> </span>/tmp/*

<span class="w">    </span><span class="c1"># Clean system logs (keep last 3 days)</span>
<span class="w">    </span>sudo<span class="w"> </span>journalctl<span class="w"> </span>--vacuum-time<span class="o">=</span>3d

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="s2">Cleanup completed!</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="o">}</span>

<span class="c1"># Main menu</span>
<span class="k">case</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">1</span><span class="k">:-</span><span class="nv">menu</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="k">in</span>
<span class="w">    </span><span class="s2">&quot;usage&quot;</span><span class="o">)</span>
<span class="w">        </span>show_disk_usage
<span class="w">        </span><span class="p">;;</span>
<span class="w">    </span><span class="s2">&quot;large&quot;</span><span class="o">)</span>
<span class="w">        </span>show_large_dirs
<span class="w">        </span><span class="p">;;</span>
<span class="w">    </span><span class="s2">&quot;health&quot;</span><span class="o">)</span>
<span class="w">        </span>check_storage_health
<span class="w">        </span><span class="p">;;</span>
<span class="w">    </span><span class="s2">&quot;clean&quot;</span><span class="o">)</span>
<span class="w">        </span>clean_temp_files
<span class="w">        </span><span class="p">;;</span>
<span class="w">    </span><span class="s2">&quot;menu&quot;</span><span class="p">|</span>*<span class="o">)</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Storage Manager for Ubuntu 22.04&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Usage: </span><span class="nv">$0</span><span class="s2"> [option]&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Options:&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  usage  - Show disk usage&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  large  - Show largest directories&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  health - Check storage health&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  clean  - Clean temporary files&quot;</span>
<span class="w">        </span><span class="p">;;</span>
<span class="k">esac</span>
</pre></div>
</div>
</section>
</section>
<section id="best-practices">
<h4>Best Practices<a class="headerlink" href="#best-practices" title="Link to this heading"></a></h4>
<section id="storage-planning">
<h5>Storage Planning<a class="headerlink" href="#storage-planning" title="Link to this heading"></a></h5>
<ol class="arabic simple">
<li><p><strong>Capacity Planning</strong>: Always plan for 20-30% free space</p></li>
<li><p><strong>Performance Requirements</strong>: Choose storage type based on IOPS needs</p></li>
<li><p><strong>Redundancy</strong>: Implement appropriate backup and RAID strategies</p></li>
<li><p><strong>Monitoring</strong>: Set up alerts for storage usage thresholds</p></li>
</ol>
</section>
<section id="ubuntu-22-04-specific-recommendations">
<h5>Ubuntu 22.04 Specific Recommendations<a class="headerlink" href="#ubuntu-22-04-specific-recommendations" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install useful storage tools</span>
sudo<span class="w"> </span>apt<span class="w"> </span>update
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>htop<span class="w"> </span>iotop<span class="w"> </span>smartmontools<span class="w"> </span>sysstat<span class="w"> </span>tree<span class="w"> </span>ncdu

<span class="c1"># Set up automatic TRIM for SSDs</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>fstrim.timer
sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>fstrim.timer

<span class="c1"># Configure log rotation</span>
sudo<span class="w"> </span>vim<span class="w"> </span>/etc/logrotate.conf

<span class="c1"># Monitor storage usage with cron</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;0 */6 * * * /usr/bin/df -h | mail -s &#39;Storage Report&#39; admin@example.com&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>crontab<span class="w"> </span>-
</pre></div>
</div>
</section>
<section id="security-considerations">
<h5>Security Considerations<a class="headerlink" href="#security-considerations" title="Link to this heading"></a></h5>
<ol class="arabic simple">
<li><p><strong>Encryption</strong>: Use LUKS for full disk encryption</p></li>
<li><p><strong>Access Controls</strong>: Implement proper file permissions</p></li>
<li><p><strong>Backup Security</strong>: Encrypt backups and test restoration</p></li>
<li><p><strong>Network Storage</strong>: Use secure protocols (SSH, VPN)</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set up LUKS encryption</span>
sudo<span class="w"> </span>cryptsetup<span class="w"> </span>luksFormat<span class="w"> </span>/dev/sdb
sudo<span class="w"> </span>cryptsetup<span class="w"> </span>luksOpen<span class="w"> </span>/dev/sdb<span class="w"> </span>encrypted_drive

<span class="c1"># Create filesystem on encrypted device</span>
sudo<span class="w"> </span>mkfs.ext4<span class="w"> </span>/dev/mapper/encrypted_drive

<span class="c1"># Mount encrypted filesystem</span>
sudo<span class="w"> </span>mkdir<span class="w"> </span>/mnt/encrypted
sudo<span class="w"> </span>mount<span class="w"> </span>/dev/mapper/encrypted_drive<span class="w"> </span>/mnt/encrypted
</pre></div>
</div>
</section>
</section>
</section>
</section>
<span id="document-disk-management"></span><section id="disk-management">
<h2>Disk Management<a class="headerlink" href="#disk-management" title="Link to this heading"></a></h2>
<section id="understanding-disk-management">
<h3>Understanding Disk Management<a class="headerlink" href="#understanding-disk-management" title="Link to this heading"></a></h3>
<p>Disk management involves the organization, partitioning, formatting, and maintenance of storage devices. In Ubuntu 22.04, disk management is crucial for optimal system performance and data organization.</p>
<section id="disk-management-fundamentals">
<h4>Disk Management Fundamentals<a class="headerlink" href="#disk-management-fundamentals" title="Link to this heading"></a></h4>
<section id="what-is-disk-management">
<h5>What is Disk Management?<a class="headerlink" href="#what-is-disk-management" title="Link to this heading"></a></h5>
<p>Disk management encompasses:</p>
<ul class="simple">
<li><p><strong>Partitioning</strong>: Dividing physical disks into logical sections</p></li>
<li><p><strong>Formatting</strong>: Preparing partitions with file systems</p></li>
<li><p><strong>Mounting</strong>: Making partitions accessible to the operating system</p></li>
<li><p><strong>Monitoring</strong>: Tracking disk health and performance</p></li>
<li><p><strong>Maintenance</strong>: Optimizing and repairing disk issues</p></li>
</ul>
</section>
</section>
<section id="disk-types-and-interfaces">
<h4>Disk Types and Interfaces<a class="headerlink" href="#disk-types-and-interfaces" title="Link to this heading"></a></h4>
<section id="physical-disk-types">
<h5>Physical Disk Types<a class="headerlink" href="#physical-disk-types" title="Link to this heading"></a></h5>
<ol class="arabic simple">
<li><p><strong>Hard Disk Drives (HDD)</strong></p>
<ul class="simple">
<li><p>Mechanical storage with spinning platters</p></li>
<li><p>Lower cost per GB</p></li>
<li><p>Higher latency, slower access times</p></li>
<li><p>Good for bulk storage and archival</p></li>
</ul>
</li>
<li><p><strong>Solid State Drives (SSD)</strong></p>
<ul class="simple">
<li><p>Flash memory-based storage</p></li>
<li><p>Faster access times, lower latency</p></li>
<li><p>Higher cost per GB</p></li>
<li><p>Ideal for operating systems and applications</p></li>
</ul>
</li>
<li><p><strong>NVMe SSDs</strong></p>
<ul class="simple">
<li><p>PCIe-based interface</p></li>
<li><p>Highest performance storage</p></li>
<li><p>Direct CPU communication</p></li>
<li><p>Best for high-performance applications</p></li>
</ul>
</li>
</ol>
</section>
<section id="interface-types">
<h5>Interface Types<a class="headerlink" href="#interface-types" title="Link to this heading"></a></h5>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>SATA (Serial ATA)
├── SATA I: 1.5 Gbps
├── SATA II: 3.0 Gbps
└── SATA III: 6.0 Gbps

NVMe (Non-Volatile Memory Express)
├── PCIe 3.0: Up to 32 Gbps
└── PCIe 4.0: Up to 64 Gbps
</pre></div>
</div>
</section>
</section>
<section id="ubuntu-22-04-disk-management-commands">
<h4>Ubuntu 22.04 Disk Management Commands<a class="headerlink" href="#ubuntu-22-04-disk-management-commands" title="Link to this heading"></a></h4>
<section id="essential-disk-commands">
<h5>Essential Disk Commands<a class="headerlink" href="#essential-disk-commands" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># List all block devices</span>
lsblk

<span class="c1"># Display partition tables</span>
sudo<span class="w"> </span>fdisk<span class="w"> </span>-l

<span class="c1"># Show disk usage by filesystem</span>
df<span class="w"> </span>-h

<span class="c1"># Display directory sizes</span>
du<span class="w"> </span>-sh<span class="w"> </span>/home/*

<span class="c1"># List mounted filesystems</span>
mount<span class="w"> </span><span class="p">|</span><span class="w"> </span>column<span class="w"> </span>-t

<span class="c1"># Show disk I/O statistics</span>
iostat<span class="w"> </span>-x<span class="w"> </span><span class="m">1</span>
</pre></div>
</div>
</section>
<section id="advanced-disk-information">
<h5>Advanced Disk Information<a class="headerlink" href="#advanced-disk-information" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Detailed disk information</span>
sudo<span class="w"> </span>lshw<span class="w"> </span>-class<span class="w"> </span>disk

<span class="c1"># SMART disk health information</span>
sudo<span class="w"> </span>smartctl<span class="w"> </span>-a<span class="w"> </span>/dev/sda

<span class="c1"># Disk geometry information</span>
sudo<span class="w"> </span>hdparm<span class="w"> </span>-g<span class="w"> </span>/dev/sda

<span class="c1"># Check bad blocks</span>
sudo<span class="w"> </span>badblocks<span class="w"> </span>-v<span class="w"> </span>/dev/sda

<span class="c1"># Display partition UUID</span>
sudo<span class="w"> </span>blkid
</pre></div>
</div>
</section>
</section>
<section id="partitioning-with-fdisk">
<h4>Partitioning with fdisk<a class="headerlink" href="#partitioning-with-fdisk" title="Link to this heading"></a></h4>
<section id="creating-partitions">
<h5>Creating Partitions<a class="headerlink" href="#creating-partitions" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Start fdisk for a specific disk</span>
sudo<span class="w"> </span>fdisk<span class="w"> </span>/dev/sdb

<span class="c1"># Within fdisk:</span>
<span class="c1"># n - Create new partition</span>
<span class="c1"># d - Delete partition</span>
<span class="c1"># p - Print partition table</span>
<span class="c1"># w - Write changes and exit</span>
<span class="c1"># q - Quit without saving</span>

<span class="c1"># Example: Create a new primary partition</span>
sudo<span class="w"> </span>fdisk<span class="w"> </span>/dev/sdb<span class="w"> </span><span class="s">&lt;&lt; EOF</span>
<span class="s">n</span>
<span class="s">p</span>
<span class="s">1</span>


<span class="s">w</span>
<span class="s">EOF</span>
</pre></div>
</div>
</section>
<section id="partitioning-with-parted">
<h5>Partitioning with parted<a class="headerlink" href="#partitioning-with-parted" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create GPT partition table</span>
sudo<span class="w"> </span>parted<span class="w"> </span>/dev/sdb<span class="w"> </span>mklabel<span class="w"> </span>gpt

<span class="c1"># Create partition</span>
sudo<span class="w"> </span>parted<span class="w"> </span>/dev/sdb<span class="w"> </span>mkpart<span class="w"> </span>primary<span class="w"> </span>ext4<span class="w"> </span><span class="m">0</span>%<span class="w"> </span><span class="m">100</span>%

<span class="c1"># Set partition flags</span>
sudo<span class="w"> </span>parted<span class="w"> </span>/dev/sdb<span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>boot<span class="w"> </span>on

<span class="c1"># Display partition information</span>
sudo<span class="w"> </span>parted<span class="w"> </span>/dev/sdb<span class="w"> </span>print
</pre></div>
</div>
</section>
</section>
<section id="filesystem-creation-and-management">
<h4>Filesystem Creation and Management<a class="headerlink" href="#filesystem-creation-and-management" title="Link to this heading"></a></h4>
<section id="creating-filesystems">
<h5>Creating Filesystems<a class="headerlink" href="#creating-filesystems" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create ext4 filesystem</span>
sudo<span class="w"> </span>mkfs.ext4<span class="w"> </span>/dev/sdb1

<span class="c1"># Create XFS filesystem</span>
sudo<span class="w"> </span>mkfs.xfs<span class="w"> </span>/dev/sdb1

<span class="c1"># Create Btrfs filesystem</span>
sudo<span class="w"> </span>mkfs.btrfs<span class="w"> </span>/dev/sdb1

<span class="c1"># Create FAT32 filesystem</span>
sudo<span class="w"> </span>mkfs.fat<span class="w"> </span>-F32<span class="w"> </span>/dev/sdb1
</pre></div>
</div>
</section>
<section id="filesystem-checking-and-repair">
<h5>Filesystem Checking and Repair<a class="headerlink" href="#filesystem-checking-and-repair" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check ext4 filesystem</span>
sudo<span class="w"> </span>fsck.ext4<span class="w"> </span>/dev/sdb1

<span class="c1"># Force check even if clean</span>
sudo<span class="w"> </span>fsck.ext4<span class="w"> </span>-f<span class="w"> </span>/dev/sdb1

<span class="c1"># Check and repair filesystem</span>
sudo<span class="w"> </span>fsck.ext4<span class="w"> </span>-p<span class="w"> </span>/dev/sdb1

<span class="c1"># Check XFS filesystem</span>
sudo<span class="w"> </span>xfs_check<span class="w"> </span>/dev/sdb1
</pre></div>
</div>
</section>
</section>
<section id="mounting-and-unmounting">
<h4>Mounting and Unmounting<a class="headerlink" href="#mounting-and-unmounting" title="Link to this heading"></a></h4>
<section id="manual-mounting">
<h5>Manual Mounting<a class="headerlink" href="#manual-mounting" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create mount point</span>
sudo<span class="w"> </span>mkdir<span class="w"> </span>/mnt/mydisk

<span class="c1"># Mount filesystem</span>
sudo<span class="w"> </span>mount<span class="w"> </span>/dev/sdb1<span class="w"> </span>/mnt/mydisk

<span class="c1"># Mount with specific options</span>
sudo<span class="w"> </span>mount<span class="w"> </span>-o<span class="w"> </span>rw,noatime<span class="w"> </span>/dev/sdb1<span class="w"> </span>/mnt/mydisk

<span class="c1"># Unmount filesystem</span>
sudo<span class="w"> </span>umount<span class="w"> </span>/mnt/mydisk

<span class="c1"># Force unmount (use carefully)</span>
sudo<span class="w"> </span>umount<span class="w"> </span>-f<span class="w"> </span>/mnt/mydisk
</pre></div>
</div>
</section>
<section id="automatic-mounting-with-etc-fstab">
<h5>Automatic Mounting with /etc/fstab<a class="headerlink" href="#automatic-mounting-with-etc-fstab" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Edit fstab file</span>
sudo<span class="w"> </span>vim<span class="w"> </span>/etc/fstab

<span class="c1"># Example fstab entries:</span>
<span class="c1"># UUID=12345678-1234-1234-1234-123456789012 /mnt/mydisk ext4 defaults 0 2</span>
<span class="c1"># /dev/sdb1 /mnt/backup ext4 rw,noatime 0 2</span>

<span class="c1"># Get UUID of a partition</span>
sudo<span class="w"> </span>blkid<span class="w"> </span>/dev/sdb1

<span class="c1"># Test fstab configuration</span>
sudo<span class="w"> </span>mount<span class="w"> </span>-a
</pre></div>
</div>
</section>
</section>
<section id="frequently-asked-questions">
<h4>Frequently Asked Questions<a class="headerlink" href="#frequently-asked-questions" title="Link to this heading"></a></h4>
<section id="q-how-do-i-check-disk-space-usage-on-ubuntu-22-04">
<h5>Q: How do I check disk space usage on Ubuntu 22.04?<a class="headerlink" href="#q-how-do-i-check-disk-space-usage-on-ubuntu-22-04" title="Link to this heading"></a></h5>
<p><strong>A:</strong> Use these commands to check disk space:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Overall disk usage</span>
df<span class="w"> </span>-h

<span class="c1"># Specific directory usage</span>
du<span class="w"> </span>-sh<span class="w"> </span>/home/username

<span class="c1"># Interactive disk usage browser</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>ncdu
ncdu<span class="w"> </span>/
</pre></div>
</div>
</section>
<section id="q-what-s-the-difference-between-fdisk-and-parted">
<h5>Q: What’s the difference between fdisk and parted?<a class="headerlink" href="#q-what-s-the-difference-between-fdisk-and-parted" title="Link to this heading"></a></h5>
<p><strong>A:</strong></p>
<ul class="simple">
<li><p><strong>fdisk</strong>: Traditional partitioning tool, best for MBR partitions</p></li>
<li><p><strong>parted</strong>: Modern tool supporting both MBR and GPT, better for large disks (&gt;2TB)</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># fdisk - good for disks &lt; 2TB</span>
sudo<span class="w"> </span>fdisk<span class="w"> </span>/dev/sdb

<span class="c1"># parted - better for large disks and GPT</span>
sudo<span class="w"> </span>parted<span class="w"> </span>/dev/sdb
</pre></div>
</div>
</section>
<section id="q-how-do-i-resize-a-partition-without-losing-data">
<h5>Q: How do I resize a partition without losing data?<a class="headerlink" href="#q-how-do-i-resize-a-partition-without-losing-data" title="Link to this heading"></a></h5>
<p><strong>A:</strong> Use these steps carefully:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. Backup your data first!</span>
<span class="c1"># 2. Unmount the partition</span>
sudo<span class="w"> </span>umount<span class="w"> </span>/dev/sdb1

<span class="c1"># 3. Check filesystem</span>
sudo<span class="w"> </span>fsck<span class="w"> </span>-f<span class="w"> </span>/dev/sdb1

<span class="c1"># 4. Resize partition with parted</span>
sudo<span class="w"> </span>parted<span class="w"> </span>/dev/sdb<span class="w"> </span>resizepart<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">100</span>%

<span class="c1"># 5. Resize filesystem</span>
sudo<span class="w"> </span>resize2fs<span class="w"> </span>/dev/sdb1

<span class="c1"># 6. Remount</span>
sudo<span class="w"> </span>mount<span class="w"> </span>/dev/sdb1<span class="w"> </span>/mnt/mydisk
</pre></div>
</div>
</section>
<section id="q-how-can-i-securely-wipe-a-disk">
<h5>Q: How can I securely wipe a disk?<a class="headerlink" href="#q-how-can-i-securely-wipe-a-disk" title="Link to this heading"></a></h5>
<p><strong>A:</strong> Several methods for secure disk wiping:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Method 1: Using dd (single pass)</span>
sudo<span class="w"> </span>dd<span class="w"> </span><span class="k">if</span><span class="o">=</span>/dev/zero<span class="w"> </span><span class="nv">of</span><span class="o">=</span>/dev/sdb<span class="w"> </span><span class="nv">bs</span><span class="o">=</span>1M<span class="w"> </span><span class="nv">status</span><span class="o">=</span>progress

<span class="c1"># Method 2: Using shred (multiple passes)</span>
sudo<span class="w"> </span>shred<span class="w"> </span>-vfz<span class="w"> </span>-n<span class="w"> </span><span class="m">3</span><span class="w"> </span>/dev/sdb

<span class="c1"># Method 3: Using DBAN (boot from USB)</span>
<span class="c1"># Download DBAN ISO and create bootable USB</span>

<span class="c1"># For SSDs, use secure erase</span>
sudo<span class="w"> </span>hdparm<span class="w"> </span>--user-master<span class="w"> </span>u<span class="w"> </span>--security-set-pass<span class="w"> </span>p<span class="w"> </span>/dev/sdb
sudo<span class="w"> </span>hdparm<span class="w"> </span>--user-master<span class="w"> </span>u<span class="w"> </span>--security-erase<span class="w"> </span>p<span class="w"> </span>/dev/sdb
</pre></div>
</div>
</section>
</section>
<section id="coding-examples">
<h4>Coding Examples<a class="headerlink" href="#coding-examples" title="Link to this heading"></a></h4>
<section id="python-disk-management-script">
<h5>Python Disk Management Script<a class="headerlink" href="#python-disk-management-script" title="Link to this heading"></a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Disk management utility for Ubuntu 22.04</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DiskManager</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_root_privileges</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_root_privileges</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if running with root privileges&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">geteuid</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This script requires root privileges. Run with sudo.&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">list_disks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List all available disks&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;lsblk&#39;</span><span class="p">,</span> <span class="s1">&#39;-J&#39;</span><span class="p">],</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;blockdevices&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error listing disks: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_disk_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get detailed information about a disk&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Get basic info</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;lsblk&#39;</span><span class="p">,</span> <span class="s1">&#39;-J&#39;</span><span class="p">,</span> <span class="n">device</span><span class="p">],</span>
                                  <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">basic_info</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>

            <span class="c1"># Get SMART info</span>
            <span class="n">smart_result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;smartctl&#39;</span><span class="p">,</span> <span class="s1">&#39;-i&#39;</span><span class="p">,</span> <span class="n">device</span><span class="p">],</span>
                                        <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;basic&#39;</span><span class="p">:</span> <span class="n">basic_info</span><span class="p">,</span>
                <span class="s1">&#39;smart&#39;</span><span class="p">:</span> <span class="n">smart_result</span><span class="o">.</span><span class="n">stdout</span> <span class="k">if</span> <span class="n">smart_result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;N/A&#39;</span>
            <span class="p">}</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_partition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;100%&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new partition&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Create GPT partition table</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;parted&#39;</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="s1">&#39;mklabel&#39;</span><span class="p">,</span> <span class="s1">&#39;gpt&#39;</span><span class="p">],</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Create partition</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;parted&#39;</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="s1">&#39;mkpart&#39;</span><span class="p">,</span> <span class="s1">&#39;primary&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;ext4&#39;</span><span class="p">,</span> <span class="s1">&#39;0%&#39;</span><span class="p">,</span> <span class="n">size</span><span class="p">],</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error creating partition: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">format_partition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">filesystem</span><span class="o">=</span><span class="s1">&#39;ext4&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Format a partition with specified filesystem&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">filesystem</span> <span class="o">==</span> <span class="s1">&#39;ext4&#39;</span><span class="p">:</span>
                <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;mkfs.ext4&#39;</span><span class="p">,</span> <span class="s1">&#39;-F&#39;</span><span class="p">,</span> <span class="n">device</span><span class="p">],</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">filesystem</span> <span class="o">==</span> <span class="s1">&#39;xfs&#39;</span><span class="p">:</span>
                <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;mkfs.xfs&#39;</span><span class="p">,</span> <span class="s1">&#39;-f&#39;</span><span class="p">,</span> <span class="n">device</span><span class="p">],</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">filesystem</span> <span class="o">==</span> <span class="s1">&#39;btrfs&#39;</span><span class="p">:</span>
                <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;mkfs.btrfs&#39;</span><span class="p">,</span> <span class="s1">&#39;-f&#39;</span><span class="p">,</span> <span class="n">device</span><span class="p">],</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported filesystem: </span><span class="si">{</span><span class="n">filesystem</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error formatting partition: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">mount_partition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">mountpoint</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="s1">&#39;defaults&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mount a partition&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Create mountpoint if it doesn&#39;t exist</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">mountpoint</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Mount the partition</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;mount&#39;</span><span class="p">,</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">mountpoint</span><span class="p">],</span>
                         <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error mounting partition: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_filesystem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check filesystem integrity&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;fsck&#39;</span><span class="p">,</span> <span class="s1">&#39;-n&#39;</span><span class="p">,</span> <span class="n">device</span><span class="p">],</span>
                                  <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;clean&#39;</span> <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;errors&#39;</span><span class="p">,</span>
                <span class="s1">&#39;output&#39;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span>
            <span class="p">}</span>
        <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;output&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span>

<span class="c1"># Example usage</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">dm</span> <span class="o">=</span> <span class="n">DiskManager</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Available Disks ===&quot;</span><span class="p">)</span>
    <span class="n">disks</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">list_disks</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">disk</span> <span class="ow">in</span> <span class="n">disks</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Device: </span><span class="si">{</span><span class="n">disk</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, Size: </span><span class="si">{</span><span class="n">disk</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, Type: </span><span class="si">{</span><span class="n">disk</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Interactive disk management</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">device</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">dm</span><span class="o">.</span><span class="n">get_disk_info</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">nDisk information for </span><span class="si">{</span><span class="n">device</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="bash-disk-monitoring-script">
<h5>Bash Disk Monitoring Script<a class="headerlink" href="#bash-disk-monitoring-script" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1"># disk_monitor.sh - Comprehensive disk monitoring for Ubuntu 22.04</span>

<span class="c1"># Configuration</span>
<span class="nv">ALERT_THRESHOLD</span><span class="o">=</span><span class="m">85</span><span class="w">  </span><span class="c1"># Alert when disk usage exceeds this percentage</span>
<span class="nv">EMAIL_ALERT</span><span class="o">=</span><span class="s2">&quot;admin@example.com&quot;</span>
<span class="nv">LOG_FILE</span><span class="o">=</span><span class="s2">&quot;/var/log/disk_monitor.log&quot;</span>

<span class="c1"># Colors</span>
<span class="nv">RED</span><span class="o">=</span><span class="s1">&#39;\033[0;31m&#39;</span>
<span class="nv">GREEN</span><span class="o">=</span><span class="s1">&#39;\033[0;32m&#39;</span>
<span class="nv">YELLOW</span><span class="o">=</span><span class="s1">&#39;\033[1;33m&#39;</span>
<span class="nv">BLUE</span><span class="o">=</span><span class="s1">&#39;\033[0;34m&#39;</span>
<span class="nv">NC</span><span class="o">=</span><span class="s1">&#39;\033[0m&#39;</span>

<span class="c1"># Logging function</span>
log_message<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>date<span class="w"> </span><span class="s1">&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span class="k">)</span><span class="s2"> - </span><span class="nv">$1</span><span class="s2">&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LOG_FILE</span><span class="s2">&quot;</span>
<span class="o">}</span>

<span class="c1"># Check disk usage</span>
check_disk_usage<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BLUE</span><span class="si">}</span><span class="s2">=== Disk Usage Check ===</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="w">    </span>df<span class="w"> </span>-h<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-vE<span class="w"> </span><span class="s1">&#39;^Filesystem|tmpfs|cdrom&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $5 &quot; &quot; $1 &quot; &quot; $6}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>output<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">        </span><span class="nv">usage</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="nv">$output</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $1}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s1">&#39;s/%//g&#39;</span><span class="k">)</span>
<span class="w">        </span><span class="nv">partition</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="nv">$output</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $2}&#39;</span><span class="k">)</span>
<span class="w">        </span><span class="nv">mountpoint</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="nv">$output</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $3}&#39;</span><span class="k">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$usage</span><span class="w"> </span>-ge<span class="w"> </span><span class="nv">$ALERT_THRESHOLD</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">RED</span><span class="si">}</span><span class="s2">WARNING: </span><span class="nv">$partition</span><span class="s2"> (</span><span class="nv">$mountpoint</span><span class="s2">) is </span><span class="si">${</span><span class="nv">usage</span><span class="si">}</span><span class="s2">% full</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">            </span>log_message<span class="w"> </span><span class="s2">&quot;HIGH USAGE: </span><span class="nv">$partition</span><span class="s2"> (</span><span class="nv">$mountpoint</span><span class="s2">) is </span><span class="si">${</span><span class="nv">usage</span><span class="si">}</span><span class="s2">% full&quot;</span>

<span class="w">            </span><span class="c1"># Send email alert if configured</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nb">command</span><span class="w"> </span>-v<span class="w"> </span>mail<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$EMAIL_ALERT</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Disk usage alert: </span><span class="nv">$partition</span><span class="s2"> (</span><span class="nv">$mountpoint</span><span class="s2">) is </span><span class="si">${</span><span class="nv">usage</span><span class="si">}</span><span class="s2">% full&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">                    </span>mail<span class="w"> </span>-s<span class="w"> </span><span class="s2">&quot;Disk Usage Alert - </span><span class="k">$(</span>hostname<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$EMAIL_ALERT</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="k">fi</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="s2">OK: </span><span class="nv">$partition</span><span class="s2"> (</span><span class="nv">$mountpoint</span><span class="s2">) is </span><span class="si">${</span><span class="nv">usage</span><span class="si">}</span><span class="s2">% full</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="k">fi</span>
<span class="w">    </span><span class="k">done</span>
<span class="o">}</span>

<span class="c1"># Check disk health using SMART</span>
check_disk_health<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BLUE</span><span class="si">}</span><span class="s2">=== Disk Health Check ===</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span>disk<span class="w"> </span><span class="k">in</span><span class="w"> </span>/dev/sd<span class="o">[</span>a-z<span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-b<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$disk</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Checking </span><span class="nv">$disk</span><span class="s2">...&quot;</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nb">command</span><span class="w"> </span>-v<span class="w"> </span>smartctl<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span><span class="nv">health</span><span class="o">=</span><span class="k">$(</span>smartctl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$disk</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;SMART overall-health&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $6}&#39;</span><span class="k">)</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$health</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;PASSED&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="nv">$disk</span><span class="s2">: Health OK</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">                </span><span class="k">else</span>
<span class="w">                    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">RED</span><span class="si">}</span><span class="nv">$disk</span><span class="s2">: Health FAILED</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">                    </span>log_message<span class="w"> </span><span class="s2">&quot;DISK HEALTH: </span><span class="nv">$disk</span><span class="s2"> health check failed&quot;</span>
<span class="w">                </span><span class="k">fi</span>

<span class="w">                </span><span class="c1"># Check temperature</span>
<span class="w">                </span><span class="nv">temp</span><span class="o">=</span><span class="k">$(</span>smartctl<span class="w"> </span>-A<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$disk</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>Temperature_Celsius<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $10}&#39;</span><span class="k">)</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$temp</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$temp</span><span class="s2">&quot;</span><span class="w"> </span>-gt<span class="w"> </span><span class="m">55</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                        </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">YELLOW</span><span class="si">}</span><span class="nv">$disk</span><span class="s2">: Temperature high (</span><span class="si">${</span><span class="nv">temp</span><span class="si">}</span><span class="s2">°C)</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">                    </span><span class="k">else</span>
<span class="w">                        </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="nv">$disk</span><span class="s2">: Temperature OK (</span><span class="si">${</span><span class="nv">temp</span><span class="si">}</span><span class="s2">°C)</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">                    </span><span class="k">fi</span>
<span class="w">                </span><span class="k">fi</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;smartctl not available. Install with: sudo apt install smartmontools&quot;</span>
<span class="w">            </span><span class="k">fi</span>
<span class="w">        </span><span class="k">fi</span>
<span class="w">    </span><span class="k">done</span>
<span class="o">}</span>

<span class="c1"># Monitor I/O performance</span>
monitor_io<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BLUE</span><span class="si">}</span><span class="s2">=== I/O Performance Monitor ===</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">command</span><span class="w"> </span>-v<span class="w"> </span>iostat<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span>iostat<span class="w"> </span>-x<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-n<span class="w"> </span>+4
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;iostat not available. Install with: sudo apt install sysstat&quot;</span>
<span class="w">    </span><span class="k">fi</span>
<span class="o">}</span>

<span class="c1"># Find large files</span>
find_large_files<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BLUE</span><span class="si">}</span><span class="s2">=== Large Files (&gt;1GB) ===</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="w">    </span>find<span class="w"> </span>/<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-size<span class="w"> </span>+1G<span class="w"> </span>-exec<span class="w"> </span>ls<span class="w"> </span>-lh<span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>awk<span class="w"> </span><span class="s1">&#39;{print $5 &quot;\t&quot; $9}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-hr<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-10
<span class="o">}</span>

<span class="c1"># Clean temporary files</span>
cleanup_temp<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BLUE</span><span class="si">}</span><span class="s2">=== Cleaning Temporary Files ===</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="c1"># Get initial disk usage</span>
<span class="w">    </span><span class="nv">initial_usage</span><span class="o">=</span><span class="k">$(</span>df<span class="w"> </span>/<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-1<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $3}&#39;</span><span class="k">)</span>

<span class="w">    </span><span class="c1"># Clean apt cache</span>
<span class="w">    </span>apt-get<span class="w"> </span>autoclean<span class="w"> </span>-y
<span class="w">    </span>apt-get<span class="w"> </span>autoremove<span class="w"> </span>-y

<span class="w">    </span><span class="c1"># Clean logs older than 30 days</span>
<span class="w">    </span>find<span class="w"> </span>/var/log<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;*.log&quot;</span><span class="w"> </span>-mtime<span class="w"> </span>+30<span class="w"> </span>-delete

<span class="w">    </span><span class="c1"># Clean temporary files</span>
<span class="w">    </span>find<span class="w"> </span>/tmp<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-mtime<span class="w"> </span>+7<span class="w"> </span>-delete
<span class="w">    </span>find<span class="w"> </span>/var/tmp<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-mtime<span class="w"> </span>+7<span class="w"> </span>-delete

<span class="w">    </span><span class="c1"># Clean user caches</span>
<span class="w">    </span>find<span class="w"> </span>/home<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;.cache&quot;</span><span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-exec<span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span><span class="o">{}</span>/thumbnails/*<span class="w"> </span><span class="se">\;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null

<span class="w">    </span><span class="c1"># Get final disk usage</span>
<span class="w">    </span><span class="nv">final_usage</span><span class="o">=</span><span class="k">$(</span>df<span class="w"> </span>/<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-1<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $3}&#39;</span><span class="k">)</span>

<span class="w">    </span><span class="c1"># Calculate space freed</span>
<span class="w">    </span><span class="nv">space_freed</span><span class="o">=</span><span class="k">$((</span><span class="nv">initial_usage</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">final_usage</span><span class="k">))</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="s2">Cleanup completed. Space freed: </span><span class="si">${</span><span class="nv">space_freed</span><span class="si">}</span><span class="s2">KB</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="w">    </span>log_message<span class="w"> </span><span class="s2">&quot;CLEANUP: Freed </span><span class="si">${</span><span class="nv">space_freed</span><span class="si">}</span><span class="s2">KB of disk space&quot;</span>
<span class="o">}</span>

<span class="c1"># Generate disk report</span>
generate_report<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nv">report_file</span><span class="o">=</span><span class="s2">&quot;/tmp/disk_report_</span><span class="k">$(</span>date<span class="w"> </span>+%Y%m%d_%H%M%S<span class="k">)</span><span class="s2">.txt&quot;</span>

<span class="w">    </span><span class="o">{</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Disk Report for </span><span class="k">$(</span>hostname<span class="k">)</span><span class="s2"> - </span><span class="k">$(</span>date<span class="k">)</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;==================================================&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>

<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Disk Usage:&quot;</span>
<span class="w">        </span>df<span class="w"> </span>-h
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>

<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Largest Directories:&quot;</span>
<span class="w">        </span>du<span class="w"> </span>-h<span class="w"> </span>/home<span class="w"> </span>/var<span class="w"> </span>/usr<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-hr<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-10
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>

<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Mount Points:&quot;</span>
<span class="w">        </span>mount<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;^/dev&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>

<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Block Devices:&quot;</span>
<span class="w">        </span>lsblk

<span class="w">    </span><span class="o">}</span><span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$report_file</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="s2">Report generated: </span><span class="nv">$report_file</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="c1"># Email report if configured</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">command</span><span class="w"> </span>-v<span class="w"> </span>mail<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$EMAIL_ALERT</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span>cat<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$report_file</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>mail<span class="w"> </span>-s<span class="w"> </span><span class="s2">&quot;Disk Report - </span><span class="k">$(</span>hostname<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$EMAIL_ALERT</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">fi</span>
<span class="o">}</span>

<span class="c1"># Main menu</span>
<span class="k">case</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">1</span><span class="k">:-</span><span class="nv">help</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="k">in</span>
<span class="w">    </span><span class="s2">&quot;usage&quot;</span><span class="o">)</span>
<span class="w">        </span>check_disk_usage
<span class="w">        </span><span class="p">;;</span>
<span class="w">    </span><span class="s2">&quot;health&quot;</span><span class="o">)</span>
<span class="w">        </span>check_disk_health
<span class="w">        </span><span class="p">;;</span>
<span class="w">    </span><span class="s2">&quot;io&quot;</span><span class="o">)</span>
<span class="w">        </span>monitor_io
<span class="w">        </span><span class="p">;;</span>
<span class="w">    </span><span class="s2">&quot;large&quot;</span><span class="o">)</span>
<span class="w">        </span>find_large_files
<span class="w">        </span><span class="p">;;</span>
<span class="w">    </span><span class="s2">&quot;clean&quot;</span><span class="o">)</span>
<span class="w">        </span>cleanup_temp
<span class="w">        </span><span class="p">;;</span>
<span class="w">    </span><span class="s2">&quot;report&quot;</span><span class="o">)</span>
<span class="w">        </span>generate_report
<span class="w">        </span><span class="p">;;</span>
<span class="w">    </span><span class="s2">&quot;all&quot;</span><span class="o">)</span>
<span class="w">        </span>check_disk_usage
<span class="w">        </span>check_disk_health
<span class="w">        </span>monitor_io
<span class="w">        </span>find_large_files
<span class="w">        </span><span class="p">;;</span>
<span class="w">    </span><span class="s2">&quot;help&quot;</span><span class="p">|</span>*<span class="o">)</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Disk Monitor for Ubuntu 22.04&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Usage: </span><span class="nv">$0</span><span class="s2"> [option]&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Options:&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  usage  - Check disk usage&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  health - Check disk health (SMART)&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  io     - Monitor I/O performance&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  large  - Find large files&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  clean  - Clean temporary files&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  report - Generate comprehensive report&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  all    - Run all checks&quot;</span>
<span class="w">        </span><span class="p">;;</span>
<span class="k">esac</span>
</pre></div>
</div>
</section>
</section>
<section id="best-practices-for-disk-management">
<h4>Best Practices for Disk Management<a class="headerlink" href="#best-practices-for-disk-management" title="Link to this heading"></a></h4>
<section id="planning-and-strategy">
<h5>Planning and Strategy<a class="headerlink" href="#planning-and-strategy" title="Link to this heading"></a></h5>
<ol class="arabic simple">
<li><p><strong>Partition Strategy</strong>:</p>
<ul class="simple">
<li><p>Separate /home from root partition</p></li>
<li><p>Use dedicated partitions for /var and /tmp</p></li>
<li><p>Plan for future expansion</p></li>
</ul>
</li>
<li><p><strong>Filesystem Selection</strong>:</p>
<ul class="simple">
<li><p>ext4: General purpose, reliable</p></li>
<li><p>XFS: Large files and high performance</p></li>
<li><p>Btrfs: Advanced features, snapshots</p></li>
<li><p>ZFS: Enterprise features, data integrity</p></li>
</ul>
</li>
<li><p><strong>Monitoring and Maintenance</strong>:</p>
<ul class="simple">
<li><p>Regular SMART checks</p></li>
<li><p>Monitor disk usage trends</p></li>
<li><p>Schedule regular filesystem checks</p></li>
<li><p>Implement log rotation</p></li>
</ul>
</li>
</ol>
</section>
<section id="ubuntu-22-04-optimization-tips">
<h5>Ubuntu 22.04 Optimization Tips<a class="headerlink" href="#ubuntu-22-04-optimization-tips" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Enable automatic TRIM for SSDs</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>fstrim.timer

<span class="c1"># Optimize mount options for performance</span>
<span class="c1"># Add to /etc/fstab:</span>
<span class="c1"># /dev/sda1 / ext4 defaults,noatime,discard 0 1</span>

<span class="c1"># Configure I/O scheduler for SSDs</span>
<span class="nb">echo</span><span class="w"> </span>none<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/sys/block/sda/queue/scheduler

<span class="c1"># Set up monitoring</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>smartmontools<span class="w"> </span>sysstat
sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>smartd

<span class="c1"># Configure SMART monitoring</span>
sudo<span class="w"> </span>vim<span class="w"> </span>/etc/smartd.conf
<span class="c1"># Add: /dev/sda -a -o on -S on -s (S/../.././02|L/../../6/03)</span>
</pre></div>
</div>
</section>
<section id="security-and-recovery">
<h5>Security and Recovery<a class="headerlink" href="#security-and-recovery" title="Link to this heading"></a></h5>
<ol class="arabic simple">
<li><p><strong>Backup Strategy</strong>:</p>
<ul class="simple">
<li><p>Regular automated backups</p></li>
<li><p>Test restoration procedures</p></li>
<li><p>Offsite backup storage</p></li>
<li><p>Document recovery procedures</p></li>
</ul>
</li>
<li><p><strong>Access Control</strong>:</p>
<ul class="simple">
<li><p>Proper file permissions</p></li>
<li><p>User and group management</p></li>
<li><p>Audit trail logging</p></li>
<li><p>Encryption for sensitive data</p></li>
</ul>
</li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set up automatic backups</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>rsync

<span class="c1"># Create backup script</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>/usr/local/bin/backup.sh<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s">#!/bin/bash</span>
<span class="s">rsync -avz --delete /home/ /backup/home/</span>
<span class="s">rsync -avz --delete /etc/ /backup/etc/</span>
<span class="s">EOF</span>

chmod<span class="w"> </span>+x<span class="w"> </span>/usr/local/bin/backup.sh

<span class="c1"># Schedule with cron</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;0 2 * * * /usr/local/bin/backup.sh&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>crontab<span class="w"> </span>-
</pre></div>
</div>
</section>
</section>
</section>
</section>
<span id="document-file-systems"></span><section id="file-systems">
<h2>File Systems<a class="headerlink" href="#file-systems" title="Link to this heading"></a></h2>
<section id="understanding-file-systems">
<h3>Understanding File Systems<a class="headerlink" href="#understanding-file-systems" title="Link to this heading"></a></h3>
<p>A file system is a method used by operating systems to store, organize, and manage files on storage devices. It defines how data is stored, accessed, and organized on disks.</p>
<section id="what-is-a-file-system">
<h4>What is a File System?<a class="headerlink" href="#what-is-a-file-system" title="Link to this heading"></a></h4>
<p>A file system provides:</p>
<ul class="simple">
<li><p><strong>File Organization</strong>: Hierarchical structure for organizing files and directories</p></li>
<li><p><strong>Metadata Management</strong>: Information about files (size, permissions, timestamps)</p></li>
<li><p><strong>Space Management</strong>: Allocation and deallocation of disk space</p></li>
<li><p><strong>Access Control</strong>: Security and permission mechanisms</p></li>
<li><p><strong>Data Integrity</strong>: Protection against data corruption</p></li>
</ul>
</section>
<section id="file-system-components">
<h4>File System Components<a class="headerlink" href="#file-system-components" title="Link to this heading"></a></h4>
<section id="core-components">
<h5>Core Components<a class="headerlink" href="#core-components" title="Link to this heading"></a></h5>
<ol class="arabic simple">
<li><p><strong>Superblock</strong>: Contains metadata about the filesystem</p></li>
<li><p><strong>Inode Table</strong>: Stores file metadata and pointers to data blocks</p></li>
<li><p><strong>Data Blocks</strong>: Actual file content storage</p></li>
<li><p><strong>Directory Structure</strong>: Hierarchical organization of files and folders</p></li>
<li><p><strong>Journal</strong>: Transaction log for filesystem changes (in journaling filesystems)</p></li>
</ol>
</section>
<section id="file-system-structure">
<h5>File System Structure<a class="headerlink" href="#file-system-structure" title="Link to this heading"></a></h5>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Filesystem Layout
├── Superblock (filesystem metadata)
├── Group Descriptors (block group information)
├── Block Bitmap (free/used block tracking)
├── Inode Bitmap (free/used inode tracking)
├── Inode Table (file metadata)
└── Data Blocks (actual file content)
</pre></div>
</div>
</section>
</section>
<section id="common-file-systems-in-ubuntu-22-04">
<h4>Common File Systems in Ubuntu 22.04<a class="headerlink" href="#common-file-systems-in-ubuntu-22-04" title="Link to this heading"></a></h4>
<section id="ext4-fourth-extended-filesystem">
<h5>ext4 (Fourth Extended Filesystem)<a class="headerlink" href="#ext4-fourth-extended-filesystem" title="Link to this heading"></a></h5>
<p>The default filesystem for Ubuntu 22.04:</p>
<p><strong>Features:</strong>
* Journaling for data integrity
* Large file and filesystem support (up to 1 EB)
* Backward compatibility with ext2/ext3
* Online defragmentation
* Delayed allocation</p>
<p><strong>Use Cases:</strong>
* General purpose computing
* Desktop and server installations
* Boot partitions
* Home directories</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create ext4 filesystem</span>
sudo<span class="w"> </span>mkfs.ext4<span class="w"> </span>/dev/sdb1

<span class="c1"># Check ext4 filesystem</span>
sudo<span class="w"> </span>fsck.ext4<span class="w"> </span>/dev/sdb1

<span class="c1"># Get ext4 filesystem information</span>
sudo<span class="w"> </span>tune2fs<span class="w"> </span>-l<span class="w"> </span>/dev/sdb1

<span class="c1"># Optimize ext4 filesystem</span>
sudo<span class="w"> </span>tune2fs<span class="w"> </span>-o<span class="w"> </span>journal_data_writeback<span class="w"> </span>/dev/sdb1
</pre></div>
</div>
</section>
<section id="xfs-extended-file-system">
<h5>XFS (eXtended File System)<a class="headerlink" href="#xfs-extended-file-system" title="Link to this heading"></a></h5>
<p>High-performance 64-bit journaling filesystem:</p>
<p><strong>Features:</strong>
* Excellent scalability
* Online resizing (grow only)
* Advanced quota management
* Allocation groups for parallel I/O
* Metadata journaling</p>
<p><strong>Use Cases:</strong>
* Large files and databases
* High-performance computing
* Video editing and media storage
* Enterprise storage systems</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create XFS filesystem</span>
sudo<span class="w"> </span>mkfs.xfs<span class="w"> </span>/dev/sdb1

<span class="c1"># Check XFS filesystem</span>
sudo<span class="w"> </span>xfs_check<span class="w"> </span>/dev/sdb1

<span class="c1"># Repair XFS filesystem</span>
sudo<span class="w"> </span>xfs_repair<span class="w"> </span>/dev/sdb1

<span class="c1"># Get XFS information</span>
sudo<span class="w"> </span>xfs_info<span class="w"> </span>/dev/sdb1

<span class="c1"># Resize XFS filesystem (grow only)</span>
sudo<span class="w"> </span>xfs_growfs<span class="w"> </span>/mnt/xfs
</pre></div>
</div>
</section>
<section id="btrfs-b-tree-file-system">
<h5>Btrfs (B-tree File System)<a class="headerlink" href="#btrfs-b-tree-file-system" title="Link to this heading"></a></h5>
<p>Modern copy-on-write filesystem:</p>
<p><strong>Features:</strong>
* Snapshots and cloning
* Built-in RAID support
* Compression (zlib, lzo, zstd)
* Checksumming for data integrity
* Online resizing (grow and shrink)</p>
<p><strong>Use Cases:</strong>
* System snapshots
* Development environments
* Data deduplication scenarios
* Advanced storage management</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create Btrfs filesystem</span>
sudo<span class="w"> </span>mkfs.btrfs<span class="w"> </span>/dev/sdb1

<span class="c1"># Mount with compression</span>
sudo<span class="w"> </span>mount<span class="w"> </span>-o<span class="w"> </span><span class="nv">compress</span><span class="o">=</span>zstd<span class="w"> </span>/dev/sdb1<span class="w"> </span>/mnt/btrfs

<span class="c1"># Create snapshot</span>
sudo<span class="w"> </span>btrfs<span class="w"> </span>subvolume<span class="w"> </span>snapshot<span class="w"> </span>/mnt/btrfs<span class="w"> </span>/mnt/btrfs/snapshot

<span class="c1"># List subvolumes</span>
sudo<span class="w"> </span>btrfs<span class="w"> </span>subvolume<span class="w"> </span>list<span class="w"> </span>/mnt/btrfs
</pre></div>
</div>
</section>
<section id="zfs-zettabyte-file-system">
<h5>ZFS (Zettabyte File System)<a class="headerlink" href="#zfs-zettabyte-file-system" title="Link to this heading"></a></h5>
<p>Advanced filesystem with built-in volume management:</p>
<p><strong>Features:</strong>
* Built-in RAID (RAID-Z)
* Snapshots and clones
* Data deduplication
* Compression
* End-to-end checksumming</p>
<p><strong>Installation and Use:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install ZFS on Ubuntu 22.04</span>
sudo<span class="w"> </span>apt<span class="w"> </span>update
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>zfsutils-linux

<span class="c1"># Create ZFS pool</span>
sudo<span class="w"> </span>zpool<span class="w"> </span>create<span class="w"> </span>mypool<span class="w"> </span>/dev/sdb

<span class="c1"># Create ZFS dataset</span>
sudo<span class="w"> </span>zfs<span class="w"> </span>create<span class="w"> </span>mypool/data

<span class="c1"># Enable compression</span>
sudo<span class="w"> </span>zfs<span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="nv">compression</span><span class="o">=</span>lz4<span class="w"> </span>mypool/data

<span class="c1"># Create snapshot</span>
sudo<span class="w"> </span>zfs<span class="w"> </span>snapshot<span class="w"> </span>mypool/data@snapshot1
</pre></div>
</div>
</section>
<section id="fat32-and-ntfs">
<h5>FAT32 and NTFS<a class="headerlink" href="#fat32-and-ntfs" title="Link to this heading"></a></h5>
<p><strong>FAT32</strong>: Universal compatibility, limited file size (4GB max)
<strong>NTFS</strong>: Windows filesystem with advanced features</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create FAT32 filesystem</span>
sudo<span class="w"> </span>mkfs.fat<span class="w"> </span>-F32<span class="w"> </span>/dev/sdb1

<span class="c1"># Create NTFS filesystem</span>
sudo<span class="w"> </span>mkfs.ntfs<span class="w"> </span>/dev/sdb1

<span class="c1"># Mount NTFS with full permissions</span>
sudo<span class="w"> </span>mount<span class="w"> </span>-t<span class="w"> </span>ntfs-3g<span class="w"> </span>/dev/sdb1<span class="w"> </span>/mnt/ntfs<span class="w"> </span>-o<span class="w"> </span>permissions
</pre></div>
</div>
</section>
</section>
<section id="file-system-operations-in-ubuntu-22-04">
<h4>File System Operations in Ubuntu 22.04<a class="headerlink" href="#file-system-operations-in-ubuntu-22-04" title="Link to this heading"></a></h4>
<section id="creating-file-systems">
<h5>Creating File Systems<a class="headerlink" href="#creating-file-systems" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># ext4 with custom options</span>
sudo<span class="w"> </span>mkfs.ext4<span class="w"> </span>-L<span class="w"> </span><span class="s2">&quot;MyData&quot;</span><span class="w"> </span>-m<span class="w"> </span><span class="m">1</span><span class="w"> </span>/dev/sdb1

<span class="c1"># XFS with custom block size</span>
sudo<span class="w"> </span>mkfs.xfs<span class="w"> </span>-f<span class="w"> </span>-b<span class="w"> </span><span class="nv">size</span><span class="o">=</span><span class="m">4096</span><span class="w"> </span>/dev/sdb1

<span class="c1"># Btrfs with multiple devices (RAID)</span>
sudo<span class="w"> </span>mkfs.btrfs<span class="w"> </span>-d<span class="w"> </span>raid1<span class="w"> </span>-m<span class="w"> </span>raid1<span class="w"> </span>/dev/sdb1<span class="w"> </span>/dev/sdc1

<span class="c1"># Set filesystem label</span>
sudo<span class="w"> </span>e2label<span class="w"> </span>/dev/sdb1<span class="w"> </span><span class="s2">&quot;DataDisk&quot;</span>
</pre></div>
</div>
</section>
<section id="mounting-file-systems">
<h5>Mounting File Systems<a class="headerlink" href="#mounting-file-systems" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Basic mounting</span>
sudo<span class="w"> </span>mount<span class="w"> </span>/dev/sdb1<span class="w"> </span>/mnt/data

<span class="c1"># Mount with specific options</span>
sudo<span class="w"> </span>mount<span class="w"> </span>-o<span class="w"> </span>rw,noatime,discard<span class="w"> </span>/dev/sdb1<span class="w"> </span>/mnt/data

<span class="c1"># Mount by UUID (preferred method)</span>
sudo<span class="w"> </span>mount<span class="w"> </span><span class="nv">UUID</span><span class="o">=</span><span class="m">12345678</span>-1234-1234-1234-123456789abc<span class="w"> </span>/mnt/data

<span class="c1"># Mount with user permissions</span>
sudo<span class="w"> </span>mount<span class="w"> </span>-o<span class="w"> </span><span class="nv">uid</span><span class="o">=</span><span class="m">1000</span>,gid<span class="o">=</span><span class="m">1000</span><span class="w"> </span>/dev/sdb1<span class="w"> </span>/mnt/data
</pre></div>
</div>
</section>
<section id="checking-and-repairing-file-systems">
<h5>Checking and Repairing File Systems<a class="headerlink" href="#checking-and-repairing-file-systems" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check filesystem (read-only)</span>
sudo<span class="w"> </span>fsck<span class="w"> </span>-n<span class="w"> </span>/dev/sdb1

<span class="c1"># Automatic repair</span>
sudo<span class="w"> </span>fsck<span class="w"> </span>-p<span class="w"> </span>/dev/sdb1

<span class="c1"># Force check and repair</span>
sudo<span class="w"> </span>fsck<span class="w"> </span>-f<span class="w"> </span>/dev/sdb1

<span class="c1"># Check specific filesystem types</span>
sudo<span class="w"> </span>fsck.ext4<span class="w"> </span>/dev/sdb1
sudo<span class="w"> </span>xfs_check<span class="w"> </span>/dev/sdb1
sudo<span class="w"> </span>btrfs<span class="w"> </span>check<span class="w"> </span>/dev/sdb1
</pre></div>
</div>
</section>
</section>
<section id="file-system-monitoring">
<h4>File System Monitoring<a class="headerlink" href="#file-system-monitoring" title="Link to this heading"></a></h4>
<section id="monitoring-tools-and-commands">
<h5>Monitoring Tools and Commands<a class="headerlink" href="#monitoring-tools-and-commands" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Real-time filesystem usage</span>
watch<span class="w"> </span>df<span class="w"> </span>-h

<span class="c1"># Inode usage</span>
df<span class="w"> </span>-i

<span class="c1"># Detailed filesystem information</span>
stat<span class="w"> </span>-f<span class="w"> </span>/

<span class="c1"># Monitor filesystem I/O</span>
sudo<span class="w"> </span>iotop<span class="w"> </span>-o

<span class="c1"># Check filesystem fragmentation (ext4)</span>
sudo<span class="w"> </span>e4defrag<span class="w"> </span>-c<span class="w"> </span>/dev/sdb1

<span class="c1"># Btrfs filesystem usage</span>
sudo<span class="w"> </span>btrfs<span class="w"> </span>filesystem<span class="w"> </span>usage<span class="w"> </span>/mnt/btrfs
</pre></div>
</div>
</section>
</section>
<section id="frequently-asked-questions">
<h4>Frequently Asked Questions<a class="headerlink" href="#frequently-asked-questions" title="Link to this heading"></a></h4>
<section id="q-which-filesystem-should-i-choose-for-ubuntu-22-04">
<h5>Q: Which filesystem should I choose for Ubuntu 22.04?<a class="headerlink" href="#q-which-filesystem-should-i-choose-for-ubuntu-22-04" title="Link to this heading"></a></h5>
<p><strong>A:</strong> Filesystem selection depends on your use case:</p>
<ul class="simple">
<li><p><strong>ext4</strong>: Best general-purpose choice, default for Ubuntu</p></li>
<li><p><strong>XFS</strong>: Large files, databases, high-performance needs</p></li>
<li><p><strong>Btrfs</strong>: Need snapshots, compression, or advanced features</p></li>
<li><p><strong>ZFS</strong>: Enterprise features, data integrity critical</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># For most users (recommended)</span>
sudo<span class="w"> </span>mkfs.ext4<span class="w"> </span>/dev/sdb1

<span class="c1"># For large files and databases</span>
sudo<span class="w"> </span>mkfs.xfs<span class="w"> </span>/dev/sdb1

<span class="c1"># For snapshots and modern features</span>
sudo<span class="w"> </span>mkfs.btrfs<span class="w"> </span>/dev/sdb1
</pre></div>
</div>
</section>
<section id="q-how-do-i-convert-between-filesystems">
<h5>Q: How do I convert between filesystems?<a class="headerlink" href="#q-how-do-i-convert-between-filesystems" title="Link to this heading"></a></h5>
<p><strong>A:</strong> Filesystem conversion requires backup and restore:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. Backup data</span>
sudo<span class="w"> </span>rsync<span class="w"> </span>-av<span class="w"> </span>/mnt/source/<span class="w"> </span>/backup/

<span class="c1"># 2. Unmount and recreate filesystem</span>
sudo<span class="w"> </span>umount<span class="w"> </span>/mnt/source
sudo<span class="w"> </span>mkfs.ext4<span class="w"> </span>/dev/sdb1

<span class="c1"># 3. Mount and restore data</span>
sudo<span class="w"> </span>mount<span class="w"> </span>/dev/sdb1<span class="w"> </span>/mnt/source
sudo<span class="w"> </span>rsync<span class="w"> </span>-av<span class="w"> </span>/backup/<span class="w"> </span>/mnt/source/
</pre></div>
</div>
</section>
<section id="q-how-do-i-optimize-filesystem-performance">
<h5>Q: How do I optimize filesystem performance?<a class="headerlink" href="#q-how-do-i-optimize-filesystem-performance" title="Link to this heading"></a></h5>
<p><strong>A:</strong> Several optimization techniques:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># For SSDs - enable TRIM</span>
sudo<span class="w"> </span>mount<span class="w"> </span>-o<span class="w"> </span>discard<span class="w"> </span>/dev/sdb1<span class="w"> </span>/mnt/data

<span class="c1"># Disable access time updates</span>
sudo<span class="w"> </span>mount<span class="w"> </span>-o<span class="w"> </span>noatime<span class="w"> </span>/dev/sdb1<span class="w"> </span>/mnt/data

<span class="c1"># For databases - use direct I/O</span>
sudo<span class="w"> </span>mount<span class="w"> </span>-o<span class="w"> </span><span class="nv">barrier</span><span class="o">=</span><span class="m">0</span><span class="w"> </span>/dev/sdb1<span class="w"> </span>/mnt/database

<span class="c1"># Optimize ext4 for SSDs</span>
sudo<span class="w"> </span>tune2fs<span class="w"> </span>-o<span class="w"> </span>discard<span class="w"> </span>/dev/sdb1
</pre></div>
</div>
</section>
<section id="q-how-do-i-recover-deleted-files">
<h5>Q: How do I recover deleted files?<a class="headerlink" href="#q-how-do-i-recover-deleted-files" title="Link to this heading"></a></h5>
<p><strong>A:</strong> Recovery methods depend on the filesystem:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install recovery tools</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>testdisk<span class="w"> </span>photorec<span class="w"> </span>extundelete

<span class="c1"># For ext4 filesystems</span>
sudo<span class="w"> </span>extundelete<span class="w"> </span>/dev/sdb1<span class="w"> </span>--restore-all

<span class="c1"># General purpose recovery</span>
sudo<span class="w"> </span>photorec<span class="w"> </span>/dev/sdb1

<span class="c1"># For immediate action after deletion</span>
sudo<span class="w"> </span>grep<span class="w"> </span>-a<span class="w"> </span>-B25<span class="w"> </span>-A25<span class="w"> </span><span class="s1">&#39;text from deleted file&#39;</span><span class="w"> </span>/dev/sdb1
</pre></div>
</div>
</section>
</section>
<section id="coding-examples">
<h4>Coding Examples<a class="headerlink" href="#coding-examples" title="Link to this heading"></a></h4>
<section id="python-filesystem-analyzer">
<h5>Python Filesystem Analyzer<a class="headerlink" href="#python-filesystem-analyzer" title="Link to this heading"></a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Filesystem analyzer for Ubuntu 22.04</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="k">class</span><span class="w"> </span><span class="nc">FilesystemAnalyzer</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mountpoints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mountpoints</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_mountpoints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all mounted filesystems&quot;&quot;&quot;</span>
        <span class="n">mountpoints</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/proc/mounts&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;/dev/&#39;</span><span class="p">):</span>
                        <span class="n">mountpoints</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                            <span class="s1">&#39;device&#39;</span><span class="p">:</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                            <span class="s1">&#39;mountpoint&#39;</span><span class="p">:</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                            <span class="s1">&#39;filesystem&#39;</span><span class="p">:</span> <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                            <span class="s1">&#39;options&#39;</span><span class="p">:</span> <span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                        <span class="p">})</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error reading mount points: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">mountpoints</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">analyze_filesystem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Analyze filesystem usage and characteristics&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Get basic filesystem statistics</span>
            <span class="n">statvfs</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">statvfs</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

            <span class="n">total_size</span> <span class="o">=</span> <span class="n">statvfs</span><span class="o">.</span><span class="n">f_frsize</span> <span class="o">*</span> <span class="n">statvfs</span><span class="o">.</span><span class="n">f_blocks</span>
            <span class="n">free_size</span> <span class="o">=</span> <span class="n">statvfs</span><span class="o">.</span><span class="n">f_frsize</span> <span class="o">*</span> <span class="n">statvfs</span><span class="o">.</span><span class="n">f_bavail</span>
            <span class="n">used_size</span> <span class="o">=</span> <span class="n">total_size</span> <span class="o">-</span> <span class="n">free_size</span>

            <span class="c1"># Get inode information</span>
            <span class="n">total_inodes</span> <span class="o">=</span> <span class="n">statvfs</span><span class="o">.</span><span class="n">f_files</span>
            <span class="n">free_inodes</span> <span class="o">=</span> <span class="n">statvfs</span><span class="o">.</span><span class="n">f_favail</span>
            <span class="n">used_inodes</span> <span class="o">=</span> <span class="n">total_inodes</span> <span class="o">-</span> <span class="n">free_inodes</span>

            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">path</span><span class="p">,</span>
                <span class="s1">&#39;total_size_gb&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">total_size</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>
                <span class="s1">&#39;used_size_gb&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">used_size</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>
                <span class="s1">&#39;free_size_gb&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">free_size</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>
                <span class="s1">&#39;usage_percent&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">((</span><span class="n">used_size</span> <span class="o">/</span> <span class="n">total_size</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                <span class="s1">&#39;total_inodes&#39;</span><span class="p">:</span> <span class="n">total_inodes</span><span class="p">,</span>
                <span class="s1">&#39;used_inodes&#39;</span><span class="p">:</span> <span class="n">used_inodes</span><span class="p">,</span>
                <span class="s1">&#39;free_inodes&#39;</span><span class="p">:</span> <span class="n">free_inodes</span><span class="p">,</span>
                <span class="s1">&#39;inode_usage_percent&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">((</span><span class="n">used_inodes</span> <span class="o">/</span> <span class="n">total_inodes</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">total_inodes</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="p">}</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_largest_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">min_size_mb</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find largest files in a directory tree&quot;&quot;&quot;</span>
        <span class="n">large_files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">min_size_bytes</span> <span class="o">=</span> <span class="n">min_size_mb</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="c1"># Skip certain directories to avoid permission errors</span>
                <span class="n">dirs</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dirs</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">d</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">d</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;proc&#39;</span><span class="p">,</span> <span class="s1">&#39;sys&#39;</span><span class="p">,</span> <span class="s1">&#39;dev&#39;</span><span class="p">]]</span>

                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
                        <span class="n">file_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">file_size</span> <span class="o">&gt;=</span> <span class="n">min_size_bytes</span><span class="p">:</span>
                            <span class="n">large_files</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                                <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">file_path</span><span class="p">,</span>
                                <span class="s1">&#39;size_mb&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">file_size</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>
                                <span class="s1">&#39;size_gb&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">file_size</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
                            <span class="p">})</span>
                    <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">IOError</span><span class="p">):</span>
                        <span class="k">continue</span>  <span class="c1"># Skip files we can&#39;t access</span>

            <span class="c1"># Sort by size and return top files</span>
            <span class="n">large_files</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;size_mb&#39;</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">large_files</span><span class="p">[:</span><span class="n">count</span><span class="p">]</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[{</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_directory_sizes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get sizes of directories&quot;&quot;&quot;</span>
        <span class="n">directory_sizes</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;du&#39;</span><span class="p">,</span> <span class="s1">&#39;-h&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;--max-depth=</span><span class="si">{</span><span class="n">max_depth</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">],</span>
                                  <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">n&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">t&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">size</span><span class="p">,</span> <span class="n">dir_path</span> <span class="o">=</span> <span class="n">parts</span>
                        <span class="n">directory_sizes</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                            <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">dir_path</span><span class="p">,</span>
                            <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">size</span>
                        <span class="p">})</span>

            <span class="k">return</span> <span class="n">directory_sizes</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[{</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_filesystem_health</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check filesystem health using fsck&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Run read-only check</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;fsck&#39;</span><span class="p">,</span> <span class="s1">&#39;-n&#39;</span><span class="p">,</span> <span class="n">device</span><span class="p">],</span>
                                  <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;device&#39;</span><span class="p">:</span> <span class="n">device</span><span class="p">,</span>
                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;clean&#39;</span> <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;errors_found&#39;</span><span class="p">,</span>
                <span class="s1">&#39;output&#39;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span>
                <span class="s1">&#39;errors&#39;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">stderr</span>
            <span class="p">}</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;device&#39;</span><span class="p">:</span> <span class="n">device</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">monitor_filesystem_performance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Monitor filesystem I/O performance&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Start iostat monitoring</span>
            <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s1">&#39;iostat&#39;</span><span class="p">,</span> <span class="s1">&#39;-x&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">duration</span><span class="p">)],</span>
                                     <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                                     <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                                     <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">output</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>

            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;duration&#39;</span><span class="p">:</span> <span class="n">duration</span><span class="p">,</span>
                <span class="s1">&#39;iostat_output&#39;</span><span class="p">:</span> <span class="n">output</span><span class="p">,</span>
                <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="n">error</span> <span class="k">if</span> <span class="n">error</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="p">}</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate comprehensive filesystem report&quot;&quot;&quot;</span>
        <span class="n">report</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">),</span>
            <span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">uname</span><span class="p">()</span><span class="o">.</span><span class="n">nodename</span><span class="p">,</span>
            <span class="s1">&#39;mountpoints&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mountpoints</span><span class="p">,</span>
            <span class="s1">&#39;filesystem_analysis&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;large_files&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;directory_sizes&#39;</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>

        <span class="c1"># Analyze each mounted filesystem</span>
        <span class="k">for</span> <span class="n">mount</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mountpoints</span><span class="p">:</span>
            <span class="n">analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_filesystem</span><span class="p">(</span><span class="n">mount</span><span class="p">[</span><span class="s1">&#39;mountpoint&#39;</span><span class="p">])</span>
            <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;device&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mount</span><span class="p">[</span><span class="s1">&#39;device&#39;</span><span class="p">]</span>
            <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;filesystem_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mount</span><span class="p">[</span><span class="s1">&#39;filesystem&#39;</span><span class="p">]</span>
            <span class="n">report</span><span class="p">[</span><span class="s1">&#39;filesystem_analysis&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">analysis</span><span class="p">)</span>

        <span class="c1"># Find large files in home and var directories</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;/home&#39;</span><span class="p">,</span> <span class="s1">&#39;/var&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="n">large_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_largest_files</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">min_size_mb</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
                <span class="n">report</span><span class="p">[</span><span class="s1">&#39;large_files&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">large_files</span><span class="p">)</span>

        <span class="c1"># Get directory sizes for common directories</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;/home&#39;</span><span class="p">,</span> <span class="s1">&#39;/var&#39;</span><span class="p">,</span> <span class="s1">&#39;/usr&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="n">dir_sizes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_directory_sizes</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">report</span><span class="p">[</span><span class="s1">&#39;directory_sizes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">dir_sizes</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">report</span>

<span class="c1"># Example usage</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">analyzer</span> <span class="o">=</span> <span class="n">FilesystemAnalyzer</span><span class="p">()</span>

    <span class="c1"># Generate and display report</span>
    <span class="n">report</span> <span class="o">=</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">generate_report</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">report</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

    <span class="c1"># Save report to file</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;/tmp/filesystem_report_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span><span class="si">}</span><span class="s1">.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">report</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="bash-filesystem-management-script">
<h5>Bash Filesystem Management Script<a class="headerlink" href="#bash-filesystem-management-script" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1"># filesystem_manager.sh - Comprehensive filesystem management for Ubuntu 22.04</span>

<span class="c1"># Configuration</span>
<span class="nv">BACKUP_DIR</span><span class="o">=</span><span class="s2">&quot;/backup&quot;</span>
<span class="nv">LOG_FILE</span><span class="o">=</span><span class="s2">&quot;/var/log/filesystem_manager.log&quot;</span>

<span class="c1"># Colors</span>
<span class="nv">RED</span><span class="o">=</span><span class="s1">&#39;\033[0;31m&#39;</span>
<span class="nv">GREEN</span><span class="o">=</span><span class="s1">&#39;\033[0;32m&#39;</span>
<span class="nv">YELLOW</span><span class="o">=</span><span class="s1">&#39;\033[1;33m&#39;</span>
<span class="nv">BLUE</span><span class="o">=</span><span class="s1">&#39;\033[0;34m&#39;</span>
<span class="nv">NC</span><span class="o">=</span><span class="s1">&#39;\033[0m&#39;</span>

<span class="c1"># Logging function</span>
log_message<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>date<span class="w"> </span><span class="s1">&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span class="k">)</span><span class="s2"> - </span><span class="nv">$1</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LOG_FILE</span><span class="s2">&quot;</span>
<span class="o">}</span>

<span class="c1"># Check if running as root</span>
check_root<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$EUID</span><span class="w"> </span>-ne<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">RED</span><span class="si">}</span><span class="s2">This script must be run as root</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>
<span class="o">}</span>

<span class="c1"># Display filesystem information</span>
show_filesystem_info<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BLUE</span><span class="si">}</span><span class="s2">=== Filesystem Information ===</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Mounted Filesystems:&quot;</span>
<span class="w">    </span>df<span class="w"> </span>-hT<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-v<span class="w"> </span>tmpfs
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Filesystem Types:&quot;</span>
<span class="w">    </span>lsblk<span class="w"> </span>-f
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Mount Points:&quot;</span>
<span class="w">    </span>mount<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;^/dev&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>column<span class="w"> </span>-t
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="o">}</span>

<span class="c1"># Create filesystem with optimal settings</span>
create_filesystem<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">device</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">fstype</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">label</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$3</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$fstype</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Usage: create_filesystem &lt;device&gt; &lt;filesystem_type&gt; [label]&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Supported types: ext4, xfs, btrfs&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">YELLOW</span><span class="si">}</span><span class="s2">Creating </span><span class="nv">$fstype</span><span class="s2"> filesystem on </span><span class="nv">$device</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$fstype</span><span class="s2">&quot;</span><span class="w"> </span><span class="k">in</span>
<span class="w">        </span><span class="s2">&quot;ext4&quot;</span><span class="o">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$label</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span>mkfs.ext4<span class="w"> </span>-L<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$label</span><span class="s2">&quot;</span><span class="w"> </span>-m<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">                </span>mkfs.ext4<span class="w"> </span>-m<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="k">fi</span>

<span class="w">            </span><span class="c1"># Optimize for SSD if detected</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="k">$(</span>cat<span class="w"> </span>/sys/block/<span class="k">$(</span>basename<span class="w"> </span><span class="nv">$device</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s1">&#39;s/[0-9]*$//&#39;</span><span class="k">)</span>/queue/rotational<span class="k">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span>tune2fs<span class="w"> </span>-o<span class="w"> </span>discard<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;SSD optimizations applied&quot;</span>
<span class="w">            </span><span class="k">fi</span>
<span class="w">            </span><span class="p">;;</span>

<span class="w">        </span><span class="s2">&quot;xfs&quot;</span><span class="o">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$label</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span>mkfs.xfs<span class="w"> </span>-f<span class="w"> </span>-L<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$label</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">                </span>mkfs.xfs<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="k">fi</span>
<span class="w">            </span><span class="p">;;</span>

<span class="w">        </span><span class="s2">&quot;btrfs&quot;</span><span class="o">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$label</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span>mkfs.btrfs<span class="w"> </span>-f<span class="w"> </span>-L<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$label</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">                </span>mkfs.btrfs<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="k">fi</span>
<span class="w">            </span><span class="p">;;</span>

<span class="w">        </span>*<span class="o">)</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">RED</span><span class="si">}</span><span class="s2">Unsupported filesystem type: </span><span class="nv">$fstype</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">    </span><span class="k">esac</span>

<span class="w">    </span>log_message<span class="w"> </span><span class="s2">&quot;Created </span><span class="nv">$fstype</span><span class="s2"> filesystem on </span><span class="nv">$device</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="s2">Filesystem created successfully</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="o">}</span>

<span class="c1"># Mount filesystem with optimal options</span>
mount_filesystem<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">device</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">mountpoint</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">fstype</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$3</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$mountpoint</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Usage: mount_filesystem &lt;device&gt; &lt;mountpoint&gt; [filesystem_type]&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="c1"># Create mountpoint if it doesn&#39;t exist</span>
<span class="w">    </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$mountpoint</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="c1"># Detect filesystem type if not provided</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$fstype</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nv">fstype</span><span class="o">=</span><span class="k">$(</span>blkid<span class="w"> </span>-o<span class="w"> </span>value<span class="w"> </span>-s<span class="w"> </span>TYPE<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="k">)</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="c1"># Set optimal mount options based on filesystem type</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$fstype</span><span class="s2">&quot;</span><span class="w"> </span><span class="k">in</span>
<span class="w">        </span><span class="s2">&quot;ext4&quot;</span><span class="o">)</span>
<span class="w">            </span><span class="nv">mount_options</span><span class="o">=</span><span class="s2">&quot;defaults,noatime&quot;</span>
<span class="w">            </span><span class="c1"># Add discard for SSDs</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="k">$(</span>cat<span class="w"> </span>/sys/block/<span class="k">$(</span>basename<span class="w"> </span><span class="nv">$device</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s1">&#39;s/[0-9]*$//&#39;</span><span class="k">)</span>/queue/rotational<span class="k">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span><span class="nv">mount_options</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$mount_options</span><span class="s2">,discard&quot;</span>
<span class="w">            </span><span class="k">fi</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">        </span><span class="s2">&quot;xfs&quot;</span><span class="o">)</span>
<span class="w">            </span><span class="nv">mount_options</span><span class="o">=</span><span class="s2">&quot;defaults,noatime&quot;</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">        </span><span class="s2">&quot;btrfs&quot;</span><span class="o">)</span>
<span class="w">            </span><span class="nv">mount_options</span><span class="o">=</span><span class="s2">&quot;defaults,noatime,compress=zstd&quot;</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">        </span>*<span class="o">)</span>
<span class="w">            </span><span class="nv">mount_options</span><span class="o">=</span><span class="s2">&quot;defaults&quot;</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">    </span><span class="k">esac</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">YELLOW</span><span class="si">}</span><span class="s2">Mounting </span><span class="nv">$device</span><span class="s2"> at </span><span class="nv">$mountpoint</span><span class="s2"> with options: </span><span class="nv">$mount_options</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span>mount<span class="w"> </span>-o<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$mount_options</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$mountpoint</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span>log_message<span class="w"> </span><span class="s2">&quot;Mounted </span><span class="nv">$device</span><span class="s2"> at </span><span class="nv">$mountpoint</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="s2">Filesystem mounted successfully</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="w">        </span><span class="c1"># Add to fstab for permanent mounting</span>
<span class="w">        </span><span class="nv">uuid</span><span class="o">=</span><span class="k">$(</span>blkid<span class="w"> </span>-o<span class="w"> </span>value<span class="w"> </span>-s<span class="w"> </span>UUID<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="k">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$uuid</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;UUID=</span><span class="nv">$uuid</span><span class="s2"> </span><span class="nv">$mountpoint</span><span class="s2"> </span><span class="nv">$fstype</span><span class="s2"> </span><span class="nv">$mount_options</span><span class="s2"> 0 2&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/fstab
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Added to /etc/fstab for automatic mounting&quot;</span>
<span class="w">        </span><span class="k">fi</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">RED</span><span class="si">}</span><span class="s2">Failed to mount filesystem</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>
<span class="o">}</span>

<span class="c1"># Check filesystem health</span>
check_filesystem_health<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">device</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Usage: check_filesystem_health &lt;device&gt;&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BLUE</span><span class="si">}</span><span class="s2">=== Checking filesystem health for </span><span class="nv">$device</span><span class="s2"> ===</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="c1"># Get filesystem type</span>
<span class="w">    </span><span class="nv">fstype</span><span class="o">=</span><span class="k">$(</span>blkid<span class="w"> </span>-o<span class="w"> </span>value<span class="w"> </span>-s<span class="w"> </span>TYPE<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="k">)</span>

<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$fstype</span><span class="s2">&quot;</span><span class="w"> </span><span class="k">in</span>
<span class="w">        </span><span class="s2">&quot;ext4&quot;</span><span class="p">|</span><span class="s2">&quot;ext3&quot;</span><span class="p">|</span><span class="s2">&quot;ext2&quot;</span><span class="o">)</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Running fsck for ext filesystem...&quot;</span>
<span class="w">            </span>fsck.ext4<span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">        </span><span class="s2">&quot;xfs&quot;</span><span class="o">)</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Running xfs_check...&quot;</span>
<span class="w">            </span>xfs_check<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">        </span><span class="s2">&quot;btrfs&quot;</span><span class="o">)</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Running btrfs check...&quot;</span>
<span class="w">            </span>btrfs<span class="w"> </span>check<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">        </span>*<span class="o">)</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Running generic fsck...&quot;</span>
<span class="w">            </span>fsck<span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">    </span><span class="k">esac</span>

<span class="w">    </span>log_message<span class="w"> </span><span class="s2">&quot;Filesystem health check completed for </span><span class="nv">$device</span><span class="s2">&quot;</span>
<span class="o">}</span>

<span class="c1"># Optimize filesystem performance</span>
optimize_filesystem<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">mountpoint</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$mountpoint</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Usage: optimize_filesystem &lt;mountpoint&gt;&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BLUE</span><span class="si">}</span><span class="s2">=== Optimizing filesystem at </span><span class="nv">$mountpoint</span><span class="s2"> ===</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="c1"># Get device and filesystem type</span>
<span class="w">    </span><span class="nv">device</span><span class="o">=</span><span class="k">$(</span>df<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$mountpoint</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-1<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $1}&#39;</span><span class="k">)</span>
<span class="w">    </span><span class="nv">fstype</span><span class="o">=</span><span class="k">$(</span>df<span class="w"> </span>-T<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$mountpoint</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-1<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $2}&#39;</span><span class="k">)</span>

<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$fstype</span><span class="s2">&quot;</span><span class="w"> </span><span class="k">in</span>
<span class="w">        </span><span class="s2">&quot;ext4&quot;</span><span class="o">)</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Optimizing ext4 filesystem...&quot;</span>

<span class="w">            </span><span class="c1"># Defragment if needed</span>
<span class="w">            </span>e4defrag<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$mountpoint</span><span class="s2">&quot;</span>

<span class="w">            </span><span class="c1"># Optimize inode allocation</span>
<span class="w">            </span>tune2fs<span class="w"> </span>-o<span class="w"> </span>journal_data_writeback<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span>

<span class="w">            </span><span class="c1"># Enable TRIM for SSDs</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="k">$(</span>cat<span class="w"> </span>/sys/block/<span class="k">$(</span>basename<span class="w"> </span><span class="nv">$device</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s1">&#39;s/[0-9]*$//&#39;</span><span class="k">)</span>/queue/rotational<span class="k">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span>tune2fs<span class="w"> </span>-o<span class="w"> </span>discard<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;SSD optimizations applied&quot;</span>
<span class="w">            </span><span class="k">fi</span>
<span class="w">            </span><span class="p">;;</span>

<span class="w">        </span><span class="s2">&quot;xfs&quot;</span><span class="o">)</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Optimizing XFS filesystem...&quot;</span>

<span class="w">            </span><span class="c1"># XFS is generally well-optimized by default</span>
<span class="w">            </span><span class="c1"># Check if online defragmentation is needed</span>
<span class="w">            </span>xfs_fsr<span class="w"> </span>-v<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$mountpoint</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="p">;;</span>

<span class="w">        </span><span class="s2">&quot;btrfs&quot;</span><span class="o">)</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Optimizing Btrfs filesystem...&quot;</span>

<span class="w">            </span><span class="c1"># Balance filesystem</span>
<span class="w">            </span>btrfs<span class="w"> </span>balance<span class="w"> </span>start<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$mountpoint</span><span class="s2">&quot;</span>

<span class="w">            </span><span class="c1"># Defragment</span>
<span class="w">            </span>btrfs<span class="w"> </span>filesystem<span class="w"> </span>defragment<span class="w"> </span>-r<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$mountpoint</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">    </span><span class="k">esac</span>

<span class="w">    </span>log_message<span class="w"> </span><span class="s2">&quot;Filesystem optimization completed for </span><span class="nv">$mountpoint</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="s2">Optimization completed</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="o">}</span>

<span class="c1"># Backup filesystem</span>
backup_filesystem<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">source</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">backup_name</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$source</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Usage: backup_filesystem &lt;source_mountpoint&gt; [backup_name]&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$backup_name</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nv">backup_name</span><span class="o">=</span><span class="s2">&quot;filesystem_backup_</span><span class="k">$(</span>date<span class="w"> </span>+%Y%m%d_%H%M%S<span class="k">)</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="nv">backup_path</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$BACKUP_DIR</span><span class="s2">/</span><span class="nv">$backup_name</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">YELLOW</span><span class="si">}</span><span class="s2">Creating backup of </span><span class="nv">$source</span><span class="s2"> to </span><span class="nv">$backup_path</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="c1"># Create backup directory</span>
<span class="w">    </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$backup_path</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="c1"># Use rsync for efficient backup</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span>rsync<span class="w"> </span>-avH<span class="w"> </span>--progress<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$source</span><span class="s2">/&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$backup_path</span><span class="s2">/&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span>log_message<span class="w"> </span><span class="s2">&quot;Backup created: </span><span class="nv">$source</span><span class="s2"> -&gt; </span><span class="nv">$backup_path</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="s2">Backup completed successfully</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="w">        </span><span class="c1"># Create metadata file</span>
<span class="w">        </span>cat<span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$backup_path</span><span class="s2">/.backup_info&quot;</span><span class="w"> </span><span class="s">&lt;&lt; EOF</span>
<span class="s">Source: $source</span>
<span class="s">Backup Date: $(date)</span>
<span class="s">Backup Size: $(du -sh &quot;$backup_path&quot; | cut -f1)</span>
<span class="s">EOF</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">RED</span><span class="si">}</span><span class="s2">Backup failed</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>
<span class="o">}</span>

<span class="c1"># Monitor filesystem usage</span>
monitor_filesystem<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BLUE</span><span class="si">}</span><span class="s2">=== Filesystem Usage Monitor ===</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="k">while</span><span class="w"> </span>true<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">        </span>clear
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Filesystem Usage (updated every 5 seconds) - Press Ctrl+C to exit&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;================================================================&quot;</span>

<span class="w">        </span>df<span class="w"> </span>-h<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;^Filesystem|^/dev&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>

<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;I/O Statistics:&quot;</span>
<span class="w">        </span>iostat<span class="w"> </span>-x<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-n<span class="w"> </span>+4
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>

<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Top 5 largest directories in /:&quot;</span>
<span class="w">        </span>du<span class="w"> </span>-h<span class="w"> </span>--max-depth<span class="o">=</span><span class="m">1</span><span class="w"> </span>/<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-hr<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-5

<span class="w">        </span>sleep<span class="w"> </span><span class="m">5</span>
<span class="w">    </span><span class="k">done</span>
<span class="o">}</span>

<span class="c1"># Main menu</span>
<span class="k">case</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">1</span><span class="k">:-</span><span class="nv">help</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="k">in</span>
<span class="w">    </span><span class="s2">&quot;info&quot;</span><span class="o">)</span>
<span class="w">        </span>show_filesystem_info
<span class="w">        </span><span class="p">;;</span>
<span class="w">    </span><span class="s2">&quot;create&quot;</span><span class="o">)</span>
<span class="w">        </span>check_root
<span class="w">        </span>create_filesystem<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$3</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$4</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="p">;;</span>
<span class="w">    </span><span class="s2">&quot;mount&quot;</span><span class="o">)</span>
<span class="w">        </span>check_root
<span class="w">        </span>mount_filesystem<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$3</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$4</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="p">;;</span>
<span class="w">    </span><span class="s2">&quot;check&quot;</span><span class="o">)</span>
<span class="w">        </span>check_root
<span class="w">        </span>check_filesystem_health<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="p">;;</span>
<span class="w">    </span><span class="s2">&quot;optimize&quot;</span><span class="o">)</span>
<span class="w">        </span>check_root
<span class="w">        </span>optimize_filesystem<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="p">;;</span>
<span class="w">    </span><span class="s2">&quot;backup&quot;</span><span class="o">)</span>
<span class="w">        </span>check_root
<span class="w">        </span>backup_filesystem<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$3</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="p">;;</span>
<span class="w">    </span><span class="s2">&quot;monitor&quot;</span><span class="o">)</span>
<span class="w">        </span>monitor_filesystem
<span class="w">        </span><span class="p">;;</span>
<span class="w">    </span><span class="s2">&quot;help&quot;</span><span class="p">|</span>*<span class="o">)</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Filesystem Manager for Ubuntu 22.04&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Usage: </span><span class="nv">$0</span><span class="s2"> [command] [options]&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Commands:&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  info                          - Show filesystem information&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  create &lt;device&gt; &lt;type&gt; [label] - Create filesystem&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  mount &lt;device&gt; &lt;mountpoint&gt;   - Mount filesystem with optimal options&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  check &lt;device&gt;                - Check filesystem health&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  optimize &lt;mountpoint&gt;         - Optimize filesystem performance&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  backup &lt;source&gt; [name]        - Backup filesystem&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  monitor                       - Monitor filesystem usage&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Supported filesystem types: ext4, xfs, btrfs&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Examples:&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  </span><span class="nv">$0</span><span class="s2"> create /dev/sdb1 ext4 MyData&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  </span><span class="nv">$0</span><span class="s2"> mount /dev/sdb1 /mnt/data&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  </span><span class="nv">$0</span><span class="s2"> check /dev/sdb1&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  </span><span class="nv">$0</span><span class="s2"> optimize /home&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  </span><span class="nv">$0</span><span class="s2"> backup /home home_backup&quot;</span>
<span class="w">        </span><span class="p">;;</span>
<span class="k">esac</span>
</pre></div>
</div>
</section>
</section>
<section id="best-practices-for-file-systems">
<h4>Best Practices for File Systems<a class="headerlink" href="#best-practices-for-file-systems" title="Link to this heading"></a></h4>
<section id="choosing-the-right-filesystem">
<h5>Choosing the Right Filesystem<a class="headerlink" href="#choosing-the-right-filesystem" title="Link to this heading"></a></h5>
<p><strong>Decision Matrix:</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Use Case                    | Recommended Filesystem
----------------------------|----------------------
General desktop/server      | ext4
Large files/databases       | XFS
Snapshots/modern features   | Btrfs
Maximum data integrity      | ZFS
Cross-platform compatibility| FAT32/NTFS
High-performance computing  | XFS or ext4
</pre></div>
</div>
</section>
<section id="performance-optimization">
<h5>Performance Optimization<a class="headerlink" href="#performance-optimization" title="Link to this heading"></a></h5>
<ol class="arabic">
<li><p><strong>Mount Options</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># For general use</span>
mount<span class="w"> </span>-o<span class="w"> </span>defaults,noatime<span class="w"> </span>/dev/sdb1<span class="w"> </span>/mnt/data

<span class="c1"># For SSDs</span>
mount<span class="w"> </span>-o<span class="w"> </span>defaults,noatime,discard<span class="w"> </span>/dev/sdb1<span class="w"> </span>/mnt/data

<span class="c1"># For databases</span>
mount<span class="w"> </span>-o<span class="w"> </span>defaults,noatime,barrier<span class="o">=</span><span class="m">0</span><span class="w"> </span>/dev/sdb1<span class="w"> </span>/mnt/database
</pre></div>
</div>
</li>
<li><p><strong>I/O Scheduler</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># For SSDs</span>
<span class="nb">echo</span><span class="w"> </span>none<span class="w"> </span>&gt;<span class="w"> </span>/sys/block/sda/queue/scheduler

<span class="c1"># For HDDs</span>
<span class="nb">echo</span><span class="w"> </span>mq-deadline<span class="w"> </span>&gt;<span class="w"> </span>/sys/block/sda/queue/scheduler
</pre></div>
</div>
</li>
<li><p><strong>Filesystem Tuning</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Optimize ext4 for SSDs</span>
tune2fs<span class="w"> </span>-o<span class="w"> </span>discard<span class="w"> </span>/dev/sda1

<span class="c1"># Reduce reserved space (ext4)</span>
tune2fs<span class="w"> </span>-m<span class="w"> </span><span class="m">1</span><span class="w"> </span>/dev/sda1
</pre></div>
</div>
</li>
</ol>
</section>
<section id="security-and-maintenance">
<h5>Security and Maintenance<a class="headerlink" href="#security-and-maintenance" title="Link to this heading"></a></h5>
<ol class="arabic">
<li><p><strong>Regular Checks</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Schedule regular filesystem checks</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;0 3 * * 0 /sbin/fsck -A -f&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/crontab
</pre></div>
</div>
</li>
<li><p><strong>Backup Strategy</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Automated backups</span>
rsync<span class="w"> </span>-avH<span class="w"> </span>/home/<span class="w"> </span>/backup/home/

<span class="c1"># Filesystem snapshots (Btrfs)</span>
btrfs<span class="w"> </span>subvolume<span class="w"> </span>snapshot<span class="w"> </span>/home<span class="w"> </span>/home/.snapshots/<span class="k">$(</span>date<span class="w"> </span>+%Y%m%d<span class="k">)</span>
</pre></div>
</div>
</li>
<li><p><strong>Monitoring</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set up disk usage alerts</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;df -h | awk &#39;NR&gt;1 {if(\$5+0 &gt; 85) print \$0}&#39; | mail -s &#39;Disk Alert&#39; admin@example.com&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>crontab<span class="w"> </span>-
</pre></div>
</div>
</li>
</ol>
</section>
</section>
</section>
</section>
<span id="document-data-organization"></span><section id="data-organization">
<h2>Data Organization<a class="headerlink" href="#data-organization" title="Link to this heading"></a></h2>
<section id="understanding-data-organization">
<h3>Understanding Data Organization<a class="headerlink" href="#understanding-data-organization" title="Link to this heading"></a></h3>
<p>Data organization refers to the systematic arrangement and structuring of data to optimize storage efficiency, access speed, and management ease. Proper data organization is crucial for system performance and data integrity.</p>
<section id="data-organization-fundamentals">
<h4>Data Organization Fundamentals<a class="headerlink" href="#data-organization-fundamentals" title="Link to this heading"></a></h4>
<section id="what-is-data-organization">
<h5>What is Data Organization?<a class="headerlink" href="#what-is-data-organization" title="Link to this heading"></a></h5>
<p>Data organization encompasses:</p>
<ul class="simple">
<li><p><strong>Data Structure</strong>: How data is arranged and stored</p></li>
<li><p><strong>Data Classification</strong>: Categorizing data by type, importance, and access patterns</p></li>
<li><p><strong>Data Hierarchy</strong>: Organizing data in logical levels and relationships</p></li>
<li><p><strong>Data Access Patterns</strong>: Understanding how data is accessed and used</p></li>
<li><p><strong>Data Lifecycle</strong>: Managing data from creation to deletion</p></li>
</ul>
</section>
</section>
<section id="data-classification-types">
<h4>Data Classification Types<a class="headerlink" href="#data-classification-types" title="Link to this heading"></a></h4>
<section id="by-access-frequency">
<h5>By Access Frequency<a class="headerlink" href="#by-access-frequency" title="Link to this heading"></a></h5>
<ol class="arabic simple">
<li><p><strong>Hot Data</strong>: Frequently accessed, requires fast storage (SSD)</p></li>
<li><p><strong>Warm Data</strong>: Occasionally accessed, standard performance storage</p></li>
<li><p><strong>Cold Data</strong>: Rarely accessed, slower but cost-effective storage</p></li>
<li><p><strong>Archival Data</strong>: Long-term retention, very infrequent access</p></li>
</ol>
</section>
<section id="by-data-type">
<h5>By Data Type<a class="headerlink" href="#by-data-type" title="Link to this heading"></a></h5>
<ol class="arabic simple">
<li><p><strong>Structured Data</strong>: Databases, spreadsheets, organized formats</p></li>
<li><p><strong>Semi-structured Data</strong>: JSON, XML, log files</p></li>
<li><p><strong>Unstructured Data</strong>: Documents, images, videos, emails</p></li>
</ol>
</section>
<section id="by-criticality">
<h5>By Criticality<a class="headerlink" href="#by-criticality" title="Link to this heading"></a></h5>
<ol class="arabic simple">
<li><p><strong>Critical Data</strong>: Business-essential, requires high availability</p></li>
<li><p><strong>Important Data</strong>: Significant but not critical</p></li>
<li><p><strong>Standard Data</strong>: Regular business data</p></li>
<li><p><strong>Temporary Data</strong>: Short-term, disposable data</p></li>
</ol>
</section>
</section>
<section id="ubuntu-22-04-data-organization-tools">
<h4>Ubuntu 22.04 Data Organization Tools<a class="headerlink" href="#ubuntu-22-04-data-organization-tools" title="Link to this heading"></a></h4>
<section id="directory-structure-best-practices">
<h5>Directory Structure Best Practices<a class="headerlink" href="#directory-structure-best-practices" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Standard Ubuntu directory structure</span>
/
├──<span class="w"> </span>home/<span class="w">           </span><span class="c1"># User data</span>
├──<span class="w"> </span>var/<span class="w">            </span><span class="c1"># Variable data (logs, databases)</span>
├──<span class="w"> </span>usr/<span class="w">            </span><span class="c1"># User programs and libraries</span>
├──<span class="w"> </span>opt/<span class="w">            </span><span class="c1"># Optional software packages</span>
├──<span class="w"> </span>srv/<span class="w">            </span><span class="c1"># Service data</span>
├──<span class="w"> </span>tmp/<span class="w">            </span><span class="c1"># Temporary files</span>
└──<span class="w"> </span>mnt/<span class="w">            </span><span class="c1"># Mount points for external storage</span>

<span class="c1"># Recommended user data organization</span>
/home/username/
├──<span class="w"> </span>Documents/<span class="w">      </span><span class="c1"># Personal documents</span>
├──<span class="w"> </span>Projects/<span class="w">       </span><span class="c1"># Development projects</span>
├──<span class="w"> </span>Media/<span class="w">          </span><span class="c1"># Photos, videos, music</span>
├──<span class="w"> </span>Archive/<span class="w">        </span><span class="c1"># Old/archived files</span>
├──<span class="w"> </span>Backup/<span class="w">         </span><span class="c1"># Local backups</span>
└──<span class="w"> </span>Work/<span class="w">           </span><span class="c1"># Work-related files</span>
</pre></div>
</div>
</section>
<section id="file-organization-commands">
<h5>File Organization Commands<a class="headerlink" href="#file-organization-commands" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create organized directory structure</span>
mkdir<span class="w"> </span>-p<span class="w"> </span>~/Documents/<span class="o">{</span>Personal,Work<span class="o">}</span>/<span class="o">{</span><span class="m">2024</span>,2023,Archive<span class="o">}</span>
mkdir<span class="w"> </span>-p<span class="w"> </span>~/Projects/<span class="o">{</span>Active,Completed,Archive<span class="o">}</span>
mkdir<span class="w"> </span>-p<span class="w"> </span>~/Media/<span class="o">{</span>Photos,Videos,Music<span class="o">}</span>/<span class="o">{</span><span class="m">2024</span>,2023,Archive<span class="o">}</span>

<span class="c1"># File organization by date</span>
find<span class="w"> </span>~/Downloads<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-newermt<span class="w"> </span><span class="s2">&quot;2024-01-01&quot;</span><span class="w"> </span>!<span class="w"> </span>-newermt<span class="w"> </span><span class="s2">&quot;2024-12-31&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-exec<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>~/Archive/2024/<span class="w"> </span><span class="se">\;</span><span class="w"> </span>-exec<span class="w"> </span>mv<span class="w"> </span><span class="o">{}</span><span class="w"> </span>~/Archive/2024/<span class="w"> </span><span class="se">\;</span>

<span class="c1"># Organize files by extension</span>
<span class="nb">cd</span><span class="w"> </span>~/Downloads
<span class="k">for</span><span class="w"> </span>ext<span class="w"> </span><span class="k">in</span><span class="w"> </span>pdf<span class="w"> </span>doc<span class="w"> </span>docx<span class="w"> </span>txt<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span>mkdir<span class="w"> </span>-p<span class="w"> </span>~/Documents/<span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="nv">$ext</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span><span class="s1">&#39;[:lower:]&#39;</span><span class="w"> </span><span class="s1">&#39;[:upper:]&#39;</span><span class="k">)</span>
<span class="w">    </span>find<span class="w"> </span>.<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;*.</span><span class="nv">$ext</span><span class="s2">&quot;</span><span class="w"> </span>-exec<span class="w"> </span>mv<span class="w"> </span><span class="o">{}</span><span class="w"> </span>~/Documents/<span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="nv">$ext</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span><span class="s1">&#39;[:lower:]&#39;</span><span class="w"> </span><span class="s1">&#39;[:upper:]&#39;</span><span class="k">)</span>/<span class="w"> </span><span class="se">\;</span>
<span class="k">done</span>

<span class="c1"># Find and organize duplicate files</span>
fdupes<span class="w"> </span>-r<span class="w"> </span>~/Documents<span class="w"> </span>-d
</pre></div>
</div>
</section>
</section>
<section id="data-backup-and-archival">
<h4>Data Backup and Archival<a class="headerlink" href="#data-backup-and-archival" title="Link to this heading"></a></h4>
<section id="backup-strategies">
<h5>Backup Strategies<a class="headerlink" href="#backup-strategies" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 3-2-1 Backup Rule Implementation</span>
<span class="c1"># 3 copies, 2 different media types, 1 offsite</span>

<span class="c1"># Local backup (rsync)</span>
rsync<span class="w"> </span>-avH<span class="w"> </span>--delete<span class="w"> </span>~/Documents/<span class="w"> </span>/backup/documents/

<span class="c1"># External drive backup</span>
rsync<span class="w"> </span>-avH<span class="w"> </span>--delete<span class="w"> </span>~/Documents/<span class="w"> </span>/media/external/backup/documents/

<span class="c1"># Cloud backup (rclone)</span>
rclone<span class="w"> </span>sync<span class="w"> </span>~/Documents/<span class="w"> </span>cloud:backup/documents/

<span class="c1"># Compressed archive backup</span>
tar<span class="w"> </span>-czf<span class="w"> </span>/backup/documents_<span class="k">$(</span>date<span class="w"> </span>+%Y%m%d<span class="k">)</span>.tar.gz<span class="w"> </span>~/Documents/
</pre></div>
</div>
</section>
<section id="automated-data-organization">
<h5>Automated Data Organization<a class="headerlink" href="#automated-data-organization" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create organization script</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>~/bin/organize_data.sh<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s">#!/bin/bash</span>

<span class="s"># Organize downloads by file type</span>
<span class="s">organize_downloads() {</span>
<span class="s">    cd ~/Downloads</span>

<span class="s">    # Create directories</span>
<span class="s">    mkdir -p {Documents,Images,Videos,Music,Archives,Software}</span>

<span class="s">    # Move files by type</span>
<span class="s">    find . -maxdepth 1 -type f \( -iname &quot;*.pdf&quot; -o -iname &quot;*.doc&quot; -o -iname &quot;*.docx&quot; -o -iname &quot;*.txt&quot; \) -exec mv {} Documents/ \;</span>
<span class="s">    find . -maxdepth 1 -type f \( -iname &quot;*.jpg&quot; -o -iname &quot;*.png&quot; -o -iname &quot;*.gif&quot; -o -iname &quot;*.jpeg&quot; \) -exec mv {} Images/ \;</span>
<span class="s">    find . -maxdepth 1 -type f \( -iname &quot;*.mp4&quot; -o -iname &quot;*.avi&quot; -o -iname &quot;*.mkv&quot; \) -exec mv {} Videos/ \;</span>
<span class="s">    find . -maxdepth 1 -type f \( -iname &quot;*.mp3&quot; -o -iname &quot;*.flac&quot; -o -iname &quot;*.wav&quot; \) -exec mv {} Music/ \;</span>
<span class="s">    find . -maxdepth 1 -type f \( -iname &quot;*.zip&quot; -o -iname &quot;*.tar.gz&quot; -o -iname &quot;*.rar&quot; \) -exec mv {} Archives/ \;</span>
<span class="s">    find . -maxdepth 1 -type f \( -iname &quot;*.deb&quot; -o -iname &quot;*.appimage&quot; \) -exec mv {} Software/ \;</span>
<span class="s">}</span>

<span class="s"># Clean old temporary files</span>
<span class="s">clean_temp() {</span>
<span class="s">    find ~/Downloads -type f -mtime +30 -delete</span>
<span class="s">    find ~/.cache -type f -mtime +7 -delete</span>
<span class="s">    find /tmp -user $USER -type f -mtime +1 -delete 2&gt;/dev/null</span>
<span class="s">}</span>

<span class="s"># Archive old files</span>
<span class="s">archive_old() {</span>
<span class="s">    find ~/Documents -type f -mtime +365 -exec mkdir -p ~/Archive/$(date +%Y) \; -exec mv {} ~/Archive/$(date +%Y)/ \;</span>
<span class="s">}</span>

<span class="s"># Execute functions</span>
<span class="s">organize_downloads</span>
<span class="s">clean_temp</span>
<span class="s">archive_old</span>

<span class="s">echo &quot;Data organization completed: $(date)&quot;</span>
<span class="s">EOF</span>

chmod<span class="w"> </span>+x<span class="w"> </span>~/bin/organize_data.sh

<span class="c1"># Schedule with cron</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;0 2 * * * ~/bin/organize_data.sh&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>crontab<span class="w"> </span>-
</pre></div>
</div>
</section>
</section>
<section id="data-compression-and-deduplication">
<h4>Data Compression and Deduplication<a class="headerlink" href="#data-compression-and-deduplication" title="Link to this heading"></a></h4>
<section id="file-compression-techniques">
<h5>File Compression Techniques<a class="headerlink" href="#file-compression-techniques" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install compression tools</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>p7zip-full<span class="w"> </span>rar<span class="w"> </span>unrar<span class="w"> </span>gzip<span class="w"> </span>bzip2<span class="w"> </span>xz-utils

<span class="c1"># Create compressed archives</span>
<span class="c1"># gzip (fast, good compression)</span>
tar<span class="w"> </span>-czf<span class="w"> </span>archive.tar.gz<span class="w"> </span>/path/to/data

<span class="c1"># bzip2 (better compression, slower)</span>
tar<span class="w"> </span>-cjf<span class="w"> </span>archive.tar.bz2<span class="w"> </span>/path/to/data

<span class="c1"># xz (best compression, slowest)</span>
tar<span class="w"> </span>-cJf<span class="w"> </span>archive.tar.xz<span class="w"> </span>/path/to/data

<span class="c1"># 7zip (excellent compression)</span>
7z<span class="w"> </span>a<span class="w"> </span>-t7z<span class="w"> </span>-mx<span class="o">=</span><span class="m">9</span><span class="w"> </span>archive.7z<span class="w"> </span>/path/to/data

<span class="c1"># Compare compression ratios</span>
<span class="k">for</span><span class="w"> </span>method<span class="w"> </span><span class="k">in</span><span class="w"> </span>gz<span class="w"> </span>bz2<span class="w"> </span>xz<span class="w"> </span>7z<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Compressing with </span><span class="nv">$method</span><span class="s2">...&quot;</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="nv">$method</span><span class="w"> </span><span class="k">in</span>
<span class="w">        </span>gz<span class="o">)</span><span class="w"> </span>tar<span class="w"> </span>-czf<span class="w"> </span>test.tar.gz<span class="w"> </span>~/Documents<span class="w"> </span><span class="p">;;</span>
<span class="w">        </span>bz2<span class="o">)</span><span class="w"> </span>tar<span class="w"> </span>-cjf<span class="w"> </span>test.tar.bz2<span class="w"> </span>~/Documents<span class="w"> </span><span class="p">;;</span>
<span class="w">        </span>xz<span class="o">)</span><span class="w"> </span>tar<span class="w"> </span>-cJf<span class="w"> </span>test.tar.xz<span class="w"> </span>~/Documents<span class="w"> </span><span class="p">;;</span>
<span class="w">        </span>7z<span class="o">)</span><span class="w"> </span>7z<span class="w"> </span>a<span class="w"> </span>test.7z<span class="w"> </span>~/Documents<span class="w"> </span><span class="p">;;</span>
<span class="w">    </span><span class="k">esac</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$method</span><span class="s2">: </span><span class="k">$(</span>ls<span class="w"> </span>-lh<span class="w"> </span>test.*<span class="nv">$method</span>*<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $5}&#39;</span><span class="k">)</span><span class="s2">&quot;</span>
<span class="k">done</span>
</pre></div>
</div>
</section>
<section id="duplicate-file-management">
<h5>Duplicate File Management<a class="headerlink" href="#duplicate-file-management" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install deduplication tools</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>fdupes<span class="w"> </span>rdfind

<span class="c1"># Find duplicates with fdupes</span>
fdupes<span class="w"> </span>-r<span class="w"> </span>~/Documents

<span class="c1"># Find and delete duplicates interactively</span>
fdupes<span class="w"> </span>-r<span class="w"> </span>-d<span class="w"> </span>~/Documents

<span class="c1"># Find duplicates with rdfind</span>
rdfind<span class="w"> </span>~/Documents

<span class="c1"># Advanced duplicate handling with rdfind</span>
rdfind<span class="w"> </span>-makehardlinks<span class="w"> </span><span class="nb">true</span><span class="w"> </span>~/Documents
rdfind<span class="w"> </span>-makeresultsfile<span class="w"> </span><span class="nb">false</span><span class="w"> </span>-makehardlinks<span class="w"> </span><span class="nb">true</span><span class="w"> </span>~/Documents
</pre></div>
</div>
</section>
</section>
<section id="data-monitoring-and-analysis">
<h4>Data Monitoring and Analysis<a class="headerlink" href="#data-monitoring-and-analysis" title="Link to this heading"></a></h4>
<section id="storage-usage-analysis">
<h5>Storage Usage Analysis<a class="headerlink" href="#storage-usage-analysis" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Analyze disk usage by directory</span>
ncdu<span class="w"> </span>/home

<span class="c1"># Find largest files</span>
find<span class="w"> </span>/home<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-exec<span class="w"> </span>du<span class="w"> </span>-h<span class="w"> </span><span class="o">{}</span><span class="w"> </span>+<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-rh<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-20

<span class="c1"># Analyze file types and sizes</span>
find<span class="w"> </span>/home<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s1">&#39;s/.*\\.//&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span><span class="p">|</span><span class="w"> </span>uniq<span class="w"> </span>-c<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-rn

<span class="c1"># Monitor storage usage trends</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>~/bin/storage_trend.sh<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s">#!/bin/bash</span>

<span class="s">LOGFILE=&quot;/var/log/storage_usage.log&quot;</span>

<span class="s">echo &quot;$(date): $(df -h / | tail -1 | awk &#39;{print $5}&#39;)&quot; &gt;&gt; $LOGFILE</span>

<span class="s"># Generate weekly report</span>
<span class="s">if [ &quot;$(date +%u)&quot; -eq 1 ]; then</span>
<span class="s">    echo &quot;Weekly Storage Report - $(date)&quot; &gt; /tmp/storage_report.txt</span>
<span class="s">    tail -7 $LOGFILE &gt;&gt; /tmp/storage_report.txt</span>
<span class="s">    mail -s &quot;Storage Usage Report&quot; admin@example.com &lt; /tmp/storage_report.txt</span>
<span class="s">fi</span>
<span class="s">EOF</span>

chmod<span class="w"> </span>+x<span class="w"> </span>~/bin/storage_trend.sh
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;0 0 * * * ~/bin/storage_trend.sh&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>crontab<span class="w"> </span>-
</pre></div>
</div>
</section>
<section id="file-system-metadata-analysis">
<h5>File System Metadata Analysis<a class="headerlink" href="#file-system-metadata-analysis" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Analyze inode usage</span>
df<span class="w"> </span>-i

<span class="c1"># Find directories with most files</span>
find<span class="w"> </span>/home<span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-exec<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;echo &quot;$(find &quot;$1&quot; -maxdepth 1 | wc -l) $1&quot;&#39;</span><span class="w"> </span>_<span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-rn<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-10

<span class="c1"># Analyze file access patterns</span>
find<span class="w"> </span>/home<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-atime<span class="w"> </span>-7<span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l<span class="w">  </span><span class="c1"># Files accessed in last 7 days</span>
find<span class="w"> </span>/home<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-mtime<span class="w"> </span>-7<span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l<span class="w">  </span><span class="c1"># Files modified in last 7 days</span>
find<span class="w"> </span>/home<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-atime<span class="w"> </span>+365<span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l<span class="w">  </span><span class="c1"># Files not accessed in over a year</span>
</pre></div>
</div>
</section>
</section>
<section id="frequently-asked-questions">
<h4>Frequently Asked Questions<a class="headerlink" href="#frequently-asked-questions" title="Link to this heading"></a></h4>
<section id="q-how-should-i-organize-my-home-directory-in-ubuntu-22-04">
<h5>Q: How should I organize my home directory in Ubuntu 22.04?<a class="headerlink" href="#q-how-should-i-organize-my-home-directory-in-ubuntu-22-04" title="Link to this heading"></a></h5>
<p><strong>A:</strong> Follow this recommended structure:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>~/
├──<span class="w"> </span>Documents/
│<span class="w">   </span>├──<span class="w"> </span>Personal/
│<span class="w">   </span>├──<span class="w"> </span>Work/
│<span class="w">   </span>└──<span class="w"> </span>Archive/
├──<span class="w"> </span>Projects/
│<span class="w">   </span>├──<span class="w"> </span>Active/
│<span class="w">   </span>├──<span class="w"> </span>Completed/
│<span class="w">   </span>└──<span class="w"> </span>Learning/
├──<span class="w"> </span>Media/
│<span class="w">   </span>├──<span class="w"> </span>Photos/
│<span class="w">   </span>├──<span class="w"> </span>Videos/
│<span class="w">   </span>└──<span class="w"> </span>Music/
├──<span class="w"> </span>Downloads/
│<span class="w">   </span>└──<span class="w"> </span><span class="o">(</span>temporary,<span class="w"> </span>clean<span class="w"> </span>regularly<span class="o">)</span>
├──<span class="w"> </span>Backup/
│<span class="w">   </span>└──<span class="w"> </span><span class="o">(</span><span class="nb">local</span><span class="w"> </span>backup<span class="w"> </span>copies<span class="o">)</span>
└──<span class="w"> </span>Scripts/
<span class="w">    </span>└──<span class="w"> </span><span class="o">(</span>personal<span class="w"> </span>automation<span class="w"> </span>scripts<span class="o">)</span>
</pre></div>
</div>
</section>
<section id="q-what-s-the-best-way-to-handle-duplicate-files">
<h5>Q: What’s the best way to handle duplicate files?<a class="headerlink" href="#q-what-s-the-best-way-to-handle-duplicate-files" title="Link to this heading"></a></h5>
<p><strong>A:</strong> Use these strategies:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. Find duplicates without deleting</span>
fdupes<span class="w"> </span>-r<span class="w"> </span>~/Documents

<span class="c1"># 2. Interactive deletion</span>
fdupes<span class="w"> </span>-r<span class="w"> </span>-d<span class="w"> </span>~/Documents

<span class="c1"># 3. Automatic deletion (keep first occurrence)</span>
fdupes<span class="w"> </span>-r<span class="w"> </span>-f<span class="w"> </span>~/Documents<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-v<span class="w"> </span><span class="s1">&#39;^$&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>xargs<span class="w"> </span>rm

<span class="c1"># 4. Convert to hard links (saves space)</span>
rdfind<span class="w"> </span>-makehardlinks<span class="w"> </span><span class="nb">true</span><span class="w"> </span>~/Documents
</pre></div>
</div>
</section>
<section id="q-how-can-i-automate-file-organization">
<h5>Q: How can I automate file organization?<a class="headerlink" href="#q-how-can-i-automate-file-organization" title="Link to this heading"></a></h5>
<p><strong>A:</strong> Create automated organization scripts:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># File organizer by extension</span>
<span class="c1">#!/bin/bash</span>
organize_by_extension<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">source_dir</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">target_dir</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="nb">cd</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$source_dir</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span>file<span class="w"> </span><span class="k">in</span><span class="w"> </span>*.*<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$file</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span><span class="nv">ext</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">file</span><span class="p">##*.</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="nv">ext_upper</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ext</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span><span class="s1">&#39;[:lower:]&#39;</span><span class="w"> </span><span class="s1">&#39;[:upper:]&#39;</span><span class="k">)</span>
<span class="w">            </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target_dir</span><span class="s2">/</span><span class="nv">$ext_upper</span><span class="s2">&quot;</span>
<span class="w">            </span>mv<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$file</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target_dir</span><span class="s2">/</span><span class="nv">$ext_upper</span><span class="s2">/&quot;</span>
<span class="w">        </span><span class="k">fi</span>
<span class="w">    </span><span class="k">done</span>
<span class="o">}</span>

<span class="c1"># Usage</span>
organize_by_extension<span class="w"> </span>~/Downloads<span class="w"> </span>~/Downloads/Organized
</pre></div>
</div>
</section>
<section id="q-how-do-i-implement-a-data-retention-policy">
<h5>Q: How do I implement a data retention policy?<a class="headerlink" href="#q-how-do-i-implement-a-data-retention-policy" title="Link to this heading"></a></h5>
<p><strong>A:</strong> Create a retention management system:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1"># data_retention.sh</span>

<span class="c1"># Define retention periods (days)</span>
<span class="nv">TEMP_RETENTION</span><span class="o">=</span><span class="m">7</span>
<span class="nv">LOG_RETENTION</span><span class="o">=</span><span class="m">90</span>
<span class="nv">BACKUP_RETENTION</span><span class="o">=</span><span class="m">365</span>
<span class="nv">ARCHIVE_RETENTION</span><span class="o">=</span><span class="m">2555</span><span class="w">  </span><span class="c1"># 7 years</span>

<span class="c1"># Clean temporary files</span>
find<span class="w"> </span>/tmp<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-mtime<span class="w"> </span>+<span class="nv">$TEMP_RETENTION</span><span class="w"> </span>-delete
find<span class="w"> </span>~/.cache<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-mtime<span class="w"> </span>+<span class="nv">$TEMP_RETENTION</span><span class="w"> </span>-delete

<span class="c1"># Archive old logs</span>
find<span class="w"> </span>/var/log<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;*.log&quot;</span><span class="w"> </span>-mtime<span class="w"> </span>+<span class="nv">$LOG_RETENTION</span><span class="w"> </span>-gzip

<span class="c1"># Remove old backups</span>
find<span class="w"> </span>/backup<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;*.tar.gz&quot;</span><span class="w"> </span>-mtime<span class="w"> </span>+<span class="nv">$BACKUP_RETENTION</span><span class="w"> </span>-delete

<span class="c1"># Alert for very old archives</span>
find<span class="w"> </span>/archive<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-mtime<span class="w"> </span>+<span class="nv">$ARCHIVE_RETENTION</span><span class="w"> </span>-ls<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>mail<span class="w"> </span>-s<span class="w"> </span><span class="s2">&quot;Files exceeding retention policy&quot;</span><span class="w"> </span>admin@example.com
</pre></div>
</div>
</section>
</section>
<section id="coding-examples">
<h4>Coding Examples<a class="headerlink" href="#coding-examples" title="Link to this heading"></a></h4>
<section id="python-data-organization-manager">
<h5>Python Data Organization Manager<a class="headerlink" href="#python-data-organization-manager" title="Link to this heading"></a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Advanced data organization manager for Ubuntu 22.04</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">mimetypes</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">argparse</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DataOrganizer</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">base_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">base_path</span> <span class="k">else</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_types</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;documents&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;.pdf&#39;</span><span class="p">,</span> <span class="s1">&#39;.doc&#39;</span><span class="p">,</span> <span class="s1">&#39;.docx&#39;</span><span class="p">,</span> <span class="s1">&#39;.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;.rtf&#39;</span><span class="p">,</span> <span class="s1">&#39;.odt&#39;</span><span class="p">],</span>
            <span class="s1">&#39;images&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;.jpeg&#39;</span><span class="p">,</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="s1">&#39;.gif&#39;</span><span class="p">,</span> <span class="s1">&#39;.bmp&#39;</span><span class="p">,</span> <span class="s1">&#39;.tiff&#39;</span><span class="p">,</span> <span class="s1">&#39;.svg&#39;</span><span class="p">],</span>
            <span class="s1">&#39;videos&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;.mp4&#39;</span><span class="p">,</span> <span class="s1">&#39;.avi&#39;</span><span class="p">,</span> <span class="s1">&#39;.mkv&#39;</span><span class="p">,</span> <span class="s1">&#39;.mov&#39;</span><span class="p">,</span> <span class="s1">&#39;.wmv&#39;</span><span class="p">,</span> <span class="s1">&#39;.flv&#39;</span><span class="p">,</span> <span class="s1">&#39;.webm&#39;</span><span class="p">],</span>
            <span class="s1">&#39;music&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;.mp3&#39;</span><span class="p">,</span> <span class="s1">&#39;.flac&#39;</span><span class="p">,</span> <span class="s1">&#39;.wav&#39;</span><span class="p">,</span> <span class="s1">&#39;.ogg&#39;</span><span class="p">,</span> <span class="s1">&#39;.m4a&#39;</span><span class="p">,</span> <span class="s1">&#39;.aac&#39;</span><span class="p">],</span>
            <span class="s1">&#39;archives&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;.zip&#39;</span><span class="p">,</span> <span class="s1">&#39;.tar&#39;</span><span class="p">,</span> <span class="s1">&#39;.gz&#39;</span><span class="p">,</span> <span class="s1">&#39;.bz2&#39;</span><span class="p">,</span> <span class="s1">&#39;.xz&#39;</span><span class="p">,</span> <span class="s1">&#39;.rar&#39;</span><span class="p">,</span> <span class="s1">&#39;.7z&#39;</span><span class="p">],</span>
            <span class="s1">&#39;code&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;.py&#39;</span><span class="p">,</span> <span class="s1">&#39;.js&#39;</span><span class="p">,</span> <span class="s1">&#39;.html&#39;</span><span class="p">,</span> <span class="s1">&#39;.css&#39;</span><span class="p">,</span> <span class="s1">&#39;.java&#39;</span><span class="p">,</span> <span class="s1">&#39;.cpp&#39;</span><span class="p">,</span> <span class="s1">&#39;.c&#39;</span><span class="p">,</span> <span class="s1">&#39;.php&#39;</span><span class="p">],</span>
            <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;.json&#39;</span><span class="p">,</span> <span class="s1">&#39;.xml&#39;</span><span class="p">,</span> <span class="s1">&#39;.sql&#39;</span><span class="p">,</span> <span class="s1">&#39;.db&#39;</span><span class="p">,</span> <span class="s1">&#39;.sqlite&#39;</span><span class="p">]</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_file_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate MD5 hash of a file&quot;&quot;&quot;</span>
        <span class="n">hash_md5</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4096</span><span class="p">),</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
                    <span class="n">hash_md5</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">hash_md5</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">find_duplicates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find duplicate files in a directory&quot;&quot;&quot;</span>
        <span class="n">duplicates</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                <span class="n">filepath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="o">/</span> <span class="n">file</span>
                <span class="k">if</span> <span class="n">filepath</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
                    <span class="n">file_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_file_hash</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">file_hash</span><span class="p">:</span>
                        <span class="n">duplicates</span><span class="p">[</span><span class="n">file_hash</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>

        <span class="c1"># Filter out unique files</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">duplicates</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">organize_by_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_dir</span><span class="p">,</span> <span class="n">target_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Organize files by type&quot;&quot;&quot;</span>
        <span class="n">source_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">source_dir</span><span class="p">)</span>
        <span class="n">target_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">target_dir</span><span class="p">)</span> <span class="k">if</span> <span class="n">target_dir</span> <span class="k">else</span> <span class="n">source_path</span> <span class="o">/</span> <span class="s2">&quot;Organized&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">source_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Source directory </span><span class="si">{</span><span class="n">source_path</span><span class="si">}</span><span class="s2"> does not exist&quot;</span><span class="p">)</span>

        <span class="n">target_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">source_path</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">file_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">and</span> <span class="n">file_path</span><span class="o">.</span><span class="n">parent</span> <span class="o">==</span> <span class="n">source_path</span><span class="p">:</span>
                <span class="n">file_ext</span> <span class="o">=</span> <span class="n">file_path</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

                <span class="c1"># Determine file category</span>
                <span class="n">category</span> <span class="o">=</span> <span class="s1">&#39;misc&#39;</span>
                <span class="k">for</span> <span class="n">cat</span><span class="p">,</span> <span class="n">extensions</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_types</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">file_ext</span> <span class="ow">in</span> <span class="n">extensions</span><span class="p">:</span>
                        <span class="n">category</span> <span class="o">=</span> <span class="n">cat</span>
                        <span class="k">break</span>

                <span class="c1"># Create category directory</span>
                <span class="n">category_dir</span> <span class="o">=</span> <span class="n">target_path</span> <span class="o">/</span> <span class="n">category</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
                <span class="n">category_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="c1"># Move file</span>
                <span class="n">new_path</span> <span class="o">=</span> <span class="n">category_dir</span> <span class="o">/</span> <span class="n">file_path</span><span class="o">.</span><span class="n">name</span>

                <span class="c1"># Handle naming conflicts</span>
                <span class="n">counter</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">original_name</span> <span class="o">=</span> <span class="n">new_path</span><span class="o">.</span><span class="n">stem</span>
                <span class="k">while</span> <span class="n">new_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                    <span class="n">new_path</span> <span class="o">=</span> <span class="n">category_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">original_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">counter</span><span class="si">}{</span><span class="n">file_path</span><span class="o">.</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">new_path</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;moved_</span><span class="si">{</span><span class="n">category</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Moved </span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">category</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="si">}</span><span class="s2">/&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error moving </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">organize_by_date</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_dir</span><span class="p">,</span> <span class="n">target_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Organize files by modification date&quot;&quot;&quot;</span>
        <span class="n">source_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">source_dir</span><span class="p">)</span>
        <span class="n">target_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">target_dir</span><span class="p">)</span> <span class="k">if</span> <span class="n">target_dir</span> <span class="k">else</span> <span class="n">source_path</span> <span class="o">/</span> <span class="s2">&quot;ByDate&quot;</span>

        <span class="n">target_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">source_path</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">file_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
                <span class="c1"># Get modification time</span>
                <span class="n">mtime</span> <span class="o">=</span> <span class="n">file_path</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_mtime</span>
                <span class="n">date_str</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y/%m&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">(</span><span class="n">mtime</span><span class="p">))</span>

                <span class="c1"># Create date directory</span>
                <span class="n">date_dir</span> <span class="o">=</span> <span class="n">target_path</span> <span class="o">/</span> <span class="n">date_str</span>
                <span class="n">date_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="c1"># Move file</span>
                <span class="n">new_path</span> <span class="o">=</span> <span class="n">date_dir</span> <span class="o">/</span> <span class="n">file_path</span><span class="o">.</span><span class="n">name</span>

                <span class="c1"># Handle naming conflicts</span>
                <span class="n">counter</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">original_name</span> <span class="o">=</span> <span class="n">new_path</span><span class="o">.</span><span class="n">stem</span>
                <span class="k">while</span> <span class="n">new_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                    <span class="n">new_path</span> <span class="o">=</span> <span class="n">date_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">original_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">counter</span><span class="si">}{</span><span class="n">file_path</span><span class="o">.</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">new_path</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;moved_by_date&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error moving </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">clean_empty_directories</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove empty directories&quot;&quot;&quot;</span>
        <span class="n">removed_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">topdown</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">dir_name</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
                <span class="n">dir_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="o">/</span> <span class="n">dir_name</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">dir_path</span><span class="o">.</span><span class="n">iterdir</span><span class="p">()):</span>
                        <span class="n">dir_path</span><span class="o">.</span><span class="n">rmdir</span><span class="p">()</span>
                        <span class="n">removed_count</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removed empty directory: </span><span class="si">{</span><span class="n">dir_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                    <span class="k">pass</span>  <span class="c1"># Directory not empty or permission denied</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;removed_empty_dirs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">removed_count</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">analyze_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Analyze directory structure and file distribution&quot;&quot;&quot;</span>
        <span class="n">analysis</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;total_files&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;total_size&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;file_types&#39;</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>
            <span class="s1">&#39;size_by_type&#39;</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>
            <span class="s1">&#39;largest_files&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;oldest_files&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;newest_files&#39;</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>

        <span class="n">files_with_info</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                <span class="n">file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="o">/</span> <span class="n">file</span>
                <span class="k">if</span> <span class="n">file_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">stat_info</span> <span class="o">=</span> <span class="n">file_path</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span>
                        <span class="n">file_size</span> <span class="o">=</span> <span class="n">stat_info</span><span class="o">.</span><span class="n">st_size</span>
                        <span class="n">file_ext</span> <span class="o">=</span> <span class="n">file_path</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

                        <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;total_files&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;total_size&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">file_size</span>
                        <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;file_types&#39;</span><span class="p">][</span><span class="n">file_ext</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;size_by_type&#39;</span><span class="p">][</span><span class="n">file_ext</span><span class="p">]</span> <span class="o">+=</span> <span class="n">file_size</span>

                        <span class="n">files_with_info</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                            <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">file_path</span><span class="p">,</span>
                            <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">file_size</span><span class="p">,</span>
                            <span class="s1">&#39;mtime&#39;</span><span class="p">:</span> <span class="n">stat_info</span><span class="o">.</span><span class="n">st_mtime</span>
                        <span class="p">})</span>
                    <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                        <span class="k">continue</span>

        <span class="c1"># Sort files for top lists</span>
        <span class="n">files_with_info</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;largest_files&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]),</span> <span class="s1">&#39;size_mb&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">)}</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files_with_info</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
        <span class="p">]</span>

        <span class="n">files_with_info</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;mtime&#39;</span><span class="p">])</span>
        <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;oldest_files&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]),</span> <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;mtime&#39;</span><span class="p">]))}</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files_with_info</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
        <span class="p">]</span>

        <span class="n">files_with_info</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;mtime&#39;</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;newest_files&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]),</span> <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;mtime&#39;</span><span class="p">]))}</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files_with_info</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
        <span class="p">]</span>

        <span class="k">return</span> <span class="n">analysis</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_backup_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_dir</span><span class="p">,</span> <span class="n">backup_dir</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create organized backup structure&quot;&quot;&quot;</span>
        <span class="n">source_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">source_dir</span><span class="p">)</span>
        <span class="n">backup_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">backup_dir</span><span class="p">)</span>

        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">_%H%M%S&#39;</span><span class="p">)</span>
        <span class="n">backup_target</span> <span class="o">=</span> <span class="n">backup_path</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;backup_</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">backup_target</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Copy files with organization</span>
        <span class="k">for</span> <span class="n">category</span><span class="p">,</span> <span class="n">extensions</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_types</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">category_backup</span> <span class="o">=</span> <span class="n">backup_target</span> <span class="o">/</span> <span class="n">category</span>
            <span class="n">category_backup</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">source_path</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                    <span class="n">file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="o">/</span> <span class="n">file</span>
                    <span class="k">if</span> <span class="n">file_path</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">extensions</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">category_backup</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;backed_up_</span><span class="si">{</span><span class="n">category</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error backing up </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate organization report&quot;&quot;&quot;</span>
        <span class="n">report</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">),</span>
            <span class="s1">&#39;statistics&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">),</span>
            <span class="s1">&#39;summary&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Processed </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="si">}</span><span class="s2"> operations&quot;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">report</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Data Organization Manager&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;command&#39;</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;organize&#39;</span><span class="p">,</span> <span class="s1">&#39;analyze&#39;</span><span class="p">,</span> <span class="s1">&#39;duplicates&#39;</span><span class="p">,</span> <span class="s1">&#39;backup&#39;</span><span class="p">,</span> <span class="s1">&#39;clean&#39;</span><span class="p">])</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Source directory&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--target&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Target directory&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--by-type&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Organize by file type&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--by-date&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Organize by date&#39;</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">organizer</span> <span class="o">=</span> <span class="n">DataOrganizer</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">command</span> <span class="o">==</span> <span class="s1">&#39;organize&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">by_type</span><span class="p">:</span>
            <span class="n">organizer</span><span class="o">.</span><span class="n">organize_by_type</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">by_date</span><span class="p">:</span>
            <span class="n">organizer</span><span class="o">.</span><span class="n">organize_by_date</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">organizer</span><span class="o">.</span><span class="n">organize_by_type</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">command</span> <span class="o">==</span> <span class="s1">&#39;analyze&#39;</span><span class="p">:</span>
        <span class="n">analysis</span> <span class="o">=</span> <span class="n">organizer</span><span class="o">.</span><span class="n">analyze_directory</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">source</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">analysis</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="nb">str</span><span class="p">))</span>

    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">command</span> <span class="o">==</span> <span class="s1">&#39;duplicates&#39;</span><span class="p">:</span>
        <span class="n">duplicates</span> <span class="o">=</span> <span class="n">organizer</span><span class="o">.</span><span class="n">find_duplicates</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">source</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">duplicates</span><span class="p">)</span><span class="si">}</span><span class="s2"> sets of duplicate files:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">hash_val</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">duplicates</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hash </span><span class="si">{</span><span class="n">hash_val</span><span class="p">[:</span><span class="mi">8</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">command</span> <span class="o">==</span> <span class="s1">&#39;backup&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">target</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Target directory required for backup&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">organizer</span><span class="o">.</span><span class="n">create_backup_structure</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">command</span> <span class="o">==</span> <span class="s1">&#39;clean&#39;</span><span class="p">:</span>
        <span class="n">organizer</span><span class="o">.</span><span class="n">clean_empty_directories</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">source</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">organizer</span><span class="o">.</span><span class="n">generate_report</span><span class="p">())</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="bash-file-organization-system">
<h5>Bash File Organization System<a class="headerlink" href="#bash-file-organization-system" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1"># advanced_file_organizer.sh - Advanced file organization system for Ubuntu 22.04</span>

<span class="c1"># Configuration</span>
<span class="nv">CONFIG_FILE</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/.file_organizer.conf&quot;</span>
<span class="nv">LOG_FILE</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/.file_organizer.log&quot;</span>

<span class="c1"># Default configuration</span>
cat<span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$CONFIG_FILE</span><span class="s2">&quot;</span><span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s"># File Organization Configuration</span>
<span class="s">ORGANIZE_DOWNLOADS=true</span>
<span class="s">ORGANIZE_DESKTOP=true</span>
<span class="s">AUTO_ARCHIVE_DAYS=365</span>
<span class="s">DUPLICATE_ACTION=ask  # ask, delete, link</span>
<span class="s">BACKUP_ENABLED=true</span>
<span class="s">BACKUP_DIR=&quot;$HOME/Backup&quot;</span>

<span class="s"># File type definitions</span>
<span class="s">DOCUMENTS=&quot;pdf doc docx txt rtf odt&quot;</span>
<span class="s">IMAGES=&quot;jpg jpeg png gif bmp tiff svg&quot;</span>
<span class="s">VIDEOS=&quot;mp4 avi mkv mov wmv flv webm&quot;</span>
<span class="s">MUSIC=&quot;mp3 flac wav ogg m4a aac&quot;</span>
<span class="s">ARCHIVES=&quot;zip tar gz bz2 xz rar 7z&quot;</span>
<span class="s">CODE=&quot;py js html css java cpp c php&quot;</span>
<span class="s">DATA=&quot;csv json xml sql db sqlite&quot;</span>
<span class="s">EOF</span>

<span class="c1"># Load configuration</span>
<span class="nb">source</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$CONFIG_FILE</span><span class="s2">&quot;</span>

<span class="c1"># Logging function</span>
log_message<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>date<span class="w"> </span><span class="s1">&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span class="k">)</span><span class="s2"> - </span><span class="nv">$1</span><span class="s2">&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LOG_FILE</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="o">}</span>

<span class="c1"># Create directory structure</span>
create_structure<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">base_dir</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>

<span class="w">    </span>log_message<span class="w"> </span><span class="s2">&quot;Creating directory structure in </span><span class="nv">$base_dir</span><span class="s2">&quot;</span>

<span class="w">    </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$base_dir</span><span class="s2">&quot;</span>/<span class="o">{</span>Documents,Images,Videos,Music,Archives,Code,Data,Misc<span class="o">}</span>
<span class="w">    </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$base_dir</span><span class="s2">&quot;</span>/Archive/<span class="o">{</span><span class="k">$(</span>date<span class="w"> </span>+%Y<span class="k">)</span>,<span class="k">$(</span>date<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;last year&#39;</span><span class="w"> </span>+%Y<span class="k">)</span><span class="o">}</span>
<span class="w">    </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$base_dir</span><span class="s2">&quot;</span>/Backup

<span class="w">    </span>log_message<span class="w"> </span><span class="s2">&quot;Directory structure created&quot;</span>
<span class="o">}</span>

<span class="c1"># Get file category</span>
get_file_category<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">file</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">extension</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">file</span><span class="p">##*.</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nv">extension</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$extension</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span><span class="s1">&#39;[:upper:]&#39;</span><span class="w"> </span><span class="s1">&#39;[:lower:]&#39;</span><span class="k">)</span>

<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot; </span><span class="nv">$DOCUMENTS</span><span class="s2"> &quot;</span><span class="w"> </span><span class="k">in</span><span class="w"> </span>*<span class="s2">&quot; </span><span class="nv">$extension</span><span class="s2"> &quot;</span>*<span class="o">)</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Documents&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">;;</span><span class="w"> </span><span class="k">esac</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot; </span><span class="nv">$IMAGES</span><span class="s2"> &quot;</span><span class="w"> </span><span class="k">in</span><span class="w"> </span>*<span class="s2">&quot; </span><span class="nv">$extension</span><span class="s2"> &quot;</span>*<span class="o">)</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Images&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">;;</span><span class="w"> </span><span class="k">esac</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot; </span><span class="nv">$VIDEOS</span><span class="s2"> &quot;</span><span class="w"> </span><span class="k">in</span><span class="w"> </span>*<span class="s2">&quot; </span><span class="nv">$extension</span><span class="s2"> &quot;</span>*<span class="o">)</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Videos&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">;;</span><span class="w"> </span><span class="k">esac</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot; </span><span class="nv">$MUSIC</span><span class="s2"> &quot;</span><span class="w"> </span><span class="k">in</span><span class="w"> </span>*<span class="s2">&quot; </span><span class="nv">$extension</span><span class="s2"> &quot;</span>*<span class="o">)</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Music&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">;;</span><span class="w"> </span><span class="k">esac</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot; </span><span class="nv">$ARCHIVES</span><span class="s2"> &quot;</span><span class="w"> </span><span class="k">in</span><span class="w"> </span>*<span class="s2">&quot; </span><span class="nv">$extension</span><span class="s2"> &quot;</span>*<span class="o">)</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Archives&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">;;</span><span class="w"> </span><span class="k">esac</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot; </span><span class="nv">$CODE</span><span class="s2"> &quot;</span><span class="w"> </span><span class="k">in</span><span class="w"> </span>*<span class="s2">&quot; </span><span class="nv">$extension</span><span class="s2"> &quot;</span>*<span class="o">)</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Code&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">;;</span><span class="w"> </span><span class="k">esac</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot; </span><span class="nv">$DATA</span><span class="s2"> &quot;</span><span class="w"> </span><span class="k">in</span><span class="w"> </span>*<span class="s2">&quot; </span><span class="nv">$extension</span><span class="s2"> &quot;</span>*<span class="o">)</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Data&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">;;</span><span class="w"> </span><span class="k">esac</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Misc&quot;</span>
<span class="o">}</span>

<span class="c1"># Organize files by type</span>
organize_by_type<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">source_dir</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">target_dir</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span>

<span class="w">    </span>log_message<span class="w"> </span><span class="s2">&quot;Organizing files from </span><span class="nv">$source_dir</span><span class="s2"> to </span><span class="nv">$target_dir</span><span class="s2">&quot;</span>

<span class="w">    </span>create_structure<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target_dir</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">moved_count</span><span class="o">=</span><span class="m">0</span>

<span class="w">    </span>find<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$source_dir</span><span class="s2">&quot;</span><span class="w"> </span>-maxdepth<span class="w"> </span><span class="m">1</span><span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>-r<span class="w"> </span>file<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$file</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span><span class="nb">local</span><span class="w"> </span><span class="nv">filename</span><span class="o">=</span><span class="k">$(</span>basename<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$file</span><span class="s2">&quot;</span><span class="k">)</span>
<span class="w">            </span><span class="nb">local</span><span class="w"> </span><span class="nv">category</span><span class="o">=</span><span class="k">$(</span>get_file_category<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$filename</span><span class="s2">&quot;</span><span class="k">)</span>
<span class="w">            </span><span class="nb">local</span><span class="w"> </span><span class="nv">target_file</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$target_dir</span><span class="s2">/</span><span class="nv">$category</span><span class="s2">/</span><span class="nv">$filename</span><span class="s2">&quot;</span>

<span class="w">            </span><span class="c1"># Handle name conflicts</span>
<span class="w">            </span><span class="nb">local</span><span class="w"> </span><span class="nv">counter</span><span class="o">=</span><span class="m">1</span>
<span class="w">            </span><span class="nb">local</span><span class="w"> </span><span class="nv">base_name</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">filename</span><span class="p">%.*</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="nb">local</span><span class="w"> </span><span class="nv">extension</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">filename</span><span class="p">##*.</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target_file</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$extension</span><span class="s2">&quot;</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$filename</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                    </span><span class="nv">target_file</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$target_dir</span><span class="s2">/</span><span class="nv">$category</span><span class="s2">/</span><span class="si">${</span><span class="nv">base_name</span><span class="si">}</span><span class="s2">_</span><span class="si">${</span><span class="nv">counter</span><span class="si">}</span><span class="s2">.</span><span class="si">${</span><span class="nv">extension</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">                </span><span class="k">else</span>
<span class="w">                    </span><span class="nv">target_file</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$target_dir</span><span class="s2">/</span><span class="nv">$category</span><span class="s2">/</span><span class="si">${</span><span class="nv">filename</span><span class="si">}</span><span class="s2">_</span><span class="si">${</span><span class="nv">counter</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">                </span><span class="k">fi</span>
<span class="w">                </span><span class="o">((</span>counter++<span class="o">))</span>
<span class="w">            </span><span class="k">done</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span>mv<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$file</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target_file</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span>log_message<span class="w"> </span><span class="s2">&quot;Moved </span><span class="nv">$filename</span><span class="s2"> to </span><span class="nv">$category</span><span class="s2">/&quot;</span>
<span class="w">                </span><span class="o">((</span>moved_count++<span class="o">))</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">                </span>log_message<span class="w"> </span><span class="s2">&quot;Failed to move </span><span class="nv">$filename</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="k">fi</span>
<span class="w">        </span><span class="k">fi</span>
<span class="w">    </span><span class="k">done</span>

<span class="w">    </span>log_message<span class="w"> </span><span class="s2">&quot;Organized </span><span class="nv">$moved_count</span><span class="s2"> files&quot;</span>
<span class="o">}</span>

<span class="c1"># Find and handle duplicates</span>
handle_duplicates<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">directory</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">action</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">2</span><span class="k">:-</span><span class="nv">$DUPLICATE_ACTION</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="w">    </span>log_message<span class="w"> </span><span class="s2">&quot;Finding duplicates in </span><span class="nv">$directory</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span>!<span class="w"> </span><span class="nb">command</span><span class="w"> </span>-v<span class="w"> </span>fdupes<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span>log_message<span class="w"> </span><span class="s2">&quot;Installing fdupes for duplicate detection&quot;</span>
<span class="w">        </span>sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>fdupes
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">duplicates_file</span><span class="o">=</span><span class="s2">&quot;/tmp/duplicates_</span><span class="nv">$$</span><span class="s2">&quot;</span>
<span class="w">    </span>fdupes<span class="w"> </span>-r<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$directory</span><span class="s2">&quot;</span><span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$duplicates_file</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">duplicate_sets</span><span class="o">=</span><span class="m">0</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">files_processed</span><span class="o">=</span><span class="m">0</span>

<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="nv">IFS</span><span class="o">=</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>-r<span class="w"> </span>line<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$line</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span><span class="o">((</span>duplicate_sets++<span class="o">))</span>
<span class="w">        </span><span class="k">elif</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$line</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$action</span><span class="s2">&quot;</span><span class="w"> </span><span class="k">in</span>
<span class="w">                </span><span class="s2">&quot;delete&quot;</span><span class="o">)</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$files_processed</span><span class="w"> </span>-gt<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                        </span>rm<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$line</span><span class="s2">&quot;</span>
<span class="w">                        </span>log_message<span class="w"> </span><span class="s2">&quot;Deleted duplicate: </span><span class="nv">$line</span><span class="s2">&quot;</span>
<span class="w">                    </span><span class="k">fi</span>
<span class="w">                    </span><span class="p">;;</span>
<span class="w">                </span><span class="s2">&quot;link&quot;</span><span class="o">)</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$files_processed</span><span class="w"> </span>-gt<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                        </span><span class="nb">local</span><span class="w"> </span><span class="nv">first_file</span><span class="o">=</span><span class="k">$(</span>head<span class="w"> </span>-1<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$duplicates_file</span><span class="s2">&quot;</span><span class="k">)</span>
<span class="w">                        </span>rm<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$line</span><span class="s2">&quot;</span>
<span class="w">                        </span>ln<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$first_file</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$line</span><span class="s2">&quot;</span>
<span class="w">                        </span>log_message<span class="w"> </span><span class="s2">&quot;Linked duplicate: </span><span class="nv">$line</span><span class="s2">&quot;</span>
<span class="w">                    </span><span class="k">fi</span>
<span class="w">                    </span><span class="p">;;</span>
<span class="w">                </span><span class="s2">&quot;ask&quot;</span><span class="o">)</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$files_processed</span><span class="w"> </span>-gt<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Duplicate found: </span><span class="nv">$line</span><span class="s2">&quot;</span>
<span class="w">                        </span><span class="nb">read</span><span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;Delete this file? (y/N): &quot;</span><span class="w"> </span>-n<span class="w"> </span><span class="m">1</span><span class="w"> </span>-r
<span class="w">                        </span><span class="nb">echo</span>
<span class="w">                        </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$REPLY</span><span class="w"> </span><span class="o">=</span>~<span class="w"> </span>^<span class="o">[</span>Yy<span class="o">]</span>$<span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                            </span>rm<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$line</span><span class="s2">&quot;</span>
<span class="w">                            </span>log_message<span class="w"> </span><span class="s2">&quot;User deleted duplicate: </span><span class="nv">$line</span><span class="s2">&quot;</span>
<span class="w">                        </span><span class="k">fi</span>
<span class="w">                    </span><span class="k">fi</span>
<span class="w">                    </span><span class="p">;;</span>
<span class="w">            </span><span class="k">esac</span>
<span class="w">            </span><span class="o">((</span>files_processed++<span class="o">))</span>
<span class="w">        </span><span class="k">fi</span>
<span class="w">    </span><span class="k">done</span><span class="w"> </span>&lt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$duplicates_file</span><span class="s2">&quot;</span>

<span class="w">    </span>rm<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$duplicates_file</span><span class="s2">&quot;</span>
<span class="w">    </span>log_message<span class="w"> </span><span class="s2">&quot;Processed </span><span class="nv">$duplicate_sets</span><span class="s2"> sets of duplicates&quot;</span>
<span class="o">}</span>

<span class="c1"># Archive old files</span>
archive_old_files<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">source_dir</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">days</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">2</span><span class="k">:-</span><span class="nv">$AUTO_ARCHIVE_DAYS</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="w">    </span>log_message<span class="w"> </span><span class="s2">&quot;Archiving files older than </span><span class="nv">$days</span><span class="s2"> days from </span><span class="nv">$source_dir</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">archive_dir</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$source_dir</span><span class="s2">/Archive/</span><span class="k">$(</span>date<span class="w"> </span>+%Y<span class="k">)</span><span class="s2">&quot;</span>
<span class="w">    </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$archive_dir</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">archived_count</span><span class="o">=</span><span class="m">0</span>

<span class="w">    </span>find<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$source_dir</span><span class="s2">&quot;</span><span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-mtime<span class="w"> </span>+<span class="nv">$days</span><span class="w"> </span>!<span class="w"> </span>-path<span class="w"> </span><span class="s2">&quot;*/Archive/*&quot;</span><span class="w"> </span>!<span class="w"> </span>-path<span class="w"> </span><span class="s2">&quot;*/Backup/*&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>-r<span class="w"> </span>file<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">        </span><span class="nb">local</span><span class="w"> </span><span class="nv">relative_path</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">file</span><span class="p">#</span><span class="nv">$source_dir</span><span class="p">/</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="nb">local</span><span class="w"> </span><span class="nv">archive_path</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$archive_dir</span><span class="s2">/</span><span class="nv">$relative_path</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="nb">local</span><span class="w"> </span><span class="nv">archive_parent</span><span class="o">=</span><span class="k">$(</span>dirname<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$archive_path</span><span class="s2">&quot;</span><span class="k">)</span>

<span class="w">        </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$archive_parent</span><span class="s2">&quot;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span>mv<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$file</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$archive_path</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span>log_message<span class="w"> </span><span class="s2">&quot;Archived: </span><span class="nv">$relative_path</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="o">((</span>archived_count++<span class="o">))</span>
<span class="w">        </span><span class="k">fi</span>
<span class="w">    </span><span class="k">done</span>

<span class="w">    </span>log_message<span class="w"> </span><span class="s2">&quot;Archived </span><span class="nv">$archived_count</span><span class="s2"> files&quot;</span>
<span class="o">}</span>

<span class="c1"># Create backup</span>
create_backup<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">source_dir</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">backup_dir</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">2</span><span class="k">:-</span><span class="nv">$BACKUP_DIR</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BACKUP_ENABLED</span><span class="s2">&quot;</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span><span class="s2">&quot;true&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span>log_message<span class="w"> </span><span class="s2">&quot;Backup disabled in configuration&quot;</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span>log_message<span class="w"> </span><span class="s2">&quot;Creating backup of </span><span class="nv">$source_dir</span><span class="s2"> to </span><span class="nv">$backup_dir</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">timestamp</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>+%Y%m%d_%H%M%S<span class="k">)</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">backup_target</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$backup_dir</span><span class="s2">/backup_</span><span class="nv">$timestamp</span><span class="s2">&quot;</span>

<span class="w">    </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$backup_target</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span>rsync<span class="w"> </span>-av<span class="w"> </span>--progress<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$source_dir</span><span class="s2">/&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$backup_target</span><span class="s2">/&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span>log_message<span class="w"> </span><span class="s2">&quot;Backup created successfully: </span><span class="nv">$backup_target</span><span class="s2">&quot;</span>

<span class="w">        </span><span class="c1"># Compress backup</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nb">command</span><span class="w"> </span>-v<span class="w"> </span>tar<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span>tar<span class="w"> </span>-czf<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$backup_target</span><span class="s2">.tar.gz&quot;</span><span class="w"> </span>-C<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$backup_dir</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;backup_</span><span class="nv">$timestamp</span><span class="s2">&quot;</span>
<span class="w">            </span>rm<span class="w"> </span>-rf<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$backup_target</span><span class="s2">&quot;</span>
<span class="w">            </span>log_message<span class="w"> </span><span class="s2">&quot;Backup compressed: </span><span class="nv">$backup_target</span><span class="s2">.tar.gz&quot;</span>
<span class="w">        </span><span class="k">fi</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span>log_message<span class="w"> </span><span class="s2">&quot;Backup failed&quot;</span>
<span class="w">    </span><span class="k">fi</span>
<span class="o">}</span>

<span class="c1"># Generate organization report</span>
generate_report<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">directory</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">report_file</span><span class="o">=</span><span class="s2">&quot;/tmp/organization_report_</span><span class="k">$(</span>date<span class="w"> </span>+%Y%m%d<span class="k">)</span><span class="s2">.txt&quot;</span>

<span class="w">    </span><span class="o">{</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;File Organization Report&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;========================&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Generated: </span><span class="k">$(</span>date<span class="k">)</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Directory: </span><span class="nv">$directory</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>

<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Directory Structure:&quot;</span>
<span class="w">        </span>tree<span class="w"> </span>-d<span class="w"> </span>-L<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$directory</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="o">||</span><span class="w"> </span>find<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$directory</span><span class="s2">&quot;</span><span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-20
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>

<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;File Count by Type:&quot;</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nb">type</span><span class="w"> </span><span class="k">in</span><span class="w"> </span>Documents<span class="w"> </span>Images<span class="w"> </span>Videos<span class="w"> </span>Music<span class="w"> </span>Archives<span class="w"> </span>Code<span class="w"> </span>Data<span class="w"> </span>Misc<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$directory</span><span class="s2">/</span><span class="nv">$type</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span><span class="nv">count</span><span class="o">=</span><span class="k">$(</span>find<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$directory</span><span class="s2">/</span><span class="nv">$type</span><span class="s2">&quot;</span><span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l<span class="k">)</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$type</span><span class="s2">: </span><span class="nv">$count</span><span class="s2"> files&quot;</span>
<span class="w">            </span><span class="k">fi</span>
<span class="w">        </span><span class="k">done</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>

<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Storage Usage:&quot;</span>
<span class="w">        </span>du<span class="w"> </span>-sh<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$directory</span><span class="s2">&quot;</span>/*<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-hr
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>

<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Recent Activity (from log):&quot;</span>
<span class="w">        </span>tail<span class="w"> </span>-20<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LOG_FILE</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="o">}</span><span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$report_file</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Report generated: </span><span class="nv">$report_file</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="c1"># Email report if mail is configured</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">command</span><span class="w"> </span>-v<span class="w"> </span>mail<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span>cat<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$report_file</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>mail<span class="w"> </span>-s<span class="w"> </span><span class="s2">&quot;File Organization Report&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$USER</span><span class="s2">@localhost&quot;</span>
<span class="w">    </span><span class="k">fi</span>
<span class="o">}</span>

<span class="c1"># Main execution</span>
main<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">1</span><span class="k">:-</span><span class="nv">help</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="k">in</span>
<span class="w">        </span><span class="s2">&quot;organize&quot;</span><span class="o">)</span>
<span class="w">            </span>organize_by_type<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">2</span><span class="k">:-</span><span class="nv">$HOME</span><span class="p">/Downloads</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">3</span><span class="k">:-</span><span class="nv">$HOME</span><span class="p">/Organized</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">        </span><span class="s2">&quot;duplicates&quot;</span><span class="o">)</span>
<span class="w">            </span>handle_duplicates<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">2</span><span class="k">:-</span><span class="nv">$HOME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">3</span><span class="k">:-</span><span class="nv">ask</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">        </span><span class="s2">&quot;archive&quot;</span><span class="o">)</span>
<span class="w">            </span>archive_old_files<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">2</span><span class="k">:-</span><span class="nv">$HOME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">3</span><span class="k">:-</span><span class="nv">365</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">        </span><span class="s2">&quot;backup&quot;</span><span class="o">)</span>
<span class="w">            </span>create_backup<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">2</span><span class="k">:-</span><span class="nv">$HOME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">3</span><span class="k">:-</span><span class="nv">$BACKUP_DIR</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">        </span><span class="s2">&quot;report&quot;</span><span class="o">)</span>
<span class="w">            </span>generate_report<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">2</span><span class="k">:-</span><span class="nv">$HOME</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">        </span><span class="s2">&quot;full&quot;</span><span class="o">)</span>
<span class="w">            </span><span class="c1"># Full organization workflow</span>
<span class="w">            </span><span class="nb">local</span><span class="w"> </span><span class="nv">target_dir</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">2</span><span class="k">:-</span><span class="nv">$HOME</span><span class="p">/Organized</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="w">            </span>log_message<span class="w"> </span><span class="s2">&quot;Starting full organization workflow&quot;</span>

<span class="w">            </span>create_backup<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/Downloads&quot;</span>
<span class="w">            </span>organize_by_type<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/Downloads&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target_dir</span><span class="s2">&quot;</span>
<span class="w">            </span>handle_duplicates<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target_dir</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;ask&quot;</span>
<span class="w">            </span>archive_old_files<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target_dir</span><span class="s2">&quot;</span>
<span class="w">            </span>generate_report<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target_dir</span><span class="s2">&quot;</span>

<span class="w">            </span>log_message<span class="w"> </span><span class="s2">&quot;Full organization workflow completed&quot;</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">        </span><span class="s2">&quot;config&quot;</span><span class="o">)</span>
<span class="w">            </span>nano<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$CONFIG_FILE</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">        </span><span class="s2">&quot;help&quot;</span><span class="p">|</span>*<span class="o">)</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Advanced File Organizer for Ubuntu 22.04&quot;</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Usage: </span><span class="nv">$0</span><span class="s2"> [command] [options]&quot;</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Commands:&quot;</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  organize [source] [target]    - Organize files by type&quot;</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  duplicates [dir] [action]     - Handle duplicate files (ask/delete/link)&quot;</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  archive [dir] [days]          - Archive old files&quot;</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  backup [source] [target]      - Create backup&quot;</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  report [directory]            - Generate organization report&quot;</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  full [target]                 - Run complete organization workflow&quot;</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  config                        - Edit configuration&quot;</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Examples:&quot;</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  </span><span class="nv">$0</span><span class="s2"> organize ~/Downloads ~/Organized&quot;</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  </span><span class="nv">$0</span><span class="s2"> duplicates ~/Documents delete&quot;</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  </span><span class="nv">$0</span><span class="s2"> archive ~/Documents 180&quot;</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  </span><span class="nv">$0</span><span class="s2"> full ~/MyFiles&quot;</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">    </span><span class="k">esac</span>
<span class="o">}</span>

<span class="c1"># Run main function with all arguments</span>
main<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span>
</pre></div>
</div>
</section>
</section>
<section id="best-practices-for-data-organization">
<h4>Best Practices for Data Organization<a class="headerlink" href="#best-practices-for-data-organization" title="Link to this heading"></a></h4>
<section id="strategic-planning">
<h5>Strategic Planning<a class="headerlink" href="#strategic-planning" title="Link to this heading"></a></h5>
<ol class="arabic simple">
<li><p><strong>Data Classification Strategy</strong>:</p>
<ul class="simple">
<li><p>Identify data types and access patterns</p></li>
<li><p>Define retention policies</p></li>
<li><p>Establish backup requirements</p></li>
<li><p>Plan for data growth</p></li>
</ul>
</li>
<li><p><strong>Directory Structure Design</strong>:</p>
<ul class="simple">
<li><p>Use consistent naming conventions</p></li>
<li><p>Implement logical hierarchies</p></li>
<li><p>Plan for scalability</p></li>
<li><p>Document organization rules</p></li>
</ul>
</li>
</ol>
</section>
<section id="automation-and-maintenance">
<h5>Automation and Maintenance<a class="headerlink" href="#automation-and-maintenance" title="Link to this heading"></a></h5>
<ol class="arabic">
<li><p><strong>Automated Organization</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Daily organization cron job</span>
<span class="m">0</span><span class="w"> </span><span class="m">2</span><span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>/home/user/bin/organize_data.sh

<span class="c1"># Weekly duplicate cleanup</span>
<span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span><span class="m">0</span><span class="w"> </span>fdupes<span class="w"> </span>-r<span class="w"> </span>-d<span class="w"> </span>/home/user/Documents

<span class="c1"># Monthly archival</span>
<span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>/home/user/bin/archive_old_files.sh
</pre></div>
</div>
</li>
<li><p><strong>Monitoring and Alerts</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Storage usage monitoring</span>
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="k">$(</span>df<span class="w"> </span>/<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-1<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $5}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s1">&#39;s/%//&#39;</span><span class="k">)</span><span class="w"> </span>-gt<span class="w"> </span><span class="m">85</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Disk usage critical&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>mail<span class="w"> </span>-s<span class="w"> </span><span class="s2">&quot;Storage Alert&quot;</span><span class="w"> </span>admin
<span class="k">fi</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="security-and-compliance">
<h5>Security and Compliance<a class="headerlink" href="#security-and-compliance" title="Link to this heading"></a></h5>
<ol class="arabic simple">
<li><p><strong>Data Protection</strong>:</p>
<ul class="simple">
<li><p>Implement access controls</p></li>
<li><p>Use encryption for sensitive data</p></li>
<li><p>Regular security audits</p></li>
<li><p>Backup verification</p></li>
</ul>
</li>
<li><p><strong>Compliance Requirements</strong>:</p>
<ul class="simple">
<li><p>Document data handling procedures</p></li>
<li><p>Implement retention policies</p></li>
<li><p>Audit trail maintenance</p></li>
<li><p>Regular compliance reviews</p></li>
</ul>
</li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set up secure data handling</span>
<span class="c1"># Encrypt sensitive directories</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>ecryptfs-utils
ecryptfs-migrate-home<span class="w"> </span>-u<span class="w"> </span>username

<span class="c1"># Set appropriate permissions</span>
find<span class="w"> </span>/home/user/Documents<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">640</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span>
find<span class="w"> </span>/home/user/Documents<span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-exec<span class="w"> </span>chmod<span class="w"> </span><span class="m">750</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span>
</pre></div>
</div>
</section>
</section>
</section>
</section>
</div>
<div class="toctree-wrapper compound">
<span id="document-raid-systems"></span><section id="raid-systems">
<h2>RAID Systems<a class="headerlink" href="#raid-systems" title="Link to this heading"></a></h2>
<section id="understanding-raid">
<h3>Understanding RAID<a class="headerlink" href="#understanding-raid" title="Link to this heading"></a></h3>
<p>RAID (Redundant Array of Independent Disks) is a technology that combines multiple disk drives into a single logical unit to improve performance, provide redundancy, or both. RAID systems are crucial for data protection and performance optimization in storage systems.</p>
<section id="what-is-raid">
<h4>What is RAID?<a class="headerlink" href="#what-is-raid" title="Link to this heading"></a></h4>
<p>RAID provides:</p>
<ul class="simple">
<li><p><strong>Data Redundancy</strong>: Protection against disk failures</p></li>
<li><p><strong>Performance Improvement</strong>: Faster read/write operations through parallelism</p></li>
<li><p><strong>Storage Efficiency</strong>: Optimized use of available disk space</p></li>
<li><p><strong>Fault Tolerance</strong>: Ability to continue operation despite disk failures</p></li>
<li><p><strong>Scalability</strong>: Easy expansion of storage capacity</p></li>
</ul>
</section>
<section id="raid-levels-overview">
<h4>RAID Levels Overview<a class="headerlink" href="#raid-levels-overview" title="Link to this heading"></a></h4>
<section id="standard-raid-levels">
<h5>Standard RAID Levels<a class="headerlink" href="#standard-raid-levels" title="Link to this heading"></a></h5>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>RAID Level    | Description              | Min Disks | Fault Tolerance | Performance
--------------|--------------------------|-----------|-----------------|-------------
RAID 0        | Striping (no redundancy) | 2         | None           | High Read/Write
RAID 1        | Mirroring                | 2         | 1 disk failure | Good Read, Normal Write
RAID 5        | Striping with Parity     | 3         | 1 disk failure | Good Read, Moderate Write
RAID 6        | Double Parity           | 4         | 2 disk failures| Good Read, Lower Write
RAID 10       | Mirror + Stripe         | 4         | Multiple disks | High Read/Write
</pre></div>
</div>
</section>
<section id="raid-0-striping">
<h5>RAID 0 - Striping<a class="headerlink" href="#raid-0-striping" title="Link to this heading"></a></h5>
<p><strong>Characteristics:</strong>
* Data is striped across multiple disks
* No redundancy - failure of any disk results in total data loss
* Excellent performance for both reads and writes
* Full utilization of disk capacity</p>
<p><strong>Use Cases:</strong>
* High-performance applications
* Temporary data processing
* Non-critical data requiring high speed</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create RAID 0 with mdadm</span>
sudo<span class="w"> </span>mdadm<span class="w"> </span>--create<span class="w"> </span>/dev/md0<span class="w"> </span>--level<span class="o">=</span><span class="m">0</span><span class="w"> </span>--raid-devices<span class="o">=</span><span class="m">2</span><span class="w"> </span>/dev/sdb<span class="w"> </span>/dev/sdc

<span class="c1"># Format and mount</span>
sudo<span class="w"> </span>mkfs.ext4<span class="w"> </span>/dev/md0
sudo<span class="w"> </span>mkdir<span class="w"> </span>/mnt/raid0
sudo<span class="w"> </span>mount<span class="w"> </span>/dev/md0<span class="w"> </span>/mnt/raid0
</pre></div>
</div>
</section>
<section id="raid-1-mirroring">
<h5>RAID 1 - Mirroring<a class="headerlink" href="#raid-1-mirroring" title="Link to this heading"></a></h5>
<p><strong>Characteristics:</strong>
* Data is mirrored across multiple disks
* Can survive failure of all but one disk
* Read performance can be improved
* Write performance is similar to single disk
* 50% storage efficiency</p>
<p><strong>Use Cases:</strong>
* Critical data requiring high availability
* Operating system partitions
* Database storage
* Boot drives</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create RAID 1 with mdadm</span>
sudo<span class="w"> </span>mdadm<span class="w"> </span>--create<span class="w"> </span>/dev/md1<span class="w"> </span>--level<span class="o">=</span><span class="m">1</span><span class="w"> </span>--raid-devices<span class="o">=</span><span class="m">2</span><span class="w"> </span>/dev/sdb<span class="w"> </span>/dev/sdc

<span class="c1"># Monitor RAID status</span>
cat<span class="w"> </span>/proc/mdstat

<span class="c1"># Check RAID details</span>
sudo<span class="w"> </span>mdadm<span class="w"> </span>--detail<span class="w"> </span>/dev/md1
</pre></div>
</div>
</section>
<section id="raid-5-striping-with-parity">
<h5>RAID 5 - Striping with Parity<a class="headerlink" href="#raid-5-striping-with-parity" title="Link to this heading"></a></h5>
<p><strong>Characteristics:</strong>
* Data and parity information striped across all disks
* Can survive failure of one disk
* Good read performance
* Write performance penalty due to parity calculation
* Storage efficiency: (n-1)/n where n is number of disks</p>
<p><strong>Use Cases:</strong>
* General purpose storage
* File servers
* Backup storage
* Cost-effective redundancy</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create RAID 5 with 3 disks</span>
sudo<span class="w"> </span>mdadm<span class="w"> </span>--create<span class="w"> </span>/dev/md5<span class="w"> </span>--level<span class="o">=</span><span class="m">5</span><span class="w"> </span>--raid-devices<span class="o">=</span><span class="m">3</span><span class="w"> </span>/dev/sdb<span class="w"> </span>/dev/sdc<span class="w"> </span>/dev/sdd

<span class="c1"># Add spare disk</span>
sudo<span class="w"> </span>mdadm<span class="w"> </span>--add<span class="w"> </span>/dev/md5<span class="w"> </span>/dev/sde
</pre></div>
</div>
</section>
<section id="raid-6-double-parity">
<h5>RAID 6 - Double Parity<a class="headerlink" href="#raid-6-double-parity" title="Link to this heading"></a></h5>
<p><strong>Characteristics:</strong>
* Two parity blocks for each stripe
* Can survive failure of two disks
* Better fault tolerance than RAID 5
* Lower write performance than RAID 5
* Storage efficiency: (n-2)/n</p>
<p><strong>Use Cases:</strong>
* Large disk arrays
* Critical data with high availability requirements
* Long rebuild times scenarios
* Enterprise storage systems</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create RAID 6 with 4 disks</span>
sudo<span class="w"> </span>mdadm<span class="w"> </span>--create<span class="w"> </span>/dev/md6<span class="w"> </span>--level<span class="o">=</span><span class="m">6</span><span class="w"> </span>--raid-devices<span class="o">=</span><span class="m">4</span><span class="w"> </span>/dev/sdb<span class="w"> </span>/dev/sdc<span class="w"> </span>/dev/sdd<span class="w"> </span>/dev/sde
</pre></div>
</div>
</section>
<section id="raid-10-mirror-and-stripe">
<h5>RAID 10 - Mirror and Stripe<a class="headerlink" href="#raid-10-mirror-and-stripe" title="Link to this heading"></a></h5>
<p><strong>Characteristics:</strong>
* Combines RAID 1 (mirroring) and RAID 0 (striping)
* Excellent performance and redundancy
* Can survive multiple disk failures (in different mirror sets)
* 50% storage efficiency
* Fast rebuild times</p>
<p><strong>Use Cases:</strong>
* High-performance databases
* Virtual machine storage
* High-availability applications
* Enterprise critical data</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create RAID 10 with 4 disks</span>
sudo<span class="w"> </span>mdadm<span class="w"> </span>--create<span class="w"> </span>/dev/md10<span class="w"> </span>--level<span class="o">=</span><span class="m">10</span><span class="w"> </span>--raid-devices<span class="o">=</span><span class="m">4</span><span class="w"> </span>/dev/sdb<span class="w"> </span>/dev/sdc<span class="w"> </span>/dev/sdd<span class="w"> </span>/dev/sde
</pre></div>
</div>
</section>
</section>
<section id="setting-up-raid-on-ubuntu-22-04">
<h4>Setting Up RAID on Ubuntu 22.04<a class="headerlink" href="#setting-up-raid-on-ubuntu-22-04" title="Link to this heading"></a></h4>
<section id="installing-raid-tools">
<h5>Installing RAID Tools<a class="headerlink" href="#installing-raid-tools" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install mdadm for software RAID</span>
sudo<span class="w"> </span>apt<span class="w"> </span>update
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>mdadm

<span class="c1"># Install additional tools</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>smartmontools<span class="w"> </span>hdparm<span class="w"> </span>parted

<span class="c1"># Check available disks</span>
sudo<span class="w"> </span>fdisk<span class="w"> </span>-l
lsblk
</pre></div>
</div>
</section>
<section id="preparing-disks-for-raid">
<h5>Preparing Disks for RAID<a class="headerlink" href="#preparing-disks-for-raid" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Wipe disk signatures (WARNING: This destroys data!)</span>
sudo<span class="w"> </span>wipefs<span class="w"> </span>-a<span class="w"> </span>/dev/sdb
sudo<span class="w"> </span>wipefs<span class="w"> </span>-a<span class="w"> </span>/dev/sdc

<span class="c1"># Create partitions (optional, can use whole disks)</span>
sudo<span class="w"> </span>parted<span class="w"> </span>/dev/sdb<span class="w"> </span>mklabel<span class="w"> </span>gpt
sudo<span class="w"> </span>parted<span class="w"> </span>/dev/sdb<span class="w"> </span>mkpart<span class="w"> </span>primary<span class="w"> </span><span class="m">0</span>%<span class="w"> </span><span class="m">100</span>%
sudo<span class="w"> </span>parted<span class="w"> </span>/dev/sdb<span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>raid<span class="w"> </span>on

<span class="c1"># Verify no existing RAID metadata</span>
sudo<span class="w"> </span>mdadm<span class="w"> </span>--examine<span class="w"> </span>/dev/sdb
sudo<span class="w"> </span>mdadm<span class="w"> </span>--examine<span class="w"> </span>/dev/sdc
</pre></div>
</div>
</section>
<section id="creating-raid-arrays">
<h5>Creating RAID Arrays<a class="headerlink" href="#creating-raid-arrays" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create RAID 1 array</span>
sudo<span class="w"> </span>mdadm<span class="w"> </span>--create<span class="w"> </span>--verbose<span class="w"> </span>/dev/md0<span class="w"> </span><span class="se">\\</span>
<span class="w">    </span>--level<span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="se">\\</span>
<span class="w">    </span>--raid-devices<span class="o">=</span><span class="m">2</span><span class="w"> </span><span class="se">\\</span>
<span class="w">    </span>/dev/sdb<span class="w"> </span>/dev/sdc

<span class="c1"># Create RAID 5 array with spare</span>
sudo<span class="w"> </span>mdadm<span class="w"> </span>--create<span class="w"> </span>--verbose<span class="w"> </span>/dev/md1<span class="w"> </span><span class="se">\\</span>
<span class="w">    </span>--level<span class="o">=</span><span class="m">5</span><span class="w"> </span><span class="se">\\</span>
<span class="w">    </span>--raid-devices<span class="o">=</span><span class="m">3</span><span class="w"> </span><span class="se">\\</span>
<span class="w">    </span>--spare-devices<span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="se">\\</span>
<span class="w">    </span>/dev/sdb<span class="w"> </span>/dev/sdc<span class="w"> </span>/dev/sdd<span class="w"> </span>/dev/sde

<span class="c1"># Save RAID configuration</span>
sudo<span class="w"> </span>mdadm<span class="w"> </span>--detail<span class="w"> </span>--scan<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/mdadm/mdadm.conf

<span class="c1"># Update initramfs</span>
sudo<span class="w"> </span>update-initramfs<span class="w"> </span>-u
</pre></div>
</div>
</section>
</section>
<section id="raid-management-and-monitoring">
<h4>RAID Management and Monitoring<a class="headerlink" href="#raid-management-and-monitoring" title="Link to this heading"></a></h4>
<section id="monitoring-raid-status">
<h5>Monitoring RAID Status<a class="headerlink" href="#monitoring-raid-status" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check RAID status</span>
cat<span class="w"> </span>/proc/mdstat

<span class="c1"># Detailed RAID information</span>
sudo<span class="w"> </span>mdadm<span class="w"> </span>--detail<span class="w"> </span>/dev/md0

<span class="c1"># Monitor RAID in real-time</span>
watch<span class="w"> </span>cat<span class="w"> </span>/proc/mdstat

<span class="c1"># Check individual disk health</span>
sudo<span class="w"> </span>smartctl<span class="w"> </span>-a<span class="w"> </span>/dev/sdb
</pre></div>
</div>
</section>
<section id="raid-maintenance-operations">
<h5>RAID Maintenance Operations<a class="headerlink" href="#raid-maintenance-operations" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add a disk to RAID array</span>
sudo<span class="w"> </span>mdadm<span class="w"> </span>--add<span class="w"> </span>/dev/md0<span class="w"> </span>/dev/sdd

<span class="c1"># Remove a disk from RAID array</span>
sudo<span class="w"> </span>mdadm<span class="w"> </span>--remove<span class="w"> </span>/dev/md0<span class="w"> </span>/dev/sdd

<span class="c1"># Mark a disk as failed</span>
sudo<span class="w"> </span>mdadm<span class="w"> </span>--fail<span class="w"> </span>/dev/md0<span class="w"> </span>/dev/sdb

<span class="c1"># Replace a failed disk</span>
sudo<span class="w"> </span>mdadm<span class="w"> </span>--remove<span class="w"> </span>/dev/md0<span class="w"> </span>/dev/sdb
<span class="c1"># Physically replace disk</span>
sudo<span class="w"> </span>mdadm<span class="w"> </span>--add<span class="w"> </span>/dev/md0<span class="w"> </span>/dev/sdb

<span class="c1"># Grow RAID array (add more disks)</span>
sudo<span class="w"> </span>mdadm<span class="w"> </span>--grow<span class="w"> </span>/dev/md0<span class="w"> </span>--raid-devices<span class="o">=</span><span class="m">3</span><span class="w"> </span>--add<span class="w"> </span>/dev/sdd

<span class="c1"># Reshape RAID array</span>
sudo<span class="w"> </span>mdadm<span class="w"> </span>--grow<span class="w"> </span>/dev/md0<span class="w"> </span>--level<span class="o">=</span><span class="m">6</span>
</pre></div>
</div>
</section>
</section>
<section id="raid-performance-optimization">
<h4>RAID Performance Optimization<a class="headerlink" href="#raid-performance-optimization" title="Link to this heading"></a></h4>
<section id="stripe-size-optimization">
<h5>Stripe Size Optimization<a class="headerlink" href="#stripe-size-optimization" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create RAID with custom chunk size</span>
sudo<span class="w"> </span>mdadm<span class="w"> </span>--create<span class="w"> </span>/dev/md0<span class="w"> </span><span class="se">\\</span>
<span class="w">    </span>--level<span class="o">=</span><span class="m">5</span><span class="w"> </span><span class="se">\\</span>
<span class="w">    </span>--chunk<span class="o">=</span><span class="m">64</span><span class="w"> </span><span class="se">\\</span>
<span class="w">    </span>--raid-devices<span class="o">=</span><span class="m">3</span><span class="w"> </span><span class="se">\\</span>
<span class="w">    </span>/dev/sdb<span class="w"> </span>/dev/sdc<span class="w"> </span>/dev/sdd

<span class="c1"># Test different chunk sizes for your workload</span>
<span class="k">for</span><span class="w"> </span>chunk<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">32</span><span class="w"> </span><span class="m">64</span><span class="w"> </span><span class="m">128</span><span class="w"> </span><span class="m">256</span><span class="w"> </span><span class="m">512</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Testing chunk size: </span><span class="nv">$chunk</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="c1"># Create test array and measure performance</span>
<span class="k">done</span>
</pre></div>
</div>
</section>
<section id="i-o-scheduler-optimization">
<h5>I/O Scheduler Optimization<a class="headerlink" href="#i-o-scheduler-optimization" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set I/O scheduler for RAID devices</span>
<span class="nb">echo</span><span class="w"> </span>mq-deadline<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/sys/block/md0/queue/scheduler

<span class="c1"># Optimize readahead</span>
sudo<span class="w"> </span>blockdev<span class="w"> </span>--setra<span class="w"> </span><span class="m">65536</span><span class="w"> </span>/dev/md0

<span class="c1"># Disable barriers for better performance (if UPS protected)</span>
sudo<span class="w"> </span>mount<span class="w"> </span>-o<span class="w"> </span><span class="nv">barrier</span><span class="o">=</span><span class="m">0</span><span class="w"> </span>/dev/md0<span class="w"> </span>/mnt/raid
</pre></div>
</div>
</section>
<section id="filesystem-considerations">
<h5>Filesystem Considerations<a class="headerlink" href="#filesystem-considerations" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Align filesystem to RAID geometry</span>
<span class="c1"># For RAID 5 with 3 disks and 64K chunk size:</span>
<span class="c1"># Stripe width = (disks - parity) * chunk_size = 2 * 64K = 128K</span>

sudo<span class="w"> </span>mkfs.ext4<span class="w"> </span>-E<span class="w"> </span><span class="nv">stride</span><span class="o">=</span><span class="m">16</span>,stripe-width<span class="o">=</span><span class="m">32</span><span class="w"> </span>/dev/md0

<span class="c1"># For XFS on RAID</span>
sudo<span class="w"> </span>mkfs.xfs<span class="w"> </span>-d<span class="w"> </span><span class="nv">su</span><span class="o">=</span><span class="m">65536</span>,sw<span class="o">=</span><span class="m">2</span><span class="w"> </span>/dev/md0
</pre></div>
</div>
</section>
</section>
<section id="frequently-asked-questions">
<h4>Frequently Asked Questions<a class="headerlink" href="#frequently-asked-questions" title="Link to this heading"></a></h4>
<section id="q-which-raid-level-should-i-choose-for-my-use-case">
<h5>Q: Which RAID level should I choose for my use case?<a class="headerlink" href="#q-which-raid-level-should-i-choose-for-my-use-case" title="Link to this heading"></a></h5>
<p><strong>A:</strong> Choose based on your priorities:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Priority              | Recommended RAID
---------------------|------------------
Maximum Performance  | RAID 0 (no redundancy)
High Availability    | RAID 1 or RAID 10
Balanced Performance | RAID 5
Maximum Protection   | RAID 6
Performance + Safety | RAID 10
</pre></div>
</div>
</section>
<section id="q-can-i-convert-between-raid-levels">
<h5>Q: Can I convert between RAID levels?<a class="headerlink" href="#q-can-i-convert-between-raid-levels" title="Link to this heading"></a></h5>
<p><strong>A:</strong> Yes, but with limitations:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convert RAID 1 to RAID 5 (requires adding disks first)</span>
sudo<span class="w"> </span>mdadm<span class="w"> </span>--add<span class="w"> </span>/dev/md0<span class="w"> </span>/dev/sdd
sudo<span class="w"> </span>mdadm<span class="w"> </span>--grow<span class="w"> </span>/dev/md0<span class="w"> </span>--level<span class="o">=</span><span class="m">5</span><span class="w"> </span>--raid-devices<span class="o">=</span><span class="m">3</span>

<span class="c1"># Convert RAID 5 to RAID 6</span>
sudo<span class="w"> </span>mdadm<span class="w"> </span>--grow<span class="w"> </span>/dev/md0<span class="w"> </span>--level<span class="o">=</span><span class="m">6</span><span class="w"> </span>--raid-devices<span class="o">=</span><span class="m">4</span><span class="w"> </span>--add<span class="w"> </span>/dev/sde

<span class="c1"># Note: Always backup data before conversion!</span>
</pre></div>
</div>
</section>
<section id="q-how-do-i-recover-from-a-raid-failure">
<h5>Q: How do I recover from a RAID failure?<a class="headerlink" href="#q-how-do-i-recover-from-a-raid-failure" title="Link to this heading"></a></h5>
<p><strong>A:</strong> Recovery steps depend on the failure type:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># For single disk failure in RAID 1/5/6:</span>
<span class="c1"># 1. Replace failed disk</span>
sudo<span class="w"> </span>mdadm<span class="w"> </span>--remove<span class="w"> </span>/dev/md0<span class="w"> </span>/dev/sdb<span class="w">  </span><span class="c1"># Remove failed disk</span>
<span class="c1"># 2. Add new disk</span>
sudo<span class="w"> </span>mdadm<span class="w"> </span>--add<span class="w"> </span>/dev/md0<span class="w"> </span>/dev/sdb

<span class="c1"># For array corruption:</span>
<span class="c1"># 1. Stop array</span>
sudo<span class="w"> </span>mdadm<span class="w"> </span>--stop<span class="w"> </span>/dev/md0
<span class="c1"># 2. Assemble with force</span>
sudo<span class="w"> </span>mdadm<span class="w"> </span>--assemble<span class="w"> </span>--force<span class="w"> </span>/dev/md0<span class="w"> </span>/dev/sdb<span class="w"> </span>/dev/sdc

<span class="c1"># For complete array loss:</span>
<span class="c1"># 1. Try to recreate array with same parameters</span>
<span class="c1"># 2. Use data recovery tools</span>
<span class="c1"># 3. Restore from backup</span>
</pre></div>
</div>
</section>
<section id="q-how-do-i-monitor-raid-health-automatically">
<h5>Q: How do I monitor RAID health automatically?<a class="headerlink" href="#q-how-do-i-monitor-raid-health-automatically" title="Link to this heading"></a></h5>
<p><strong>A:</strong> Set up automated monitoring:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Configure mdadm monitoring</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;MAILADDR admin@example.com&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/mdadm/mdadm.conf

<span class="c1"># Test email notification</span>
sudo<span class="w"> </span>mdadm<span class="w"> </span>--monitor<span class="w"> </span>--test<span class="w"> </span>/dev/md0

<span class="c1"># Set up continuous monitoring service</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>mdmonitor
sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>mdmonitor
</pre></div>
</div>
</section>
</section>
<section id="coding-examples">
<h4>Coding Examples<a class="headerlink" href="#coding-examples" title="Link to this heading"></a></h4>
<section id="python-raid-monitoring-script">
<h5>Python RAID Monitoring Script<a class="headerlink" href="#python-raid-monitoring-script" title="Link to this heading"></a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">RAID monitoring and management script for Ubuntu 22.04</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">smtplib</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">email.mime.text</span><span class="w"> </span><span class="kn">import</span> <span class="n">MIMEText</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

<span class="k">class</span><span class="w"> </span><span class="nc">RAIDMonitor</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raid_devices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">discover_raid_devices</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">discover_raid_devices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Discover all RAID devices on the system&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="s1">&#39;/proc/mdstat&#39;</span><span class="p">],</span>
                                  <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">devices</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">n&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;md&#39;</span><span class="p">):</span>
                    <span class="n">device_name</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">devices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;/dev/</span><span class="si">{</span><span class="n">device_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">devices</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error discovering RAID devices: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_raid_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get detailed status of a RAID device&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;mdadm&#39;</span><span class="p">,</span> <span class="s1">&#39;--detail&#39;</span><span class="p">,</span> <span class="n">device</span><span class="p">],</span>
                                  <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Failed to get status for </span><span class="si">{</span><span class="n">device</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">}</span>

            <span class="n">status</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;device&#39;</span><span class="p">:</span> <span class="n">device</span><span class="p">,</span> <span class="s1">&#39;healthy&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="p">{}}</span>

            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">n&#39;</span><span class="p">):</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

                <span class="k">if</span> <span class="s1">&#39;State :&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">state</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">status</span><span class="p">[</span><span class="s1">&#39;details&#39;</span><span class="p">][</span><span class="s1">&#39;state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span>
                    <span class="k">if</span> <span class="s1">&#39;clean&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                        <span class="n">status</span><span class="p">[</span><span class="s1">&#39;healthy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">elif</span> <span class="s1">&#39;RAID Level :&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">status</span><span class="p">[</span><span class="s1">&#39;details&#39;</span><span class="p">][</span><span class="s1">&#39;level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

                <span class="k">elif</span> <span class="s1">&#39;Array Size :&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">status</span><span class="p">[</span><span class="s1">&#39;details&#39;</span><span class="p">][</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

                <span class="k">elif</span> <span class="s1">&#39;Used Dev Size :&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">status</span><span class="p">[</span><span class="s1">&#39;details&#39;</span><span class="p">][</span><span class="s1">&#39;used_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

                <span class="k">elif</span> <span class="s1">&#39;Active Devices :&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">status</span><span class="p">[</span><span class="s1">&#39;details&#39;</span><span class="p">][</span><span class="s1">&#39;active_devices&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

                <span class="k">elif</span> <span class="s1">&#39;Working Devices :&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">status</span><span class="p">[</span><span class="s1">&#39;details&#39;</span><span class="p">][</span><span class="s1">&#39;working_devices&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

                <span class="k">elif</span> <span class="s1">&#39;Failed Devices :&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">failed</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                    <span class="n">status</span><span class="p">[</span><span class="s1">&#39;details&#39;</span><span class="p">][</span><span class="s1">&#39;failed_devices&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">failed</span>
                    <span class="k">if</span> <span class="n">failed</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">status</span><span class="p">[</span><span class="s1">&#39;healthy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">return</span> <span class="n">status</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;device&#39;</span><span class="p">:</span> <span class="n">device</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_disk_health</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check individual disk health using SMART&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;smartctl&#39;</span><span class="p">,</span> <span class="s1">&#39;-H&#39;</span><span class="p">,</span> <span class="n">device</span><span class="p">],</span>
                                  <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">if</span> <span class="s1">&#39;PASSED&#39;</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;device&#39;</span><span class="p">:</span> <span class="n">device</span><span class="p">,</span> <span class="s1">&#39;smart_status&#39;</span><span class="p">:</span> <span class="s1">&#39;PASSED&#39;</span><span class="p">,</span> <span class="s1">&#39;healthy&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;device&#39;</span><span class="p">:</span> <span class="n">device</span><span class="p">,</span> <span class="s1">&#39;smart_status&#39;</span><span class="p">:</span> <span class="s1">&#39;FAILED&#39;</span><span class="p">,</span> <span class="s1">&#39;healthy&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;device&#39;</span><span class="p">:</span> <span class="n">device</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_array_sync</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if array is currently syncing/rebuilding&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/proc/mdstat&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

            <span class="n">device_name</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">n&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">device_name</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;resync&#39;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">or</span> <span class="s1">&#39;recovery&#39;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">or</span> <span class="s1">&#39;rebuild&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="c1"># Extract progress if available</span>
                        <span class="n">progress_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">[([^</span><span class="se">\\</span><span class="s1">]]+)</span><span class="se">\\</span><span class="s1">]&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">progress_match</span><span class="p">:</span>
                            <span class="k">return</span> <span class="p">{</span>
                                <span class="s1">&#39;syncing&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                                <span class="s1">&#39;progress&#39;</span><span class="p">:</span> <span class="n">progress_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
                                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                            <span class="p">}</span>
                        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;syncing&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()}</span>

            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;syncing&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate comprehensive RAID status report&quot;&quot;&quot;</span>
        <span class="n">report</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
            <span class="s1">&#39;hostname&#39;</span><span class="p">:</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;hostname&#39;</span><span class="p">],</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
            <span class="s1">&#39;raid_devices&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;overall_health&#39;</span><span class="p">:</span> <span class="kc">True</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">raid_devices</span><span class="p">:</span>
            <span class="n">device_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_raid_status</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
            <span class="n">sync_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_array_sync</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

            <span class="n">device_report</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;device&#39;</span><span class="p">:</span> <span class="n">device</span><span class="p">,</span>
                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="n">device_status</span><span class="p">,</span>
                <span class="s1">&#39;sync&#39;</span><span class="p">:</span> <span class="n">sync_status</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">device_status</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;healthy&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="n">report</span><span class="p">[</span><span class="s1">&#39;overall_health&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="n">report</span><span class="p">[</span><span class="s1">&#39;raid_devices&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">device_report</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">report</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">send_alert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">subject</span><span class="o">=</span><span class="s2">&quot;RAID Alert&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Send email alert (requires SMTP configuration)&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Configure SMTP settings</span>
            <span class="n">smtp_server</span> <span class="o">=</span> <span class="s2">&quot;localhost&quot;</span>
            <span class="n">smtp_port</span> <span class="o">=</span> <span class="mi">587</span>
            <span class="n">from_email</span> <span class="o">=</span> <span class="s2">&quot;raid-monitor@localhost&quot;</span>
            <span class="n">to_email</span> <span class="o">=</span> <span class="s2">&quot;admin@localhost&quot;</span>

            <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
            <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;Subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subject</span>
            <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;From&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">from_email</span>
            <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;To&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_email</span>

            <span class="n">server</span> <span class="o">=</span> <span class="n">smtplib</span><span class="o">.</span><span class="n">SMTP</span><span class="p">(</span><span class="n">smtp_server</span><span class="p">,</span> <span class="n">smtp_port</span><span class="p">)</span>
            <span class="n">server</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">server</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>

            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to send alert: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">monitor_continuous</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">300</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Continuous monitoring with specified interval (seconds)&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Starting RAID monitoring (checking every </span><span class="si">{</span><span class="n">interval</span><span class="si">}</span><span class="s2"> seconds)&quot;</span><span class="p">)</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">report</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_report</span><span class="p">()</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">report</span><span class="p">[</span><span class="s1">&#39;overall_health&#39;</span><span class="p">]:</span>
                    <span class="n">alert_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;RAID Health Alert - </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;hostname&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\\</span><span class="s2">n</span><span class="se">\\</span><span class="s2">n&quot;</span>
                    <span class="n">alert_message</span> <span class="o">+=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">report</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ALERT: RAID issues detected at </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">send_alert</span><span class="p">(</span><span class="n">alert_message</span><span class="p">,</span> <span class="s2">&quot;RAID Health Alert&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;All RAID devices healthy at </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">interval</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">nMonitoring stopped by user&quot;</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error during monitoring: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">interval</span><span class="p">)</span>

<span class="c1"># Example usage and CLI interface</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">argparse</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;RAID Monitoring Tool&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--monitor&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Start continuous monitoring&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--report&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Generate one-time report&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--device&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Check specific device&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--interval&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Monitoring interval in seconds&#39;</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">monitor</span> <span class="o">=</span> <span class="n">RAIDMonitor</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">monitor</span><span class="p">:</span>
        <span class="n">monitor</span><span class="o">.</span><span class="n">monitor_continuous</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">interval</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">report</span><span class="p">:</span>
        <span class="n">report</span> <span class="o">=</span> <span class="n">monitor</span><span class="o">.</span><span class="n">generate_report</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">report</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">device</span><span class="p">:</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">monitor</span><span class="o">.</span><span class="n">get_raid_status</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Default: show brief status</span>
        <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">monitor</span><span class="o">.</span><span class="n">raid_devices</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">monitor</span><span class="o">.</span><span class="n">get_raid_status</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
            <span class="n">health</span> <span class="o">=</span> <span class="s2">&quot;HEALTHY&quot;</span> <span class="k">if</span> <span class="n">status</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;healthy&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;UNHEALTHY&quot;</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">device</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">health</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="bash-raid-management-script">
<h5>Bash RAID Management Script<a class="headerlink" href="#bash-raid-management-script" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1"># raid_manager.sh - Comprehensive RAID management for Ubuntu 22.04</span>

<span class="c1"># Configuration</span>
<span class="nv">CONFIG_FILE</span><span class="o">=</span><span class="s2">&quot;/etc/raid_manager.conf&quot;</span>
<span class="nv">LOG_FILE</span><span class="o">=</span><span class="s2">&quot;/var/log/raid_manager.log&quot;</span>
<span class="nv">ALERT_EMAIL</span><span class="o">=</span><span class="s2">&quot;admin@localhost&quot;</span>

<span class="c1"># Colors for output</span>
<span class="nv">RED</span><span class="o">=</span><span class="s1">&#39;\033[0;31m&#39;</span>
<span class="nv">GREEN</span><span class="o">=</span><span class="s1">&#39;\033[0;32m&#39;</span>
<span class="nv">YELLOW</span><span class="o">=</span><span class="s1">&#39;\033[1;33m&#39;</span>
<span class="nv">BLUE</span><span class="o">=</span><span class="s1">&#39;\033[0;34m&#39;</span>
<span class="nv">NC</span><span class="o">=</span><span class="s1">&#39;\033[0m&#39;</span>

<span class="c1"># Logging function</span>
log_message<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>date<span class="w"> </span><span class="s1">&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span class="k">)</span><span class="s2"> - </span><span class="nv">$1</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LOG_FILE</span><span class="s2">&quot;</span>
<span class="o">}</span>

<span class="c1"># Check if running as root</span>
check_root<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$EUID</span><span class="w"> </span>-ne<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">RED</span><span class="si">}</span><span class="s2">This script must be run as root</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>
<span class="o">}</span>

<span class="c1"># Install required packages</span>
install_dependencies<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BLUE</span><span class="si">}</span><span class="s2">Installing RAID dependencies...</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="w">    </span>apt<span class="w"> </span>update
<span class="w">    </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>mdadm<span class="w"> </span>smartmontools<span class="w"> </span>parted<span class="w"> </span>gdisk<span class="w"> </span>mail-utils

<span class="w">    </span><span class="c1"># Enable mdadm monitoring</span>
<span class="w">    </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>mdmonitor
<span class="w">    </span>systemctl<span class="w"> </span>start<span class="w"> </span>mdmonitor

<span class="w">    </span>log_message<span class="w"> </span><span class="s2">&quot;RAID dependencies installed&quot;</span>
<span class="o">}</span>

<span class="c1"># Discover RAID devices</span>
discover_raids<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BLUE</span><span class="si">}</span><span class="s2">=== Discovered RAID Devices ===</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-f<span class="w"> </span>/proc/mdstat<span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span>cat<span class="w"> </span>/proc/mdstat
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>

<span class="w">        </span><span class="c1"># List detailed information for each device</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span>device<span class="w"> </span><span class="k">in</span><span class="w"> </span>/dev/md*<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-b<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="s2">Details for </span><span class="nv">$device</span><span class="s2">:</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">                </span>mdadm<span class="w"> </span>--detail<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-20
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="w">            </span><span class="k">fi</span>
<span class="w">        </span><span class="k">done</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;No RAID devices found&quot;</span>
<span class="w">    </span><span class="k">fi</span>
<span class="o">}</span>

<span class="c1"># Create RAID array</span>
create_raid<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">level</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">devices</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">array_name</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$3</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$level</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$devices</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Usage: create_raid &lt;level&gt; &lt;device1,device2,...&gt; [array_name]&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Example: create_raid 1 /dev/sdb,/dev/sdc myraid&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">device_array</span><span class="o">=(</span><span class="si">${</span><span class="nv">devices</span><span class="p">//,/ </span><span class="si">}</span><span class="o">)</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">device_count</span><span class="o">=</span><span class="si">${#</span><span class="nv">device_array</span><span class="p">[@]</span><span class="si">}</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">raid_device</span><span class="o">=</span><span class="s2">&quot;/dev/md</span><span class="si">${</span><span class="nv">array_name</span><span class="k">:-$(</span>date<span class="w"> </span>+%s<span class="k">)</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">YELLOW</span><span class="si">}</span><span class="s2">Creating RAID </span><span class="nv">$level</span><span class="s2"> with </span><span class="nv">$device_count</span><span class="s2"> devices</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="c1"># Validate RAID level and device count</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$level</span><span class="s2">&quot;</span><span class="w"> </span><span class="k">in</span>
<span class="w">        </span><span class="s2">&quot;0&quot;</span><span class="o">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$device_count</span><span class="w"> </span>-lt<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">RED</span><span class="si">}</span><span class="s2">RAID 0 requires at least 2 devices</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">            </span><span class="k">fi</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">        </span><span class="s2">&quot;1&quot;</span><span class="o">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$device_count</span><span class="w"> </span>-lt<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">RED</span><span class="si">}</span><span class="s2">RAID 1 requires at least 2 devices</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">            </span><span class="k">fi</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">        </span><span class="s2">&quot;5&quot;</span><span class="o">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$device_count</span><span class="w"> </span>-lt<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">RED</span><span class="si">}</span><span class="s2">RAID 5 requires at least 3 devices</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">            </span><span class="k">fi</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">        </span><span class="s2">&quot;6&quot;</span><span class="o">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$device_count</span><span class="w"> </span>-lt<span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">RED</span><span class="si">}</span><span class="s2">RAID 6 requires at least 4 devices</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">            </span><span class="k">fi</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">        </span><span class="s2">&quot;10&quot;</span><span class="o">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$device_count</span><span class="w"> </span>-lt<span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="k">$((</span><span class="nv">device_count</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="m">2</span><span class="k">))</span><span class="w"> </span>-ne<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">RED</span><span class="si">}</span><span class="s2">RAID 10 requires at least 4 devices (even number)</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">            </span><span class="k">fi</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">        </span>*<span class="o">)</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">RED</span><span class="si">}</span><span class="s2">Unsupported RAID level: </span><span class="nv">$level</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">    </span><span class="k">esac</span>

<span class="w">    </span><span class="c1"># Prepare devices</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Preparing devices...&quot;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span>device<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">device_array</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Wiping </span><span class="nv">$device</span><span class="s2">...&quot;</span>
<span class="w">        </span>wipefs<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span>

<span class="w">        </span><span class="c1"># Zero superblock if exists</span>
<span class="w">        </span>mdadm<span class="w"> </span>--zero-superblock<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null
<span class="w">    </span><span class="k">done</span>

<span class="w">    </span><span class="c1"># Create RAID array</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Creating RAID array...&quot;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span>mdadm<span class="w"> </span>--create<span class="w"> </span>--verbose<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$raid_device</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\\</span>
<span class="w">        </span>--level<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$level</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\\</span>
<span class="w">        </span>--raid-devices<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$device_count</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\\</span>
<span class="w">        </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">device_array</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>

<span class="w">        </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="s2">RAID array created successfully: </span><span class="nv">$raid_device</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="w">        </span><span class="c1"># Save configuration</span>
<span class="w">        </span>mdadm<span class="w"> </span>--detail<span class="w"> </span>--scan<span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/mdadm/mdadm.conf
<span class="w">        </span>update-initramfs<span class="w"> </span>-u

<span class="w">        </span>log_message<span class="w"> </span><span class="s2">&quot;Created RAID </span><span class="nv">$level</span><span class="s2"> array </span><span class="nv">$raid_device</span><span class="s2"> with devices: </span><span class="nv">$devices</span><span class="s2">&quot;</span>

<span class="w">        </span><span class="c1"># Wait for array to synchronize</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Waiting for initial synchronization...&quot;</span>
<span class="w">        </span><span class="k">while</span><span class="w"> </span>grep<span class="w"> </span>-q<span class="w"> </span><span class="s2">&quot;resync&quot;</span><span class="w"> </span>/proc/mdstat<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;.&quot;</span>
<span class="w">            </span>sleep<span class="w"> </span><span class="m">5</span>
<span class="w">        </span><span class="k">done</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="s2">Initial synchronization complete</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">RED</span><span class="si">}</span><span class="s2">Failed to create RAID array</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>
<span class="o">}</span>

<span class="c1"># Monitor RAID health</span>
monitor_raid_health<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BLUE</span><span class="si">}</span><span class="s2">=== RAID Health Monitor ===</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">unhealthy_found</span><span class="o">=</span><span class="nb">false</span>

<span class="w">    </span><span class="c1"># Check each RAID device</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span>device<span class="w"> </span><span class="k">in</span><span class="w"> </span>/dev/md*<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-b<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Checking </span><span class="nv">$device</span><span class="s2">...&quot;</span>

<span class="w">            </span><span class="c1"># Get RAID status</span>
<span class="w">            </span><span class="nb">local</span><span class="w"> </span><span class="nv">status</span><span class="o">=</span><span class="k">$(</span>mdadm<span class="w"> </span>--detail<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;State :&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $3}&#39;</span><span class="k">)</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$status</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;clean&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="nv">$device</span><span class="s2">: Healthy (</span><span class="nv">$status</span><span class="s2">)</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">RED</span><span class="si">}</span><span class="nv">$device</span><span class="s2">: Unhealthy (</span><span class="nv">$status</span><span class="s2">)</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">                </span><span class="nv">unhealthy_found</span><span class="o">=</span><span class="nb">true</span>

<span class="w">                </span><span class="c1"># Get detailed information</span>
<span class="w">                </span>mdadm<span class="w"> </span>--detail<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="k">fi</span>

<span class="w">            </span><span class="c1"># Check for rebuild/resync</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span>grep<span class="w"> </span>-q<span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>basename<span class="w"> </span><span class="nv">$device</span><span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span>/proc/mdstat<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span><span class="nb">local</span><span class="w"> </span><span class="nv">sync_info</span><span class="o">=</span><span class="k">$(</span>grep<span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>basename<span class="w"> </span><span class="nv">$device</span><span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span>/proc/mdstat<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;(resync|rebuild|recovery)&quot;</span><span class="k">)</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$sync_info</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">YELLOW</span><span class="si">}</span><span class="nv">$device</span><span class="s2">: </span><span class="nv">$sync_info</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">                </span><span class="k">fi</span>
<span class="w">            </span><span class="k">fi</span>

<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="w">        </span><span class="k">fi</span>
<span class="w">    </span><span class="k">done</span>

<span class="w">    </span><span class="c1"># Check individual disk health</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BLUE</span><span class="si">}</span><span class="s2">=== Individual Disk Health ===</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span>device<span class="w"> </span><span class="k">in</span><span class="w"> </span>/dev/sd<span class="o">[</span>a-z<span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-b<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span><span class="nb">local</span><span class="w"> </span><span class="nv">smart_status</span><span class="o">=</span><span class="k">$(</span>smartctl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;SMART overall-health&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $6}&#39;</span><span class="k">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$smart_status</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;PASSED&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="nv">$device</span><span class="s2">: SMART PASSED</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="k">elif</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$smart_status</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;FAILED&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">RED</span><span class="si">}</span><span class="nv">$device</span><span class="s2">: SMART FAILED</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">                </span><span class="nv">unhealthy_found</span><span class="o">=</span><span class="nb">true</span>
<span class="w">            </span><span class="k">fi</span>
<span class="w">        </span><span class="k">fi</span>
<span class="w">    </span><span class="k">done</span>

<span class="w">    </span><span class="c1"># Send alert if issues found</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$unhealthy_found</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;true&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span>log_message<span class="w"> </span><span class="s2">&quot;RAID health issues detected&quot;</span>
<span class="w">        </span>send_alert<span class="w"> </span><span class="s2">&quot;RAID health issues detected on </span><span class="k">$(</span>hostname<span class="k">)</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">fi</span>
<span class="o">}</span>

<span class="c1"># Manage RAID device</span>
manage_raid<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">action</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">device</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">target</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$3</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$action</span><span class="s2">&quot;</span><span class="w"> </span><span class="k">in</span>
<span class="w">        </span><span class="s2">&quot;add&quot;</span><span class="o">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Usage: manage_raid add &lt;raid_device&gt; &lt;new_disk&gt;&quot;</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">            </span><span class="k">fi</span>

<span class="w">            </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">YELLOW</span><span class="si">}</span><span class="s2">Adding </span><span class="nv">$target</span><span class="s2"> to </span><span class="nv">$device</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span>mdadm<span class="w"> </span>--add<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="s2">Disk added successfully</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">                </span>log_message<span class="w"> </span><span class="s2">&quot;Added disk </span><span class="nv">$target</span><span class="s2"> to </span><span class="nv">$device</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">RED</span><span class="si">}</span><span class="s2">Failed to add disk</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="k">fi</span>
<span class="w">            </span><span class="p">;;</span>

<span class="w">        </span><span class="s2">&quot;remove&quot;</span><span class="o">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Usage: manage_raid remove &lt;raid_device&gt; &lt;disk&gt;&quot;</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">            </span><span class="k">fi</span>

<span class="w">            </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">YELLOW</span><span class="si">}</span><span class="s2">Removing </span><span class="nv">$target</span><span class="s2"> from </span><span class="nv">$device</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span>mdadm<span class="w"> </span>--remove<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="s2">Disk removed successfully</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">                </span>log_message<span class="w"> </span><span class="s2">&quot;Removed disk </span><span class="nv">$target</span><span class="s2"> from </span><span class="nv">$device</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">RED</span><span class="si">}</span><span class="s2">Failed to remove disk</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="k">fi</span>
<span class="w">            </span><span class="p">;;</span>

<span class="w">        </span><span class="s2">&quot;fail&quot;</span><span class="o">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Usage: manage_raid fail &lt;raid_device&gt; &lt;disk&gt;&quot;</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">            </span><span class="k">fi</span>

<span class="w">            </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">YELLOW</span><span class="si">}</span><span class="s2">Marking </span><span class="nv">$target</span><span class="s2"> as failed in </span><span class="nv">$device</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span>mdadm<span class="w"> </span>--fail<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="s2">Disk marked as failed</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">                </span>log_message<span class="w"> </span><span class="s2">&quot;Marked disk </span><span class="nv">$target</span><span class="s2"> as failed in </span><span class="nv">$device</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">RED</span><span class="si">}</span><span class="s2">Failed to mark disk as failed</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="k">fi</span>
<span class="w">            </span><span class="p">;;</span>

<span class="w">        </span><span class="s2">&quot;replace&quot;</span><span class="o">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Usage: manage_raid replace &lt;raid_device&gt; &lt;old_disk&gt; &lt;new_disk&gt;&quot;</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Note: old_disk should be failed first&quot;</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">            </span><span class="k">fi</span>

<span class="w">            </span><span class="nb">local</span><span class="w"> </span><span class="nv">new_disk</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$4</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$new_disk</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;New disk not specified&quot;</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">            </span><span class="k">fi</span>

<span class="w">            </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">YELLOW</span><span class="si">}</span><span class="s2">Replacing </span><span class="nv">$target</span><span class="s2"> with </span><span class="nv">$new_disk</span><span class="s2"> in </span><span class="nv">$device</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="w">            </span><span class="c1"># Remove failed disk</span>
<span class="w">            </span>mdadm<span class="w"> </span>--remove<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$target</span><span class="s2">&quot;</span>

<span class="w">            </span><span class="c1"># Add new disk</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span>mdadm<span class="w"> </span>--add<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$new_disk</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="s2">Disk replacement initiated</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">                </span>log_message<span class="w"> </span><span class="s2">&quot;Replaced disk </span><span class="nv">$target</span><span class="s2"> with </span><span class="nv">$new_disk</span><span class="s2"> in </span><span class="nv">$device</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">RED</span><span class="si">}</span><span class="s2">Failed to add replacement disk</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="k">fi</span>
<span class="w">            </span><span class="p">;;</span>

<span class="w">        </span>*<span class="o">)</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Available actions: add, remove, fail, replace&quot;</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">    </span><span class="k">esac</span>
<span class="o">}</span>

<span class="c1"># Send email alert</span>
send_alert<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">message</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">command</span><span class="w"> </span>-v<span class="w"> </span>mail<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$message</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>mail<span class="w"> </span>-s<span class="w"> </span><span class="s2">&quot;RAID Alert - </span><span class="k">$(</span>hostname<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ALERT_EMAIL</span><span class="s2">&quot;</span>
<span class="w">        </span>log_message<span class="w"> </span><span class="s2">&quot;Alert sent: </span><span class="nv">$message</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span>log_message<span class="w"> </span><span class="s2">&quot;Alert (mail not configured): </span><span class="nv">$message</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">fi</span>
<span class="o">}</span>

<span class="c1"># Performance test</span>
test_raid_performance<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">device</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">test_file</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Usage: test_raid_performance &lt;device&gt; [test_file]&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">mount_point</span><span class="o">=</span><span class="s2">&quot;/mnt/raid_test&quot;</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">test_path</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">test_file</span><span class="k">:-</span><span class="nv">$mount_point</span><span class="p">/test_file</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BLUE</span><span class="si">}</span><span class="s2">=== RAID Performance Test ===</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="c1"># Mount if not already mounted</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span>!<span class="w"> </span>mountpoint<span class="w"> </span>-q<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$mount_point</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$mount_point</span><span class="s2">&quot;</span>
<span class="w">        </span>mount<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$mount_point</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Testing write performance...&quot;</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">write_speed</span><span class="o">=</span><span class="k">$(</span>dd<span class="w"> </span><span class="k">if</span><span class="o">=</span>/dev/zero<span class="w"> </span><span class="nv">of</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$test_path</span><span class="s2">&quot;</span><span class="w"> </span><span class="nv">bs</span><span class="o">=</span>1M<span class="w"> </span><span class="nv">count</span><span class="o">=</span><span class="m">1024</span><span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;MB/s&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $(NF-1) &quot; &quot; $NF}&#39;</span><span class="k">)</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Write speed: </span><span class="nv">$write_speed</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Testing read performance...&quot;</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">read_speed</span><span class="o">=</span><span class="k">$(</span>dd<span class="w"> </span><span class="k">if</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$test_path</span><span class="s2">&quot;</span><span class="w"> </span><span class="nv">of</span><span class="o">=</span>/dev/null<span class="w"> </span><span class="nv">bs</span><span class="o">=</span>1M<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;MB/s&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $(NF-1) &quot; &quot; $NF}&#39;</span><span class="k">)</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Read speed: </span><span class="nv">$read_speed</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="c1"># Cleanup</span>
<span class="w">    </span>rm<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$test_path</span><span class="s2">&quot;</span>

<span class="w">    </span>log_message<span class="w"> </span><span class="s2">&quot;Performance test for </span><span class="nv">$device</span><span class="s2"> - Write: </span><span class="nv">$write_speed</span><span class="s2">, Read: </span><span class="nv">$read_speed</span><span class="s2">&quot;</span>
<span class="o">}</span>

<span class="c1"># Main menu</span>
<span class="k">case</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">1</span><span class="k">:-</span><span class="nv">help</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="k">in</span>
<span class="w">    </span><span class="s2">&quot;install&quot;</span><span class="o">)</span>
<span class="w">        </span>check_root
<span class="w">        </span>install_dependencies
<span class="w">        </span><span class="p">;;</span>
<span class="w">    </span><span class="s2">&quot;discover&quot;</span><span class="o">)</span>
<span class="w">        </span>discover_raids
<span class="w">        </span><span class="p">;;</span>
<span class="w">    </span><span class="s2">&quot;create&quot;</span><span class="o">)</span>
<span class="w">        </span>check_root
<span class="w">        </span>create_raid<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$3</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$4</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="p">;;</span>
<span class="w">    </span><span class="s2">&quot;monitor&quot;</span><span class="o">)</span>
<span class="w">        </span>monitor_raid_health
<span class="w">        </span><span class="p">;;</span>
<span class="w">    </span><span class="s2">&quot;manage&quot;</span><span class="o">)</span>
<span class="w">        </span>check_root
<span class="w">        </span>manage_raid<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$3</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$4</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$5</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="p">;;</span>
<span class="w">    </span><span class="s2">&quot;performance&quot;</span><span class="o">)</span>
<span class="w">        </span>test_raid_performance<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$3</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="p">;;</span>
<span class="w">    </span><span class="s2">&quot;help&quot;</span><span class="p">|</span>*<span class="o">)</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;RAID Manager for Ubuntu 22.04&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Usage: </span><span class="nv">$0</span><span class="s2"> [command] [options]&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Commands:&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  install                           - Install RAID dependencies&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  discover                          - Discover existing RAID devices&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  create &lt;level&gt; &lt;devices&gt; [name]   - Create new RAID array&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  monitor                           - Check RAID health&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  manage &lt;action&gt; &lt;device&gt; &lt;disk&gt;   - Manage RAID devices&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  performance &lt;device&gt; [file]       - Test RAID performance&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;RAID Levels: 0, 1, 5, 6, 10&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Manage Actions: add, remove, fail, replace&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Examples:&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  </span><span class="nv">$0</span><span class="s2"> create 1 /dev/sdb,/dev/sdc mirror1&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  </span><span class="nv">$0</span><span class="s2"> create 5 /dev/sdb,/dev/sdc,/dev/sdd stripe1&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  </span><span class="nv">$0</span><span class="s2"> manage add /dev/md0 /dev/sde&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  </span><span class="nv">$0</span><span class="s2"> manage replace /dev/md0 /dev/sdb /dev/sdf&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  </span><span class="nv">$0</span><span class="s2"> performance /dev/md0&quot;</span>
<span class="w">        </span><span class="p">;;</span>
<span class="k">esac</span>
</pre></div>
</div>
</section>
</section>
<section id="best-practices-for-raid-implementation">
<h4>Best Practices for RAID Implementation<a class="headerlink" href="#best-practices-for-raid-implementation" title="Link to this heading"></a></h4>
<section id="planning-and-design">
<h5>Planning and Design<a class="headerlink" href="#planning-and-design" title="Link to this heading"></a></h5>
<ol class="arabic simple">
<li><p><strong>Capacity Planning</strong>:</p>
<ul class="simple">
<li><p>Calculate usable capacity for each RAID level</p></li>
<li><p>Plan for future expansion</p></li>
<li><p>Consider spare drives for automatic rebuilds</p></li>
<li><p>Account for rebuild times</p></li>
</ul>
</li>
<li><p><strong>Performance Considerations</strong>:</p>
<ul class="simple">
<li><p>Match disk speeds and sizes</p></li>
<li><p>Use appropriate chunk sizes for workload</p></li>
<li><p>Consider I/O patterns</p></li>
<li><p>Plan for concurrent operations</p></li>
</ul>
</li>
</ol>
</section>
<section id="hardware-considerations">
<h5>Hardware Considerations<a class="headerlink" href="#hardware-considerations" title="Link to this heading"></a></h5>
<ol class="arabic">
<li><p><strong>Disk Selection</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check disk specifications</span>
sudo<span class="w"> </span>hdparm<span class="w"> </span>-I<span class="w"> </span>/dev/sdb<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;(Model|Serial|Capacity)&quot;</span>

<span class="c1"># Verify disks are identical</span>
<span class="k">for</span><span class="w"> </span>disk<span class="w"> </span><span class="k">in</span><span class="w"> </span>/dev/sd<span class="o">[</span>b-d<span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== </span><span class="nv">$disk</span><span class="s2"> ===&quot;</span>
<span class="w">    </span>sudo<span class="w"> </span>smartctl<span class="w"> </span>-i<span class="w"> </span><span class="nv">$disk</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;(Device Model|Serial Number|User Capacity)&quot;</span>
<span class="k">done</span>
</pre></div>
</div>
</li>
<li><p><strong>Controller Considerations</strong>:</p>
<ul class="simple">
<li><p>Hardware RAID vs Software RAID</p></li>
<li><p>Battery-backed write cache</p></li>
<li><p>Multiple controller support</p></li>
<li><p>Hot-swap capability</p></li>
</ul>
</li>
</ol>
</section>
<section id="monitoring-and-maintenance">
<h5>Monitoring and Maintenance<a class="headerlink" href="#monitoring-and-maintenance" title="Link to this heading"></a></h5>
<ol class="arabic">
<li><p><strong>Automated Monitoring</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set up email notifications</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;MAILADDR admin@example.com&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/mdadm/mdadm.conf

<span class="c1"># Configure monitoring daemon</span>
systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>mdmonitor

<span class="c1"># Test notifications</span>
mdadm<span class="w"> </span>--monitor<span class="w"> </span>--test<span class="w"> </span>/dev/md0
</pre></div>
</div>
</li>
<li><p><strong>Regular Maintenance</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Schedule regular RAID checks</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;0 1 1 * * root echo check &gt; /sys/block/md0/md/sync_action&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/crontab

<span class="c1"># Monitor rebuild progress</span>
watch<span class="w"> </span>cat<span class="w"> </span>/proc/mdstat

<span class="c1"># Check SMART status regularly</span>
<span class="k">for</span><span class="w"> </span>disk<span class="w"> </span><span class="k">in</span><span class="w"> </span>/dev/sd<span class="o">[</span>a-z<span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span>smartctl<span class="w"> </span>-a<span class="w"> </span><span class="nv">$disk</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;(Health|Temperature|Error)&quot;</span>
<span class="k">done</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="recovery-and-disaster-planning">
<h5>Recovery and Disaster Planning<a class="headerlink" href="#recovery-and-disaster-planning" title="Link to this heading"></a></h5>
<ol class="arabic">
<li><p><strong>Backup Strategy</strong>:</p>
<ul class="simple">
<li><p>RAID is not a backup solution</p></li>
<li><p>Implement 3-2-1 backup rule</p></li>
<li><p>Test restoration procedures</p></li>
<li><p>Document recovery processes</p></li>
</ul>
</li>
<li><p><strong>Disaster Recovery</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Save RAID configuration</span>
mdadm<span class="w"> </span>--detail<span class="w"> </span>--scan<span class="w"> </span>&gt;<span class="w"> </span>/etc/mdadm/mdadm.conf.backup

<span class="c1"># Create recovery documentation</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>/root/raid_recovery.txt<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s">RAID Recovery Procedures:</span>

<span class="s">1. Boot from rescue media</span>
<span class="s">2. Install mdadm: apt install mdadm</span>
<span class="s">3. Scan for arrays: mdadm --assemble --scan</span>
<span class="s">4. Force assembly if needed: mdadm --assemble --force /dev/md0 /dev/sdb /dev/sdc</span>
<span class="s">5. Mount and check data</span>
<span class="s">EOF</span>
</pre></div>
</div>
</li>
</ol>
</section>
</section>
</section>
</section>
<span id="document-network-storage"></span><section id="network-storage">
<h2>Network Storage<a class="headerlink" href="#network-storage" title="Link to this heading"></a></h2>
<section id="understanding-network-storage">
<h3>Understanding Network Storage<a class="headerlink" href="#understanding-network-storage" title="Link to this heading"></a></h3>
<p>Network storage allows multiple systems to access shared storage resources over a network. This technology is essential for modern IT environments, enabling centralized data management, improved collaboration, and efficient resource utilization.</p>
<section id="types-of-network-storage">
<h4>Types of Network Storage<a class="headerlink" href="#types-of-network-storage" title="Link to this heading"></a></h4>
<section id="network-attached-storage-nas">
<h5>Network Attached Storage (NAS)<a class="headerlink" href="#network-attached-storage-nas" title="Link to this heading"></a></h5>
<p><strong>Characteristics:</strong>
* File-level storage access
* Uses standard network protocols (NFS, SMB/CIFS, FTP)
* Easy to deploy and manage
* Suitable for file sharing and collaboration</p>
<p><strong>Common Protocols:</strong>
* <strong>NFS (Network File System)</strong>: Unix/Linux native protocol
* <strong>SMB/CIFS</strong>: Windows native, also supported by Linux
* <strong>FTP/SFTP</strong>: File transfer protocols
* <strong>HTTP/WebDAV</strong>: Web-based file access</p>
</section>
<section id="storage-area-network-san">
<h5>Storage Area Network (SAN)<a class="headerlink" href="#storage-area-network-san" title="Link to this heading"></a></h5>
<p><strong>Characteristics:</strong>
* Block-level storage access
* High-performance dedicated network
* Uses specialized protocols (iSCSI, Fibre Channel)
* Enterprise-level performance and reliability</p>
<p><strong>Common Protocols:</strong>
* <strong>iSCSI</strong>: SCSI over IP networks
* <strong>Fibre Channel</strong>: High-speed dedicated network
* <strong>FCoE</strong>: Fibre Channel over Ethernet
* <strong>InfiniBand</strong>: High-performance computing networks</p>
</section>
<section id="cloud-storage">
<h5>Cloud Storage<a class="headerlink" href="#cloud-storage" title="Link to this heading"></a></h5>
<p><strong>Characteristics:</strong>
* Storage as a Service (STaaS)
* Scalable and elastic
* Geographic distribution
* Pay-per-use model</p>
<p><strong>Common Services:</strong>
* <strong>Object Storage</strong>: Amazon S3, Google Cloud Storage, Azure Blob
* <strong>File Storage</strong>: Amazon EFS, Google Filestore, Azure Files
* <strong>Block Storage</strong>: Amazon EBS, Google Persistent Disk, Azure Disk</p>
</section>
</section>
<section id="setting-up-nfs-on-ubuntu-22-04">
<h4>Setting Up NFS on Ubuntu 22.04<a class="headerlink" href="#setting-up-nfs-on-ubuntu-22-04" title="Link to this heading"></a></h4>
<section id="nfs-server-configuration">
<h5>NFS Server Configuration<a class="headerlink" href="#nfs-server-configuration" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install NFS server</span>
sudo<span class="w"> </span>apt<span class="w"> </span>update
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>nfs-kernel-server

<span class="c1"># Create shared directories</span>
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/srv/nfs/shared
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/srv/nfs/public
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/srv/nfs/private

<span class="c1"># Set permissions</span>
sudo<span class="w"> </span>chown<span class="w"> </span>nobody:nogroup<span class="w"> </span>/srv/nfs/shared
sudo<span class="w"> </span>chown<span class="w"> </span>nobody:nogroup<span class="w"> </span>/srv/nfs/public
sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">755</span><span class="w"> </span>/srv/nfs/shared
sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">755</span><span class="w"> </span>/srv/nfs/public

<span class="c1"># Configure exports</span>
sudo<span class="w"> </span>nano<span class="w"> </span>/etc/exports

<span class="c1"># Add export configurations</span>
cat<span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/exports<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s"># NFS exports configuration</span>
<span class="s">/srv/nfs/shared    192.168.1.0/24(rw,sync,no_subtree_check)</span>
<span class="s">/srv/nfs/public    *(ro,sync,no_subtree_check)</span>
<span class="s">/srv/nfs/private   192.168.1.100(rw,sync,no_subtree_check,no_root_squash)</span>
<span class="s">EOF</span>

<span class="c1"># Export the shares</span>
sudo<span class="w"> </span>exportfs<span class="w"> </span>-a

<span class="c1"># Restart NFS service</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>nfs-kernel-server
sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>nfs-kernel-server

<span class="c1"># Check NFS status</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>nfs-kernel-server
sudo<span class="w"> </span>exportfs<span class="w"> </span>-v
</pre></div>
</div>
</section>
<section id="nfs-client-configuration">
<h5>NFS Client Configuration<a class="headerlink" href="#nfs-client-configuration" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install NFS client</span>
sudo<span class="w"> </span>apt<span class="w"> </span>update
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>nfs-common

<span class="c1"># Create mount points</span>
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/mnt/nfs/shared
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/mnt/nfs/public

<span class="c1"># Test NFS connectivity</span>
showmount<span class="w"> </span>-e<span class="w"> </span><span class="m">192</span>.168.1.10

<span class="c1"># Mount NFS shares</span>
sudo<span class="w"> </span>mount<span class="w"> </span>-t<span class="w"> </span>nfs<span class="w"> </span><span class="m">192</span>.168.1.10:/srv/nfs/shared<span class="w"> </span>/mnt/nfs/shared
sudo<span class="w"> </span>mount<span class="w"> </span>-t<span class="w"> </span>nfs<span class="w"> </span><span class="m">192</span>.168.1.10:/srv/nfs/public<span class="w"> </span>/mnt/nfs/public

<span class="c1"># Verify mounts</span>
df<span class="w"> </span>-h<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>nfs

<span class="c1"># Add to fstab for persistent mounting</span>
cat<span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/fstab<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s"># NFS mounts</span>
<span class="s">192.168.1.10:/srv/nfs/shared  /mnt/nfs/shared  nfs  defaults,_netdev  0  0</span>
<span class="s">192.168.1.10:/srv/nfs/public  /mnt/nfs/public  nfs  ro,defaults,_netdev  0  0</span>
<span class="s">EOF</span>

<span class="c1"># Test fstab entries</span>
sudo<span class="w"> </span>umount<span class="w"> </span>/mnt/nfs/shared
sudo<span class="w"> </span>mount<span class="w"> </span>-a
</pre></div>
</div>
</section>
</section>
<section id="setting-up-samba-smb-cifs-on-ubuntu-22-04">
<h4>Setting Up Samba (SMB/CIFS) on Ubuntu 22.04<a class="headerlink" href="#setting-up-samba-smb-cifs-on-ubuntu-22-04" title="Link to this heading"></a></h4>
<section id="samba-server-configuration">
<h5>Samba Server Configuration<a class="headerlink" href="#samba-server-configuration" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install Samba</span>
sudo<span class="w"> </span>apt<span class="w"> </span>update
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>samba<span class="w"> </span>samba-common-bin

<span class="c1"># Create shared directories</span>
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/srv/samba/shared
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/srv/samba/public
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/srv/samba/users

<span class="c1"># Set permissions</span>
sudo<span class="w"> </span>chown<span class="w"> </span>root:sambashare<span class="w"> </span>/srv/samba/shared
sudo<span class="w"> </span>chown<span class="w"> </span>root:sambashare<span class="w"> </span>/srv/samba/public
sudo<span class="w"> </span>chown<span class="w"> </span>root:sambashare<span class="w"> </span>/srv/samba/users
sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">2775</span><span class="w"> </span>/srv/samba/shared
sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">2775</span><span class="w"> </span>/srv/samba/public
sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">2775</span><span class="w"> </span>/srv/samba/users

<span class="c1"># Backup original configuration</span>
sudo<span class="w"> </span>cp<span class="w"> </span>/etc/samba/smb.conf<span class="w"> </span>/etc/samba/smb.conf.backup

<span class="c1"># Configure Samba</span>
cat<span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/samba/smb.conf<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>

<span class="s">[shared]</span>
<span class="s">    comment = Shared Files</span>
<span class="s">    path = /srv/samba/shared</span>
<span class="s">    browseable = yes</span>
<span class="s">    writable = yes</span>
<span class="s">    guest ok = no</span>
<span class="s">    valid users = @sambashare</span>
<span class="s">    create mask = 0664</span>
<span class="s">    directory mask = 2775</span>

<span class="s">[public]</span>
<span class="s">    comment = Public Files</span>
<span class="s">    path = /srv/samba/public</span>
<span class="s">    browseable = yes</span>
<span class="s">    writable = yes</span>
<span class="s">    guest ok = yes</span>
<span class="s">    read only = no</span>
<span class="s">    create mask = 0755</span>

<span class="s">[users]</span>
<span class="s">    comment = User Directories</span>
<span class="s">    path = /srv/samba/users/%S</span>
<span class="s">    browseable = no</span>
<span class="s">    writable = yes</span>
<span class="s">    valid users = %S</span>
<span class="s">    create mask = 0644</span>
<span class="s">    directory mask = 0755</span>
<span class="s">EOF</span>

<span class="c1"># Create Samba user</span>
sudo<span class="w"> </span>useradd<span class="w"> </span>-M<span class="w"> </span>-s<span class="w"> </span>/usr/sbin/nologin<span class="w"> </span>sambauser
sudo<span class="w"> </span>usermod<span class="w"> </span>-aG<span class="w"> </span>sambashare<span class="w"> </span>sambauser
sudo<span class="w"> </span>smbpasswd<span class="w"> </span>-a<span class="w"> </span>sambauser

<span class="c1"># Restart Samba services</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>smbd<span class="w"> </span>nmbd
sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>smbd<span class="w"> </span>nmbd

<span class="c1"># Check Samba status</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>smbd
testparm
</pre></div>
</div>
</section>
<section id="samba-client-configuration">
<h5>Samba Client Configuration<a class="headerlink" href="#samba-client-configuration" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install CIFS utilities</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>cifs-utils

<span class="c1"># Create mount points</span>
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/mnt/samba/shared
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/mnt/samba/public

<span class="c1"># Mount Samba shares</span>
sudo<span class="w"> </span>mount<span class="w"> </span>-t<span class="w"> </span>cifs<span class="w"> </span>//192.168.1.10/shared<span class="w"> </span>/mnt/samba/shared<span class="w"> </span>-o<span class="w"> </span><span class="nv">username</span><span class="o">=</span>sambauser

<span class="c1"># Create credentials file for automatic mounting</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>~/.smbcredentials<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s">username=sambauser</span>
<span class="s">password=your_password</span>
<span class="s">domain=workgroup</span>
<span class="s">EOF</span>

chmod<span class="w"> </span><span class="m">600</span><span class="w"> </span>~/.smbcredentials

<span class="c1"># Add to fstab</span>
cat<span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/fstab<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s"># Samba mounts</span>
<span class="s">//192.168.1.10/shared  /mnt/samba/shared  cifs  credentials=/home/username/.smbcredentials,uid=1000,gid=1000,_netdev  0  0</span>
<span class="s">//192.168.1.10/public  /mnt/samba/public  cifs  guest,uid=1000,gid=1000,_netdev  0  0</span>
<span class="s">EOF</span>
</pre></div>
</div>
</section>
</section>
<section id="setting-up-iscsi-on-ubuntu-22-04">
<h4>Setting Up iSCSI on Ubuntu 22.04<a class="headerlink" href="#setting-up-iscsi-on-ubuntu-22-04" title="Link to this heading"></a></h4>
<section id="iscsi-target-server-configuration">
<h5>iSCSI Target Server Configuration<a class="headerlink" href="#iscsi-target-server-configuration" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install iSCSI target</span>
sudo<span class="w"> </span>apt<span class="w"> </span>update
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>tgt

<span class="c1"># Create storage backing file</span>
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/srv/iscsi
sudo<span class="w"> </span>dd<span class="w"> </span><span class="k">if</span><span class="o">=</span>/dev/zero<span class="w"> </span><span class="nv">of</span><span class="o">=</span>/srv/iscsi/disk1.img<span class="w"> </span><span class="nv">bs</span><span class="o">=</span>1M<span class="w"> </span><span class="nv">count</span><span class="o">=</span><span class="m">10240</span>

<span class="c1"># Configure iSCSI target</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>/etc/tgt/conf.d/iscsi-target.conf<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s"># iSCSI Target Configuration</span>
<span class="s">&lt;target iqn.2024-01.com.example:storage.disk1&gt;</span>
<span class="s">    backing-store /srv/iscsi/disk1.img</span>
<span class="s">    # Allow access from specific initiators</span>
<span class="s">    initiator-address 192.168.1.0/24</span>
<span class="s">    # Authentication (optional)</span>
<span class="s">    incominguser username password</span>
<span class="s">&lt;/target&gt;</span>
<span class="s">EOF</span>

<span class="c1"># Restart target service</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>tgt
sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>tgt

<span class="c1"># Check target status</span>
sudo<span class="w"> </span>tgtadm<span class="w"> </span>--mode<span class="w"> </span>target<span class="w"> </span>--op<span class="w"> </span>show
</pre></div>
</div>
</section>
<section id="iscsi-initiator-configuration">
<h5>iSCSI Initiator Configuration<a class="headerlink" href="#iscsi-initiator-configuration" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install iSCSI initiator</span>
sudo<span class="w"> </span>apt<span class="w"> </span>update
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>open-iscsi

<span class="c1"># Configure initiator name</span>
sudo<span class="w"> </span>nano<span class="w"> </span>/etc/iscsi/initiatorname.iscsi
<span class="c1"># Set: InitiatorName=iqn.2024-01.com.example:client1</span>

<span class="c1"># Configure CHAP authentication (if required)</span>
sudo<span class="w"> </span>nano<span class="w"> </span>/etc/iscsi/iscsid.conf
<span class="c1"># Uncomment and set:</span>
<span class="c1"># node.session.auth.authmethod = CHAP</span>
<span class="c1"># node.session.auth.username = username</span>
<span class="c1"># node.session.auth.password = password</span>

<span class="c1"># Discover targets</span>
sudo<span class="w"> </span>iscsiadm<span class="w"> </span>-m<span class="w"> </span>discovery<span class="w"> </span>-t<span class="w"> </span>sendtargets<span class="w"> </span>-p<span class="w"> </span><span class="m">192</span>.168.1.10

<span class="c1"># Login to target</span>
sudo<span class="w"> </span>iscsiadm<span class="w"> </span>-m<span class="w"> </span>node<span class="w"> </span>--login

<span class="c1"># Check connected sessions</span>
sudo<span class="w"> </span>iscsiadm<span class="w"> </span>-m<span class="w"> </span>session

<span class="c1"># Format and mount iSCSI disk</span>
sudo<span class="w"> </span>fdisk<span class="w"> </span>/dev/sdb<span class="w">  </span><span class="c1"># Create partition</span>
sudo<span class="w"> </span>mkfs.ext4<span class="w"> </span>/dev/sdb1
sudo<span class="w"> </span>mkdir<span class="w"> </span>/mnt/iscsi
sudo<span class="w"> </span>mount<span class="w"> </span>/dev/sdb1<span class="w"> </span>/mnt/iscsi
</pre></div>
</div>
</section>
</section>
<section id="cloud-storage-integration">
<h4>Cloud Storage Integration<a class="headerlink" href="#cloud-storage-integration" title="Link to this heading"></a></h4>
<section id="rclone-configuration">
<h5>Rclone Configuration<a class="headerlink" href="#rclone-configuration" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install rclone</span>
sudo<span class="w"> </span>apt<span class="w"> </span>update
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>rclone

<span class="c1"># Configure cloud storage</span>
rclone<span class="w"> </span>config

<span class="c1"># Example: Mount Google Drive</span>
mkdir<span class="w"> </span>~/GoogleDrive
rclone<span class="w"> </span>mount<span class="w"> </span>gdrive:<span class="w"> </span>~/GoogleDrive<span class="w"> </span>--daemon

<span class="c1"># Example: Sync to cloud storage</span>
rclone<span class="w"> </span>sync<span class="w"> </span>/home/user/Documents<span class="w"> </span>gdrive:Documents

<span class="c1"># Create systemd service for persistent mounting</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>~/.config/systemd/user/rclone-gdrive.service<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s">[Unit]</span>
<span class="s">Description=Google Drive mount</span>
<span class="s">After=network.target</span>

<span class="s">[Service]</span>
<span class="s">Type=notify</span>
<span class="s">ExecStart=/usr/bin/rclone mount gdrive: %h/GoogleDrive --vfs-cache-mode writes</span>
<span class="s">ExecStop=/bin/fusermount -u %h/GoogleDrive</span>
<span class="s">Restart=always</span>
<span class="s">RestartSec=10</span>

<span class="s">[Install]</span>
<span class="s">WantedBy=default.target</span>
<span class="s">EOF</span>

systemctl<span class="w"> </span>--user<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>rclone-gdrive.service
systemctl<span class="w"> </span>--user<span class="w"> </span>start<span class="w"> </span>rclone-gdrive.service
</pre></div>
</div>
</section>
<section id="s3-compatible-storage">
<h5>S3-Compatible Storage<a class="headerlink" href="#s3-compatible-storage" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install s3fs</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>s3fs

<span class="c1"># Create credentials file</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;access_key:secret_key&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>~/.passwd-s3fs
chmod<span class="w"> </span><span class="m">600</span><span class="w"> </span>~/.passwd-s3fs

<span class="c1"># Mount S3 bucket</span>
mkdir<span class="w"> </span>~/s3bucket
s3fs<span class="w"> </span>mybucket<span class="w"> </span>~/s3bucket<span class="w"> </span>-o<span class="w"> </span><span class="nv">passwd_file</span><span class="o">=</span>~/.passwd-s3fs<span class="w"> </span>-o<span class="w"> </span><span class="nv">url</span><span class="o">=</span>https://s3.amazonaws.com

<span class="c1"># Add to fstab for persistent mounting</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;s3fs#mybucket /home/user/s3bucket fuse _netdev,passwd_file=/home/user/.passwd-s3fs,url=https://s3.amazonaws.com 0 0&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/fstab
</pre></div>
</div>
</section>
</section>
<section id="network-storage-performance-optimization">
<h4>Network Storage Performance Optimization<a class="headerlink" href="#network-storage-performance-optimization" title="Link to this heading"></a></h4>
<section id="nfs-performance-tuning">
<h5>NFS Performance Tuning<a class="headerlink" href="#nfs-performance-tuning" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Optimize NFS mount options</span>
sudo<span class="w"> </span>mount<span class="w"> </span>-t<span class="w"> </span>nfs<span class="w"> </span>-o<span class="w"> </span><span class="nv">rsize</span><span class="o">=</span><span class="m">32768</span>,wsize<span class="o">=</span><span class="m">32768</span>,hard,intr,tcp<span class="w"> </span><span class="m">192</span>.168.1.10:/srv/nfs/shared<span class="w"> </span>/mnt/nfs/shared

<span class="c1"># Configure NFS daemon threads</span>
sudo<span class="w"> </span>nano<span class="w"> </span>/etc/default/nfs-kernel-server
<span class="c1"># Set: RPCNFSDCOUNT=16</span>

<span class="c1"># Optimize network buffer sizes</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;net.core.rmem_max = 16777216&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/sysctl.conf
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;net.core.wmem_max = 16777216&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/sysctl.conf
sudo<span class="w"> </span>sysctl<span class="w"> </span>-p
</pre></div>
</div>
</section>
<section id="samba-performance-tuning">
<h5>Samba Performance Tuning<a class="headerlink" href="#samba-performance-tuning" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add performance options to smb.conf</span>
cat<span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/samba/smb.conf<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s">[global]</span>
<span class="s">    # Performance tuning</span>
<span class="s">    socket options = TCP_NODELAY IPTOS_LOWDELAY SO_RCVBUF=65536 SO_SNDBUF=65536</span>
<span class="s">    read raw = yes</span>
<span class="s">    write raw = yes</span>
<span class="s">    max xmit = 65535</span>
<span class="s">    dead time = 15</span>
<span class="s">    getwd cache = yes</span>
<span class="s">EOF</span>

sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>smbd
</pre></div>
</div>
</section>
<section id="iscsi-performance-tuning">
<h5>iSCSI Performance Tuning<a class="headerlink" href="#iscsi-performance-tuning" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Optimize iSCSI parameters</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;node.session.iscsi.InitialR2T = No&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/iscsi/iscsid.conf
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;node.session.iscsi.ImmediateData = Yes&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/iscsi/iscsid.conf
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;node.session.iscsi.FirstBurstLength = 262144&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/iscsi/iscsid.conf
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;node.session.iscsi.MaxBurstLength = 16776192&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/iscsi/iscsid.conf
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;node.conn[0].iscsi.MaxRecvDataSegmentLength = 262144&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/iscsi/iscsid.conf

sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>iscsid
</pre></div>
</div>
</section>
</section>
<section id="frequently-asked-questions">
<h4>Frequently Asked Questions<a class="headerlink" href="#frequently-asked-questions" title="Link to this heading"></a></h4>
<section id="q-which-network-storage-protocol-should-i-choose">
<h5>Q: Which network storage protocol should I choose?<a class="headerlink" href="#q-which-network-storage-protocol-should-i-choose" title="Link to this heading"></a></h5>
<p><strong>A:</strong> Choose based on your requirements:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Use Case                    | Recommended Protocol | Reason
----------------------------|---------------------|------------------
Linux-only environment     | NFS                 | Native performance
Mixed OS environment       | SMB/CIFS            | Universal compatibility
High-performance storage    | iSCSI               | Block-level access
Simple file sharing         | FTP/SFTP            | Easy setup
Cloud storage              | Object storage APIs  | Scalability
Database storage           | iSCSI or FC         | Low latency
</pre></div>
</div>
</section>
<section id="q-how-do-i-troubleshoot-nfs-connection-issues">
<h5>Q: How do I troubleshoot NFS connection issues?<a class="headerlink" href="#q-how-do-i-troubleshoot-nfs-connection-issues" title="Link to this heading"></a></h5>
<p><strong>A:</strong> Follow these troubleshooting steps:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check NFS service status</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>nfs-kernel-server

<span class="c1"># Check exports</span>
sudo<span class="w"> </span>exportfs<span class="w"> </span>-v

<span class="c1"># Test connectivity</span>
telnet<span class="w"> </span>nfs-server-ip<span class="w"> </span><span class="m">2049</span>

<span class="c1"># Check firewall</span>
sudo<span class="w"> </span>ufw<span class="w"> </span>status
<span class="c1"># Open NFS ports if needed</span>
sudo<span class="w"> </span>ufw<span class="w"> </span>allow<span class="w"> </span>from<span class="w"> </span><span class="m">192</span>.168.1.0/24<span class="w"> </span>to<span class="w"> </span>any<span class="w"> </span>port<span class="w"> </span><span class="m">2049</span>

<span class="c1"># Check mount on client</span>
showmount<span class="w"> </span>-e<span class="w"> </span>nfs-server-ip

<span class="c1"># Debug mount issues</span>
sudo<span class="w"> </span>mount<span class="w"> </span>-t<span class="w"> </span>nfs<span class="w"> </span>-v<span class="w"> </span>nfs-server-ip:/path<span class="w"> </span>/mnt/point
</pre></div>
</div>
</section>
<section id="q-how-can-i-secure-network-storage">
<h5>Q: How can I secure network storage?<a class="headerlink" href="#q-how-can-i-secure-network-storage" title="Link to this heading"></a></h5>
<p><strong>A:</strong> Implement these security measures:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. Use VPN for remote access</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>openvpn

<span class="c1"># 2. Enable firewall</span>
sudo<span class="w"> </span>ufw<span class="w"> </span><span class="nb">enable</span>
sudo<span class="w"> </span>ufw<span class="w"> </span>allow<span class="w"> </span>from<span class="w"> </span><span class="m">192</span>.168.1.0/24<span class="w"> </span>to<span class="w"> </span>any<span class="w"> </span>port<span class="w"> </span><span class="m">2049</span><span class="w">  </span><span class="c1"># NFS</span>
sudo<span class="w"> </span>ufw<span class="w"> </span>allow<span class="w"> </span>from<span class="w"> </span><span class="m">192</span>.168.1.0/24<span class="w"> </span>to<span class="w"> </span>any<span class="w"> </span>port<span class="w"> </span><span class="m">445</span><span class="w">   </span><span class="c1"># SMB</span>

<span class="c1"># 3. Use authentication</span>
<span class="c1"># For NFS: Configure Kerberos</span>
<span class="c1"># For SMB: Use strong passwords and encryption</span>

<span class="c1"># 4. Enable encryption</span>
<span class="c1"># For SMB, add to smb.conf:</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;smb encrypt = required&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/samba/smb.conf

<span class="c1"># 5. Regular security updates</span>
sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>upgrade
</pre></div>
</div>
</section>
<section id="q-how-do-i-monitor-network-storage-performance">
<h5>Q: How do I monitor network storage performance?<a class="headerlink" href="#q-how-do-i-monitor-network-storage-performance" title="Link to this heading"></a></h5>
<p><strong>A:</strong> Use these monitoring tools:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Monitor network I/O</span>
iftop<span class="w"> </span>-i<span class="w"> </span>eth0

<span class="c1"># Monitor NFS statistics</span>
nfsstat<span class="w"> </span>-c<span class="w">  </span><span class="c1"># Client stats</span>
nfsstat<span class="w"> </span>-s<span class="w">  </span><span class="c1"># Server stats</span>

<span class="c1"># Monitor iSCSI performance</span>
iostat<span class="w"> </span>-x<span class="w"> </span><span class="m">1</span>

<span class="c1"># Monitor Samba connections</span>
sudo<span class="w"> </span>smbstatus

<span class="c1"># Create monitoring script</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>monitor_network_storage.sh<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s">#!/bin/bash</span>

<span class="s">echo &quot;=== Network Storage Performance Monitor ===&quot;</span>
<span class="s">echo &quot;Date: $(date)&quot;</span>
<span class="s">echo &quot;&quot;</span>

<span class="s">echo &quot;NFS Statistics:&quot;</span>
<span class="s">nfsstat -c 2&gt;/dev/null || echo &quot;NFS client not active&quot;</span>
<span class="s">echo &quot;&quot;</span>

<span class="s">echo &quot;Network Interface Statistics:&quot;</span>
<span class="s">cat /proc/net/dev | grep -E &quot;(eth0|ens|enp)&quot;</span>
<span class="s">echo &quot;&quot;</span>

<span class="s">echo &quot;Active Network Connections:&quot;</span>
<span class="s">ss -tuln | grep -E &quot;(2049|445|3260)&quot;  # NFS, SMB, iSCSI</span>
<span class="s">EOF</span>

chmod<span class="w"> </span>+x<span class="w"> </span>monitor_network_storage.sh
</pre></div>
</div>
</section>
</section>
<section id="coding-examples">
<h4>Coding Examples<a class="headerlink" href="#coding-examples" title="Link to this heading"></a></h4>
<section id="python-network-storage-monitor">
<h5>Python Network Storage Monitor<a class="headerlink" href="#python-network-storage-monitor" title="Link to this heading"></a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Network storage monitoring script for Ubuntu 22.04</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">psutil</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

<span class="k">class</span><span class="w"> </span><span class="nc">NetworkStorageMonitor</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interfaces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_network_interfaces</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_network_interfaces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get list of network interfaces&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">psutil</span><span class="o">.</span><span class="n">net_if_addrs</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_nfs_mounts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check NFS mount status&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;mount&#39;</span><span class="p">,</span> <span class="s1">&#39;-t&#39;</span><span class="p">,</span> <span class="s1">&#39;nfs&#39;</span><span class="p">],</span>
                                  <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">mounts</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">n&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">6</span><span class="p">:</span>
                        <span class="n">mounts</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                            <span class="s1">&#39;server&#39;</span><span class="p">:</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                            <span class="s1">&#39;mountpoint&#39;</span><span class="p">:</span> <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                            <span class="s1">&#39;options&#39;</span><span class="p">:</span> <span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                        <span class="p">})</span>

            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;success&#39;</span><span class="p">,</span> <span class="s1">&#39;mounts&#39;</span><span class="p">:</span> <span class="n">mounts</span><span class="p">}</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_smb_mounts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check SMB/CIFS mount status&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;mount&#39;</span><span class="p">,</span> <span class="s1">&#39;-t&#39;</span><span class="p">,</span> <span class="s1">&#39;cifs&#39;</span><span class="p">],</span>
                                  <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">mounts</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">n&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">6</span><span class="p">:</span>
                        <span class="n">mounts</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                            <span class="s1">&#39;server&#39;</span><span class="p">:</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                            <span class="s1">&#39;mountpoint&#39;</span><span class="p">:</span> <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                            <span class="s1">&#39;options&#39;</span><span class="p">:</span> <span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                        <span class="p">})</span>

            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;success&#39;</span><span class="p">,</span> <span class="s1">&#39;mounts&#39;</span><span class="p">:</span> <span class="n">mounts</span><span class="p">}</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_iscsi_sessions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check iSCSI session status&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;iscsiadm&#39;</span><span class="p">,</span> <span class="s1">&#39;-m&#39;</span><span class="p">,</span> <span class="s1">&#39;session&#39;</span><span class="p">],</span>
                                  <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">sessions</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">n&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">line</span> <span class="ow">and</span> <span class="s1">&#39;tcp:&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">sessions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;success&#39;</span><span class="p">,</span> <span class="s1">&#39;sessions&#39;</span><span class="p">:</span> <span class="n">sessions</span><span class="p">}</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_network_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get network interface statistics&quot;&quot;&quot;</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">net_io</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">net_io_counters</span><span class="p">(</span><span class="n">pernic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">interface</span><span class="p">,</span> <span class="n">counters</span> <span class="ow">in</span> <span class="n">net_io</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">stats</span><span class="p">[</span><span class="n">interface</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;bytes_sent&#39;</span><span class="p">:</span> <span class="n">counters</span><span class="o">.</span><span class="n">bytes_sent</span><span class="p">,</span>
                <span class="s1">&#39;bytes_recv&#39;</span><span class="p">:</span> <span class="n">counters</span><span class="o">.</span><span class="n">bytes_recv</span><span class="p">,</span>
                <span class="s1">&#39;packets_sent&#39;</span><span class="p">:</span> <span class="n">counters</span><span class="o">.</span><span class="n">packets_sent</span><span class="p">,</span>
                <span class="s1">&#39;packets_recv&#39;</span><span class="p">:</span> <span class="n">counters</span><span class="o">.</span><span class="n">packets_recv</span><span class="p">,</span>
                <span class="s1">&#39;errors_in&#39;</span><span class="p">:</span> <span class="n">counters</span><span class="o">.</span><span class="n">errin</span><span class="p">,</span>
                <span class="s1">&#39;errors_out&#39;</span><span class="p">:</span> <span class="n">counters</span><span class="o">.</span><span class="n">errout</span><span class="p">,</span>
                <span class="s1">&#39;drops_in&#39;</span><span class="p">:</span> <span class="n">counters</span><span class="o">.</span><span class="n">dropin</span><span class="p">,</span>
                <span class="s1">&#39;drops_out&#39;</span><span class="p">:</span> <span class="n">counters</span><span class="o">.</span><span class="n">dropout</span>
            <span class="p">}</span>

        <span class="k">return</span> <span class="n">stats</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_service_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">service_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check systemd service status&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;systemctl&#39;</span><span class="p">,</span> <span class="s1">&#39;is-active&#39;</span><span class="p">,</span> <span class="n">service_name</span><span class="p">],</span>
                                  <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;unknown&#39;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_connectivity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test network connectivity to host:port&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">socket</span>
            <span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
            <span class="n">sock</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">connect_ex</span><span class="p">((</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
            <span class="n">sock</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate comprehensive network storage report&quot;&quot;&quot;</span>
        <span class="n">report</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
            <span class="s1">&#39;uptime&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span>
            <span class="s1">&#39;services&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;nfs-server&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_service_status</span><span class="p">(</span><span class="s1">&#39;nfs-kernel-server&#39;</span><span class="p">),</span>
                <span class="s1">&#39;smbd&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_service_status</span><span class="p">(</span><span class="s1">&#39;smbd&#39;</span><span class="p">),</span>
                <span class="s1">&#39;nmbd&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_service_status</span><span class="p">(</span><span class="s1">&#39;nmbd&#39;</span><span class="p">),</span>
                <span class="s1">&#39;iscsid&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_service_status</span><span class="p">(</span><span class="s1">&#39;iscsid&#39;</span><span class="p">),</span>
                <span class="s1">&#39;tgt&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_service_status</span><span class="p">(</span><span class="s1">&#39;tgt&#39;</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="s1">&#39;mounts&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;nfs&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_nfs_mounts</span><span class="p">(),</span>
                <span class="s1">&#39;smb&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_smb_mounts</span><span class="p">()</span>
            <span class="p">},</span>
            <span class="s1">&#39;iscsi&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_iscsi_sessions</span><span class="p">(),</span>
            <span class="s1">&#39;network&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_network_stats</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">report</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">monitor_performance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Monitor network storage performance over time&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Monitoring network storage for </span><span class="si">{</span><span class="n">duration</span><span class="si">}</span><span class="s2"> seconds...&quot;</span><span class="p">)</span>

        <span class="n">start_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_network_stats</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span>
        <span class="n">end_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_network_stats</span><span class="p">()</span>

        <span class="n">performance</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">interface</span> <span class="ow">in</span> <span class="n">start_stats</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">interface</span> <span class="ow">in</span> <span class="n">end_stats</span><span class="p">:</span>
                <span class="n">sent_diff</span> <span class="o">=</span> <span class="n">end_stats</span><span class="p">[</span><span class="n">interface</span><span class="p">][</span><span class="s1">&#39;bytes_sent&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">start_stats</span><span class="p">[</span><span class="n">interface</span><span class="p">][</span><span class="s1">&#39;bytes_sent&#39;</span><span class="p">]</span>
                <span class="n">recv_diff</span> <span class="o">=</span> <span class="n">end_stats</span><span class="p">[</span><span class="n">interface</span><span class="p">][</span><span class="s1">&#39;bytes_recv&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">start_stats</span><span class="p">[</span><span class="n">interface</span><span class="p">][</span><span class="s1">&#39;bytes_recv&#39;</span><span class="p">]</span>

                <span class="n">performance</span><span class="p">[</span><span class="n">interface</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;avg_send_rate_mbps&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">sent_diff</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">duration</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">),</span>
                    <span class="s1">&#39;avg_recv_rate_mbps&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">recv_diff</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">duration</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">),</span>
                    <span class="s1">&#39;total_sent_mb&#39;</span><span class="p">:</span> <span class="n">sent_diff</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">),</span>
                    <span class="s1">&#39;total_recv_mb&#39;</span><span class="p">:</span> <span class="n">recv_diff</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">)</span>
                <span class="p">}</span>

        <span class="k">return</span> <span class="n">performance</span>

<span class="c1"># Example usage</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">argparse</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Network Storage Monitor&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--report&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Generate status report&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--monitor&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Monitor performance for N seconds&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--json&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Output in JSON format&#39;</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">monitor</span> <span class="o">=</span> <span class="n">NetworkStorageMonitor</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">report</span><span class="p">:</span>
        <span class="n">report</span> <span class="o">=</span> <span class="n">monitor</span><span class="o">.</span><span class="n">generate_report</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">json</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">report</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Network Storage Status Report&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">40</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Timestamp: </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">nServices:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">service</span><span class="p">,</span> <span class="n">status</span> <span class="ow">in</span> <span class="n">report</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">service</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">nNFS Mounts: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;mounts&#39;</span><span class="p">][</span><span class="s1">&#39;nfs&#39;</span><span class="p">][</span><span class="s1">&#39;mounts&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SMB Mounts: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;mounts&#39;</span><span class="p">][</span><span class="s1">&#39;smb&#39;</span><span class="p">][</span><span class="s1">&#39;mounts&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;iSCSI Sessions: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;iscsi&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sessions&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">[]))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">monitor</span><span class="p">:</span>
        <span class="n">performance</span> <span class="o">=</span> <span class="n">monitor</span><span class="o">.</span><span class="n">monitor_performance</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">monitor</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">nNetwork Performance Summary (</span><span class="si">{</span><span class="n">args</span><span class="o">.</span><span class="n">monitor</span><span class="si">}</span><span class="s2">s):&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">interface</span><span class="p">,</span> <span class="n">stats</span> <span class="ow">in</span> <span class="n">performance</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">interface</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Average Send Rate: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;avg_send_rate_mbps&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> Mbps&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Average Recv Rate: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;avg_recv_rate_mbps&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> Mbps&quot;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">print_help</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="best-practices-for-network-storage">
<h4>Best Practices for Network Storage<a class="headerlink" href="#best-practices-for-network-storage" title="Link to this heading"></a></h4>
<section id="security-best-practices">
<h5>Security Best Practices<a class="headerlink" href="#security-best-practices" title="Link to this heading"></a></h5>
<ol class="arabic simple">
<li><p><strong>Network Segmentation</strong>:</p>
<ul class="simple">
<li><p>Use dedicated VLANs for storage traffic</p></li>
<li><p>Implement firewall rules</p></li>
<li><p>Regular security audits</p></li>
</ul>
</li>
<li><p><strong>Authentication and Authorization</strong>:</p>
<ul class="simple">
<li><p>Strong passwords and multi-factor authentication</p></li>
<li><p>Regular credential rotation</p></li>
<li><p>Principle of least privilege</p></li>
</ul>
</li>
<li><p><strong>Encryption</strong>:</p>
<ul class="simple">
<li><p>Encrypt data in transit</p></li>
<li><p>Encrypt data at rest</p></li>
<li><p>Use VPN for remote access</p></li>
</ul>
</li>
</ol>
</section>
<section id="performance-best-practices">
<h5>Performance Best Practices<a class="headerlink" href="#performance-best-practices" title="Link to this heading"></a></h5>
<ol class="arabic simple">
<li><p><strong>Network Optimization</strong>:</p>
<ul class="simple">
<li><p>Use dedicated high-speed networks</p></li>
<li><p>Optimize TCP window sizes</p></li>
<li><p>Enable jumbo frames where supported</p></li>
</ul>
</li>
<li><p><strong>Protocol Selection</strong>:</p>
<ul class="simple">
<li><p>Choose appropriate protocols for workload</p></li>
<li><p>Optimize protocol-specific parameters</p></li>
<li><p>Consider multi-path configurations</p></li>
</ul>
</li>
<li><p><strong>Monitoring and Maintenance</strong>:</p>
<ul class="simple">
<li><p>Regular performance monitoring</p></li>
<li><p>Proactive capacity planning</p></li>
<li><p>Scheduled maintenance windows</p></li>
</ul>
</li>
</ol>
</section>
</section>
</section>
</section>
<span id="document-volume-management"></span><section id="volume-management">
<h2>Volume Management<a class="headerlink" href="#volume-management" title="Link to this heading"></a></h2>
<p>Volume management provides an abstraction layer between physical storage devices and file systems, enabling dynamic storage allocation, resizing, and advanced features like snapshots and encryption.</p>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#introduction-to-volume-management" id="id1">Introduction to Volume Management</a></p>
<ul>
<li><p><a class="reference internal" href="#key-concepts" id="id2">Key Concepts</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#lvm-logical-volume-manager" id="id3">LVM (Logical Volume Manager)</a></p>
<ul>
<li><p><a class="reference internal" href="#installation-and-setup" id="id4">Installation and Setup</a></p></li>
<li><p><a class="reference internal" href="#creating-physical-volumes" id="id5">Creating Physical Volumes</a></p></li>
<li><p><a class="reference internal" href="#creating-volume-groups" id="id6">Creating Volume Groups</a></p></li>
<li><p><a class="reference internal" href="#creating-logical-volumes" id="id7">Creating Logical Volumes</a></p></li>
<li><p><a class="reference internal" href="#formatting-and-mounting-lvm-volumes" id="id8">Formatting and Mounting LVM Volumes</a></p></li>
<li><p><a class="reference internal" href="#resizing-lvm-volumes" id="id9">Resizing LVM Volumes</a></p></li>
<li><p><a class="reference internal" href="#lvm-snapshots" id="id10">LVM Snapshots</a></p></li>
<li><p><a class="reference internal" href="#advanced-lvm-features" id="id11">Advanced LVM Features</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#zfs-volume-management" id="id12">ZFS Volume Management</a></p>
<ul>
<li><p><a class="reference internal" href="#installation-on-ubuntu-22-04" id="id13">Installation on Ubuntu 22.04</a></p></li>
<li><p><a class="reference internal" href="#creating-zfs-pools" id="id14">Creating ZFS Pools</a></p></li>
<li><p><a class="reference internal" href="#creating-zfs-datasets" id="id15">Creating ZFS Datasets</a></p></li>
<li><p><a class="reference internal" href="#zfs-snapshots-and-clones" id="id16">ZFS Snapshots and Clones</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#btrfs-volume-management" id="id17">Btrfs Volume Management</a></p>
<ul>
<li><p><a class="reference internal" href="#creating-btrfs-volumes" id="id18">Creating Btrfs Volumes</a></p></li>
<li><p><a class="reference internal" href="#btrfs-subvolumes" id="id19">Btrfs Subvolumes</a></p></li>
<li><p><a class="reference internal" href="#btrfs-snapshots" id="id20">Btrfs Snapshots</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#volume-management-scripts" id="id21">Volume Management Scripts</a></p>
<ul>
<li><p><a class="reference internal" href="#lvm-monitoring-script" id="id22">LVM Monitoring Script</a></p></li>
<li><p><a class="reference internal" href="#automated-backup-script" id="id23">Automated Backup Script</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#common-tasks-and-q-a" id="id24">Common Tasks and Q&amp;A</a></p></li>
<li><p><a class="reference internal" href="#best-practices" id="id25">Best Practices</a></p></li>
<li><p><a class="reference internal" href="#see-also" id="id26">See Also</a></p></li>
</ul>
</nav>
<section id="introduction-to-volume-management">
<h3><a class="toc-backref" href="#id1" role="doc-backlink">Introduction to Volume Management</a><a class="headerlink" href="#introduction-to-volume-management" title="Link to this heading"></a></h3>
<p>Volume management systems allow you to:</p>
<ul class="simple">
<li><p>Combine multiple physical disks into logical volumes</p></li>
<li><p>Resize volumes dynamically without downtime</p></li>
<li><p>Create snapshots for backup and testing</p></li>
<li><p>Implement storage encryption and compression</p></li>
<li><p>Manage storage pools efficiently</p></li>
</ul>
<section id="key-concepts">
<h4><a class="toc-backref" href="#id2" role="doc-backlink">Key Concepts</a><a class="headerlink" href="#key-concepts" title="Link to this heading"></a></h4>
<dl class="simple">
<dt><strong>Physical Volumes (PV)</strong></dt><dd><p>Physical storage devices or partitions</p>
</dd>
<dt><strong>Volume Groups (VG)</strong></dt><dd><p>Collections of physical volumes</p>
</dd>
<dt><strong>Logical Volumes (LV)</strong></dt><dd><p>Virtual partitions created from volume groups</p>
</dd>
<dt><strong>Logical Volume Manager (LVM)</strong></dt><dd><p>The primary volume management system in Linux</p>
</dd>
</dl>
</section>
</section>
<section id="lvm-logical-volume-manager">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">LVM (Logical Volume Manager)</a><a class="headerlink" href="#lvm-logical-volume-manager" title="Link to this heading"></a></h3>
<section id="installation-and-setup">
<h4><a class="toc-backref" href="#id4" role="doc-backlink">Installation and Setup</a><a class="headerlink" href="#installation-and-setup" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install LVM tools on Ubuntu 22.04</span>
sudo<span class="w"> </span>apt<span class="w"> </span>update
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>lvm2

<span class="c1"># Check LVM installation</span>
lvm<span class="w"> </span>version
</pre></div>
</div>
</section>
<section id="creating-physical-volumes">
<h4><a class="toc-backref" href="#id5" role="doc-backlink">Creating Physical Volumes</a><a class="headerlink" href="#creating-physical-volumes" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create physical volume from disk</span>
sudo<span class="w"> </span>pvcreate<span class="w"> </span>/dev/sdb

<span class="c1"># Create PV from partition</span>
sudo<span class="w"> </span>pvcreate<span class="w"> </span>/dev/sdc1

<span class="c1"># Display physical volumes</span>
sudo<span class="w"> </span>pvdisplay
sudo<span class="w"> </span>pvs
</pre></div>
</div>
</section>
<section id="creating-volume-groups">
<h4><a class="toc-backref" href="#id6" role="doc-backlink">Creating Volume Groups</a><a class="headerlink" href="#creating-volume-groups" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create volume group from single PV</span>
sudo<span class="w"> </span>vgcreate<span class="w"> </span>myvg<span class="w"> </span>/dev/sdb

<span class="c1"># Create VG from multiple PVs</span>
sudo<span class="w"> </span>vgcreate<span class="w"> </span>datavg<span class="w"> </span>/dev/sdb<span class="w"> </span>/dev/sdc

<span class="c1"># Display volume groups</span>
sudo<span class="w"> </span>vgdisplay
sudo<span class="w"> </span>vgs
</pre></div>
</div>
</section>
<section id="creating-logical-volumes">
<h4><a class="toc-backref" href="#id7" role="doc-backlink">Creating Logical Volumes</a><a class="headerlink" href="#creating-logical-volumes" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create LV with specific size</span>
sudo<span class="w"> </span>lvcreate<span class="w"> </span>-L<span class="w"> </span>10G<span class="w"> </span>-n<span class="w"> </span>mylv<span class="w"> </span>myvg

<span class="c1"># Create LV using percentage of VG</span>
sudo<span class="w"> </span>lvcreate<span class="w"> </span>-l<span class="w"> </span><span class="m">50</span>%VG<span class="w"> </span>-n<span class="w"> </span>datalv<span class="w"> </span>datavg

<span class="c1"># Create LV using all available space</span>
sudo<span class="w"> </span>lvcreate<span class="w"> </span>-l<span class="w"> </span><span class="m">100</span>%FREE<span class="w"> </span>-n<span class="w"> </span>homelv<span class="w"> </span>myvg

<span class="c1"># Display logical volumes</span>
sudo<span class="w"> </span>lvdisplay
sudo<span class="w"> </span>lvs
</pre></div>
</div>
</section>
<section id="formatting-and-mounting-lvm-volumes">
<h4><a class="toc-backref" href="#id8" role="doc-backlink">Formatting and Mounting LVM Volumes</a><a class="headerlink" href="#formatting-and-mounting-lvm-volumes" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Format logical volume</span>
sudo<span class="w"> </span>mkfs.ext4<span class="w"> </span>/dev/myvg/mylv

<span class="c1"># Create mount point</span>
sudo<span class="w"> </span>mkdir<span class="w"> </span>/mnt/mylv

<span class="c1"># Mount the volume</span>
sudo<span class="w"> </span>mount<span class="w"> </span>/dev/myvg/mylv<span class="w"> </span>/mnt/mylv

<span class="c1"># Add to /etc/fstab for persistent mounting</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;/dev/myvg/mylv /mnt/mylv ext4 defaults 0 2&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/fstab
</pre></div>
</div>
</section>
<section id="resizing-lvm-volumes">
<h4><a class="toc-backref" href="#id9" role="doc-backlink">Resizing LVM Volumes</a><a class="headerlink" href="#resizing-lvm-volumes" title="Link to this heading"></a></h4>
<p><strong>Extending Logical Volumes</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extend LV size</span>
sudo<span class="w"> </span>lvextend<span class="w"> </span>-L<span class="w"> </span>+5G<span class="w"> </span>/dev/myvg/mylv

<span class="c1"># Extend LV to use all available space</span>
sudo<span class="w"> </span>lvextend<span class="w"> </span>-l<span class="w"> </span>+100%FREE<span class="w"> </span>/dev/myvg/mylv

<span class="c1"># Resize filesystem (ext4)</span>
sudo<span class="w"> </span>resize2fs<span class="w"> </span>/dev/myvg/mylv

<span class="c1"># For XFS filesystem</span>
sudo<span class="w"> </span>xfs_growfs<span class="w"> </span>/mnt/mylv
</pre></div>
</div>
<p><strong>Shrinking Logical Volumes</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Unmount the filesystem first</span>
sudo<span class="w"> </span>umount<span class="w"> </span>/mnt/mylv

<span class="c1"># Check filesystem</span>
sudo<span class="w"> </span>e2fsck<span class="w"> </span>-f<span class="w"> </span>/dev/myvg/mylv

<span class="c1"># Shrink filesystem first</span>
sudo<span class="w"> </span>resize2fs<span class="w"> </span>/dev/myvg/mylv<span class="w"> </span>8G

<span class="c1"># Then shrink the logical volume</span>
sudo<span class="w"> </span>lvreduce<span class="w"> </span>-L<span class="w"> </span>8G<span class="w"> </span>/dev/myvg/mylv

<span class="c1"># Remount</span>
sudo<span class="w"> </span>mount<span class="w"> </span>/dev/myvg/mylv<span class="w"> </span>/mnt/mylv
</pre></div>
</div>
</section>
<section id="lvm-snapshots">
<h4><a class="toc-backref" href="#id10" role="doc-backlink">LVM Snapshots</a><a class="headerlink" href="#lvm-snapshots" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create snapshot</span>
sudo<span class="w"> </span>lvcreate<span class="w"> </span>-L<span class="w"> </span>2G<span class="w"> </span>-s<span class="w"> </span>-n<span class="w"> </span>mylv_snapshot<span class="w"> </span>/dev/myvg/mylv

<span class="c1"># Mount snapshot for backup</span>
sudo<span class="w"> </span>mkdir<span class="w"> </span>/mnt/snapshot
sudo<span class="w"> </span>mount<span class="w"> </span>/dev/myvg/mylv_snapshot<span class="w"> </span>/mnt/snapshot

<span class="c1"># Remove snapshot after backup</span>
sudo<span class="w"> </span>umount<span class="w"> </span>/mnt/snapshot
sudo<span class="w"> </span>lvremove<span class="w"> </span>/dev/myvg/mylv_snapshot
</pre></div>
</div>
</section>
<section id="advanced-lvm-features">
<h4><a class="toc-backref" href="#id11" role="doc-backlink">Advanced LVM Features</a><a class="headerlink" href="#advanced-lvm-features" title="Link to this heading"></a></h4>
<p><strong>LVM Thin Provisioning</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create thin pool</span>
sudo<span class="w"> </span>lvcreate<span class="w"> </span>-L<span class="w"> </span>50G<span class="w"> </span>--thinpool<span class="w"> </span>mythinpool<span class="w"> </span>myvg

<span class="c1"># Create thin volume</span>
sudo<span class="w"> </span>lvcreate<span class="w"> </span>-V<span class="w"> </span>100G<span class="w"> </span>--thin<span class="w"> </span>myvg/mythinpool<span class="w"> </span>-n<span class="w"> </span>thinlv

<span class="c1"># Monitor thin pool usage</span>
sudo<span class="w"> </span>lvs<span class="w"> </span>-o<span class="w"> </span>+data_percent,metadata_percent
</pre></div>
</div>
<p><strong>LVM Caching</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create cache pool (requires SSD)</span>
sudo<span class="w"> </span>lvcreate<span class="w"> </span>-L<span class="w"> </span>10G<span class="w"> </span>-n<span class="w"> </span>cachepool<span class="w"> </span>myvg<span class="w"> </span>/dev/nvme0n1p1

<span class="c1"># Convert to cache pool</span>
sudo<span class="w"> </span>lvconvert<span class="w"> </span>--type<span class="w"> </span>cache-pool<span class="w"> </span>myvg/cachepool

<span class="c1"># Cache a logical volume</span>
sudo<span class="w"> </span>lvconvert<span class="w"> </span>--type<span class="w"> </span>cache<span class="w"> </span>--cachepool<span class="w"> </span>myvg/cachepool<span class="w"> </span>myvg/mylv
</pre></div>
</div>
</section>
</section>
<section id="zfs-volume-management">
<h3><a class="toc-backref" href="#id12" role="doc-backlink">ZFS Volume Management</a><a class="headerlink" href="#zfs-volume-management" title="Link to this heading"></a></h3>
<section id="installation-on-ubuntu-22-04">
<h4><a class="toc-backref" href="#id13" role="doc-backlink">Installation on Ubuntu 22.04</a><a class="headerlink" href="#installation-on-ubuntu-22-04" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install ZFS</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>zfsutils-linux

<span class="c1"># Load ZFS module</span>
sudo<span class="w"> </span>modprobe<span class="w"> </span>zfs

<span class="c1"># Verify installation</span>
zfs<span class="w"> </span>version
</pre></div>
</div>
</section>
<section id="creating-zfs-pools">
<h4><a class="toc-backref" href="#id14" role="doc-backlink">Creating ZFS Pools</a><a class="headerlink" href="#creating-zfs-pools" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create simple pool</span>
sudo<span class="w"> </span>zpool<span class="w"> </span>create<span class="w"> </span>mypool<span class="w"> </span>/dev/sdb

<span class="c1"># Create mirrored pool</span>
sudo<span class="w"> </span>zpool<span class="w"> </span>create<span class="w"> </span>mypool<span class="w"> </span>mirror<span class="w"> </span>/dev/sdb<span class="w"> </span>/dev/sdc

<span class="c1"># Create RAIDZ pool (RAID5-like)</span>
sudo<span class="w"> </span>zpool<span class="w"> </span>create<span class="w"> </span>mypool<span class="w"> </span>raidz<span class="w"> </span>/dev/sdb<span class="w"> </span>/dev/sdc<span class="w"> </span>/dev/sdd

<span class="c1"># Check pool status</span>
sudo<span class="w"> </span>zpool<span class="w"> </span>status
sudo<span class="w"> </span>zpool<span class="w"> </span>list
</pre></div>
</div>
</section>
<section id="creating-zfs-datasets">
<h4><a class="toc-backref" href="#id15" role="doc-backlink">Creating ZFS Datasets</a><a class="headerlink" href="#creating-zfs-datasets" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create dataset</span>
sudo<span class="w"> </span>zfs<span class="w"> </span>create<span class="w"> </span>mypool/data

<span class="c1"># Create dataset with compression</span>
sudo<span class="w"> </span>zfs<span class="w"> </span>create<span class="w"> </span>-o<span class="w"> </span><span class="nv">compression</span><span class="o">=</span>lz4<span class="w"> </span>mypool/compressed

<span class="c1"># Set quota</span>
sudo<span class="w"> </span>zfs<span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="nv">quota</span><span class="o">=</span>10G<span class="w"> </span>mypool/data

<span class="c1"># List datasets</span>
sudo<span class="w"> </span>zfs<span class="w"> </span>list
</pre></div>
</div>
</section>
<section id="zfs-snapshots-and-clones">
<h4><a class="toc-backref" href="#id16" role="doc-backlink">ZFS Snapshots and Clones</a><a class="headerlink" href="#zfs-snapshots-and-clones" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create snapshot</span>
sudo<span class="w"> </span>zfs<span class="w"> </span>snapshot<span class="w"> </span>mypool/data@backup-<span class="k">$(</span>date<span class="w"> </span>+%Y%m%d<span class="k">)</span>

<span class="c1"># List snapshots</span>
sudo<span class="w"> </span>zfs<span class="w"> </span>list<span class="w"> </span>-t<span class="w"> </span>snapshot

<span class="c1"># Clone snapshot</span>
sudo<span class="w"> </span>zfs<span class="w"> </span>clone<span class="w"> </span>mypool/data@backup-20250715<span class="w"> </span>mypool/data-clone

<span class="c1"># Rollback to snapshot</span>
sudo<span class="w"> </span>zfs<span class="w"> </span>rollback<span class="w"> </span>mypool/data@backup-20250715
</pre></div>
</div>
</section>
</section>
<section id="btrfs-volume-management">
<h3><a class="toc-backref" href="#id17" role="doc-backlink">Btrfs Volume Management</a><a class="headerlink" href="#btrfs-volume-management" title="Link to this heading"></a></h3>
<section id="creating-btrfs-volumes">
<h4><a class="toc-backref" href="#id18" role="doc-backlink">Creating Btrfs Volumes</a><a class="headerlink" href="#creating-btrfs-volumes" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create single device Btrfs</span>
sudo<span class="w"> </span>mkfs.btrfs<span class="w"> </span>/dev/sdb

<span class="c1"># Create multi-device Btrfs</span>
sudo<span class="w"> </span>mkfs.btrfs<span class="w"> </span>-d<span class="w"> </span>raid1<span class="w"> </span>-m<span class="w"> </span>raid1<span class="w"> </span>/dev/sdb<span class="w"> </span>/dev/sdc

<span class="c1"># Mount Btrfs filesystem</span>
sudo<span class="w"> </span>mount<span class="w"> </span>/dev/sdb<span class="w"> </span>/mnt/btrfs
</pre></div>
</div>
</section>
<section id="btrfs-subvolumes">
<h4><a class="toc-backref" href="#id19" role="doc-backlink">Btrfs Subvolumes</a><a class="headerlink" href="#btrfs-subvolumes" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create subvolume</span>
sudo<span class="w"> </span>btrfs<span class="w"> </span>subvolume<span class="w"> </span>create<span class="w"> </span>/mnt/btrfs/subvol1

<span class="c1"># List subvolumes</span>
sudo<span class="w"> </span>btrfs<span class="w"> </span>subvolume<span class="w"> </span>list<span class="w"> </span>/mnt/btrfs

<span class="c1"># Mount subvolume</span>
sudo<span class="w"> </span>mount<span class="w"> </span>-o<span class="w"> </span><span class="nv">subvol</span><span class="o">=</span>subvol1<span class="w"> </span>/dev/sdb<span class="w"> </span>/mnt/subvol1
</pre></div>
</div>
</section>
<section id="btrfs-snapshots">
<h4><a class="toc-backref" href="#id20" role="doc-backlink">Btrfs Snapshots</a><a class="headerlink" href="#btrfs-snapshots" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create snapshot</span>
sudo<span class="w"> </span>btrfs<span class="w"> </span>subvolume<span class="w"> </span>snapshot<span class="w"> </span>/mnt/btrfs/subvol1<span class="w"> </span>/mnt/btrfs/snapshot1

<span class="c1"># Create read-only snapshot</span>
sudo<span class="w"> </span>btrfs<span class="w"> </span>subvolume<span class="w"> </span>snapshot<span class="w"> </span>-r<span class="w"> </span>/mnt/btrfs/subvol1<span class="w"> </span>/mnt/btrfs/ro-snapshot
</pre></div>
</div>
</section>
</section>
<section id="volume-management-scripts">
<h3><a class="toc-backref" href="#id21" role="doc-backlink">Volume Management Scripts</a><a class="headerlink" href="#volume-management-scripts" title="Link to this heading"></a></h3>
<section id="lvm-monitoring-script">
<h4><a class="toc-backref" href="#id22" role="doc-backlink">LVM Monitoring Script</a><a class="headerlink" href="#lvm-monitoring-script" title="Link to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">LVM Volume Monitoring Script for Ubuntu 22.04</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>

<span class="k">def</span><span class="w"> </span><span class="nf">run_command</span><span class="p">(</span><span class="n">cmd</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute shell command and return output&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="mi">1</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_pv_info</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get physical volume information&quot;&quot;&quot;</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;sudo pvs --reportformat json&quot;</span>
    <span class="n">output</span><span class="p">,</span> <span class="n">code</span> <span class="o">=</span> <span class="n">run_command</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">code</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_vg_info</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get volume group information&quot;&quot;&quot;</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;sudo vgs --reportformat json&quot;</span>
    <span class="n">output</span><span class="p">,</span> <span class="n">code</span> <span class="o">=</span> <span class="n">run_command</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">code</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_lv_info</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get logical volume information&quot;&quot;&quot;</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;sudo lvs --reportformat json&quot;</span>
    <span class="n">output</span><span class="p">,</span> <span class="n">code</span> <span class="o">=</span> <span class="n">run_command</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">code</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">check_space_usage</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check for volume groups with high usage&quot;&quot;&quot;</span>
    <span class="n">vg_info</span> <span class="o">=</span> <span class="n">get_vg_info</span><span class="p">()</span>
    <span class="n">alerts</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="s1">&#39;report&#39;</span> <span class="ow">in</span> <span class="n">vg_info</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">vg</span> <span class="ow">in</span> <span class="n">vg_info</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;vg&#39;</span><span class="p">]:</span>
            <span class="n">used_percent</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">vg</span><span class="p">[</span><span class="s1">&#39;vg_used_percent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;%&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">used_percent</span> <span class="o">&gt;</span> <span class="mi">80</span><span class="p">:</span>
                <span class="n">alerts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;VG </span><span class="si">{</span><span class="n">vg</span><span class="p">[</span><span class="s1">&#39;vg_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> is </span><span class="si">{</span><span class="n">used_percent</span><span class="si">}</span><span class="s2">% full&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">alerts</span>

<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== LVM Volume Status ===&quot;</span><span class="p">)</span>

    <span class="c1"># Physical Volumes</span>
    <span class="n">pv_info</span> <span class="o">=</span> <span class="n">get_pv_info</span><span class="p">()</span>
    <span class="k">if</span> <span class="s1">&#39;report&#39;</span> <span class="ow">in</span> <span class="n">pv_info</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Physical Volumes:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">pv</span> <span class="ow">in</span> <span class="n">pv_info</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;pv&#39;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">pv</span><span class="p">[</span><span class="s1">&#39;pv_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">pv</span><span class="p">[</span><span class="s1">&#39;pv_size&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">pv</span><span class="p">[</span><span class="s1">&#39;pv_used&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> used)&quot;</span><span class="p">)</span>

    <span class="c1"># Volume Groups</span>
    <span class="n">vg_info</span> <span class="o">=</span> <span class="n">get_vg_info</span><span class="p">()</span>
    <span class="k">if</span> <span class="s1">&#39;report&#39;</span> <span class="ow">in</span> <span class="n">vg_info</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Volume Groups:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">vg</span> <span class="ow">in</span> <span class="n">vg_info</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;vg&#39;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">vg</span><span class="p">[</span><span class="s1">&#39;vg_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">vg</span><span class="p">[</span><span class="s1">&#39;vg_size&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">vg</span><span class="p">[</span><span class="s1">&#39;vg_used_percent&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> used)&quot;</span><span class="p">)</span>

    <span class="c1"># Logical Volumes</span>
    <span class="n">lv_info</span> <span class="o">=</span> <span class="n">get_lv_info</span><span class="p">()</span>
    <span class="k">if</span> <span class="s1">&#39;report&#39;</span> <span class="ow">in</span> <span class="n">lv_info</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Logical Volumes:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">lv</span> <span class="ow">in</span> <span class="n">lv_info</span><span class="p">[</span><span class="s1">&#39;report&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;lv&#39;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">lv</span><span class="p">[</span><span class="s1">&#39;lv_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">lv</span><span class="p">[</span><span class="s1">&#39;lv_size&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">lv</span><span class="p">[</span><span class="s1">&#39;data_percent&#39;</span><span class="p">]</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;N/A&#39;</span><span class="si">}</span><span class="s2">% data)&quot;</span><span class="p">)</span>

    <span class="c1"># Check for alerts</span>
    <span class="n">alerts</span> <span class="o">=</span> <span class="n">check_space_usage</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">alerts</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== ALERTS ===&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">alert</span> <span class="ow">in</span> <span class="n">alerts</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WARNING: </span><span class="si">{</span><span class="n">alert</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="automated-backup-script">
<h4><a class="toc-backref" href="#id23" role="doc-backlink">Automated Backup Script</a><a class="headerlink" href="#automated-backup-script" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1"># LVM Snapshot Backup Script</span>

<span class="nv">VOLUME_GROUP</span><span class="o">=</span><span class="s2">&quot;myvg&quot;</span>
<span class="nv">LOGICAL_VOLUME</span><span class="o">=</span><span class="s2">&quot;mylv&quot;</span>
<span class="nv">SNAPSHOT_NAME</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">LOGICAL_VOLUME</span><span class="si">}</span><span class="s2">_backup_</span><span class="k">$(</span>date<span class="w"> </span>+%Y%m%d_%H%M%S<span class="k">)</span><span class="s2">&quot;</span>
<span class="nv">BACKUP_DIR</span><span class="o">=</span><span class="s2">&quot;/backup&quot;</span>
<span class="nv">SNAPSHOT_SIZE</span><span class="o">=</span><span class="s2">&quot;2G&quot;</span>

<span class="c1"># Function to log messages</span>
log_message<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>date<span class="w"> </span><span class="s1">&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span class="k">)</span><span class="s2">: </span><span class="nv">$1</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/var/log/lvm_backup.log
<span class="o">}</span>

<span class="c1"># Function to cleanup on exit</span>
cleanup<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$SNAPSHOT_CREATED</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span>log_message<span class="w"> </span><span class="s2">&quot;Cleaning up snapshot: </span><span class="nv">$SNAPSHOT_NAME</span><span class="s2">&quot;</span>
<span class="w">        </span>sudo<span class="w"> </span>umount<span class="w"> </span>/mnt/snapshot<span class="w"> </span><span class="m">2</span>&gt;/dev/null
<span class="w">        </span>sudo<span class="w"> </span>lvremove<span class="w"> </span>-f<span class="w"> </span>/dev/<span class="nv">$VOLUME_GROUP</span>/<span class="nv">$SNAPSHOT_NAME</span>
<span class="w">    </span><span class="k">fi</span>
<span class="o">}</span>

<span class="c1"># Set trap for cleanup</span>
<span class="nb">trap</span><span class="w"> </span>cleanup<span class="w"> </span>EXIT

<span class="c1"># Create snapshot</span>
log_message<span class="w"> </span><span class="s2">&quot;Creating snapshot: </span><span class="nv">$SNAPSHOT_NAME</span><span class="s2">&quot;</span>
<span class="k">if</span><span class="w"> </span>sudo<span class="w"> </span>lvcreate<span class="w"> </span>-L<span class="w"> </span><span class="nv">$SNAPSHOT_SIZE</span><span class="w"> </span>-s<span class="w"> </span>-n<span class="w"> </span><span class="nv">$SNAPSHOT_NAME</span><span class="w"> </span>/dev/<span class="nv">$VOLUME_GROUP</span>/<span class="nv">$LOGICAL_VOLUME</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nv">SNAPSHOT_CREATED</span><span class="o">=</span><span class="m">1</span>
<span class="w">    </span>log_message<span class="w"> </span><span class="s2">&quot;Snapshot created successfully&quot;</span>
<span class="k">else</span>
<span class="w">    </span>log_message<span class="w"> </span><span class="s2">&quot;Failed to create snapshot&quot;</span>
<span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="k">fi</span>

<span class="c1"># Mount snapshot</span>
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/mnt/snapshot
<span class="k">if</span><span class="w"> </span>sudo<span class="w"> </span>mount<span class="w"> </span>/dev/<span class="nv">$VOLUME_GROUP</span>/<span class="nv">$SNAPSHOT_NAME</span><span class="w"> </span>/mnt/snapshot<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span>log_message<span class="w"> </span><span class="s2">&quot;Snapshot mounted at /mnt/snapshot&quot;</span>
<span class="k">else</span>
<span class="w">    </span>log_message<span class="w"> </span><span class="s2">&quot;Failed to mount snapshot&quot;</span>
<span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="k">fi</span>

<span class="c1"># Create backup</span>
<span class="nv">BACKUP_FILE</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$BACKUP_DIR</span><span class="s2">/backup_</span><span class="si">${</span><span class="nv">LOGICAL_VOLUME</span><span class="si">}</span><span class="s2">_</span><span class="k">$(</span>date<span class="w"> </span>+%Y%m%d_%H%M%S<span class="k">)</span><span class="s2">.tar.gz&quot;</span>
log_message<span class="w"> </span><span class="s2">&quot;Creating backup: </span><span class="nv">$BACKUP_FILE</span><span class="s2">&quot;</span>

<span class="k">if</span><span class="w"> </span>sudo<span class="w"> </span>tar<span class="w"> </span>-czf<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BACKUP_FILE</span><span class="s2">&quot;</span><span class="w"> </span>-C<span class="w"> </span>/mnt/snapshot<span class="w"> </span>.<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span>log_message<span class="w"> </span><span class="s2">&quot;Backup completed: </span><span class="nv">$BACKUP_FILE</span><span class="s2">&quot;</span>
<span class="w">    </span>log_message<span class="w"> </span><span class="s2">&quot;Backup size: </span><span class="k">$(</span>du<span class="w"> </span>-h<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BACKUP_FILE</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-f1<span class="k">)</span><span class="s2">&quot;</span>
<span class="k">else</span>
<span class="w">    </span>log_message<span class="w"> </span><span class="s2">&quot;Backup failed&quot;</span>
<span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="k">fi</span>
</pre></div>
</div>
</section>
</section>
<section id="common-tasks-and-q-a">
<h3><a class="toc-backref" href="#id24" role="doc-backlink">Common Tasks and Q&amp;A</a><a class="headerlink" href="#common-tasks-and-q-a" title="Link to this heading"></a></h3>
<p><strong>Q: How do I extend a volume group with a new disk?</strong></p>
<p>A: Add the new disk as a physical volume and extend the volume group:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>pvcreate<span class="w"> </span>/dev/sdd
sudo<span class="w"> </span>vgextend<span class="w"> </span>myvg<span class="w"> </span>/dev/sdd
</pre></div>
</div>
<p><strong>Q: Can I move data between logical volumes?</strong></p>
<p>A: Yes, use pvmove to migrate data:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Move all data from /dev/sdb to /dev/sdc</span>
sudo<span class="w"> </span>pvmove<span class="w"> </span>/dev/sdb<span class="w"> </span>/dev/sdc
</pre></div>
</div>
<p><strong>Q: How do I remove a disk from LVM?</strong></p>
<p>A: First move data, then remove:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>pvmove<span class="w"> </span>/dev/sdb
sudo<span class="w"> </span>vgreduce<span class="w"> </span>myvg<span class="w"> </span>/dev/sdb
sudo<span class="w"> </span>pvremove<span class="w"> </span>/dev/sdb
</pre></div>
</div>
<p><strong>Q: What’s the difference between thick and thin provisioning?</strong></p>
<p>A: Thick provisioning allocates all space immediately, while thin provisioning allocates space as needed, allowing overcommitment.</p>
<p><strong>Q: How do I monitor thin pool usage?</strong></p>
<p>A: Use lvs with additional columns:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>lvs<span class="w"> </span>-o<span class="w"> </span>+data_percent,metadata_percent
</pre></div>
</div>
</section>
<section id="best-practices">
<h3><a class="toc-backref" href="#id25" role="doc-backlink">Best Practices</a><a class="headerlink" href="#best-practices" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p><strong>Regular Monitoring</strong>
- Monitor volume group usage
- Set up alerts for high usage
- Regular snapshot cleanup</p></li>
<li><p><strong>Backup Strategy</strong>
- Use LVM snapshots for consistent backups
- Test restore procedures
- Keep multiple snapshot generations</p></li>
<li><p><strong>Performance</strong>
- Align volumes with underlying storage
- Use appropriate stripe sizes
- Consider SSD caching for performance</p></li>
<li><p><strong>Security</strong>
- Use LUKS encryption for sensitive data
- Implement proper access controls
- Regular security audits</p></li>
<li><p><strong>Disaster Recovery</strong>
- Document volume group configurations
- Practice recovery procedures
- Maintain offsite backups</p></li>
</ol>
</section>
<section id="see-also">
<h3><a class="toc-backref" href="#id26" role="doc-backlink">See Also</a><a class="headerlink" href="#see-also" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference internal" href="#document-disk-management"><span class="doc">Disk Management</span></a></p></li>
<li><p><a class="reference internal" href="#document-file-systems"><span class="doc">File Systems</span></a></p></li>
<li><p><a class="reference internal" href="#document-raid-systems"><span class="doc">RAID Systems</span></a></p></li>
<li><p><a class="reference internal" href="#document-troubleshooting"><span class="doc">Troubleshooting Guide</span></a></p></li>
</ul>
</section>
</section>
<span id="document-storage-devices"></span><section id="storage-devices">
<h2>Storage Devices<a class="headerlink" href="#storage-devices" title="Link to this heading"></a></h2>
<p>This comprehensive guide covers the various types of storage devices, their characteristics, selection criteria, and management on Ubuntu 22.04 LTS.</p>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#overview-of-storage-devices" id="id2">Overview of Storage Devices</a></p>
<ul>
<li><p><a class="reference internal" href="#classification-by-technology" id="id3">Classification by Technology</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#hard-disk-drives-hdds" id="id4">Hard Disk Drives (HDDs)</a></p>
<ul>
<li><p><a class="reference internal" href="#technology-overview" id="id5">Technology Overview</a></p></li>
<li><p><a class="reference internal" href="#types-of-hdds" id="id6">Types of HDDs</a></p></li>
<li><p><a class="reference internal" href="#hdd-management-commands" id="id7">HDD Management Commands</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#solid-state-drives-ssds" id="id8">Solid State Drives (SSDs)</a></p>
<ul>
<li><p><a class="reference internal" href="#id1" id="id9">Technology Overview</a></p></li>
<li><p><a class="reference internal" href="#types-of-ssds" id="id10">Types of SSDs</a></p></li>
<li><p><a class="reference internal" href="#ssd-management-and-optimization" id="id11">SSD Management and Optimization</a></p></li>
<li><p><a class="reference internal" href="#nvme-management" id="id12">NVMe Management</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#network-attached-storage-nas" id="id13">Network Attached Storage (NAS)</a></p>
<ul>
<li><p><a class="reference internal" href="#types-of-nas-devices" id="id14">Types of NAS Devices</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#storage-area-network-san" id="id15">Storage Area Network (SAN)</a></p>
<ul>
<li><p><a class="reference internal" href="#iscsi-configuration" id="id16">iSCSI Configuration</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#optical-storage" id="id17">Optical Storage</a></p>
<ul>
<li><p><a class="reference internal" href="#cd-dvd-blu-ray-management" id="id18">CD/DVD/Blu-ray Management</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#usb-storage-devices" id="id19">USB Storage Devices</a></p>
<ul>
<li><p><a class="reference internal" href="#usb-drive-management" id="id20">USB Drive Management</a></p></li>
<li><p><a class="reference internal" href="#usb-performance-optimization" id="id21">USB Performance Optimization</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#storage-device-monitoring" id="id22">Storage Device Monitoring</a></p>
<ul>
<li><p><a class="reference internal" href="#health-monitoring-script" id="id23">Health Monitoring Script</a></p></li>
<li><p><a class="reference internal" href="#performance-benchmarking" id="id24">Performance Benchmarking</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#device-selection-guidelines" id="id25">Device Selection Guidelines</a></p>
<ul>
<li><p><a class="reference internal" href="#performance-considerations" id="id26">Performance Considerations</a></p></li>
<li><p><a class="reference internal" href="#capacity-planning" id="id27">Capacity Planning</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#common-issues-and-troubleshooting" id="id28">Common Issues and Troubleshooting</a></p></li>
<li><p><a class="reference internal" href="#best-practices" id="id29">Best Practices</a></p></li>
<li><p><a class="reference internal" href="#see-also" id="id30">See Also</a></p></li>
</ul>
</nav>
<section id="overview-of-storage-devices">
<h3><a class="toc-backref" href="#id2" role="doc-backlink">Overview of Storage Devices</a><a class="headerlink" href="#overview-of-storage-devices" title="Link to this heading"></a></h3>
<p>Storage devices are the physical components that store data persistently. Understanding different types helps in making informed decisions for system design, performance optimization, and capacity planning.</p>
<section id="classification-by-technology">
<h4><a class="toc-backref" href="#id3" role="doc-backlink">Classification by Technology</a><a class="headerlink" href="#classification-by-technology" title="Link to this heading"></a></h4>
<dl class="simple">
<dt><strong>Magnetic Storage</strong></dt><dd><p>Traditional hard disk drives (HDDs) using magnetic fields</p>
</dd>
<dt><strong>Solid State Storage</strong></dt><dd><p>Flash-based storage devices (SSDs) with no moving parts</p>
</dd>
<dt><strong>Optical Storage</strong></dt><dd><p>CD, DVD, Blu-ray discs using laser technology</p>
</dd>
<dt><strong>Tape Storage</strong></dt><dd><p>Sequential access magnetic tape for long-term archival</p>
</dd>
<dt><strong>Hybrid Storage</strong></dt><dd><p>Combination devices (SSHDs) with both magnetic and flash storage</p>
</dd>
</dl>
</section>
</section>
<section id="hard-disk-drives-hdds">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">Hard Disk Drives (HDDs)</a><a class="headerlink" href="#hard-disk-drives-hdds" title="Link to this heading"></a></h3>
<section id="technology-overview">
<h4><a class="toc-backref" href="#id5" role="doc-backlink">Technology Overview</a><a class="headerlink" href="#technology-overview" title="Link to this heading"></a></h4>
<p>HDDs store data on rotating magnetic platters with read/write heads. They offer:</p>
<ul class="simple">
<li><p>High capacity at low cost</p></li>
<li><p>Mechanical components subject to wear</p></li>
<li><p>Sequential access performance</p></li>
<li><p>Susceptible to physical shock</p></li>
</ul>
</section>
<section id="types-of-hdds">
<h4><a class="toc-backref" href="#id6" role="doc-backlink">Types of HDDs</a><a class="headerlink" href="#types-of-hdds" title="Link to this heading"></a></h4>
<p><strong>Desktop HDDs (3.5”)</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check 3.5&quot; HDD information</span>
sudo<span class="w"> </span>hdparm<span class="w"> </span>-I<span class="w"> </span>/dev/sda<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;(Model|Serial|Capacity)&quot;</span>

<span class="c1"># Typical characteristics:</span>
<span class="c1"># - Capacity: 500GB to 20TB+</span>
<span class="c1"># - RPM: 5400, 7200 RPM</span>
<span class="c1"># - Interface: SATA 6Gb/s</span>
<span class="c1"># - Power: 5-10W</span>
</pre></div>
</div>
<p><strong>Laptop HDDs (2.5”)</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check 2.5&quot; HDD specifications</span>
lsblk<span class="w"> </span>-d<span class="w"> </span>-o<span class="w"> </span>NAME,SIZE,MODEL,TRAN

<span class="c1"># Typical characteristics:</span>
<span class="c1"># - Capacity: 500GB to 5TB</span>
<span class="c1"># - RPM: 5400 RPM (some 7200 RPM)</span>
<span class="c1"># - Interface: SATA 6Gb/s</span>
<span class="c1"># - Power: 1-3W</span>
</pre></div>
</div>
<p><strong>Enterprise HDDs</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check enterprise HDD features</span>
sudo<span class="w"> </span>smartctl<span class="w"> </span>-a<span class="w"> </span>/dev/sda<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;(Model|Rotation|Power_Cycle)&quot;</span>

<span class="c1"># Characteristics:</span>
<span class="c1"># - High reliability (MTBF 2M+ hours)</span>
<span class="c1"># - 7200-15000 RPM</span>
<span class="c1"># - Advanced error correction</span>
<span class="c1"># - Vibration resistance</span>
</pre></div>
</div>
</section>
<section id="hdd-management-commands">
<h4><a class="toc-backref" href="#id7" role="doc-backlink">HDD Management Commands</a><a class="headerlink" href="#hdd-management-commands" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get detailed HDD information</span>
sudo<span class="w"> </span>hdparm<span class="w"> </span>-I<span class="w"> </span>/dev/sda

<span class="c1"># Check HDD health with SMART</span>
sudo<span class="w"> </span>smartctl<span class="w"> </span>-H<span class="w"> </span>/dev/sda
sudo<span class="w"> </span>smartctl<span class="w"> </span>-a<span class="w"> </span>/dev/sda

<span class="c1"># Test HDD performance</span>
sudo<span class="w"> </span>hdparm<span class="w"> </span>-t<span class="w"> </span>/dev/sda<span class="w">    </span><span class="c1"># Buffered reads</span>
sudo<span class="w"> </span>hdparm<span class="w"> </span>-T<span class="w"> </span>/dev/sda<span class="w">    </span><span class="c1"># Cached reads</span>

<span class="c1"># Set HDD parameters</span>
sudo<span class="w"> </span>hdparm<span class="w"> </span>-S<span class="w"> </span><span class="m">60</span><span class="w"> </span>/dev/sda<span class="w">    </span><span class="c1"># Set standby timeout</span>
sudo<span class="w"> </span>hdparm<span class="w"> </span>-B<span class="w"> </span><span class="m">254</span><span class="w"> </span>/dev/sda<span class="w">   </span><span class="c1"># Disable power management</span>
</pre></div>
</div>
</section>
</section>
<section id="solid-state-drives-ssds">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">Solid State Drives (SSDs)</a><a class="headerlink" href="#solid-state-drives-ssds" title="Link to this heading"></a></h3>
<section id="id1">
<h4><a class="toc-backref" href="#id9" role="doc-backlink">Technology Overview</a><a class="headerlink" href="#id1" title="Link to this heading"></a></h4>
<p>SSDs use NAND flash memory with no moving parts, providing:</p>
<ul class="simple">
<li><p>Fast random access</p></li>
<li><p>Low latency</p></li>
<li><p>High IOPS capability</p></li>
<li><p>Limited write endurance</p></li>
<li><p>Higher cost per GB</p></li>
</ul>
</section>
<section id="types-of-ssds">
<h4><a class="toc-backref" href="#id10" role="doc-backlink">Types of SSDs</a><a class="headerlink" href="#types-of-ssds" title="Link to this heading"></a></h4>
<p><strong>SATA SSDs</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Identify SATA SSD</span>
lsblk<span class="w"> </span>-d<span class="w"> </span>-o<span class="w"> </span>NAME,SIZE,MODEL,TRAN<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>sata

<span class="c1"># Characteristics:</span>
<span class="c1"># - Interface: SATA 6Gb/s (600MB/s max)</span>
<span class="c1"># - Form factor: 2.5&quot; or mSATA</span>
<span class="c1"># - Compatible with HDD infrastructure</span>
</pre></div>
</div>
<p><strong>NVMe SSDs</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># List NVMe devices</span>
sudo<span class="w"> </span>nvme<span class="w"> </span>list

<span class="c1"># Get NVMe device information</span>
sudo<span class="w"> </span>nvme<span class="w"> </span>id-ctrl<span class="w"> </span>/dev/nvme0n1

<span class="c1"># Characteristics:</span>
<span class="c1"># - Interface: PCIe (up to 7GB/s)</span>
<span class="c1"># - Form factors: M.2, PCIe card, U.2</span>
<span class="c1"># - Lower latency than SATA</span>
</pre></div>
</div>
<p><strong>M.2 SSDs</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check M.2 SSD details</span>
sudo<span class="w"> </span>lshw<span class="w"> </span>-class<span class="w"> </span>disk<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-A<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="s2">&quot;product.*M.2&quot;</span>

<span class="c1"># Types:</span>
<span class="c1"># - M.2 SATA: Uses SATA protocol</span>
<span class="c1"># - M.2 NVMe: Uses NVMe protocol</span>
<span class="c1"># - Form factors: 2242, 2260, 2280, 22110</span>
</pre></div>
</div>
</section>
<section id="ssd-management-and-optimization">
<h4><a class="toc-backref" href="#id11" role="doc-backlink">SSD Management and Optimization</a><a class="headerlink" href="#ssd-management-and-optimization" title="Link to this heading"></a></h4>
<p><strong>Enable TRIM Support</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check TRIM support</span>
sudo<span class="w"> </span>hdparm<span class="w"> </span>-I<span class="w"> </span>/dev/sda<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>TRIM

<span class="c1"># Enable TRIM (automatic)</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>fstrim.timer
sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>fstrim.timer

<span class="c1"># Manual TRIM</span>
sudo<span class="w"> </span>fstrim<span class="w"> </span>-v<span class="w"> </span>/

<span class="c1"># Add to fstab for continuous TRIM</span>
<span class="c1"># /dev/sda1 / ext4 defaults,discard 0 1</span>
</pre></div>
</div>
<p><strong>SSD Health Monitoring</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check SSD health with smartctl</span>
sudo<span class="w"> </span>smartctl<span class="w"> </span>-A<span class="w"> </span>/dev/sda<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;(Wear|Program|Erase|Health)&quot;</span>

<span class="c1"># For NVMe SSDs</span>
sudo<span class="w"> </span>nvme<span class="w"> </span>smart-log<span class="w"> </span>/dev/nvme0n1

<span class="c1"># Monitor wear leveling</span>
sudo<span class="w"> </span>smartctl<span class="w"> </span>-A<span class="w"> </span>/dev/sda<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>Wear_Leveling_Count
</pre></div>
</div>
<p><strong>SSD Performance Tuning</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check current I/O scheduler</span>
cat<span class="w"> </span>/sys/block/sda/queue/scheduler

<span class="c1"># Set optimal scheduler for SSD</span>
<span class="nb">echo</span><span class="w"> </span>mq-deadline<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/sys/block/sda/queue/scheduler

<span class="c1"># Disable barriers for better performance (if using UPS)</span>
<span class="c1"># mount -o nobarrier /dev/sda1 /mnt</span>
</pre></div>
</div>
</section>
<section id="nvme-management">
<h4><a class="toc-backref" href="#id12" role="doc-backlink">NVMe Management</a><a class="headerlink" href="#nvme-management" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install NVMe tools</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>nvme-cli

<span class="c1"># List NVMe devices</span>
sudo<span class="w"> </span>nvme<span class="w"> </span>list

<span class="c1"># Get device information</span>
sudo<span class="w"> </span>nvme<span class="w"> </span>id-ctrl<span class="w"> </span>/dev/nvme0n1
sudo<span class="w"> </span>nvme<span class="w"> </span>id-ns<span class="w"> </span>/dev/nvme0n1

<span class="c1"># Check NVMe health</span>
sudo<span class="w"> </span>nvme<span class="w"> </span>smart-log<span class="w"> </span>/dev/nvme0n1

<span class="c1"># Format NVMe (careful!)</span>
sudo<span class="w"> </span>nvme<span class="w"> </span>format<span class="w"> </span>/dev/nvme0n1<span class="w"> </span>--lbaf<span class="o">=</span><span class="m">0</span>

<span class="c1"># Secure erase</span>
sudo<span class="w"> </span>nvme<span class="w"> </span>format<span class="w"> </span>/dev/nvme0n1<span class="w"> </span>--ses<span class="o">=</span><span class="m">1</span>
</pre></div>
</div>
</section>
</section>
<section id="network-attached-storage-nas">
<h3><a class="toc-backref" href="#id13" role="doc-backlink">Network Attached Storage (NAS)</a><a class="headerlink" href="#network-attached-storage-nas" title="Link to this heading"></a></h3>
<section id="types-of-nas-devices">
<h4><a class="toc-backref" href="#id14" role="doc-backlink">Types of NAS Devices</a><a class="headerlink" href="#types-of-nas-devices" title="Link to this heading"></a></h4>
<p><strong>Consumer NAS</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Typical consumer NAS specs:</span>
<span class="c1"># - 1-8 drive bays</span>
<span class="c1"># - ARM or low-power x86 CPU</span>
<span class="c1"># - 512MB to 8GB RAM</span>
<span class="c1"># - Gigabit Ethernet</span>

<span class="c1"># Connect to NAS via SMB</span>
sudo<span class="w"> </span>mount<span class="w"> </span>-t<span class="w"> </span>cifs<span class="w"> </span>//nas.local/share<span class="w"> </span>/mnt/nas<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-o<span class="w"> </span><span class="nv">username</span><span class="o">=</span>user,password<span class="o">=</span>pass
</pre></div>
</div>
<p><strong>Enterprise NAS</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Enterprise NAS features:</span>
<span class="c1"># - 8+ drive bays</span>
<span class="c1"># - Redundant components</span>
<span class="c1"># - 10GbE networking</span>
<span class="c1"># - Advanced management</span>
</pre></div>
</div>
<p><strong>Building DIY NAS with Ubuntu</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install Samba for SMB/CIFS sharing</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>samba

<span class="c1"># Configure Samba share</span>
sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/samba/smb.conf<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s">[storage]</span>
<span class="s">path = /srv/storage</span>
<span class="s">browseable = yes</span>
<span class="s">read only = no</span>
<span class="s">guest ok = no</span>
<span class="s">valid users = @storage</span>
<span class="s">EOF</span>

<span class="c1"># Restart Samba</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>smbd
</pre></div>
</div>
</section>
</section>
<section id="storage-area-network-san">
<h3><a class="toc-backref" href="#id15" role="doc-backlink">Storage Area Network (SAN)</a><a class="headerlink" href="#storage-area-network-san" title="Link to this heading"></a></h3>
<section id="iscsi-configuration">
<h4><a class="toc-backref" href="#id16" role="doc-backlink">iSCSI Configuration</a><a class="headerlink" href="#iscsi-configuration" title="Link to this heading"></a></h4>
<p><strong>iSCSI Target (Server)</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install iSCSI target</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>tgt

<span class="c1"># Create target configuration</span>
sudo<span class="w"> </span>tee<span class="w"> </span>/etc/tgt/conf.d/storage.conf<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s">&lt;target iqn.2025-01.com.example:storage&gt;</span>
<span class="s">    backing-store /dev/sdb</span>
<span class="s">    incominguser iscsi-user password123</span>
<span class="s">    outgoinguser iscsi-target secretpass</span>
<span class="s">&lt;/target&gt;</span>
<span class="s">EOF</span>

<span class="c1"># Restart target service</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>tgt

<span class="c1"># Check target status</span>
sudo<span class="w"> </span>tgtadm<span class="w"> </span>--mode<span class="w"> </span>target<span class="w"> </span>--op<span class="w"> </span>show
</pre></div>
</div>
<p><strong>iSCSI Initiator (Client)</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install iSCSI initiator</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>open-iscsi

<span class="c1"># Configure authentication</span>
sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/iscsi/iscsid.conf<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s">node.session.auth.authmethod = CHAP</span>
<span class="s">node.session.auth.username = iscsi-user</span>
<span class="s">node.session.auth.password = password123</span>
<span class="s">EOF</span>

<span class="c1"># Discover targets</span>
sudo<span class="w"> </span>iscsiadm<span class="w"> </span>-m<span class="w"> </span>discovery<span class="w"> </span>-t<span class="w"> </span>st<span class="w"> </span>-p<span class="w"> </span><span class="m">192</span>.168.1.100

<span class="c1"># Login to target</span>
sudo<span class="w"> </span>iscsiadm<span class="w"> </span>-m<span class="w"> </span>node<span class="w"> </span>--login

<span class="c1"># Check connected sessions</span>
sudo<span class="w"> </span>iscsiadm<span class="w"> </span>-m<span class="w"> </span>session
</pre></div>
</div>
</section>
</section>
<section id="optical-storage">
<h3><a class="toc-backref" href="#id17" role="doc-backlink">Optical Storage</a><a class="headerlink" href="#optical-storage" title="Link to this heading"></a></h3>
<section id="cd-dvd-blu-ray-management">
<h4><a class="toc-backref" href="#id18" role="doc-backlink">CD/DVD/Blu-ray Management</a><a class="headerlink" href="#cd-dvd-blu-ray-management" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install optical drive tools</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>wodim<span class="w"> </span>genisoimage<span class="w"> </span>dvd+rw-tools

<span class="c1"># Check optical drive capabilities</span>
wodim<span class="w"> </span>--devices
sudo<span class="w"> </span>hdparm<span class="w"> </span>-I<span class="w"> </span>/dev/sr0

<span class="c1"># Create ISO image</span>
genisoimage<span class="w"> </span>-o<span class="w"> </span>backup.iso<span class="w"> </span>-J<span class="w"> </span>-R<span class="w"> </span>/home/user/documents

<span class="c1"># Burn ISO to disc</span>
wodim<span class="w"> </span>-v<span class="w"> </span><span class="nv">speed</span><span class="o">=</span><span class="m">8</span><span class="w"> </span>backup.iso

<span class="c1"># Mount optical disc</span>
sudo<span class="w"> </span>mount<span class="w"> </span>/dev/sr0<span class="w"> </span>/mnt/cdrom

<span class="c1"># Eject disc</span>
eject<span class="w"> </span>/dev/sr0
</pre></div>
</div>
</section>
</section>
<section id="usb-storage-devices">
<h3><a class="toc-backref" href="#id19" role="doc-backlink">USB Storage Devices</a><a class="headerlink" href="#usb-storage-devices" title="Link to this heading"></a></h3>
<section id="usb-drive-management">
<h4><a class="toc-backref" href="#id20" role="doc-backlink">USB Drive Management</a><a class="headerlink" href="#usb-drive-management" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># List USB storage devices</span>
lsusb<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span>storage
lsblk<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;(sd[b-z]|sr[0-9])&quot;</span>

<span class="c1"># Get USB device information</span>
sudo<span class="w"> </span>fdisk<span class="w"> </span>-l<span class="w"> </span>/dev/sdb
sudo<span class="w"> </span>hdparm<span class="w"> </span>-I<span class="w"> </span>/dev/sdb

<span class="c1"># Format USB drive (careful!)</span>
sudo<span class="w"> </span>mkfs.ext4<span class="w"> </span>/dev/sdb1
sudo<span class="w"> </span>mkfs.vfat<span class="w"> </span>-F<span class="w"> </span><span class="m">32</span><span class="w"> </span>/dev/sdb1<span class="w">  </span><span class="c1"># For Windows compatibility</span>

<span class="c1"># Mount USB drive</span>
sudo<span class="w"> </span>mkdir<span class="w"> </span>/mnt/usb
sudo<span class="w"> </span>mount<span class="w"> </span>/dev/sdb1<span class="w"> </span>/mnt/usb

<span class="c1"># Safe removal</span>
sudo<span class="w"> </span>umount<span class="w"> </span>/mnt/usb
sudo<span class="w"> </span>eject<span class="w"> </span>/dev/sdb
</pre></div>
</div>
</section>
<section id="usb-performance-optimization">
<h4><a class="toc-backref" href="#id21" role="doc-backlink">USB Performance Optimization</a><a class="headerlink" href="#usb-performance-optimization" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check USB version and speed</span>
lsusb<span class="w"> </span>-t
dmesg<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;usb.*high\|usb.*super&quot;</span>

<span class="c1"># Optimize mount options for USB</span>
sudo<span class="w"> </span>mount<span class="w"> </span>-o<span class="w"> </span>async,noatime,nodiratime<span class="w"> </span>/dev/sdb1<span class="w"> </span>/mnt/usb

<span class="c1"># Disable USB autosuspend for external drives</span>
<span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;SUBSYSTEM==&quot;usb&quot;, ATTR{idVendor}==&quot;1234&quot;, ATTR{idProduct}==&quot;5678&quot;, ATTR{power/autosuspend}=&quot;-1&quot;&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/udev/rules.d/50-usb-power.rules
</pre></div>
</div>
</section>
</section>
<section id="storage-device-monitoring">
<h3><a class="toc-backref" href="#id22" role="doc-backlink">Storage Device Monitoring</a><a class="headerlink" href="#storage-device-monitoring" title="Link to this heading"></a></h3>
<section id="health-monitoring-script">
<h4><a class="toc-backref" href="#id23" role="doc-backlink">Health Monitoring Script</a><a class="headerlink" href="#health-monitoring-script" title="Link to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Storage Device Health Monitoring Script</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

<span class="k">def</span><span class="w"> </span><span class="nf">run_command</span><span class="p">(</span><span class="n">cmd</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute command and return output&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="mi">1</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_block_devices</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get list of block devices&quot;&quot;&quot;</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;lsblk -J -o NAME,TYPE,SIZE,MODEL,SERIAL&quot;</span>
    <span class="n">output</span><span class="p">,</span> <span class="n">code</span> <span class="o">=</span> <span class="n">run_command</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">code</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">output</span><span class="p">)[</span><span class="s1">&#39;blockdevices&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">[]</span>

<span class="k">def</span><span class="w"> </span><span class="nf">check_smart_health</span><span class="p">(</span><span class="n">device</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check SMART health for device&quot;&quot;&quot;</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sudo smartctl -H /dev/</span><span class="si">{</span><span class="n">device</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">output</span><span class="p">,</span> <span class="n">code</span> <span class="o">=</span> <span class="n">run_command</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;PASSED&quot;</span> <span class="ow">in</span> <span class="n">output</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;HEALTHY&quot;</span>
    <span class="k">elif</span> <span class="s2">&quot;FAILED&quot;</span> <span class="ow">in</span> <span class="n">output</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;FAILED&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;UNKNOWN&quot;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_temperature</span><span class="p">(</span><span class="n">device</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get device temperature&quot;&quot;&quot;</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sudo smartctl -A /dev/</span><span class="si">{</span><span class="n">device</span><span class="si">}</span><span class="s2"> | grep -i temperature&quot;</span>
    <span class="n">output</span><span class="p">,</span> <span class="n">code</span> <span class="o">=</span> <span class="n">run_command</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">code</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">output</span><span class="p">:</span>
        <span class="n">temp_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\d+)\s*\(.*Celsius&#39;</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">temp_match</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">temp_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">return</span> <span class="kc">None</span>

<span class="k">def</span><span class="w"> </span><span class="nf">check_nvme_health</span><span class="p">(</span><span class="n">device</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check NVMe specific health&quot;&quot;&quot;</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sudo nvme smart-log /dev/</span><span class="si">{</span><span class="n">device</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">output</span><span class="p">,</span> <span class="n">code</span> <span class="o">=</span> <span class="n">run_command</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">code</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">health_info</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;temperature&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">temp_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\d+)&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">temp_match</span><span class="p">:</span>
                    <span class="n">health_info</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">temp_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">elif</span> <span class="s1">&#39;percentage_used&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">percent_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\d+)%&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">percent_match</span><span class="p">:</span>
                    <span class="n">health_info</span><span class="p">[</span><span class="s1">&#39;wear_level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">percent_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">health_info</span>
    <span class="k">return</span> <span class="p">{}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Storage Device Health Report - </span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">70</span><span class="p">)</span>

    <span class="n">devices</span> <span class="o">=</span> <span class="n">get_block_devices</span><span class="p">()</span>
    <span class="n">alerts</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;disk&#39;</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="s1">&#39;Unknown&#39;</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Device: /dev/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Model: </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Size: </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Check SMART health</span>
            <span class="n">health</span> <span class="o">=</span> <span class="n">check_smart_health</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Health: </span><span class="si">{</span><span class="n">health</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">health</span> <span class="o">==</span> <span class="s2">&quot;FAILED&quot;</span><span class="p">:</span>
                <span class="n">alerts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CRITICAL: Device </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> SMART health failed!&quot;</span><span class="p">)</span>

            <span class="c1"># Check temperature</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">get_temperature</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">temp</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Temperature: </span><span class="si">{</span><span class="n">temp</span><span class="si">}</span><span class="s2">°C&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">temp</span> <span class="o">&gt;</span> <span class="mi">60</span><span class="p">:</span>
                    <span class="n">alerts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WARNING: Device </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> temperature high: </span><span class="si">{</span><span class="n">temp</span><span class="si">}</span><span class="s2">°C&quot;</span><span class="p">)</span>

            <span class="c1"># Check NVMe specific data</span>
            <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;nvme&#39;</span><span class="p">):</span>
                <span class="n">nvme_health</span> <span class="o">=</span> <span class="n">check_nvme_health</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;wear_level&#39;</span> <span class="ow">in</span> <span class="n">nvme_health</span><span class="p">:</span>
                    <span class="n">wear</span> <span class="o">=</span> <span class="n">nvme_health</span><span class="p">[</span><span class="s1">&#39;wear_level&#39;</span><span class="p">]</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Wear Level: </span><span class="si">{</span><span class="n">wear</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">wear</span> <span class="o">&gt;</span> <span class="mi">80</span><span class="p">:</span>
                        <span class="n">alerts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WARNING: Device </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> wear level high: </span><span class="si">{</span><span class="n">wear</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

    <span class="c1"># Display alerts</span>
    <span class="k">if</span> <span class="n">alerts</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">70</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ALERTS:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">alert</span> <span class="ow">in</span> <span class="n">alerts</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">alert</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">All devices appear healthy.&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="performance-benchmarking">
<h4><a class="toc-backref" href="#id24" role="doc-backlink">Performance Benchmarking</a><a class="headerlink" href="#performance-benchmarking" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1"># Storage Performance Benchmark Script</span>

<span class="nv">DEVICE</span><span class="o">=</span><span class="si">${</span><span class="nv">1</span><span class="k">:-</span><span class="p">/dev/sda</span><span class="si">}</span>
<span class="nv">TEST_FILE</span><span class="o">=</span><span class="s2">&quot;/tmp/storage_test&quot;</span>
<span class="nv">BLOCK_SIZES</span><span class="o">=(</span><span class="s2">&quot;4k&quot;</span><span class="w"> </span><span class="s2">&quot;64k&quot;</span><span class="w"> </span><span class="s2">&quot;1M&quot;</span><span class="w"> </span><span class="s2">&quot;16M&quot;</span><span class="o">)</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Storage Performance Benchmark for </span><span class="nv">$DEVICE</span><span class="s2">&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;==========================================&quot;</span>

<span class="c1"># Check if device exists</span>
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-b<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$DEVICE</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Error: Device </span><span class="nv">$DEVICE</span><span class="s2"> not found&quot;</span>
<span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="k">fi</span>

<span class="c1"># Install fio if not present</span>
<span class="k">if</span><span class="w"> </span>!<span class="w"> </span><span class="nb">command</span><span class="w"> </span>-v<span class="w"> </span>fio<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Installing fio benchmark tool...&quot;</span>
<span class="w">    </span>sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>fio
<span class="k">fi</span>

<span class="c1"># Sequential read test</span>
<span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;\n--- Sequential Read Test ---&quot;</span>
sudo<span class="w"> </span>fio<span class="w"> </span>--name<span class="o">=</span>seq_read<span class="w"> </span>--filename<span class="o">=</span><span class="nv">$DEVICE</span><span class="w"> </span>--rw<span class="o">=</span><span class="nb">read</span><span class="w"> </span>--bs<span class="o">=</span>1M<span class="w"> </span>--size<span class="o">=</span>1G<span class="w"> </span>--numjobs<span class="o">=</span><span class="m">1</span><span class="w"> </span>--runtime<span class="o">=</span><span class="m">30</span><span class="w"> </span>--group_reporting

<span class="c1"># Sequential write test</span>
<span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;\n--- Sequential Write Test ---&quot;</span>
sudo<span class="w"> </span>fio<span class="w"> </span>--name<span class="o">=</span>seq_write<span class="w"> </span>--filename<span class="o">=</span><span class="nv">$DEVICE</span><span class="w"> </span>--rw<span class="o">=</span>write<span class="w"> </span>--bs<span class="o">=</span>1M<span class="w"> </span>--size<span class="o">=</span>1G<span class="w"> </span>--numjobs<span class="o">=</span><span class="m">1</span><span class="w"> </span>--runtime<span class="o">=</span><span class="m">30</span><span class="w"> </span>--group_reporting

<span class="c1"># Random read test</span>
<span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;\n--- Random Read Test ---&quot;</span>
sudo<span class="w"> </span>fio<span class="w"> </span>--name<span class="o">=</span>rand_read<span class="w"> </span>--filename<span class="o">=</span><span class="nv">$DEVICE</span><span class="w"> </span>--rw<span class="o">=</span>randread<span class="w"> </span>--bs<span class="o">=</span>4k<span class="w"> </span>--size<span class="o">=</span>1G<span class="w"> </span>--numjobs<span class="o">=</span><span class="m">4</span><span class="w"> </span>--runtime<span class="o">=</span><span class="m">30</span><span class="w"> </span>--group_reporting

<span class="c1"># Random write test</span>
<span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;\n--- Random Write Test ---&quot;</span>
sudo<span class="w"> </span>fio<span class="w"> </span>--name<span class="o">=</span>rand_write<span class="w"> </span>--filename<span class="o">=</span><span class="nv">$DEVICE</span><span class="w"> </span>--rw<span class="o">=</span>randwrite<span class="w"> </span>--bs<span class="o">=</span>4k<span class="w"> </span>--size<span class="o">=</span>1G<span class="w"> </span>--numjobs<span class="o">=</span><span class="m">4</span><span class="w"> </span>--runtime<span class="o">=</span><span class="m">30</span><span class="w"> </span>--group_reporting

<span class="c1"># Mixed workload test</span>
<span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;\n--- Mixed Workload Test (70% read, 30% write) ---&quot;</span>
sudo<span class="w"> </span>fio<span class="w"> </span>--name<span class="o">=</span>mixed<span class="w"> </span>--filename<span class="o">=</span><span class="nv">$DEVICE</span><span class="w"> </span>--rw<span class="o">=</span>randrw<span class="w"> </span>--rwmixread<span class="o">=</span><span class="m">70</span><span class="w"> </span>--bs<span class="o">=</span>4k<span class="w"> </span>--size<span class="o">=</span>1G<span class="w"> </span>--numjobs<span class="o">=</span><span class="m">4</span><span class="w"> </span>--runtime<span class="o">=</span><span class="m">30</span><span class="w"> </span>--group_reporting
</pre></div>
</div>
</section>
</section>
<section id="device-selection-guidelines">
<h3><a class="toc-backref" href="#id25" role="doc-backlink">Device Selection Guidelines</a><a class="headerlink" href="#device-selection-guidelines" title="Link to this heading"></a></h3>
<section id="performance-considerations">
<h4><a class="toc-backref" href="#id26" role="doc-backlink">Performance Considerations</a><a class="headerlink" href="#performance-considerations" title="Link to this heading"></a></h4>
<p><strong>For Operating System:</strong>
* NVMe SSD for best performance
* SATA SSD as budget alternative
* Minimum 256GB capacity</p>
<p><strong>For Data Storage:</strong>
* Large HDDs for bulk storage
* SSDs for frequently accessed data
* Consider hybrid approach</p>
<p><strong>For Backup:</strong>
* External HDDs for local backup
* Tape drives for archival
* Cloud storage for offsite backup</p>
</section>
<section id="capacity-planning">
<h4><a class="toc-backref" href="#id27" role="doc-backlink">Capacity Planning</a><a class="headerlink" href="#capacity-planning" title="Link to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Storage Capacity Planning Calculator</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">calculate_storage_needs</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Storage Capacity Planning Calculator&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;====================================&quot;</span><span class="p">)</span>

    <span class="c1"># Get current usage</span>
    <span class="n">os_size</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Operating system size (GB): &quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;50&quot;</span><span class="p">)</span>
    <span class="n">apps_size</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Applications size (GB): &quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;100&quot;</span><span class="p">)</span>
    <span class="n">user_data</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Current user data (GB): &quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;500&quot;</span><span class="p">)</span>

    <span class="c1"># Growth projections</span>
    <span class="n">growth_rate</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Annual growth rate (%): &quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;20&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span>
    <span class="n">years</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Planning period (years): &quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;3&quot;</span><span class="p">)</span>

    <span class="c1"># Calculate projected needs</span>
    <span class="n">current_total</span> <span class="o">=</span> <span class="n">os_size</span> <span class="o">+</span> <span class="n">apps_size</span> <span class="o">+</span> <span class="n">user_data</span>
    <span class="n">projected_data</span> <span class="o">=</span> <span class="n">user_data</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">growth_rate</span><span class="p">)</span> <span class="o">**</span> <span class="n">years</span><span class="p">)</span>
    <span class="n">projected_total</span> <span class="o">=</span> <span class="n">os_size</span> <span class="o">+</span> <span class="n">apps_size</span> <span class="o">+</span> <span class="n">projected_data</span>

    <span class="c1"># Add overhead for performance and backup</span>
    <span class="n">overhead_factor</span> <span class="o">=</span> <span class="mf">1.3</span>  <span class="c1"># 30% overhead</span>
    <span class="n">recommended_capacity</span> <span class="o">=</span> <span class="n">projected_total</span> <span class="o">*</span> <span class="n">overhead_factor</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Capacity Analysis:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Current total usage: </span><span class="si">{</span><span class="n">current_total</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> GB&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Projected data growth: </span><span class="si">{</span><span class="n">projected_data</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> GB&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Projected total usage: </span><span class="si">{</span><span class="n">projected_total</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> GB&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Recommended capacity: </span><span class="si">{</span><span class="n">recommended_capacity</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> GB&quot;</span><span class="p">)</span>

    <span class="c1"># Storage recommendations</span>
    <span class="k">if</span> <span class="n">recommended_capacity</span> <span class="o">&lt;</span> <span class="mi">500</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Recommendation: 500GB SSD&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">recommended_capacity</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Recommendation: 1TB SSD or 1TB HDD + 256GB SSD&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">recommended_capacity</span> <span class="o">&lt;</span> <span class="mi">4000</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Recommendation: 4TB HDD + 512GB SSD (hybrid)&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Recommendation: Multiple drive configuration or NAS&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">calculate_storage_needs</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="common-issues-and-troubleshooting">
<h3><a class="toc-backref" href="#id28" role="doc-backlink">Common Issues and Troubleshooting</a><a class="headerlink" href="#common-issues-and-troubleshooting" title="Link to this heading"></a></h3>
<p><strong>Q: My SSD performance has degraded over time. What can I do?</strong></p>
<p>A: Check TRIM support, run secure erase, monitor wear leveling:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check TRIM support</span>
sudo<span class="w"> </span>fstrim<span class="w"> </span>-v<span class="w"> </span>/

<span class="c1"># Check SSD health</span>
sudo<span class="w"> </span>smartctl<span class="w"> </span>-A<span class="w"> </span>/dev/sda<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>Wear

<span class="c1"># Consider secure erase if needed</span>
sudo<span class="w"> </span>hdparm<span class="w"> </span>--user-master<span class="w"> </span>u<span class="w"> </span>--security-set-pass<span class="w"> </span>p<span class="w"> </span>/dev/sda
sudo<span class="w"> </span>hdparm<span class="w"> </span>--user-master<span class="w"> </span>u<span class="w"> </span>--security-erase<span class="w"> </span>p<span class="w"> </span>/dev/sda
</pre></div>
</div>
<p><strong>Q: How do I recover data from a failing HDD?</strong></p>
<p>A: Use ddrescue for data recovery:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install ddrescue</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>gddrescue

<span class="c1"># Create image of failing drive</span>
sudo<span class="w"> </span>ddrescue<span class="w"> </span>-f<span class="w"> </span>-n<span class="w"> </span>/dev/sda<span class="w"> </span>/mnt/backup/drive_image.img<span class="w"> </span>/mnt/backup/recovery.log

<span class="c1"># Mount image for data recovery</span>
sudo<span class="w"> </span>mount<span class="w"> </span>-o<span class="w"> </span>loop,ro<span class="w"> </span>/mnt/backup/drive_image.img<span class="w"> </span>/mnt/recovery
</pre></div>
</div>
<p><strong>Q: My USB drive is not recognized. How to troubleshoot?</strong></p>
<p>A: Check USB subsystem and device recognition:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check USB subsystem</span>
lsusb
dmesg<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-20

<span class="c1"># Check block devices</span>
lsblk

<span class="c1"># Try different USB port</span>
<span class="c1"># Check filesystem</span>
sudo<span class="w"> </span>fsck<span class="w"> </span>/dev/sdb1
</pre></div>
</div>
</section>
<section id="best-practices">
<h3><a class="toc-backref" href="#id29" role="doc-backlink">Best Practices</a><a class="headerlink" href="#best-practices" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p><strong>Regular Monitoring</strong>
- Monitor SMART health data
- Check temperatures regularly
- Track performance metrics</p></li>
<li><p><strong>Preventive Maintenance</strong>
- Enable TRIM for SSDs
- Regular defragmentation for HDDs (if needed)
- Clean physical connections</p></li>
<li><p><strong>Data Protection</strong>
- Implement RAID where appropriate
- Regular backups
- Test restore procedures</p></li>
<li><p><strong>Performance Optimization</strong>
- Use appropriate I/O schedulers
- Optimize filesystem parameters
- Consider caching strategies</p></li>
<li><p><strong>Lifecycle Management</strong>
- Plan for device replacement
- Monitor wear indicators
- Secure data wiping when disposing</p></li>
</ol>
</section>
<section id="see-also">
<h3><a class="toc-backref" href="#id30" role="doc-backlink">See Also</a><a class="headerlink" href="#see-also" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference internal" href="#document-disk-management"><span class="doc">Disk Management</span></a></p></li>
<li><p><a class="reference internal" href="#document-file-systems"><span class="doc">File Systems</span></a></p></li>
<li><p><a class="reference internal" href="#document-raid-systems"><span class="doc">RAID Systems</span></a></p></li>
<li><p><a class="reference internal" href="#document-volume-management"><span class="doc">Volume Management</span></a></p></li>
</ul>
</section>
</section>
</div>
<div class="toctree-wrapper compound">
<span id="document-ubuntu-setup"></span><section id="ubuntu-22-04-setup-and-configuration">
<h2>Ubuntu 22.04 Setup and Configuration<a class="headerlink" href="#ubuntu-22-04-setup-and-configuration" title="Link to this heading"></a></h2>
<section id="ubuntu-22-04-lts-storage-setup">
<h3>Ubuntu 22.04 LTS Storage Setup<a class="headerlink" href="#ubuntu-22-04-lts-storage-setup" title="Link to this heading"></a></h3>
<p>Ubuntu 22.04 LTS (Jammy Jellyfish) provides excellent storage capabilities out of the box. This section covers the complete setup and configuration process for optimal storage management.</p>
<section id="system-requirements-and-preparation">
<h4>System Requirements and Preparation<a class="headerlink" href="#system-requirements-and-preparation" title="Link to this heading"></a></h4>
<section id="minimum-system-requirements">
<h5>Minimum System Requirements<a class="headerlink" href="#minimum-system-requirements" title="Link to this heading"></a></h5>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Component          | Minimum         | Recommended
-------------------|-----------------|------------------
RAM                | 4 GB           | 8 GB or more
Storage            | 25 GB          | 100 GB or more
CPU                | 2 GHz dual-core| 2 GHz quad-core
Graphics           | VGA capable    | GPU with driver support
</pre></div>
</div>
</section>
<section id="pre-installation-planning">
<h5>Pre-Installation Planning<a class="headerlink" href="#pre-installation-planning" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check hardware compatibility</span>
lshw<span class="w"> </span>-short
lscpu
lsmem
lsblk

<span class="c1"># Check UEFI/BIOS mode</span>
<span class="o">[</span><span class="w"> </span>-d<span class="w"> </span>/sys/firmware/efi<span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;UEFI&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;BIOS&quot;</span>

<span class="c1"># Verify secure boot status</span>
mokutil<span class="w"> </span>--sb-state
</pre></div>
</div>
</section>
</section>
<section id="storage-focused-installation">
<h4>Storage-Focused Installation<a class="headerlink" href="#storage-focused-installation" title="Link to this heading"></a></h4>
<section id="partitioning-strategies">
<h5>Partitioning Strategies<a class="headerlink" href="#partitioning-strategies" title="Link to this heading"></a></h5>
<p><strong>Option 1: Simple Layout (Recommended for most users)</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Device    | Mount Point | Size      | Filesystem | Purpose
----------|-------------|-----------|------------|------------------
/dev/sda1 | /boot/efi   | 512 MB    | FAT32      | EFI System
/dev/sda2 | /           | 50-100 GB | ext4       | Root filesystem
/dev/sda3 | /home       | Remaining | ext4       | User data
/dev/sda4 | [SWAP]      | 2x RAM    | swap       | Virtual memory
</pre></div>
</div>
<p><strong>Option 2: Advanced Layout (For servers/power users)</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Device    | Mount Point | Size      | Filesystem | Purpose
----------|-------------|-----------|------------|------------------
/dev/sda1 | /boot/efi   | 512 MB    | FAT32      | EFI System
/dev/sda2 | /boot       | 1 GB      | ext4       | Boot files
/dev/sda3 | /           | 20 GB     | ext4       | Root filesystem
/dev/sda4 | /var        | 20 GB     | ext4       | Variable data
/dev/sda5 | /tmp        | 5 GB      | ext4       | Temporary files
/dev/sda6 | /home       | Remaining | ext4       | User data
/dev/sda7 | [SWAP]      | 2x RAM    | swap       | Virtual memory
</pre></div>
</div>
</section>
<section id="manual-partitioning-with-fdisk">
<h5>Manual Partitioning with fdisk<a class="headerlink" href="#manual-partitioning-with-fdisk" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Start partitioning</span>
sudo<span class="w"> </span>fdisk<span class="w"> </span>/dev/sda

<span class="c1"># Create GPT partition table</span>
Command:<span class="w"> </span>g

<span class="c1"># Create EFI partition</span>
Command:<span class="w"> </span>n
Partition<span class="w"> </span>number:<span class="w"> </span><span class="m">1</span>
First<span class="w"> </span>sector:<span class="w"> </span><span class="o">(</span>default<span class="o">)</span>
Last<span class="w"> </span>sector:<span class="w"> </span>+512M
Command:<span class="w"> </span>t
Partition<span class="w"> </span>type:<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">(</span>EFI<span class="w"> </span>System<span class="o">)</span>

<span class="c1"># Create root partition</span>
Command:<span class="w"> </span>n
Partition<span class="w"> </span>number:<span class="w"> </span><span class="m">2</span>
First<span class="w"> </span>sector:<span class="w"> </span><span class="o">(</span>default<span class="o">)</span>
Last<span class="w"> </span>sector:<span class="w"> </span>+50G
<span class="c1"># (ext4 by default)</span>

<span class="c1"># Create home partition</span>
Command:<span class="w"> </span>n
Partition<span class="w"> </span>number:<span class="w"> </span><span class="m">3</span>
First<span class="w"> </span>sector:<span class="w"> </span><span class="o">(</span>default<span class="o">)</span>
Last<span class="w"> </span>sector:<span class="w"> </span><span class="o">(</span>default<span class="w"> </span>-<span class="w"> </span>use<span class="w"> </span>remaining<span class="w"> </span>space<span class="o">)</span>

<span class="c1"># Write changes</span>
Command:<span class="w"> </span>w
</pre></div>
</div>
</section>
<section id="lvm-setup-for-flexible-storage">
<h5>LVM Setup for Flexible Storage<a class="headerlink" href="#lvm-setup-for-flexible-storage" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install LVM tools</span>
sudo<span class="w"> </span>apt<span class="w"> </span>update
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>lvm2

<span class="c1"># Create physical volume</span>
sudo<span class="w"> </span>pvcreate<span class="w"> </span>/dev/sda3

<span class="c1"># Create volume group</span>
sudo<span class="w"> </span>vgcreate<span class="w"> </span>ubuntu-vg<span class="w"> </span>/dev/sda3

<span class="c1"># Create logical volumes</span>
sudo<span class="w"> </span>lvcreate<span class="w"> </span>-L<span class="w"> </span>20G<span class="w"> </span>-n<span class="w"> </span>root<span class="w"> </span>ubuntu-vg
sudo<span class="w"> </span>lvcreate<span class="w"> </span>-L<span class="w"> </span>10G<span class="w"> </span>-n<span class="w"> </span>var<span class="w"> </span>ubuntu-vg
sudo<span class="w"> </span>lvcreate<span class="w"> </span>-L<span class="w"> </span>5G<span class="w"> </span>-n<span class="w"> </span>tmp<span class="w"> </span>ubuntu-vg
sudo<span class="w"> </span>lvcreate<span class="w"> </span>-l<span class="w"> </span><span class="m">100</span>%FREE<span class="w"> </span>-n<span class="w"> </span>home<span class="w"> </span>ubuntu-vg

<span class="c1"># Format logical volumes</span>
sudo<span class="w"> </span>mkfs.ext4<span class="w"> </span>/dev/ubuntu-vg/root
sudo<span class="w"> </span>mkfs.ext4<span class="w"> </span>/dev/ubuntu-vg/var
sudo<span class="w"> </span>mkfs.ext4<span class="w"> </span>/dev/ubuntu-vg/tmp
sudo<span class="w"> </span>mkfs.ext4<span class="w"> </span>/dev/ubuntu-vg/home
</pre></div>
</div>
</section>
</section>
<section id="post-installation-storage-configuration">
<h4>Post-Installation Storage Configuration<a class="headerlink" href="#post-installation-storage-configuration" title="Link to this heading"></a></h4>
<section id="update-system-and-install-essential-tools">
<h5>Update System and Install Essential Tools<a class="headerlink" href="#update-system-and-install-essential-tools" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Update package lists and system</span>
sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>upgrade<span class="w"> </span>-y

<span class="c1"># Install essential storage tools</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span><span class="se">\\</span>
<span class="w">    </span>gdisk<span class="w"> </span><span class="se">\\</span>
<span class="w">    </span>parted<span class="w"> </span><span class="se">\\</span>
<span class="w">    </span>gparted<span class="w"> </span><span class="se">\\</span>
<span class="w">    </span>lvm2<span class="w"> </span><span class="se">\\</span>
<span class="w">    </span>mdadm<span class="w"> </span><span class="se">\\</span>
<span class="w">    </span>smartmontools<span class="w"> </span><span class="se">\\</span>
<span class="w">    </span>hdparm<span class="w"> </span><span class="se">\\</span>
<span class="w">    </span>iotop<span class="w"> </span><span class="se">\\</span>
<span class="w">    </span>htop<span class="w"> </span><span class="se">\\</span>
<span class="w">    </span>tree<span class="w"> </span><span class="se">\\</span>
<span class="w">    </span>ncdu<span class="w"> </span><span class="se">\\</span>
<span class="w">    </span>rsync<span class="w"> </span><span class="se">\\</span>
<span class="w">    </span>rclone<span class="w"> </span><span class="se">\\</span>
<span class="w">    </span>fdupes<span class="w"> </span><span class="se">\\</span>
<span class="w">    </span>testdisk<span class="w"> </span><span class="se">\\</span>
<span class="w">    </span>ddrescue<span class="w"> </span><span class="se">\\</span>
<span class="w">    </span>safecopy

<span class="c1"># Install filesystem tools</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span><span class="se">\\</span>
<span class="w">    </span>xfsprogs<span class="w"> </span><span class="se">\\</span>
<span class="w">    </span>btrfs-progs<span class="w"> </span><span class="se">\\</span>
<span class="w">    </span>ntfs-3g<span class="w"> </span><span class="se">\\</span>
<span class="w">    </span>exfat-fuse<span class="w"> </span><span class="se">\\</span>
<span class="w">    </span>exfat-utils
</pre></div>
</div>
</section>
<section id="configure-storage-monitoring">
<h5>Configure Storage Monitoring<a class="headerlink" href="#configure-storage-monitoring" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Enable and configure SMART monitoring</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>smartmontools
sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>smartmontools

<span class="c1"># Configure smartd</span>
sudo<span class="w"> </span>nano<span class="w"> </span>/etc/smartd.conf
<span class="c1"># Add: /dev/sda -a -o on -S on -s (S/../.././02|L/../../6/03)</span>

<span class="c1"># Enable automatic TRIM for SSDs</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>fstrim.timer
sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>fstrim.timer

<span class="c1"># Verify TRIM is working</span>
sudo<span class="w"> </span>fstrim<span class="w"> </span>-v<span class="w"> </span>/
</pre></div>
</div>
</section>
<section id="optimize-storage-performance">
<h5>Optimize Storage Performance<a class="headerlink" href="#optimize-storage-performance" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check current I/O scheduler</span>
cat<span class="w"> </span>/sys/block/sda/queue/scheduler

<span class="c1"># Set optimal I/O scheduler for SSDs</span>
<span class="nb">echo</span><span class="w"> </span>none<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/sys/block/sda/queue/scheduler

<span class="c1"># Set optimal I/O scheduler for HDDs</span>
<span class="nb">echo</span><span class="w"> </span>mq-deadline<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/sys/block/sda/queue/scheduler

<span class="c1"># Make scheduler change permanent</span>
<span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;ACTION==&quot;add|change&quot;, KERNEL==&quot;sd[a-z]&quot;, ATTR{queue/rotational}==&quot;0&quot;, ATTR{queue/scheduler}=&quot;none&quot;&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/udev/rules.d/60-ioschedulers.rules
<span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;ACTION==&quot;add|change&quot;, KERNEL==&quot;sd[a-z]&quot;, ATTR{queue/rotational}==&quot;1&quot;, ATTR{queue/scheduler}=&quot;mq-deadline&quot;&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/udev/rules.d/60-ioschedulers.rules
</pre></div>
</div>
</section>
</section>
<section id="storage-security-configuration">
<h4>Storage Security Configuration<a class="headerlink" href="#storage-security-configuration" title="Link to this heading"></a></h4>
<section id="full-disk-encryption-with-luks">
<h5>Full Disk Encryption with LUKS<a class="headerlink" href="#full-disk-encryption-with-luks" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install cryptsetup</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>cryptsetup

<span class="c1"># Encrypt a partition</span>
sudo<span class="w"> </span>cryptsetup<span class="w"> </span>luksFormat<span class="w"> </span>/dev/sdb1

<span class="c1"># Open encrypted partition</span>
sudo<span class="w"> </span>cryptsetup<span class="w"> </span>luksOpen<span class="w"> </span>/dev/sdb1<span class="w"> </span>encrypted_drive

<span class="c1"># Create filesystem on encrypted partition</span>
sudo<span class="w"> </span>mkfs.ext4<span class="w"> </span>/dev/mapper/encrypted_drive

<span class="c1"># Mount encrypted partition</span>
sudo<span class="w"> </span>mkdir<span class="w"> </span>/mnt/encrypted
sudo<span class="w"> </span>mount<span class="w"> </span>/dev/mapper/encrypted_drive<span class="w"> </span>/mnt/encrypted

<span class="c1"># Add to /etc/crypttab for automatic mounting</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;encrypted_drive /dev/sdb1 none luks&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/crypttab

<span class="c1"># Add to /etc/fstab</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;/dev/mapper/encrypted_drive /mnt/encrypted ext4 defaults 0 2&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/fstab
</pre></div>
</div>
</section>
<section id="file-permissions-and-access-control">
<h5>File Permissions and Access Control<a class="headerlink" href="#file-permissions-and-access-control" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set up secure permissions for user data</span>
sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">750</span><span class="w"> </span>/home/username
sudo<span class="w"> </span>chown<span class="w"> </span>username:username<span class="w"> </span>/home/username

<span class="c1"># Create shared directories with proper permissions</span>
sudo<span class="w"> </span>mkdir<span class="w"> </span>/shared
sudo<span class="w"> </span>chown<span class="w"> </span>root:users<span class="w"> </span>/shared
sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">2775</span><span class="w"> </span>/shared

<span class="c1"># Set up ACLs for fine-grained control</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>acl

<span class="c1"># Example: Give user read/write access to specific directory</span>
sudo<span class="w"> </span>setfacl<span class="w"> </span>-m<span class="w"> </span>u:username:rw<span class="w"> </span>/path/to/directory
sudo<span class="w"> </span>setfacl<span class="w"> </span>-m<span class="w"> </span>g:groupname:r<span class="w"> </span>/path/to/directory
</pre></div>
</div>
</section>
</section>
<section id="backup-and-recovery-setup">
<h4>Backup and Recovery Setup<a class="headerlink" href="#backup-and-recovery-setup" title="Link to this heading"></a></h4>
<section id="automated-backup-configuration">
<h5>Automated Backup Configuration<a class="headerlink" href="#automated-backup-configuration" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create backup directories</span>
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/backup/<span class="o">{</span>daily,weekly,monthly<span class="o">}</span>
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/backup/system/<span class="o">{</span>etc,home,var<span class="o">}</span>

<span class="c1"># Install backup tools</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>rsync<span class="w"> </span>borgbackup<span class="w"> </span>duplicity

<span class="c1"># Create backup script</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>/usr/local/bin/backup_system.sh<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s">#!/bin/bash</span>

<span class="s">BACKUP_DIR=&quot;/backup&quot;</span>
<span class="s">DATE=$(date +%Y%m%d_%H%M%S)</span>
<span class="s">LOG_FILE=&quot;/var/log/backup.log&quot;</span>

<span class="s">log_message() {</span>
<span class="s">    echo &quot;$(date &#39;+%Y-%m-%d %H:%M:%S&#39;) - $1&quot; | tee -a &quot;$LOG_FILE&quot;</span>
<span class="s">}</span>

<span class="s"># Backup system configuration</span>
<span class="s">backup_system() {</span>
<span class="s">    log_message &quot;Starting system backup&quot;</span>

<span class="s">    # Backup /etc</span>
<span class="s">    rsync -av /etc/ &quot;$BACKUP_DIR/system/etc/&quot;</span>

<span class="s">    # Backup user homes</span>
<span class="s">    rsync -av /home/ &quot;$BACKUP_DIR/system/home/&quot; --exclude=&quot;.cache&quot;</span>

<span class="s">    # Backup important /var directories</span>
<span class="s">    rsync -av /var/log/ &quot;$BACKUP_DIR/system/var/log/&quot;</span>
<span class="s">    rsync -av /var/lib/dpkg/ &quot;$BACKUP_DIR/system/var/lib/dpkg/&quot;</span>

<span class="s">    log_message &quot;System backup completed&quot;</span>
<span class="s">}</span>

<span class="s"># Backup user data</span>
<span class="s">backup_data() {</span>
<span class="s">    log_message &quot;Starting data backup&quot;</span>

<span class="s">    for user_dir in /home/*; do</span>
<span class="s">        if [ -d &quot;$user_dir&quot; ]; then</span>
<span class="s">            username=$(basename &quot;$user_dir&quot;)</span>
<span class="s">            rsync -av &quot;$user_dir/&quot; &quot;$BACKUP_DIR/daily/$username/&quot; \\</span>
<span class="s">                --exclude=&quot;.cache&quot; \\</span>
<span class="s">                --exclude=&quot;.thumbnails&quot; \\</span>
<span class="s">                --exclude=&quot;Downloads&quot;</span>
<span class="s">        fi</span>
<span class="s">    done</span>

<span class="s">    log_message &quot;Data backup completed&quot;</span>
<span class="s">}</span>

<span class="s"># Create compressed archive</span>
<span class="s">create_archive() {</span>
<span class="s">    log_message &quot;Creating compressed archive&quot;</span>

<span class="s">    tar -czf &quot;$BACKUP_DIR/archive/backup_$DATE.tar.gz&quot; \\</span>
<span class="s">        -C &quot;$BACKUP_DIR&quot; daily system</span>

<span class="s">    # Remove archives older than 30 days</span>
<span class="s">    find &quot;$BACKUP_DIR/archive&quot; -name &quot;*.tar.gz&quot; -mtime +30 -delete</span>

<span class="s">    log_message &quot;Archive created: backup_$DATE.tar.gz&quot;</span>
<span class="s">}</span>

<span class="s"># Main execution</span>
<span class="s">mkdir -p &quot;$BACKUP_DIR/archive&quot;</span>
<span class="s">backup_system</span>
<span class="s">backup_data</span>
<span class="s">create_archive</span>

<span class="s"># Send notification</span>
<span class="s">echo &quot;Backup completed on $(hostname) at $(date)&quot; | \\</span>
<span class="s">    mail -s &quot;Backup Report&quot; admin@localhost 2&gt;/dev/null || true</span>
<span class="s">EOF</span>

chmod<span class="w"> </span>+x<span class="w"> </span>/usr/local/bin/backup_system.sh

<span class="c1"># Schedule backup with cron</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;0 2 * * * /usr/local/bin/backup_system.sh&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>crontab<span class="w"> </span>-
</pre></div>
</div>
</section>
</section>
<section id="storage-monitoring-and-alerts">
<h4>Storage Monitoring and Alerts<a class="headerlink" href="#storage-monitoring-and-alerts" title="Link to this heading"></a></h4>
<section id="system-health-monitoring">
<h5>System Health Monitoring<a class="headerlink" href="#system-health-monitoring" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create monitoring script</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>/usr/local/bin/storage_monitor.sh<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s">#!/bin/bash</span>

<span class="s">LOG_FILE=&quot;/var/log/storage_monitor.log&quot;</span>
<span class="s">ALERT_THRESHOLD=85</span>
<span class="s">SMART_LOG=&quot;/var/log/smart_check.log&quot;</span>

<span class="s">log_message() {</span>
<span class="s">    echo &quot;$(date &#39;+%Y-%m-%d %H:%M:%S&#39;) - $1&quot; | tee -a &quot;$LOG_FILE&quot;</span>
<span class="s">}</span>

<span class="s"># Check disk usage</span>
<span class="s">check_disk_usage() {</span>
<span class="s">    log_message &quot;Checking disk usage&quot;</span>

<span class="s">    df -h | grep -vE &#39;^Filesystem|tmpfs|cdrom&#39; | awk &#39;{print $5 &quot; &quot; $1 &quot; &quot; $6}&#39; | while read usage device mount; do</span>
<span class="s">        usage_percent=$(echo $usage | sed &#39;s/%//g&#39;)</span>

<span class="s">        if [ $usage_percent -ge $ALERT_THRESHOLD ]; then</span>
<span class="s">            log_message &quot;ALERT: $device ($mount) is ${usage_percent}% full&quot;</span>
<span class="s">            echo &quot;Disk usage alert: $device ($mount) is ${usage_percent}% full&quot; | \\</span>
<span class="s">                mail -s &quot;Disk Usage Alert - $(hostname)&quot; admin@localhost</span>
<span class="s">        fi</span>
<span class="s">    done</span>
<span class="s">}</span>

<span class="s"># Check SMART status</span>
<span class="s">check_smart_status() {</span>
<span class="s">    log_message &quot;Checking SMART status&quot;</span>

<span class="s">    for device in /dev/sd[a-z]; do</span>
<span class="s">        if [ -b &quot;$device&quot; ]; then</span>
<span class="s">            smart_status=$(smartctl -H &quot;$device&quot; 2&gt;/dev/null | grep &quot;SMART overall-health&quot; | awk &#39;{print $6}&#39;)</span>

<span class="s">            if [ &quot;$smart_status&quot; = &quot;PASSED&quot; ]; then</span>
<span class="s">                log_message &quot;$device: SMART status OK&quot;</span>
<span class="s">            elif [ &quot;$smart_status&quot; = &quot;FAILED&quot; ]; then</span>
<span class="s">                log_message &quot;ALERT: $device SMART status FAILED&quot;</span>
<span class="s">                echo &quot;SMART failure detected on $device&quot; | \\</span>
<span class="s">                    mail -s &quot;SMART Failure Alert - $(hostname)&quot; admin@localhost</span>
<span class="s">            fi</span>

<span class="s">            # Log detailed SMART info</span>
<span class="s">            smartctl -a &quot;$device&quot; &gt;&gt; &quot;$SMART_LOG&quot;</span>
<span class="s">        fi</span>
<span class="s">    done</span>
<span class="s">}</span>

<span class="s"># Check filesystem errors</span>
<span class="s">check_filesystem_errors() {</span>
<span class="s">    log_message &quot;Checking filesystem errors&quot;</span>

<span class="s">    # Check dmesg for filesystem errors</span>
<span class="s">    if dmesg | grep -i &quot;error\|fault\|fail&quot; | grep -i &quot;ext4\|xfs\|btrfs&quot; &gt; /dev/null; then</span>
<span class="s">        log_message &quot;ALERT: Filesystem errors detected in dmesg&quot;</span>
<span class="s">        dmesg | grep -i &quot;error\|fault\|fail&quot; | grep -i &quot;ext4\|xfs\|btrfs&quot; | \\</span>
<span class="s">            mail -s &quot;Filesystem Error Alert - $(hostname)&quot; admin@localhost</span>
<span class="s">    fi</span>
<span class="s">}</span>

<span class="s"># Check RAID status (if applicable)</span>
<span class="s">check_raid_status() {</span>
<span class="s">    if [ -f /proc/mdstat ]; then</span>
<span class="s">        log_message &quot;Checking RAID status&quot;</span>

<span class="s">        if grep -q &quot;_&quot; /proc/mdstat; then</span>
<span class="s">            log_message &quot;ALERT: RAID degraded state detected&quot;</span>
<span class="s">            cat /proc/mdstat | mail -s &quot;RAID Alert - $(hostname)&quot; admin@localhost</span>
<span class="s">        fi</span>
<span class="s">    fi</span>
<span class="s">}</span>

<span class="s"># Main execution</span>
<span class="s">check_disk_usage</span>
<span class="s">check_smart_status</span>
<span class="s">check_filesystem_errors</span>
<span class="s">check_raid_status</span>

<span class="s">log_message &quot;Storage monitoring completed&quot;</span>
<span class="s">EOF</span>

chmod<span class="w"> </span>+x<span class="w"> </span>/usr/local/bin/storage_monitor.sh

<span class="c1"># Schedule monitoring</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;0 */6 * * * /usr/local/bin/storage_monitor.sh&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>crontab<span class="w"> </span>-
</pre></div>
</div>
</section>
</section>
<section id="performance-optimization">
<h4>Performance Optimization<a class="headerlink" href="#performance-optimization" title="Link to this heading"></a></h4>
<section id="kernel-parameter-tuning">
<h5>Kernel Parameter Tuning<a class="headerlink" href="#kernel-parameter-tuning" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create performance tuning configuration</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>/etc/sysctl.d/99-storage-performance.conf<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s"># Storage performance optimizations</span>

<span class="s"># Increase dirty page writeback interval</span>
<span class="s">vm.dirty_writeback_centisecs = 500</span>

<span class="s"># Increase dirty page ratio</span>
<span class="s">vm.dirty_ratio = 20</span>
<span class="s">vm.dirty_background_ratio = 10</span>

<span class="s"># Optimize memory management</span>
<span class="s">vm.swappiness = 10</span>
<span class="s">vm.vfs_cache_pressure = 50</span>

<span class="s"># Increase inotify limits</span>
<span class="s">fs.inotify.max_user_watches = 524288</span>
<span class="s">fs.inotify.max_user_instances = 256</span>

<span class="s"># Optimize network buffer sizes (for network storage)</span>
<span class="s">net.core.rmem_max = 134217728</span>
<span class="s">net.core.wmem_max = 134217728</span>
<span class="s">EOF</span>

<span class="c1"># Apply settings</span>
sudo<span class="w"> </span>sysctl<span class="w"> </span>-p<span class="w"> </span>/etc/sysctl.d/99-storage-performance.conf
</pre></div>
</div>
</section>
<section id="mount-options-optimization">
<h5>Mount Options Optimization<a class="headerlink" href="#mount-options-optimization" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Optimize /etc/fstab for performance</span>
sudo<span class="w"> </span>cp<span class="w"> </span>/etc/fstab<span class="w"> </span>/etc/fstab.backup

<span class="c1"># Example optimized fstab entries</span>
cat<span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/fstab<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s"># Optimized mount options</span>
<span class="s"># SSD mounts with noatime and discard</span>
<span class="s">UUID=your-ssd-uuid /home ext4 defaults,noatime,discard 0 2</span>

<span class="s"># HDD mounts with relatime</span>
<span class="s">UUID=your-hdd-uuid /data ext4 defaults,relatime 0 2</span>

<span class="s"># Temporary filesystems in RAM</span>
<span class="s">tmpfs /tmp tmpfs defaults,noatime,mode=1777,size=2G 0 0</span>
<span class="s">tmpfs /var/tmp tmpfs defaults,noatime,mode=1777,size=1G 0 0</span>
<span class="s">EOF</span>
</pre></div>
</div>
</section>
</section>
<section id="frequently-asked-questions">
<h4>Frequently Asked Questions<a class="headerlink" href="#frequently-asked-questions" title="Link to this heading"></a></h4>
<section id="q-how-do-i-check-if-my-system-is-using-uefi-or-bios">
<h5>Q: How do I check if my system is using UEFI or BIOS?<a class="headerlink" href="#q-how-do-i-check-if-my-system-is-using-uefi-or-bios" title="Link to this heading"></a></h5>
<p><strong>A:</strong> Use these commands to determine your boot mode:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check for UEFI</span>
<span class="o">[</span><span class="w"> </span>-d<span class="w"> </span>/sys/firmware/efi<span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;UEFI boot&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;BIOS boot&quot;</span>

<span class="c1"># Check boot mode in more detail</span>
bootctl<span class="w"> </span>status

<span class="c1"># List EFI variables (UEFI only)</span>
efibootmgr<span class="w"> </span>-v
</pre></div>
</div>
</section>
<section id="q-what-filesystem-should-i-use-for-different-use-cases">
<h5>Q: What filesystem should I use for different use cases?<a class="headerlink" href="#q-what-filesystem-should-i-use-for-different-use-cases" title="Link to this heading"></a></h5>
<p><strong>A:</strong> Recommended filesystems by use case:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Use Case                | Recommended Filesystem | Reason
------------------------|------------------------|------------------
Root partition (/)      | ext4                  | Stable, well-tested
Boot partition (/boot)  | ext4                  | Simple, reliable
Home directories        | ext4                  | Good performance
Large files/media       | XFS                   | Better large file handling
Snapshots needed        | Btrfs                 | Built-in snapshots
Windows compatibility   | NTFS                  | Cross-platform access
USB drives             | exFAT                 | Universal compatibility
</pre></div>
</div>
</section>
<section id="q-how-do-i-resize-partitions-safely-in-ubuntu-22-04">
<h5>Q: How do I resize partitions safely in Ubuntu 22.04?<a class="headerlink" href="#q-how-do-i-resize-partitions-safely-in-ubuntu-22-04" title="Link to this heading"></a></h5>
<p><strong>A:</strong> Follow these steps for safe partition resizing:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. BACKUP YOUR DATA FIRST!</span>

<span class="c1"># 2. For ext4 filesystems:</span>
<span class="c1"># Unmount the partition</span>
sudo<span class="w"> </span>umount<span class="w"> </span>/dev/sda2

<span class="c1"># Check filesystem</span>
sudo<span class="w"> </span>fsck<span class="w"> </span>-f<span class="w"> </span>/dev/sda2

<span class="c1"># Resize partition with parted</span>
sudo<span class="w"> </span>parted<span class="w"> </span>/dev/sda<span class="w"> </span>resizepart<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">100</span>%

<span class="c1"># Resize filesystem to match partition</span>
sudo<span class="w"> </span>resize2fs<span class="w"> </span>/dev/sda2

<span class="c1"># 3. For LVM volumes:</span>
<span class="c1"># Extend physical volume</span>
sudo<span class="w"> </span>pvresize<span class="w"> </span>/dev/sda3

<span class="c1"># Extend logical volume</span>
sudo<span class="w"> </span>lvextend<span class="w"> </span>-l<span class="w"> </span>+100%FREE<span class="w"> </span>/dev/ubuntu-vg/home

<span class="c1"># Resize filesystem</span>
sudo<span class="w"> </span>resize2fs<span class="w"> </span>/dev/ubuntu-vg/home
</pre></div>
</div>
</section>
<section id="q-how-do-i-set-up-automatic-mounting-for-external-drives">
<h5>Q: How do I set up automatic mounting for external drives?<a class="headerlink" href="#q-how-do-i-set-up-automatic-mounting-for-external-drives" title="Link to this heading"></a></h5>
<p><strong>A:</strong> Configure automatic mounting:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. Get device UUID</span>
sudo<span class="w"> </span>blkid<span class="w"> </span>/dev/sdb1

<span class="c1"># 2. Create mount point</span>
sudo<span class="w"> </span>mkdir<span class="w"> </span>/mnt/external

<span class="c1"># 3. Add to fstab</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;UUID=your-device-uuid /mnt/external ext4 defaults,user,noauto 0 0&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/fstab

<span class="c1"># 4. Test mounting</span>
mount<span class="w"> </span>/mnt/external

<span class="c1"># 5. For auto-mount on insertion (using udev rules)</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>/etc/udev/rules.d/99-usb-mount.rules<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s"># Auto-mount USB drives</span>
<span class="s">KERNEL==&quot;sd[a-z][0-9]&quot;, SUBSYSTEMS==&quot;usb&quot;, ACTION==&quot;add&quot;, RUN+=&quot;/usr/local/bin/usb-mount.sh %k&quot;</span>
<span class="s">KERNEL==&quot;sd[a-z][0-9]&quot;, SUBSYSTEMS==&quot;usb&quot;, ACTION==&quot;remove&quot;, RUN+=&quot;/usr/local/bin/usb-unmount.sh %k&quot;</span>
<span class="s">EOF</span>
</pre></div>
</div>
</section>
</section>
<section id="troubleshooting-common-issues">
<h4>Troubleshooting Common Issues<a class="headerlink" href="#troubleshooting-common-issues" title="Link to this heading"></a></h4>
<section id="boot-issues">
<h5>Boot Issues<a class="headerlink" href="#boot-issues" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Repair GRUB bootloader</span>
sudo<span class="w"> </span>grub-install<span class="w"> </span>/dev/sda
sudo<span class="w"> </span>update-grub

<span class="c1"># Boot from live USB and repair</span>
sudo<span class="w"> </span>mount<span class="w"> </span>/dev/sda2<span class="w"> </span>/mnt
sudo<span class="w"> </span>mount<span class="w"> </span>/dev/sda1<span class="w"> </span>/mnt/boot/efi
sudo<span class="w"> </span>mount<span class="w"> </span>--bind<span class="w"> </span>/dev<span class="w"> </span>/mnt/dev
sudo<span class="w"> </span>mount<span class="w"> </span>--bind<span class="w"> </span>/proc<span class="w"> </span>/mnt/proc
sudo<span class="w"> </span>mount<span class="w"> </span>--bind<span class="w"> </span>/sys<span class="w"> </span>/mnt/sys
sudo<span class="w"> </span>chroot<span class="w"> </span>/mnt
grub-install<span class="w"> </span>/dev/sda
update-grub
<span class="nb">exit</span>
</pre></div>
</div>
</section>
<section id="filesystem-corruption">
<h5>Filesystem Corruption<a class="headerlink" href="#filesystem-corruption" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check and repair ext4 filesystem</span>
sudo<span class="w"> </span>fsck.ext4<span class="w"> </span>-f<span class="w"> </span>/dev/sda2

<span class="c1"># For automatic repair</span>
sudo<span class="w"> </span>fsck.ext4<span class="w"> </span>-p<span class="w"> </span>/dev/sda2

<span class="c1"># For interactive repair</span>
sudo<span class="w"> </span>fsck.ext4<span class="w"> </span>/dev/sda2

<span class="c1"># Check XFS filesystem</span>
sudo<span class="w"> </span>xfs_check<span class="w"> </span>/dev/sda2

<span class="c1"># Repair XFS filesystem</span>
sudo<span class="w"> </span>xfs_repair<span class="w"> </span>/dev/sda2
</pre></div>
</div>
</section>
<section id="disk-space-issues">
<h5>Disk Space Issues<a class="headerlink" href="#disk-space-issues" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find large files</span>
sudo<span class="w"> </span>find<span class="w"> </span>/<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-size<span class="w"> </span>+100M<span class="w"> </span>-exec<span class="w"> </span>ls<span class="w"> </span>-lh<span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\\</span><span class="p">;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $9 &quot;: &quot; $5}&#39;</span>

<span class="c1"># Clean package cache</span>
sudo<span class="w"> </span>apt<span class="w"> </span>autoclean
sudo<span class="w"> </span>apt<span class="w"> </span>autoremove

<span class="c1"># Clean logs</span>
sudo<span class="w"> </span>journalctl<span class="w"> </span>--vacuum-time<span class="o">=</span>7d

<span class="c1"># Clean thumbnails and cache</span>
rm<span class="w"> </span>-rf<span class="w"> </span>~/.cache/thumbnails/*
rm<span class="w"> </span>-rf<span class="w"> </span>~/.cache/*
</pre></div>
</div>
</section>
<section id="performance-issues">
<h5>Performance Issues<a class="headerlink" href="#performance-issues" title="Link to this heading"></a></h5>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check I/O wait</span>
iostat<span class="w"> </span>-x<span class="w"> </span><span class="m">1</span>

<span class="c1"># Monitor disk activity</span>
sudo<span class="w"> </span>iotop

<span class="c1"># Check for filesystem errors</span>
dmesg<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span>error

<span class="c1"># Analyze slow queries (for databases)</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>sysstat
sar<span class="w"> </span>-d<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">10</span>
</pre></div>
</div>
</section>
</section>
</section>
</section>
<span id="document-coding-examples"></span><section id="coding-examples-and-scripts">
<h2>Coding Examples and Scripts<a class="headerlink" href="#coding-examples-and-scripts" title="Link to this heading"></a></h2>
<p>This section provides practical coding examples, scripts, and automation tools for storage management on Ubuntu 22.04.</p>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#storage-monitoring-scripts" id="id1">Storage Monitoring Scripts</a></p>
<ul>
<li><p><a class="reference internal" href="#system-storage-health-monitor" id="id2">System Storage Health Monitor</a></p></li>
<li><p><a class="reference internal" href="#automated-backup-script" id="id3">Automated Backup Script</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#raid-management-tools" id="id4">RAID Management Tools</a></p>
<ul>
<li><p><a class="reference internal" href="#raid-status-checker" id="id5">RAID Status Checker</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#lvm-automation-scripts" id="id6">LVM Automation Scripts</a></p>
<ul>
<li><p><a class="reference internal" href="#dynamic-lv-resize-script" id="id7">Dynamic LV Resize Script</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#network-storage-utilities" id="id8">Network Storage Utilities</a></p>
<ul>
<li><p><a class="reference internal" href="#nfs-mount-manager" id="id9">NFS Mount Manager</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#file-system-utilities" id="id10">File System Utilities</a></p>
<ul>
<li><p><a class="reference internal" href="#filesystem-health-checker" id="id11">Filesystem Health Checker</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#performance-testing-scripts" id="id12">Performance Testing Scripts</a></p>
<ul>
<li><p><a class="reference internal" href="#storage-benchmark-suite" id="id13">Storage Benchmark Suite</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#installation-and-usage-instructions" id="id14">Installation and Usage Instructions</a></p>
<ul>
<li><p><a class="reference internal" href="#setting-up-the-environment" id="id15">Setting Up the Environment</a></p></li>
<li><p><a class="reference internal" href="#script-configuration" id="id16">Script Configuration</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#integration-examples" id="id17">Integration Examples</a></p>
<ul>
<li><p><a class="reference internal" href="#systemd-service-integration" id="id18">Systemd Service Integration</a></p></li>
<li><p><a class="reference internal" href="#custom-alerts-integration" id="id19">Custom Alerts Integration</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="storage-monitoring-scripts">
<h3><a class="toc-backref" href="#id1" role="doc-backlink">Storage Monitoring Scripts</a><a class="headerlink" href="#storage-monitoring-scripts" title="Link to this heading"></a></h3>
<section id="system-storage-health-monitor">
<h4><a class="toc-backref" href="#id2" role="doc-backlink">System Storage Health Monitor</a><a class="headerlink" href="#system-storage-health-monitor" title="Link to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Storage Health Monitor for Ubuntu 22.04</span>
<span class="sd">Monitors disk usage, SMART status, and filesystem health</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

<span class="k">class</span><span class="w"> </span><span class="nc">StorageMonitor</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span> <span class="o">=</span> <span class="s2">&quot;/var/log/storage-monitor.log&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_disk_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get disk usage for all mounted filesystems&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;df&#39;</span><span class="p">,</span> <span class="s1">&#39;-h&#39;</span><span class="p">],</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Error getting disk usage: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_smart_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check SMART status for a device&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;smartctl&#39;</span><span class="p">,</span> <span class="s1">&#39;-H&#39;</span><span class="p">,</span> <span class="n">device</span><span class="p">],</span>
                                  <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="s2">&quot;PASSED&quot;</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_mounted_devices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get list of mounted block devices&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;lsblk&#39;</span><span class="p">,</span> <span class="s1">&#39;-J&#39;</span><span class="p">],</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
            <span class="n">devices</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;blockdevices&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">device</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mountpoint&#39;</span><span class="p">):</span>
                    <span class="n">devices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">device</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">devices</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">log_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Log status message with timestamp&quot;&quot;&quot;</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
        <span class="n">log_entry</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_file</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">log_entry</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error writing to log: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">monitor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Main monitoring function&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Storage Health Monitor - Starting...&quot;</span><span class="p">)</span>

        <span class="c1"># Check disk usage</span>
        <span class="n">usage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_disk_usage</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Disk Usage:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">usage</span><span class="p">)</span>

        <span class="c1"># Check SMART status for physical drives</span>
        <span class="n">devices</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;/dev/sda&#39;</span><span class="p">,</span> <span class="s1">&#39;/dev/sdb&#39;</span><span class="p">,</span> <span class="s1">&#39;/dev/nvme0n1&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">smart_ok</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_smart_status</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
                <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;HEALTHY&quot;</span> <span class="k">if</span> <span class="n">smart_ok</span> <span class="k">else</span> <span class="s2">&quot;WARNING&quot;</span>
                <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;SMART status for </span><span class="si">{</span><span class="n">device</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_status</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not check </span><span class="si">{</span><span class="n">device</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Alert on high usage</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">usage</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
                    <span class="n">usage_pct</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;%&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">usage_pct</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">usage_pct</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">90</span><span class="p">:</span>
                        <span class="n">alert</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;HIGH USAGE ALERT: </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="si">}</span><span class="s2"> is </span><span class="si">{</span><span class="n">usage_pct</span><span class="si">}</span><span class="s2">% full&quot;</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">alert</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_status</span><span class="p">(</span><span class="n">alert</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">monitor</span> <span class="o">=</span> <span class="n">StorageMonitor</span><span class="p">()</span>
    <span class="n">monitor</span><span class="o">.</span><span class="n">monitor</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="automated-backup-script">
<h4><a class="toc-backref" href="#id3" role="doc-backlink">Automated Backup Script</a><a class="headerlink" href="#automated-backup-script" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1"># Automated Backup Script for Ubuntu 22.04</span>
<span class="c1"># Supports incremental backups with rotation</span>

<span class="nb">set</span><span class="w"> </span>-euo<span class="w"> </span>pipefail

<span class="c1"># Configuration</span>
<span class="nv">SOURCE_DIR</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">1</span><span class="k">:-</span><span class="p">/home</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="nv">BACKUP_BASE</span><span class="o">=</span><span class="s2">&quot;/backup&quot;</span>
<span class="nv">RETENTION_DAYS</span><span class="o">=</span><span class="m">30</span>
<span class="nv">LOG_FILE</span><span class="o">=</span><span class="s2">&quot;/var/log/backup.log&quot;</span>
<span class="nv">DATE</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>+%Y%m%d_%H%M%S<span class="k">)</span>
<span class="nv">BACKUP_DIR</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BACKUP_BASE</span><span class="si">}</span><span class="s2">/backup_</span><span class="si">${</span><span class="nv">DATE</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="c1"># Functions</span>
log_message<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>date<span class="w"> </span><span class="s1">&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span class="k">)</span><span class="s2"> - </span><span class="nv">$1</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LOG_FILE</span><span class="s2">&quot;</span>
<span class="o">}</span>

check_prerequisites<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$EUID</span><span class="w"> </span>-ne<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span>log_message<span class="w"> </span><span class="s2">&quot;ERROR: This script must be run as root&quot;</span>
<span class="w">        </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span>!<span class="w"> </span><span class="nb">command</span><span class="w"> </span>-v<span class="w"> </span>rsync<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span>log_message<span class="w"> </span><span class="s2">&quot;Installing rsync...&quot;</span>
<span class="w">        </span>apt<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>rsync
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BACKUP_BASE</span><span class="s2">&quot;</span>
<span class="o">}</span>

perform_backup<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span>log_message<span class="w"> </span><span class="s2">&quot;Starting backup of </span><span class="nv">$SOURCE_DIR</span><span class="s2"> to </span><span class="nv">$BACKUP_DIR</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="c1"># Find most recent backup for incremental</span>
<span class="w">    </span><span class="nv">LATEST_BACKUP</span><span class="o">=</span><span class="k">$(</span>find<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BACKUP_BASE</span><span class="s2">&quot;</span><span class="w"> </span>-maxdepth<span class="w"> </span><span class="m">1</span><span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;backup_*&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-1<span class="k">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LATEST_BACKUP</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LATEST_BACKUP</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span>log_message<span class="w"> </span><span class="s2">&quot;Performing incremental backup from </span><span class="nv">$LATEST_BACKUP</span><span class="s2">&quot;</span>
<span class="w">        </span>rsync<span class="w"> </span>-av<span class="w"> </span>--link-dest<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$LATEST_BACKUP</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$SOURCE_DIR</span><span class="s2">/&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BACKUP_DIR</span><span class="s2">/&quot;</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span>log_message<span class="w"> </span><span class="s2">&quot;Performing full backup&quot;</span>
<span class="w">        </span>rsync<span class="w"> </span>-av<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$SOURCE_DIR</span><span class="s2">/&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BACKUP_DIR</span><span class="s2">/&quot;</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="c1"># Create backup manifest</span>
<span class="w">    </span>find<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BACKUP_DIR</span><span class="s2">&quot;</span><span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-exec<span class="w"> </span>sha256sum<span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span><span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BACKUP_DIR</span><span class="si">}</span><span class="s2">/manifest.sha256&quot;</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Backup completed: </span><span class="k">$(</span>date<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BACKUP_DIR</span><span class="si">}</span><span class="s2">/backup_info.txt&quot;</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Source: </span><span class="nv">$SOURCE_DIR</span><span class="s2">&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BACKUP_DIR</span><span class="si">}</span><span class="s2">/backup_info.txt&quot;</span>

<span class="w">    </span>log_message<span class="w"> </span><span class="s2">&quot;Backup completed successfully&quot;</span>
<span class="o">}</span>

cleanup_old_backups<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span>log_message<span class="w"> </span><span class="s2">&quot;Cleaning up backups older than </span><span class="nv">$RETENTION_DAYS</span><span class="s2"> days&quot;</span>
<span class="w">    </span>find<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BACKUP_BASE</span><span class="s2">&quot;</span><span class="w"> </span>-maxdepth<span class="w"> </span><span class="m">1</span><span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;backup_*&quot;</span><span class="w"> </span>-mtime<span class="w"> </span>+<span class="nv">$RETENTION_DAYS</span><span class="w"> </span>-exec<span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span>
<span class="w">    </span>log_message<span class="w"> </span><span class="s2">&quot;Cleanup completed&quot;</span>
<span class="o">}</span>

<span class="c1"># Main execution</span>
main<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span>log_message<span class="w"> </span><span class="s2">&quot;=== Backup Process Started ===&quot;</span>
<span class="w">    </span>check_prerequisites
<span class="w">    </span>perform_backup
<span class="w">    </span>cleanup_old_backups
<span class="w">    </span>log_message<span class="w"> </span><span class="s2">&quot;=== Backup Process Completed ===&quot;</span>
<span class="o">}</span>

<span class="c1"># Error handling</span>
<span class="nb">trap</span><span class="w"> </span><span class="s1">&#39;log_message &quot;ERROR: Backup failed on line $LINENO&quot;&#39;</span><span class="w"> </span>ERR

main<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span>
</pre></div>
</div>
</section>
</section>
<section id="raid-management-tools">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">RAID Management Tools</a><a class="headerlink" href="#raid-management-tools" title="Link to this heading"></a></h3>
<section id="raid-status-checker">
<h4><a class="toc-backref" href="#id5" role="doc-backlink">RAID Status Checker</a><a class="headerlink" href="#raid-status-checker" title="Link to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">RAID Status Checker for Ubuntu 22.04</span>
<span class="sd">Monitors software RAID arrays and hardware RAID controllers</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="k">class</span><span class="w"> </span><span class="nc">RAIDMonitor</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mdstat_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;/proc/mdstat&#39;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_software_raid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check software RAID status from /proc/mdstat&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mdstat_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;no_raid&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;No software RAID detected&quot;</span><span class="p">}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mdstat_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

            <span class="n">arrays</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;md&#39;</span><span class="p">):</span>
                    <span class="n">array_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_md_line</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:])</span>
                    <span class="n">arrays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">array_info</span><span class="p">)</span>

            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;active&quot;</span><span class="p">,</span> <span class="s2">&quot;arrays&quot;</span><span class="p">:</span> <span class="n">arrays</span><span class="p">}</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">parse_md_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">md_line</span><span class="p">,</span> <span class="n">following_lines</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse mdstat line for array information&quot;&quot;&quot;</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">md_line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">array_name</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">array_status</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="k">else</span> <span class="s2">&quot;unknown&quot;</span>

        <span class="c1"># Look for status in following lines</span>
        <span class="n">status_line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">following_lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;md&#39;</span><span class="p">):</span>
                <span class="n">status_line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">break</span>

        <span class="c1"># Check for rebuild/sync status</span>
        <span class="n">rebuild_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\[.*\]\s+.*=\s*(\d+\.\d+)%&#39;</span><span class="p">,</span> <span class="n">status_line</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">array_name</span><span class="p">,</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">array_status</span><span class="p">,</span>
            <span class="s2">&quot;devices&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_devices</span><span class="p">(</span><span class="n">md_line</span><span class="p">),</span>
            <span class="s2">&quot;rebuilding&quot;</span><span class="p">:</span> <span class="n">rebuild_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">rebuild_match</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="n">status_line</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">extract_devices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">md_line</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract device list from md line&quot;&quot;&quot;</span>
        <span class="c1"># Simple extraction - could be enhanced</span>
        <span class="n">devices</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[a-z]+\d+\[\d+\]&#39;</span><span class="p">,</span> <span class="n">md_line</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">dev</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">dev</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_hardware_raid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check hardware RAID controllers&quot;&quot;&quot;</span>
        <span class="n">controllers</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Check for MegaRAID</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;megacli&#39;</span><span class="p">,</span> <span class="s1">&#39;-AdpAllInfo&#39;</span><span class="p">,</span> <span class="s1">&#39;-aALL&#39;</span><span class="p">],</span>
                                  <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">controllers</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;MegaRAID&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;detected&quot;</span><span class="p">})</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># Check for HP Smart Array</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;hpacucli&#39;</span><span class="p">,</span> <span class="s1">&#39;ctrl&#39;</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="s1">&#39;show&#39;</span><span class="p">],</span>
                                  <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">controllers</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;HP Smart Array&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;detected&quot;</span><span class="p">})</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">return</span> <span class="n">controllers</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_full_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get complete RAID status report&quot;&quot;&quot;</span>
        <span class="n">report</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;date&#39;</span><span class="p">],</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
            <span class="s2">&quot;software_raid&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_software_raid</span><span class="p">(),</span>
            <span class="s2">&quot;hardware_raid&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_hardware_raid</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">report</span>

<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="n">monitor</span> <span class="o">=</span> <span class="n">RAIDMonitor</span><span class="p">()</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">monitor</span><span class="o">.</span><span class="n">get_full_status</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="lvm-automation-scripts">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">LVM Automation Scripts</a><a class="headerlink" href="#lvm-automation-scripts" title="Link to this heading"></a></h3>
<section id="dynamic-lv-resize-script">
<h4><a class="toc-backref" href="#id7" role="doc-backlink">Dynamic LV Resize Script</a><a class="headerlink" href="#dynamic-lv-resize-script" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1"># Dynamic Logical Volume Resize Script</span>
<span class="c1"># Automatically extends LV when usage exceeds threshold</span>

<span class="nb">set</span><span class="w"> </span>-euo<span class="w"> </span>pipefail

<span class="c1"># Configuration</span>
<span class="nv">THRESHOLD</span><span class="o">=</span><span class="m">85</span>
<span class="nv">EXTEND_SIZE</span><span class="o">=</span><span class="s2">&quot;1G&quot;</span>
<span class="nv">LOG_FILE</span><span class="o">=</span><span class="s2">&quot;/var/log/lv-autoresize.log&quot;</span>

log_message<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>date<span class="w"> </span><span class="s1">&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span class="k">)</span><span class="s2"> - </span><span class="nv">$1</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LOG_FILE</span><span class="s2">&quot;</span>
<span class="o">}</span>

check_lv_usage<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">lv_path</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span>usage

<span class="w">    </span><span class="nv">usage</span><span class="o">=</span><span class="k">$(</span>df<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$lv_path</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;NR==2 {print $5}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s1">&#39;s/%//&#39;</span><span class="k">)</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$usage</span><span class="s2">&quot;</span>
<span class="o">}</span>

extend_logical_volume<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">lv_path</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">vg_name</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">lv_name</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$3</span><span class="s2">&quot;</span>

<span class="w">    </span>log_message<span class="w"> </span><span class="s2">&quot;Extending </span><span class="nv">$lv_path</span><span class="s2"> by </span><span class="nv">$EXTEND_SIZE</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="c1"># Check VG free space</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span>free_space
<span class="w">    </span><span class="nv">free_space</span><span class="o">=</span><span class="k">$(</span>vgs<span class="w"> </span>--noheadings<span class="w"> </span>-o<span class="w"> </span>vg_free<span class="w"> </span>--units<span class="w"> </span>g<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$vg_name</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $1}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s1">&#39;s/g//&#39;</span><span class="k">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">((</span><span class="w"> </span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$free_space</span><span class="s2"> &lt; 1&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>bc<span class="w"> </span>-l<span class="k">)</span><span class="w"> </span><span class="o">))</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span>log_message<span class="w"> </span><span class="s2">&quot;ERROR: Not enough free space in VG </span><span class="nv">$vg_name</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="c1"># Extend LV</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span>lvextend<span class="w"> </span>-L<span class="w"> </span><span class="s2">&quot;+</span><span class="nv">$EXTEND_SIZE</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;/dev/</span><span class="nv">$vg_name</span><span class="s2">/</span><span class="nv">$lv_name</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="c1"># Resize filesystem</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span>resize2fs<span class="w"> </span><span class="s2">&quot;/dev/</span><span class="nv">$vg_name</span><span class="s2">/</span><span class="nv">$lv_name</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span>log_message<span class="w"> </span><span class="s2">&quot;Successfully extended </span><span class="nv">$lv_path</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="m">0</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">            </span>log_message<span class="w"> </span><span class="s2">&quot;ERROR: Failed to resize filesystem for </span><span class="nv">$lv_path</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">        </span><span class="k">fi</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span>log_message<span class="w"> </span><span class="s2">&quot;ERROR: Failed to extend LV </span><span class="nv">$lv_path</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>
<span class="o">}</span>

monitor_logical_volumes<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="c1"># Get all LVs</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="nv">IFS</span><span class="o">=</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>-r<span class="w"> </span>line<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">        </span><span class="nb">local</span><span class="w"> </span>lv_path<span class="w"> </span>vg_name<span class="w"> </span>lv_name
<span class="w">        </span><span class="nv">lv_path</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$line</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $1}&#39;</span><span class="k">)</span>
<span class="w">        </span><span class="nv">vg_name</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$line</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $2}&#39;</span><span class="k">)</span>
<span class="w">        </span><span class="nv">lv_name</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$line</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $3}&#39;</span><span class="k">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$lv_path</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$lv_path</span><span class="s2">&quot;</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span><span class="s2">&quot;LV&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span><span class="nb">local</span><span class="w"> </span>usage
<span class="w">            </span><span class="nv">usage</span><span class="o">=</span><span class="k">$(</span>check_lv_usage<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$lv_path</span><span class="s2">&quot;</span><span class="k">)</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$usage</span><span class="s2">&quot;</span><span class="w"> </span>-gt<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$THRESHOLD</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span>log_message<span class="w"> </span><span class="s2">&quot;WARNING: </span><span class="nv">$lv_path</span><span class="s2"> usage is </span><span class="si">${</span><span class="nv">usage</span><span class="si">}</span><span class="s2">%, threshold is </span><span class="si">${</span><span class="nv">THRESHOLD</span><span class="si">}</span><span class="s2">%&quot;</span>
<span class="w">                </span>extend_logical_volume<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$lv_path</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$vg_name</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$lv_name</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">                </span>log_message<span class="w"> </span><span class="s2">&quot;INFO: </span><span class="nv">$lv_path</span><span class="s2"> usage is </span><span class="si">${</span><span class="nv">usage</span><span class="si">}</span><span class="s2">% (OK)&quot;</span>
<span class="w">            </span><span class="k">fi</span>
<span class="w">        </span><span class="k">fi</span>
<span class="w">    </span><span class="k">done</span><span class="w"> </span>&lt;<span class="w"> </span>&lt;<span class="o">(</span>lvs<span class="w"> </span>--noheadings<span class="w"> </span>-o<span class="w"> </span>lv_path,vg_name,lv_name<span class="o">)</span>
<span class="o">}</span>

main<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$EUID</span><span class="w"> </span>-ne<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;This script must be run as root&quot;</span>
<span class="w">        </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span>log_message<span class="w"> </span><span class="s2">&quot;=== LV Auto-resize Monitor Started ===&quot;</span>
<span class="w">    </span>monitor_logical_volumes
<span class="w">    </span>log_message<span class="w"> </span><span class="s2">&quot;=== LV Auto-resize Monitor Completed ===&quot;</span>
<span class="o">}</span>

main<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span>
</pre></div>
</div>
</section>
</section>
<section id="network-storage-utilities">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">Network Storage Utilities</a><a class="headerlink" href="#network-storage-utilities" title="Link to this heading"></a></h3>
<section id="nfs-mount-manager">
<h4><a class="toc-backref" href="#id9" role="doc-backlink">NFS Mount Manager</a><a class="headerlink" href="#nfs-mount-manager" title="Link to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">NFS Mount Manager for Ubuntu 22.04</span>
<span class="sd">Manages NFS mounts with health checking and auto-recovery</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="k">class</span><span class="w"> </span><span class="nc">NFSManager</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_file</span><span class="o">=</span><span class="s1">&#39;/etc/nfs-mounts.yaml&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span> <span class="o">=</span> <span class="n">config_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_config</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load NFS mount configuration&quot;&quot;&quot;</span>
        <span class="n">default_config</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;mounts&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s1">&#39;server&#39;</span><span class="p">:</span> <span class="s1">&#39;192.168.1.100&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;export&#39;</span><span class="p">:</span> <span class="s1">&#39;/export/shared&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;mountpoint&#39;</span><span class="p">:</span> <span class="s1">&#39;/mnt/nfs-shared&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;options&#39;</span><span class="p">:</span> <span class="s1">&#39;rw,sync,hard,intr&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;auto_mount&#39;</span><span class="p">:</span> <span class="kc">True</span>
                <span class="p">}</span>
            <span class="p">],</span>
            <span class="s1">&#39;timeout&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
            <span class="s1">&#39;retry_count&#39;</span><span class="p">:</span> <span class="mi">3</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error loading config: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">default_config</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_config</span><span class="p">(</span><span class="n">default_config</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">default_config</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save configuration to file&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">default_flow_style</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error saving config: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_nfs_server</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">server</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if NFS server is reachable&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;ping&#39;</span><span class="p">,</span> <span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;-W&#39;</span><span class="p">,</span> <span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="n">server</span><span class="p">],</span>
                                  <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_mounted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mountpoint</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if mountpoint is currently mounted&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;mountpoint&#39;</span><span class="p">,</span> <span class="s1">&#39;-q&#39;</span><span class="p">,</span> <span class="n">mountpoint</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">mount_nfs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mount_config</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mount an NFS share&quot;&quot;&quot;</span>
        <span class="n">server</span> <span class="o">=</span> <span class="n">mount_config</span><span class="p">[</span><span class="s1">&#39;server&#39;</span><span class="p">]</span>
        <span class="n">export</span> <span class="o">=</span> <span class="n">mount_config</span><span class="p">[</span><span class="s1">&#39;export&#39;</span><span class="p">]</span>
        <span class="n">mountpoint</span> <span class="o">=</span> <span class="n">mount_config</span><span class="p">[</span><span class="s1">&#39;mountpoint&#39;</span><span class="p">]</span>
        <span class="n">options</span> <span class="o">=</span> <span class="n">mount_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;options&#39;</span><span class="p">,</span> <span class="s1">&#39;rw,sync&#39;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mounting </span><span class="si">{</span><span class="n">server</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">export</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">mountpoint</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Create mountpoint if it doesn&#39;t exist</span>
        <span class="n">Path</span><span class="p">(</span><span class="n">mountpoint</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Check if already mounted</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_mounted</span><span class="p">(</span><span class="n">mountpoint</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Already mounted: </span><span class="si">{</span><span class="n">mountpoint</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="c1"># Check server connectivity</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_nfs_server</span><span class="p">(</span><span class="n">server</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ERROR: Cannot reach NFS server </span><span class="si">{</span><span class="n">server</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Mount the share</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">nfs_source</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">server</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">export</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mount&#39;</span><span class="p">,</span> <span class="s1">&#39;-t&#39;</span><span class="p">,</span> <span class="s1">&#39;nfs&#39;</span><span class="p">,</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">nfs_source</span><span class="p">,</span> <span class="n">mountpoint</span><span class="p">]</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Successfully mounted </span><span class="si">{</span><span class="n">mountpoint</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ERROR: Mount failed: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ERROR: Exception during mount: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">unmount_nfs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mountpoint</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Unmount an NFS share&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_mounted</span><span class="p">(</span><span class="n">mountpoint</span><span class="p">):</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;umount&#39;</span><span class="p">,</span> <span class="n">mountpoint</span><span class="p">],</span>
                                      <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully unmounted </span><span class="si">{</span><span class="n">mountpoint</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ERROR: Unmount failed: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mountpoint</span><span class="si">}</span><span class="s2"> is not mounted&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ERROR: Exception during unmount: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">mount_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mount all configured NFS shares&quot;&quot;&quot;</span>
        <span class="n">success_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">total_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;mounts&#39;</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">mount_config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;mounts&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">mount_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;auto_mount&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mount_nfs</span><span class="p">(</span><span class="n">mount_config</span><span class="p">):</span>
                    <span class="n">success_count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mounted </span><span class="si">{</span><span class="n">success_count</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">total_count</span><span class="si">}</span><span class="s2"> NFS shares&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">success_count</span> <span class="o">==</span> <span class="n">total_count</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">unmount_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Unmount all configured NFS shares&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">mount_config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;mounts&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unmount_nfs</span><span class="p">(</span><span class="n">mount_config</span><span class="p">[</span><span class="s1">&#39;mountpoint&#39;</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">health_check</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check health of all NFS mounts&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;NFS Mount Health Check&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">mount_config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;mounts&#39;</span><span class="p">]:</span>
            <span class="n">server</span> <span class="o">=</span> <span class="n">mount_config</span><span class="p">[</span><span class="s1">&#39;server&#39;</span><span class="p">]</span>
            <span class="n">mountpoint</span> <span class="o">=</span> <span class="n">mount_config</span><span class="p">[</span><span class="s1">&#39;mountpoint&#39;</span><span class="p">]</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Checking </span><span class="si">{</span><span class="n">server</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">mount_config</span><span class="p">[</span><span class="s1">&#39;export&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Check server</span>
            <span class="n">server_ok</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_nfs_server</span><span class="p">(</span><span class="n">server</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Server reachable: </span><span class="si">{</span><span class="s1">&#39;YES&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">server_ok</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Check mount</span>
            <span class="n">mounted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_mounted</span><span class="p">(</span><span class="n">mountpoint</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Mounted: </span><span class="si">{</span><span class="s1">&#39;YES&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">mounted</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Check accessibility</span>
            <span class="k">if</span> <span class="n">mounted</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">test_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">mountpoint</span><span class="p">)</span> <span class="o">/</span> <span class="s1">&#39;.nfs_test&#39;</span>
                    <span class="n">test_file</span><span class="o">.</span><span class="n">touch</span><span class="p">()</span>
                    <span class="n">test_file</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Accessible: YES&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Accessible: NO&quot;</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Usage: nfs-manager.py {mount|unmount|health|mount-all|unmount-all}&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">geteuid</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This script must be run as root&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">manager</span> <span class="o">=</span> <span class="n">NFSManager</span><span class="p">()</span>
    <span class="n">command</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">command</span> <span class="o">==</span> <span class="s2">&quot;mount-all&quot;</span><span class="p">:</span>
        <span class="n">manager</span><span class="o">.</span><span class="n">mount_all</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">command</span> <span class="o">==</span> <span class="s2">&quot;unmount-all&quot;</span><span class="p">:</span>
        <span class="n">manager</span><span class="o">.</span><span class="n">unmount_all</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">command</span> <span class="o">==</span> <span class="s2">&quot;health&quot;</span><span class="p">:</span>
        <span class="n">manager</span><span class="o">.</span><span class="n">health_check</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown command: </span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="file-system-utilities">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">File System Utilities</a><a class="headerlink" href="#file-system-utilities" title="Link to this heading"></a></h3>
<section id="filesystem-health-checker">
<h4><a class="toc-backref" href="#id11" role="doc-backlink">Filesystem Health Checker</a><a class="headerlink" href="#filesystem-health-checker" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1"># Comprehensive Filesystem Health Checker for Ubuntu 22.04</span>

<span class="nb">set</span><span class="w"> </span>-euo<span class="w"> </span>pipefail

<span class="c1"># Configuration</span>
<span class="nv">LOG_FILE</span><span class="o">=</span><span class="s2">&quot;/var/log/filesystem-health.log&quot;</span>
<span class="nv">REPORT_FILE</span><span class="o">=</span><span class="s2">&quot;/tmp/filesystem-health-report.txt&quot;</span>

log_message<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>date<span class="w"> </span><span class="s1">&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span class="k">)</span><span class="s2"> - </span><span class="nv">$1</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LOG_FILE</span><span class="s2">&quot;</span>
<span class="o">}</span>

check_filesystem_errors<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">device</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">fstype</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">mountpoint</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$3</span><span class="s2">&quot;</span>

<span class="w">    </span>log_message<span class="w"> </span><span class="s2">&quot;Checking filesystem errors for </span><span class="nv">$device</span><span class="s2"> (</span><span class="nv">$fstype</span><span class="s2">)&quot;</span>

<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$fstype</span><span class="s2">&quot;</span><span class="w"> </span><span class="k">in</span>
<span class="w">        </span>ext4<span class="p">|</span>ext3<span class="p">|</span>ext2<span class="o">)</span>
<span class="w">            </span><span class="c1"># Check for ext filesystem errors</span>
<span class="w">            </span><span class="nb">local</span><span class="w"> </span>error_count
<span class="w">            </span><span class="nv">error_count</span><span class="o">=</span><span class="k">$(</span>tune2fs<span class="w"> </span>-l<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;Filesystem errors behavior&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="k">)</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span>dumpe2fs<span class="w"> </span>-h<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-q<span class="w"> </span><span class="s2">&quot;has_journal&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span>log_message<span class="w"> </span><span class="s2">&quot;  Journal filesystem detected&quot;</span>
<span class="w">            </span><span class="k">fi</span>

<span class="w">            </span><span class="c1"># Force check if needed</span>
<span class="w">            </span><span class="nb">local</span><span class="w"> </span>mount_count<span class="w"> </span>max_count
<span class="w">            </span><span class="nv">mount_count</span><span class="o">=</span><span class="k">$(</span>tune2fs<span class="w"> </span>-l<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;Mount count:&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $3}&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="k">)</span>
<span class="w">            </span><span class="nv">max_count</span><span class="o">=</span><span class="k">$(</span>tune2fs<span class="w"> </span>-l<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;Maximum mount count:&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $4}&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="k">)</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$max_count</span><span class="s2">&quot;</span><span class="w"> </span>-gt<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$mount_count</span><span class="s2">&quot;</span><span class="w"> </span>-gt<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$max_count</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span>log_message<span class="w"> </span><span class="s2">&quot;  WARNING: Mount count (</span><span class="nv">$mount_count</span><span class="s2">) exceeds maximum (</span><span class="nv">$max_count</span><span class="s2">)&quot;</span>
<span class="w">            </span><span class="k">fi</span>
<span class="w">            </span><span class="p">;;</span>

<span class="w">        </span>xfs<span class="o">)</span>
<span class="w">            </span><span class="c1"># Check XFS filesystem</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span>xfs_info<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$mountpoint</span><span class="s2">&quot;</span><span class="w"> </span>&gt;/dev/null<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span>log_message<span class="w"> </span><span class="s2">&quot;  XFS filesystem appears healthy&quot;</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">                </span>log_message<span class="w"> </span><span class="s2">&quot;  WARNING: XFS filesystem check failed&quot;</span>
<span class="w">            </span><span class="k">fi</span>
<span class="w">            </span><span class="p">;;</span>

<span class="w">        </span>btrfs<span class="o">)</span>
<span class="w">            </span><span class="c1"># Check Btrfs filesystem</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span>btrfs<span class="w"> </span>filesystem<span class="w"> </span>show<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="w"> </span>&gt;/dev/null<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span><span class="nb">local</span><span class="w"> </span>errors
<span class="w">                </span><span class="nv">errors</span><span class="o">=</span><span class="k">$(</span>btrfs<span class="w"> </span>device<span class="w"> </span>stats<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;err&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="k">)</span>
<span class="w">                </span>log_message<span class="w"> </span><span class="s2">&quot;  Btrfs error count: </span><span class="nv">$errors</span><span class="s2">&quot;</span>
<span class="w">            </span><span class="k">fi</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">    </span><span class="k">esac</span>
<span class="o">}</span>

check_disk_usage<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span>log_message<span class="w"> </span><span class="s2">&quot;Checking disk usage patterns&quot;</span>

<span class="w">    </span>df<span class="w"> </span>-h<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="nv">IFS</span><span class="o">=</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>-r<span class="w"> </span>line<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$line</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>*<span class="s2">&quot;% /&quot;</span>*<span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span><span class="nb">local</span><span class="w"> </span>usage
<span class="w">            </span><span class="nv">usage</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$line</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $5}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s1">&#39;s/%//&#39;</span><span class="k">)</span>
<span class="w">            </span><span class="nb">local</span><span class="w"> </span>mountpoint
<span class="w">            </span><span class="nv">mountpoint</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$line</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $6}&#39;</span><span class="k">)</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$usage</span><span class="s2">&quot;</span><span class="w"> </span>-gt<span class="w"> </span><span class="m">90</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span>log_message<span class="w"> </span><span class="s2">&quot;  CRITICAL: </span><span class="nv">$mountpoint</span><span class="s2"> is </span><span class="si">${</span><span class="nv">usage</span><span class="si">}</span><span class="s2">% full&quot;</span>
<span class="w">            </span><span class="k">elif</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$usage</span><span class="s2">&quot;</span><span class="w"> </span>-gt<span class="w"> </span><span class="m">80</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span>log_message<span class="w"> </span><span class="s2">&quot;  WARNING: </span><span class="nv">$mountpoint</span><span class="s2"> is </span><span class="si">${</span><span class="nv">usage</span><span class="si">}</span><span class="s2">% full&quot;</span>
<span class="w">            </span><span class="k">fi</span>
<span class="w">        </span><span class="k">fi</span>
<span class="w">    </span><span class="k">done</span>
<span class="o">}</span>

check_inode_usage<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span>log_message<span class="w"> </span><span class="s2">&quot;Checking inode usage&quot;</span>

<span class="w">    </span>df<span class="w"> </span>-i<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="nv">IFS</span><span class="o">=</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>-r<span class="w"> </span>line<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$line</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>*<span class="s2">&quot;% /&quot;</span>*<span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span><span class="nb">local</span><span class="w"> </span>usage
<span class="w">            </span><span class="nv">usage</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$line</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $5}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s1">&#39;s/%//&#39;</span><span class="k">)</span>
<span class="w">            </span><span class="nb">local</span><span class="w"> </span>mountpoint
<span class="w">            </span><span class="nv">mountpoint</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$line</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $6}&#39;</span><span class="k">)</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$usage</span><span class="s2">&quot;</span><span class="w"> </span>-gt<span class="w"> </span><span class="m">90</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span>log_message<span class="w"> </span><span class="s2">&quot;  CRITICAL: </span><span class="nv">$mountpoint</span><span class="s2"> inodes </span><span class="si">${</span><span class="nv">usage</span><span class="si">}</span><span class="s2">% used&quot;</span>
<span class="w">            </span><span class="k">elif</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$usage</span><span class="s2">&quot;</span><span class="w"> </span>-gt<span class="w"> </span><span class="m">80</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span>log_message<span class="w"> </span><span class="s2">&quot;  WARNING: </span><span class="nv">$mountpoint</span><span class="s2"> inodes </span><span class="si">${</span><span class="nv">usage</span><span class="si">}</span><span class="s2">% used&quot;</span>
<span class="w">            </span><span class="k">fi</span>
<span class="w">        </span><span class="k">fi</span>
<span class="w">    </span><span class="k">done</span>
<span class="o">}</span>

generate_report<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="o">{</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Filesystem Health Report&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Generated: </span><span class="k">$(</span>date<span class="k">)</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;==========================================&quot;</span>
<span class="w">        </span><span class="nb">echo</span>

<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;DISK USAGE:&quot;</span>
<span class="w">        </span>df<span class="w"> </span>-h
<span class="w">        </span><span class="nb">echo</span>

<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;INODE USAGE:&quot;</span>
<span class="w">        </span>df<span class="w"> </span>-i
<span class="w">        </span><span class="nb">echo</span>

<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;MOUNTED FILESYSTEMS:&quot;</span>
<span class="w">        </span>mount<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-E<span class="w"> </span><span class="s1">&#39;^/dev/&#39;</span>
<span class="w">        </span><span class="nb">echo</span>

<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;FILESYSTEM TYPES:&quot;</span>
<span class="w">        </span>lsblk<span class="w"> </span>-f
<span class="w">        </span><span class="nb">echo</span>

<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;RECENT LOG ENTRIES:&quot;</span>
<span class="w">        </span>tail<span class="w"> </span>-20<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LOG_FILE</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="o">}</span><span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$REPORT_FILE</span><span class="s2">&quot;</span>

<span class="w">    </span>log_message<span class="w"> </span><span class="s2">&quot;Health report generated: </span><span class="nv">$REPORT_FILE</span><span class="s2">&quot;</span>
<span class="o">}</span>

main<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$EUID</span><span class="w"> </span>-ne<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;This script should be run as root for complete checks&quot;</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span>log_message<span class="w"> </span><span class="s2">&quot;=== Filesystem Health Check Started ===&quot;</span>

<span class="w">    </span><span class="c1"># Get mounted filesystems</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="nv">IFS</span><span class="o">=</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>-r<span class="w"> </span>line<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$line</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>/dev/*<span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span><span class="nb">local</span><span class="w"> </span>device<span class="w"> </span>fstype<span class="w"> </span>mountpoint
<span class="w">            </span><span class="nv">device</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$line</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $1}&#39;</span><span class="k">)</span>
<span class="w">            </span><span class="nv">fstype</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$line</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $3}&#39;</span><span class="k">)</span>
<span class="w">            </span><span class="nv">mountpoint</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$line</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $2}&#39;</span><span class="k">)</span>

<span class="w">            </span>check_filesystem_errors<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$fstype</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$mountpoint</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="k">fi</span>
<span class="w">    </span><span class="k">done</span><span class="w"> </span>&lt;<span class="w"> </span>&lt;<span class="o">(</span>mount<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-E<span class="w"> </span><span class="s1">&#39;^/dev/&#39;</span><span class="o">)</span>

<span class="w">    </span>check_disk_usage
<span class="w">    </span>check_inode_usage
<span class="w">    </span>generate_report

<span class="w">    </span>log_message<span class="w"> </span><span class="s2">&quot;=== Filesystem Health Check Completed ===&quot;</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Health check completed. Report available at: </span><span class="nv">$REPORT_FILE</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Log file: </span><span class="nv">$LOG_FILE</span><span class="s2">&quot;</span>
<span class="o">}</span>

main<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span>
</pre></div>
</div>
</section>
</section>
<section id="performance-testing-scripts">
<h3><a class="toc-backref" href="#id12" role="doc-backlink">Performance Testing Scripts</a><a class="headerlink" href="#performance-testing-scripts" title="Link to this heading"></a></h3>
<section id="storage-benchmark-suite">
<h4><a class="toc-backref" href="#id13" role="doc-backlink">Storage Benchmark Suite</a><a class="headerlink" href="#storage-benchmark-suite" title="Link to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Storage Performance Benchmark Suite for Ubuntu 22.04</span>
<span class="sd">Tests various storage scenarios and generates performance reports</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="k">class</span><span class="w"> </span><span class="nc">StorageBenchmark</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_dir</span><span class="o">=</span><span class="s2">&quot;/tmp/storage_test&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">test_dir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run_dd_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_name</span><span class="p">,</span> <span class="n">block_size</span><span class="o">=</span><span class="s2">&quot;1M&quot;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1024</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run DD-based I/O test&quot;&quot;&quot;</span>
        <span class="n">test_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">test_name</span><span class="si">}</span><span class="s2">.dat&quot;</span>

        <span class="c1"># Write test</span>
        <span class="n">write_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;dd&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;if=/dev/zero&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;of=</span><span class="si">{</span><span class="n">test_file</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
               <span class="sa">f</span><span class="s1">&#39;bs=</span><span class="si">{</span><span class="n">block_size</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;count=</span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;conv=fdatasync&#39;</span><span class="p">]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">write_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">write_start</span>

            <span class="c1"># Parse DD output for speed</span>
            <span class="n">write_speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_dd_output</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>

            <span class="c1"># Read test</span>
            <span class="n">read_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;dd&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;if=</span><span class="si">{</span><span class="n">test_file</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;of=/dev/null&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;bs=</span><span class="si">{</span><span class="n">block_size</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">read_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">read_start</span>

            <span class="n">read_speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_dd_output</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>

            <span class="c1"># Cleanup</span>
            <span class="n">test_file</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>

            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;write_time&#39;</span><span class="p">:</span> <span class="n">write_time</span><span class="p">,</span>
                <span class="s1">&#39;read_time&#39;</span><span class="p">:</span> <span class="n">read_time</span><span class="p">,</span>
                <span class="s1">&#39;write_speed&#39;</span><span class="p">:</span> <span class="n">write_speed</span><span class="p">,</span>
                <span class="s1">&#39;read_speed&#39;</span><span class="p">:</span> <span class="n">read_speed</span><span class="p">,</span>
                <span class="s1">&#39;block_size&#39;</span><span class="p">:</span> <span class="n">block_size</span><span class="p">,</span>
                <span class="s1">&#39;data_size&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">count</span><span class="si">}{</span><span class="n">block_size</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">}</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">parse_dd_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dd_stderr</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse DD output to extract transfer rate&quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">re</span>

        <span class="c1"># Look for patterns like &quot;1.0 GB/s&quot; or &quot;500 MB/s&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;(\d+\.?\d*)\s*([KMGT]?B/s)&#39;</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">dd_stderr</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;Unknown&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run_fio_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_name</span><span class="p">,</span> <span class="n">job_config</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run FIO benchmark if available&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Check if fio is available</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;which&#39;</span><span class="p">,</span> <span class="s1">&#39;fio&#39;</span><span class="p">],</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Create FIO job file</span>
            <span class="n">job_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">test_name</span><span class="si">}</span><span class="s2">.fio&quot;</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">job_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">job_config</span><span class="p">)</span>

            <span class="c1"># Run FIO</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;fio&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">job_file</span><span class="p">),</span> <span class="s1">&#39;--output-format=json&#39;</span><span class="p">],</span>
                                  <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">fio_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
                <span class="n">job_file</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">fio_data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">stderr</span><span class="p">}</span>

        <span class="k">except</span> <span class="p">(</span><span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span><span class="p">,</span> <span class="ne">FileNotFoundError</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;FIO not available&#39;</span><span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run_sequential_tests</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run sequential I/O tests&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Running sequential I/O tests...&quot;</span><span class="p">)</span>

        <span class="c1"># Various block sizes</span>
        <span class="n">block_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;4K&#39;</span><span class="p">,</span> <span class="s1">&#39;64K&#39;</span><span class="p">,</span> <span class="s1">&#39;1M&#39;</span><span class="p">,</span> <span class="s1">&#39;4M&#39;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">bs</span> <span class="ow">in</span> <span class="n">block_sizes</span><span class="p">:</span>
            <span class="n">test_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sequential_</span><span class="si">{</span><span class="n">bs</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Testing </span><span class="si">{</span><span class="n">bs</span><span class="si">}</span><span class="s2"> blocks...&quot;</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_dd_test</span><span class="p">(</span><span class="n">test_name</span><span class="p">,</span> <span class="n">bs</span><span class="p">,</span> <span class="mi">256</span> <span class="k">if</span> <span class="n">bs</span> <span class="o">==</span> <span class="s1">&#39;4M&#39;</span> <span class="k">else</span> <span class="mi">1024</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">test_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run_random_tests</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run random I/O tests using FIO&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Running random I/O tests...&quot;</span><span class="p">)</span>

        <span class="c1"># Random read test</span>
        <span class="n">random_read_config</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">[random_read]</span>
<span class="s2">ioengine=libaio</span>
<span class="s2">rw=randread</span>
<span class="s2">bs=4k</span>
<span class="s2">direct=1</span>
<span class="s2">size=100M</span>
<span class="s2">numjobs=1</span>
<span class="s2">runtime=30</span>
<span class="s2">group_reporting</span>
<span class="s2">filename=</span><span class="si">{}</span><span class="s2">/random_read.dat</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_dir</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_fio_test</span><span class="p">(</span><span class="s2">&quot;random_read&quot;</span><span class="p">,</span> <span class="n">random_read_config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;random_read&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>

        <span class="c1"># Random write test</span>
        <span class="n">random_write_config</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">[random_write]</span>
<span class="s2">ioengine=libaio</span>
<span class="s2">rw=randwrite</span>
<span class="s2">bs=4k</span>
<span class="s2">direct=1</span>
<span class="s2">size=100M</span>
<span class="s2">numjobs=1</span>
<span class="s2">runtime=30</span>
<span class="s2">group_reporting</span>
<span class="s2">filename=</span><span class="si">{}</span><span class="s2">/random_write.dat</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_dir</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_fio_test</span><span class="p">(</span><span class="s2">&quot;random_write&quot;</span><span class="p">,</span> <span class="n">random_write_config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;random_write&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate performance report&quot;&quot;&quot;</span>
        <span class="n">report_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_dir</span> <span class="o">/</span> <span class="s2">&quot;benchmark_report.json&quot;</span>

        <span class="n">report</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">),</span>
            <span class="s1">&#39;test_directory&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_dir</span><span class="p">),</span>
            <span class="s1">&#39;system_info&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_system_info</span><span class="p">(),</span>
            <span class="s1">&#39;results&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span>
        <span class="p">}</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">report_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">report</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Generate human-readable summary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_summary</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Detailed report saved to: </span><span class="si">{</span><span class="n">report_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_system_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get system information&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Get CPU info</span>
            <span class="n">cpu_info</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;lscpu&#39;</span><span class="p">],</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">stdout</span>

            <span class="c1"># Get memory info</span>
            <span class="n">mem_info</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;free&#39;</span><span class="p">,</span> <span class="s1">&#39;-h&#39;</span><span class="p">],</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">stdout</span>

            <span class="c1"># Get storage info</span>
            <span class="n">storage_info</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;lsblk&#39;</span><span class="p">],</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">stdout</span>

            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;cpu&#39;</span><span class="p">:</span> <span class="n">cpu_info</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[:</span><span class="mi">10</span><span class="p">],</span>  <span class="c1"># First 10 lines</span>
                <span class="s1">&#39;memory&#39;</span><span class="p">:</span> <span class="n">mem_info</span><span class="p">,</span>
                <span class="s1">&#39;storage&#39;</span><span class="p">:</span> <span class="n">storage_info</span>
            <span class="p">}</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Could not gather system info&#39;</span><span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">print_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Print benchmark summary&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;STORAGE BENCHMARK SUMMARY&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">test_name</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;error&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">test_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;write_speed&#39;</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Write Speed: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;write_speed&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Read Speed:  </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;read_speed&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="s1">&#39;jobs&#39;</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>  <span class="c1"># FIO result</span>
                    <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;jobs&#39;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="s1">&#39;read&#39;</span> <span class="ow">in</span> <span class="n">job</span><span class="p">:</span>
                            <span class="n">iops</span> <span class="o">=</span> <span class="n">job</span><span class="p">[</span><span class="s1">&#39;read&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;iops&#39;</span><span class="p">,</span> <span class="s1">&#39;N/A&#39;</span><span class="p">)</span>
                            <span class="n">bw</span> <span class="o">=</span> <span class="n">job</span><span class="p">[</span><span class="s1">&#39;read&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bw&#39;</span><span class="p">,</span> <span class="s1">&#39;N/A&#39;</span><span class="p">)</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Read IOPS:   </span><span class="si">{</span><span class="n">iops</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Read BW:     </span><span class="si">{</span><span class="n">bw</span><span class="si">}</span><span class="s2"> KB/s&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="s1">&#39;write&#39;</span> <span class="ow">in</span> <span class="n">job</span><span class="p">:</span>
                            <span class="n">iops</span> <span class="o">=</span> <span class="n">job</span><span class="p">[</span><span class="s1">&#39;write&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;iops&#39;</span><span class="p">,</span> <span class="s1">&#39;N/A&#39;</span><span class="p">)</span>
                            <span class="n">bw</span> <span class="o">=</span> <span class="n">job</span><span class="p">[</span><span class="s1">&#39;write&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bw&#39;</span><span class="p">,</span> <span class="s1">&#39;N/A&#39;</span><span class="p">)</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Write IOPS:  </span><span class="si">{</span><span class="n">iops</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Write BW:    </span><span class="si">{</span><span class="n">bw</span><span class="si">}</span><span class="s2"> KB/s&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">test_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">: ERROR - </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run_all_tests</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run complete benchmark suite&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting Storage Benchmark Suite&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This may take several minutes...&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">run_sequential_tests</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_random_tests</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generate_report</span><span class="p">()</span>

        <span class="c1"># Cleanup</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.dat&quot;</span><span class="p">):</span>
            <span class="n">file</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">test_dir</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">test_dir</span> <span class="o">=</span> <span class="s2">&quot;/tmp/storage_test&quot;</span>

    <span class="n">benchmark</span> <span class="o">=</span> <span class="n">StorageBenchmark</span><span class="p">(</span><span class="n">test_dir</span><span class="p">)</span>
    <span class="n">benchmark</span><span class="o">.</span><span class="n">run_all_tests</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="installation-and-usage-instructions">
<h3><a class="toc-backref" href="#id14" role="doc-backlink">Installation and Usage Instructions</a><a class="headerlink" href="#installation-and-usage-instructions" title="Link to this heading"></a></h3>
<section id="setting-up-the-environment">
<h4><a class="toc-backref" href="#id15" role="doc-backlink">Setting Up the Environment</a><a class="headerlink" href="#setting-up-the-environment" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install required packages</span>
sudo<span class="w"> </span>apt<span class="w"> </span>update
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>python3-pip<span class="w"> </span>smartmontools<span class="w"> </span>fio

<span class="c1"># Install Python dependencies</span>
pip3<span class="w"> </span>install<span class="w"> </span>pyyaml

<span class="c1"># Make scripts executable</span>
chmod<span class="w"> </span>+x<span class="w"> </span>*.py<span class="w"> </span>*.sh

<span class="c1"># Create necessary directories</span>
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/var/log<span class="w"> </span>/backup
</pre></div>
</div>
</section>
<section id="script-configuration">
<h4><a class="toc-backref" href="#id16" role="doc-backlink">Script Configuration</a><a class="headerlink" href="#script-configuration" title="Link to this heading"></a></h4>
<p><strong>Storage Monitor Configuration:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set up cron job for automated monitoring</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;0 */6 * * * root /path/to/storage-monitor.py&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/crontab

<span class="c1"># Configure log rotation</span>
sudo<span class="w"> </span>tee<span class="w"> </span>/etc/logrotate.d/storage-monitor<span class="w"> </span><span class="s">&lt;&lt; EOF</span>
<span class="s">/var/log/storage-monitor.log {</span>
<span class="s">    daily</span>
<span class="s">    rotate 30</span>
<span class="s">    compress</span>
<span class="s">    missingok</span>
<span class="s">    create 644 root root</span>
<span class="s">}</span>
<span class="s">EOF</span>
</pre></div>
</div>
<p><strong>NFS Manager Setup:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install NFS utilities</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>nfs-common

<span class="c1"># Create configuration file</span>
sudo<span class="w"> </span>tee<span class="w"> </span>/etc/nfs-mounts.yaml<span class="w"> </span><span class="s">&lt;&lt; EOF</span>
<span class="s">mounts:</span>
<span class="s">  - server: &quot;your-nfs-server.local&quot;</span>
<span class="s">    export: &quot;/export/data&quot;</span>
<span class="s">    mountpoint: &quot;/mnt/nfs-data&quot;</span>
<span class="s">    options: &quot;rw,sync,hard,intr&quot;</span>
<span class="s">    auto_mount: true</span>
<span class="s">timeout: 30</span>
<span class="s">retry_count: 3</span>
<span class="s">EOF</span>
</pre></div>
</div>
</section>
</section>
<section id="integration-examples">
<h3><a class="toc-backref" href="#id17" role="doc-backlink">Integration Examples</a><a class="headerlink" href="#integration-examples" title="Link to this heading"></a></h3>
<section id="systemd-service-integration">
<h4><a class="toc-backref" href="#id18" role="doc-backlink">Systemd Service Integration</a><a class="headerlink" href="#systemd-service-integration" title="Link to this heading"></a></h4>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="c1"># /etc/systemd/system/storage-monitor.service</span>
<span class="k">[Unit]</span>
<span class="na">Description</span><span class="o">=</span><span class="s">Storage Health Monitor</span>
<span class="na">After</span><span class="o">=</span><span class="s">multi-user.target</span>

<span class="k">[Service]</span>
<span class="na">Type</span><span class="o">=</span><span class="s">oneshot</span>
<span class="na">ExecStart</span><span class="o">=</span><span class="s">/usr/local/bin/storage-monitor.py</span>
<span class="na">User</span><span class="o">=</span><span class="s">root</span>

<span class="k">[Install]</span>
<span class="na">WantedBy</span><span class="o">=</span><span class="s">multi-user.target</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Enable and start the service</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>daemon-reload
sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>storage-monitor.service
sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>storage-monitor.service
</pre></div>
</div>
</section>
<section id="custom-alerts-integration">
<h4><a class="toc-backref" href="#id19" role="doc-backlink">Custom Alerts Integration</a><a class="headerlink" href="#custom-alerts-integration" title="Link to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Email alert integration</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">smtplib</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">email.mime.text</span><span class="w"> </span><span class="kn">import</span> <span class="n">MIMEText</span>

<span class="k">def</span><span class="w"> </span><span class="nf">send_alert</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
    <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;Subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subject</span>
    <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;From&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;storage-monitor@yourserver.com&#39;</span>
    <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;To&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;admin@yourserver.com&#39;</span>

    <span class="n">server</span> <span class="o">=</span> <span class="n">smtplib</span><span class="o">.</span><span class="n">SMTP</span><span class="p">(</span><span class="s1">&#39;localhost&#39;</span><span class="p">)</span>
    <span class="n">server</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="n">server</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</div>
<p>These scripts provide a comprehensive foundation for storage management automation on Ubuntu 22.04. They can be customized and extended based on specific requirements and integrated into larger system management frameworks.</p>
</section>
</section>
</section>
<span id="document-troubleshooting"></span><section id="troubleshooting-guide">
<h2>Troubleshooting Guide<a class="headerlink" href="#troubleshooting-guide" title="Link to this heading"></a></h2>
<p>This comprehensive troubleshooting guide covers common storage-related issues on Ubuntu 22.04 and their solutions.</p>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#disk-and-partition-issues" id="id1">Disk and Partition Issues</a></p>
<ul>
<li><p><a class="reference internal" href="#disk-not-detected" id="id2">Disk Not Detected</a></p></li>
<li><p><a class="reference internal" href="#partition-table-corruption" id="id3">Partition Table Corruption</a></p></li>
<li><p><a class="reference internal" href="#boot-issues" id="id4">Boot Issues</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#filesystem-issues" id="id5">Filesystem Issues</a></p>
<ul>
<li><p><a class="reference internal" href="#filesystem-corruption" id="id6">Filesystem Corruption</a></p></li>
<li><p><a class="reference internal" href="#journal-issues" id="id7">Journal Issues</a></p></li>
<li><p><a class="reference internal" href="#full-disk-issues" id="id8">Full Disk Issues</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#lvm-issues" id="id9">LVM Issues</a></p>
<ul>
<li><p><a class="reference internal" href="#physical-volume-problems" id="id10">Physical Volume Problems</a></p></li>
<li><p><a class="reference internal" href="#volume-group-issues" id="id11">Volume Group Issues</a></p></li>
<li><p><a class="reference internal" href="#logical-volume-problems" id="id12">Logical Volume Problems</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#raid-issues" id="id13">RAID Issues</a></p>
<ul>
<li><p><a class="reference internal" href="#software-raid-problems" id="id14">Software RAID Problems</a></p></li>
<li><p><a class="reference internal" href="#hardware-raid-issues" id="id15">Hardware RAID Issues</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#network-storage-issues" id="id16">Network Storage Issues</a></p>
<ul>
<li><p><a class="reference internal" href="#nfs-mount-problems" id="id17">NFS Mount Problems</a></p></li>
<li><p><a class="reference internal" href="#samba-cifs-issues" id="id18">Samba/CIFS Issues</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#performance-issues" id="id19">Performance Issues</a></p>
<ul>
<li><p><a class="reference internal" href="#slow-disk-performance" id="id20">Slow Disk Performance</a></p></li>
<li><p><a class="reference internal" href="#high-i-o-wait" id="id21">High I/O Wait</a></p></li>
<li><p><a class="reference internal" href="#memory-and-cache-issues" id="id22">Memory and Cache Issues</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#recovery-procedures" id="id23">Recovery Procedures</a></p>
<ul>
<li><p><a class="reference internal" href="#data-recovery" id="id24">Data Recovery</a></p></li>
<li><p><a class="reference internal" href="#system-recovery" id="id25">System Recovery</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#emergency-procedures" id="id26">Emergency Procedures</a></p>
<ul>
<li><p><a class="reference internal" href="#read-only-filesystem-recovery" id="id27">Read-Only Filesystem Recovery</a></p></li>
<li><p><a class="reference internal" href="#disk-failure-emergency" id="id28">Disk Failure Emergency</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#preventive-measures" id="id29">Preventive Measures</a></p>
<ul>
<li><p><a class="reference internal" href="#regular-health-checks" id="id30">Regular Health Checks</a></p></li>
<li><p><a class="reference internal" href="#backup-verification" id="id31">Backup Verification</a></p></li>
<li><p><a class="reference internal" href="#log-monitoring" id="id32">Log Monitoring</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#advanced-debugging" id="id33">Advanced Debugging</a></p>
<ul>
<li><p><a class="reference internal" href="#kernel-debugging" id="id34">Kernel Debugging</a></p></li>
<li><p><a class="reference internal" href="#hardware-diagnostics" id="id35">Hardware Diagnostics</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="disk-and-partition-issues">
<h3><a class="toc-backref" href="#id1" role="doc-backlink">Disk and Partition Issues</a><a class="headerlink" href="#disk-and-partition-issues" title="Link to this heading"></a></h3>
<section id="disk-not-detected">
<h4><a class="toc-backref" href="#id2" role="doc-backlink">Disk Not Detected</a><a class="headerlink" href="#disk-not-detected" title="Link to this heading"></a></h4>
<p><strong>Symptoms:</strong>
- New disk not showing up in <cite>lsblk</cite> or <cite>fdisk -l</cite>
- System doesn’t recognize additional storage</p>
<p><strong>Diagnosis Steps:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check if disk is physically detected</span>
sudo<span class="w"> </span>dmesg<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;sd\|nvme\|ata&quot;</span>

<span class="c1"># Check SATA/NVMe connections</span>
lspci<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;sata\|nvme&quot;</span>

<span class="c1"># Rescan SCSI bus</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;- - -&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/sys/class/scsi_host/host*/scan

<span class="c1"># Check disk health</span>
sudo<span class="w"> </span>smartctl<span class="w"> </span>-a<span class="w"> </span>/dev/sdX
</pre></div>
</div>
<p><strong>Solutions:</strong></p>
<ol class="arabic">
<li><p><strong>Physical Connection Issues:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Power down and check connections</span>
sudo<span class="w"> </span>shutdown<span class="w"> </span>-h<span class="w"> </span>now
<span class="c1"># Check SATA/power cables</span>
<span class="c1"># Restart system</span>
</pre></div>
</div>
</li>
<li><p><strong>Driver Issues:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Update system</span>
sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>upgrade

<span class="c1"># Install additional drivers if needed</span>
sudo<span class="w"> </span>ubuntu-drivers<span class="w"> </span>autoinstall
</pre></div>
</div>
</li>
<li><p><strong>BIOS/UEFI Settings:</strong>
- Enable AHCI mode
- Check storage controller settings
- Verify disk is detected in BIOS</p></li>
</ol>
</section>
<section id="partition-table-corruption">
<h4><a class="toc-backref" href="#id3" role="doc-backlink">Partition Table Corruption</a><a class="headerlink" href="#partition-table-corruption" title="Link to this heading"></a></h4>
<p><strong>Symptoms:</strong>
- “Invalid partition table” errors
- Disk shows as unallocated space
- Boot issues</p>
<p><strong>Diagnosis:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check partition table</span>
sudo<span class="w"> </span>fdisk<span class="w"> </span>-l<span class="w"> </span>/dev/sdX

<span class="c1"># Check for backup GPT</span>
sudo<span class="w"> </span>gdisk<span class="w"> </span>-l<span class="w"> </span>/dev/sdX

<span class="c1"># Verify filesystem</span>
sudo<span class="w"> </span>file<span class="w"> </span>-s<span class="w"> </span>/dev/sdX*
</pre></div>
</div>
<p><strong>Recovery Steps:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Backup current state</span>
sudo<span class="w"> </span>dd<span class="w"> </span><span class="k">if</span><span class="o">=</span>/dev/sdX<span class="w"> </span><span class="nv">of</span><span class="o">=</span>/backup/disk-backup.img<span class="w"> </span><span class="nv">bs</span><span class="o">=</span><span class="m">512</span><span class="w"> </span><span class="nv">count</span><span class="o">=</span><span class="m">2048</span>

<span class="c1"># Try to repair GPT</span>
sudo<span class="w"> </span>gdisk<span class="w"> </span>/dev/sdX
<span class="c1"># In gdisk: use &#39;r&#39; for recovery menu, then &#39;b&#39; to rebuild MBR</span>

<span class="c1"># For MBR partition tables</span>
sudo<span class="w"> </span>fdisk<span class="w"> </span>/dev/sdX
<span class="c1"># Use &#39;p&#39; to print, &#39;w&#39; to write if fixable</span>

<span class="c1"># Create new partition table if necessary</span>
sudo<span class="w"> </span>parted<span class="w"> </span>/dev/sdX<span class="w"> </span>mklabel<span class="w"> </span>gpt
</pre></div>
</div>
</section>
<section id="boot-issues">
<h4><a class="toc-backref" href="#id4" role="doc-backlink">Boot Issues</a><a class="headerlink" href="#boot-issues" title="Link to this heading"></a></h4>
<p><strong>GRUB Boot Loader Problems:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Boot from Ubuntu Live USB</span>
<span class="c1"># Mount root filesystem</span>
sudo<span class="w"> </span>mount<span class="w"> </span>/dev/sdX1<span class="w"> </span>/mnt
sudo<span class="w"> </span>mount<span class="w"> </span>/dev/sdX2<span class="w"> </span>/mnt/boot<span class="w">  </span><span class="c1"># if separate boot partition</span>

<span class="c1"># Bind mount system directories</span>
sudo<span class="w"> </span>mount<span class="w"> </span>--bind<span class="w"> </span>/dev<span class="w"> </span>/mnt/dev
sudo<span class="w"> </span>mount<span class="w"> </span>--bind<span class="w"> </span>/proc<span class="w"> </span>/mnt/proc
sudo<span class="w"> </span>mount<span class="w"> </span>--bind<span class="w"> </span>/sys<span class="w"> </span>/mnt/sys

<span class="c1"># Chroot into system</span>
sudo<span class="w"> </span>chroot<span class="w"> </span>/mnt

<span class="c1"># Reinstall GRUB</span>
grub-install<span class="w"> </span>/dev/sdX
update-grub

<span class="c1"># Exit and reboot</span>
<span class="nb">exit</span>
sudo<span class="w"> </span>umount<span class="w"> </span>-R<span class="w"> </span>/mnt
sudo<span class="w"> </span>reboot
</pre></div>
</div>
<p><strong>Missing Boot Partition:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create new boot partition</span>
sudo<span class="w"> </span>parted<span class="w"> </span>/dev/sdX<span class="w"> </span>mkpart<span class="w"> </span>primary<span class="w"> </span>ext4<span class="w"> </span>1MiB<span class="w"> </span>512MiB
sudo<span class="w"> </span>mkfs.ext4<span class="w"> </span>/dev/sdX1

<span class="c1"># Mount and restore boot files</span>
sudo<span class="w"> </span>mount<span class="w"> </span>/dev/sdX1<span class="w"> </span>/mnt
sudo<span class="w"> </span>cp<span class="w"> </span>-r<span class="w"> </span>/boot/*<span class="w"> </span>/mnt/

<span class="c1"># Update fstab</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;UUID=</span><span class="k">$(</span>blkid<span class="w"> </span>-s<span class="w"> </span>UUID<span class="w"> </span>-o<span class="w"> </span>value<span class="w"> </span>/dev/sdX1<span class="k">)</span><span class="s2"> /boot ext4 defaults 0 2&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/fstab
</pre></div>
</div>
</section>
</section>
<section id="filesystem-issues">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">Filesystem Issues</a><a class="headerlink" href="#filesystem-issues" title="Link to this heading"></a></h3>
<section id="filesystem-corruption">
<h4><a class="toc-backref" href="#id6" role="doc-backlink">Filesystem Corruption</a><a class="headerlink" href="#filesystem-corruption" title="Link to this heading"></a></h4>
<p><strong>Symptoms:</strong>
- Read-only filesystem errors
- “Input/output error” messages
- Files disappearing or becoming inaccessible</p>
<p><strong>Emergency Recovery:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Remount filesystem as read-only</span>
sudo<span class="w"> </span>mount<span class="w"> </span>-o<span class="w"> </span>remount,ro<span class="w"> </span>/dev/sdX1

<span class="c1"># Backup critical data immediately</span>
sudo<span class="w"> </span>dd<span class="w"> </span><span class="k">if</span><span class="o">=</span>/dev/sdX1<span class="w"> </span><span class="nv">of</span><span class="o">=</span>/backup/corrupted-fs.img<span class="w"> </span><span class="nv">conv</span><span class="o">=</span>noerror,sync

<span class="c1"># Check filesystem</span>
sudo<span class="w"> </span>fsck<span class="w"> </span>-f<span class="w"> </span>/dev/sdX1
</pre></div>
</div>
<p><strong>Ext4 Filesystem Repair:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Unmount filesystem first</span>
sudo<span class="w"> </span>umount<span class="w"> </span>/dev/sdX1

<span class="c1"># Check and repair</span>
sudo<span class="w"> </span>e2fsck<span class="w"> </span>-f<span class="w"> </span>-y<span class="w"> </span>/dev/sdX1

<span class="c1"># If severely corrupted, try alternative superblock</span>
sudo<span class="w"> </span>e2fsck<span class="w"> </span>-b<span class="w"> </span><span class="m">32768</span><span class="w"> </span>/dev/sdX1

<span class="c1"># Force repair if needed</span>
sudo<span class="w"> </span>e2fsck<span class="w"> </span>-f<span class="w"> </span>-y<span class="w"> </span>-c<span class="w"> </span>/dev/sdX1
</pre></div>
</div>
<p><strong>XFS Filesystem Repair:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># XFS repair (filesystem must be unmounted)</span>
sudo<span class="w"> </span>umount<span class="w"> </span>/dev/sdX1
sudo<span class="w"> </span>xfs_repair<span class="w"> </span>/dev/sdX1

<span class="c1"># If metadata is corrupted</span>
sudo<span class="w"> </span>xfs_repair<span class="w"> </span>-L<span class="w"> </span>/dev/sdX1<span class="w">  </span><span class="c1"># This will clear the log</span>
</pre></div>
</div>
<p><strong>Btrfs Filesystem Repair:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check Btrfs filesystem</span>
sudo<span class="w"> </span>btrfs<span class="w"> </span>check<span class="w"> </span>/dev/sdX1

<span class="c1"># Repair if needed (dangerous, backup first)</span>
sudo<span class="w"> </span>btrfs<span class="w"> </span>check<span class="w"> </span>--repair<span class="w"> </span>/dev/sdX1

<span class="c1"># Scrub for data integrity</span>
sudo<span class="w"> </span>btrfs<span class="w"> </span>scrub<span class="w"> </span>start<span class="w"> </span>/mnt/btrfs-mount
</pre></div>
</div>
</section>
<section id="journal-issues">
<h4><a class="toc-backref" href="#id7" role="doc-backlink">Journal Issues</a><a class="headerlink" href="#journal-issues" title="Link to this heading"></a></h4>
<p><strong>Ext4 Journal Problems:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check journal status</span>
sudo<span class="w"> </span>tune2fs<span class="w"> </span>-l<span class="w"> </span>/dev/sdX1<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span>journal

<span class="c1"># Remove journal (converts to ext2)</span>
sudo<span class="w"> </span>tune2fs<span class="w"> </span>-O<span class="w"> </span>^has_journal<span class="w"> </span>/dev/sdX1

<span class="c1"># Add journal back</span>
sudo<span class="w"> </span>tune2fs<span class="w"> </span>-j<span class="w"> </span>/dev/sdX1

<span class="c1"># Or recreate journal</span>
sudo<span class="w"> </span>e2fsck<span class="w"> </span>-f<span class="w"> </span>/dev/sdX1
sudo<span class="w"> </span>tune2fs<span class="w"> </span>-J<span class="w"> </span><span class="nv">size</span><span class="o">=</span><span class="m">128</span><span class="w"> </span>/dev/sdX1
</pre></div>
</div>
</section>
<section id="full-disk-issues">
<h4><a class="toc-backref" href="#id8" role="doc-backlink">Full Disk Issues</a><a class="headerlink" href="#full-disk-issues" title="Link to this heading"></a></h4>
<p><strong>Disk Space Exhaustion:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find large files</span>
sudo<span class="w"> </span>find<span class="w"> </span>/<span class="w"> </span>-xdev<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-size<span class="w"> </span>+100M<span class="w"> </span>-exec<span class="w"> </span>ls<span class="w"> </span>-lh<span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null

<span class="c1"># Find large directories</span>
sudo<span class="w"> </span>du<span class="w"> </span>-h<span class="w"> </span>--max-depth<span class="o">=</span><span class="m">1</span><span class="w"> </span>/<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-hr

<span class="c1"># Clean package cache</span>
sudo<span class="w"> </span>apt<span class="w"> </span>autoremove
sudo<span class="w"> </span>apt<span class="w"> </span>autoclean

<span class="c1"># Clean journal logs</span>
sudo<span class="w"> </span>journalctl<span class="w"> </span>--vacuum-time<span class="o">=</span>3d

<span class="c1"># Clean temporary files</span>
sudo<span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>/tmp/*
sudo<span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>/var/tmp/*
</pre></div>
</div>
<p><strong>Inode Exhaustion:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check inode usage</span>
df<span class="w"> </span>-i

<span class="c1"># Find directories with many files</span>
sudo<span class="w"> </span>find<span class="w"> </span>/<span class="w"> </span>-xdev<span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-exec<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;echo &quot;$(ls -1 &quot;$1&quot; | wc -l) $1&quot;&#39;</span><span class="w"> </span>_<span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-n<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-20

<span class="c1"># Clean up small files</span>
sudo<span class="w"> </span>find<span class="w"> </span>/var/log<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;*.log&quot;</span><span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-size<span class="w"> </span>+100M<span class="w"> </span>-delete
sudo<span class="w"> </span>find<span class="w"> </span>/tmp<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-atime<span class="w"> </span>+7<span class="w"> </span>-delete
</pre></div>
</div>
</section>
</section>
<section id="lvm-issues">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">LVM Issues</a><a class="headerlink" href="#lvm-issues" title="Link to this heading"></a></h3>
<section id="physical-volume-problems">
<h4><a class="toc-backref" href="#id10" role="doc-backlink">Physical Volume Problems</a><a class="headerlink" href="#physical-volume-problems" title="Link to this heading"></a></h4>
<p><strong>PV Not Found:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Scan for PVs</span>
sudo<span class="w"> </span>pvscan

<span class="c1"># Force rescan</span>
sudo<span class="w"> </span>pvscan<span class="w"> </span>--cache

<span class="c1"># Check PV status</span>
sudo<span class="w"> </span>pvdisplay<span class="w"> </span>-v

<span class="c1"># Restore PV from backup</span>
sudo<span class="w"> </span>pvcreate<span class="w"> </span>--restorefile<span class="w"> </span>/etc/lvm/backup/vg_name<span class="w"> </span>--uuid<span class="w"> </span>PV_UUID<span class="w"> </span>/dev/sdX1
</pre></div>
</div>
<p><strong>Missing PV in VG:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check VG status</span>
sudo<span class="w"> </span>vgdisplay
sudo<span class="w"> </span>vgs<span class="w"> </span>-o<span class="w"> </span>+pv_missing

<span class="c1"># Try to activate VG with missing PV</span>
sudo<span class="w"> </span>vgchange<span class="w"> </span>-ay<span class="w"> </span>--partial<span class="w"> </span>volume_group_name

<span class="c1"># Remove missing PV</span>
sudo<span class="w"> </span>vgreduce<span class="w"> </span>--removemissing<span class="w"> </span>volume_group_name
</pre></div>
</div>
</section>
<section id="volume-group-issues">
<h4><a class="toc-backref" href="#id11" role="doc-backlink">Volume Group Issues</a><a class="headerlink" href="#volume-group-issues" title="Link to this heading"></a></h4>
<p><strong>VG Cannot Be Activated:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check VG metadata</span>
sudo<span class="w"> </span>vgck<span class="w"> </span>volume_group_name

<span class="c1"># Restore VG from backup</span>
sudo<span class="w"> </span>vgcfgrestore<span class="w"> </span>volume_group_name

<span class="c1"># Manual metadata restore</span>
sudo<span class="w"> </span>vgcfgrestore<span class="w"> </span>-f<span class="w"> </span>/etc/lvm/backup/volume_group_name<span class="w"> </span>volume_group_name
</pre></div>
</div>
</section>
<section id="logical-volume-problems">
<h4><a class="toc-backref" href="#id12" role="doc-backlink">Logical Volume Problems</a><a class="headerlink" href="#logical-volume-problems" title="Link to this heading"></a></h4>
<p><strong>LV Won’t Mount:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check LV status</span>
sudo<span class="w"> </span>lvdisplay
sudo<span class="w"> </span>lvs<span class="w"> </span>-a

<span class="c1"># Activate LV</span>
sudo<span class="w"> </span>lvchange<span class="w"> </span>-ay<span class="w"> </span>/dev/volume_group/logical_volume

<span class="c1"># Check filesystem</span>
sudo<span class="w"> </span>fsck<span class="w"> </span>/dev/volume_group/logical_volume
</pre></div>
</div>
<p><strong>LV Resize Issues:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check available space</span>
sudo<span class="w"> </span>vgs

<span class="c1"># Extend LV</span>
sudo<span class="w"> </span>lvextend<span class="w"> </span>-L<span class="w"> </span>+1G<span class="w"> </span>/dev/volume_group/logical_volume

<span class="c1"># Resize filesystem</span>
sudo<span class="w"> </span>resize2fs<span class="w"> </span>/dev/volume_group/logical_volume<span class="w">  </span><span class="c1"># for ext4</span>
sudo<span class="w"> </span>xfs_growfs<span class="w"> </span>/mount/point<span class="w">                      </span><span class="c1"># for XFS</span>
</pre></div>
</div>
</section>
</section>
<section id="raid-issues">
<h3><a class="toc-backref" href="#id13" role="doc-backlink">RAID Issues</a><a class="headerlink" href="#raid-issues" title="Link to this heading"></a></h3>
<section id="software-raid-problems">
<h4><a class="toc-backref" href="#id14" role="doc-backlink">Software RAID Problems</a><a class="headerlink" href="#software-raid-problems" title="Link to this heading"></a></h4>
<p><strong>Array Degraded:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check RAID status</span>
cat<span class="w"> </span>/proc/mdstat

<span class="c1"># Check individual device status</span>
sudo<span class="w"> </span>mdadm<span class="w"> </span>--detail<span class="w"> </span>/dev/md0

<span class="c1"># Remove failed device</span>
sudo<span class="w"> </span>mdadm<span class="w"> </span>--manage<span class="w"> </span>/dev/md0<span class="w"> </span>--remove<span class="w"> </span>/dev/sdX1

<span class="c1"># Add replacement device</span>
sudo<span class="w"> </span>mdadm<span class="w"> </span>--manage<span class="w"> </span>/dev/md0<span class="w"> </span>--add<span class="w"> </span>/dev/sdY1

<span class="c1"># Monitor rebuild</span>
watch<span class="w"> </span>cat<span class="w"> </span>/proc/mdstat
</pre></div>
</div>
<p><strong>Array Won’t Start:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Try to assemble array</span>
sudo<span class="w"> </span>mdadm<span class="w"> </span>--assemble<span class="w"> </span>/dev/md0<span class="w"> </span>/dev/sd<span class="o">[</span>abc<span class="o">]</span><span class="m">1</span>

<span class="c1"># Force assembly with missing device</span>
sudo<span class="w"> </span>mdadm<span class="w"> </span>--assemble<span class="w"> </span>--force<span class="w"> </span>/dev/md0<span class="w"> </span>/dev/sd<span class="o">[</span>ab<span class="o">]</span><span class="m">1</span>

<span class="c1"># Scan and assemble all arrays</span>
sudo<span class="w"> </span>mdadm<span class="w"> </span>--assemble<span class="w"> </span>--scan
</pre></div>
</div>
<p><strong>Superblock Issues:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check superblock</span>
sudo<span class="w"> </span>mdadm<span class="w"> </span>--examine<span class="w"> </span>/dev/sdX1

<span class="c1"># Zero superblock if corrupted</span>
sudo<span class="w"> </span>mdadm<span class="w"> </span>--zero-superblock<span class="w"> </span>/dev/sdX1

<span class="c1"># Recreate array (data loss!)</span>
sudo<span class="w"> </span>mdadm<span class="w"> </span>--create<span class="w"> </span>/dev/md0<span class="w"> </span>--level<span class="o">=</span><span class="m">1</span><span class="w"> </span>--raid-devices<span class="o">=</span><span class="m">2</span><span class="w"> </span>/dev/sda1<span class="w"> </span>/dev/sdb1
</pre></div>
</div>
</section>
<section id="hardware-raid-issues">
<h4><a class="toc-backref" href="#id15" role="doc-backlink">Hardware RAID Issues</a><a class="headerlink" href="#hardware-raid-issues" title="Link to this heading"></a></h4>
<p><strong>Controller Detection:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check for RAID controllers</span>
lspci<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span>raid

<span class="c1"># Install management tools</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>megacli<span class="w"> </span>hpacucli<span class="w">  </span><span class="c1"># for MegaRAID and HP Smart Array</span>

<span class="c1"># Check controller status</span>
sudo<span class="w"> </span>megacli<span class="w"> </span>-AdpAllInfo<span class="w"> </span>-aALL<span class="w">      </span><span class="c1"># MegaRAID</span>
sudo<span class="w"> </span>hpacucli<span class="w"> </span>ctrl<span class="w"> </span>all<span class="w"> </span>show<span class="w">         </span><span class="c1"># HP Smart Array</span>
</pre></div>
</div>
</section>
</section>
<section id="network-storage-issues">
<h3><a class="toc-backref" href="#id16" role="doc-backlink">Network Storage Issues</a><a class="headerlink" href="#network-storage-issues" title="Link to this heading"></a></h3>
<section id="nfs-mount-problems">
<h4><a class="toc-backref" href="#id17" role="doc-backlink">NFS Mount Problems</a><a class="headerlink" href="#nfs-mount-problems" title="Link to this heading"></a></h4>
<p><strong>Mount Fails:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check NFS server availability</span>
showmount<span class="w"> </span>-e<span class="w"> </span>nfs-server-ip

<span class="c1"># Test network connectivity</span>
ping<span class="w"> </span>nfs-server-ip
telnet<span class="w"> </span>nfs-server-ip<span class="w"> </span><span class="m">2049</span>

<span class="c1"># Check NFS services</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>nfs-client.target
sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>nfs-client.target

<span class="c1"># Debug mount</span>
sudo<span class="w"> </span>mount<span class="w"> </span>-v<span class="w"> </span>-t<span class="w"> </span>nfs<span class="w"> </span>nfs-server:/export<span class="w"> </span>/mnt/nfs
</pre></div>
</div>
<p><strong>Stale NFS Handles:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Force unmount</span>
sudo<span class="w"> </span>umount<span class="w"> </span>-f<span class="w"> </span>/mnt/nfs

<span class="c1"># Lazy unmount</span>
sudo<span class="w"> </span>umount<span class="w"> </span>-l<span class="w"> </span>/mnt/nfs

<span class="c1"># Clear stale handles</span>
sudo<span class="w"> </span>mount<span class="w"> </span>-o<span class="w"> </span>remount<span class="w"> </span>/mnt/nfs
</pre></div>
</div>
</section>
<section id="samba-cifs-issues">
<h4><a class="toc-backref" href="#id18" role="doc-backlink">Samba/CIFS Issues</a><a class="headerlink" href="#samba-cifs-issues" title="Link to this heading"></a></h4>
<p><strong>Authentication Failures:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Test with different authentication</span>
sudo<span class="w"> </span>mount<span class="w"> </span>-t<span class="w"> </span>cifs<span class="w"> </span>//server/share<span class="w"> </span>/mnt/cifs<span class="w"> </span>-o<span class="w"> </span><span class="nv">username</span><span class="o">=</span>user,password<span class="o">=</span>pass,vers<span class="o">=</span><span class="m">3</span>.0

<span class="c1"># Check supported protocols</span>
sudo<span class="w"> </span>mount<span class="w"> </span>-t<span class="w"> </span>cifs<span class="w"> </span>//server/share<span class="w"> </span>/mnt/cifs<span class="w"> </span>-o<span class="w"> </span><span class="nv">username</span><span class="o">=</span>user,vers<span class="o">=</span><span class="m">1</span>.0

<span class="c1"># Use credentials file</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;username=user&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/cifs-credentials
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;password=pass&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/cifs-credentials
sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">600</span><span class="w"> </span>/etc/cifs-credentials
sudo<span class="w"> </span>mount<span class="w"> </span>-t<span class="w"> </span>cifs<span class="w"> </span>//server/share<span class="w"> </span>/mnt/cifs<span class="w"> </span>-o<span class="w"> </span><span class="nv">credentials</span><span class="o">=</span>/etc/cifs-credentials
</pre></div>
</div>
</section>
</section>
<section id="performance-issues">
<h3><a class="toc-backref" href="#id19" role="doc-backlink">Performance Issues</a><a class="headerlink" href="#performance-issues" title="Link to this heading"></a></h3>
<section id="slow-disk-performance">
<h4><a class="toc-backref" href="#id20" role="doc-backlink">Slow Disk Performance</a><a class="headerlink" href="#slow-disk-performance" title="Link to this heading"></a></h4>
<p><strong>Diagnosis:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check I/O statistics</span>
iostat<span class="w"> </span>-x<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">10</span>

<span class="c1"># Monitor disk activity</span>
iotop

<span class="c1"># Check for errors</span>
dmesg<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;error\|fail&quot;</span>

<span class="c1"># SMART health check</span>
sudo<span class="w"> </span>smartctl<span class="w"> </span>-a<span class="w"> </span>/dev/sdX
</pre></div>
</div>
<p><strong>Optimization:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check and optimize mount options</span>
sudo<span class="w"> </span>mount<span class="w"> </span>-o<span class="w"> </span>remount,noatime,nodiratime<span class="w"> </span>/dev/sdX1

<span class="c1"># Adjust I/O scheduler</span>
<span class="nb">echo</span><span class="w"> </span>deadline<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/sys/block/sdX/queue/scheduler

<span class="c1"># Optimize for SSD</span>
<span class="nb">echo</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/sys/block/sdX/queue/rotational
sudo<span class="w"> </span>fstrim<span class="w"> </span>-v<span class="w"> </span>/
</pre></div>
</div>
</section>
<section id="high-i-o-wait">
<h4><a class="toc-backref" href="#id21" role="doc-backlink">High I/O Wait</a><a class="headerlink" href="#high-i-o-wait" title="Link to this heading"></a></h4>
<p><strong>Investigation:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check system load</span>
uptime

<span class="c1"># Identify processes causing I/O</span>
iotop<span class="w"> </span>-a<span class="w"> </span>-o

<span class="c1"># Check for swap usage</span>
free<span class="w"> </span>-h
swapon<span class="w"> </span>--show

<span class="c1"># Monitor I/O per process</span>
pidstat<span class="w"> </span>-d<span class="w"> </span><span class="m">1</span>
</pre></div>
</div>
</section>
<section id="memory-and-cache-issues">
<h4><a class="toc-backref" href="#id22" role="doc-backlink">Memory and Cache Issues</a><a class="headerlink" href="#memory-and-cache-issues" title="Link to this heading"></a></h4>
<p><strong>Clear Caches:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Drop caches safely</span>
sync
<span class="nb">echo</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/proc/sys/vm/drop_caches

<span class="c1"># Adjust swappiness</span>
<span class="nb">echo</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/proc/sys/vm/swappiness
</pre></div>
</div>
<p><strong>Check Memory Usage:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Detailed memory information</span>
cat<span class="w"> </span>/proc/meminfo

<span class="c1"># Check for memory leaks</span>
ps<span class="w"> </span>aux<span class="w"> </span>--sort<span class="o">=</span>-%mem<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-10
</pre></div>
</div>
</section>
</section>
<section id="recovery-procedures">
<h3><a class="toc-backref" href="#id23" role="doc-backlink">Recovery Procedures</a><a class="headerlink" href="#recovery-procedures" title="Link to this heading"></a></h3>
<section id="data-recovery">
<h4><a class="toc-backref" href="#id24" role="doc-backlink">Data Recovery</a><a class="headerlink" href="#data-recovery" title="Link to this heading"></a></h4>
<p><strong>File Recovery with TestDisk:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install TestDisk</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>testdisk

<span class="c1"># Run TestDisk for partition recovery</span>
sudo<span class="w"> </span>testdisk

<span class="c1"># Use PhotoRec for file recovery</span>
sudo<span class="w"> </span>photorec
</pre></div>
</div>
<p><strong>DD Rescue for Damaged Disks:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install ddrescue</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>gddrescue

<span class="c1"># Create image of damaged disk</span>
sudo<span class="w"> </span>ddrescue<span class="w"> </span>-d<span class="w"> </span>-r3<span class="w"> </span>/dev/sdX<span class="w"> </span>/path/to/rescue.img<span class="w"> </span>/path/to/rescue.log

<span class="c1"># Continue rescue operation</span>
sudo<span class="w"> </span>ddrescue<span class="w"> </span>-d<span class="w"> </span>-r3<span class="w"> </span>/dev/sdX<span class="w"> </span>/path/to/rescue.img<span class="w"> </span>/path/to/rescue.log
</pre></div>
</div>
</section>
<section id="system-recovery">
<h4><a class="toc-backref" href="#id25" role="doc-backlink">System Recovery</a><a class="headerlink" href="#system-recovery" title="Link to this heading"></a></h4>
<p><strong>Boot from Live USB:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Mount root filesystem</span>
sudo<span class="w"> </span>mkdir<span class="w"> </span>/mnt/system
sudo<span class="w"> </span>mount<span class="w"> </span>/dev/sdX1<span class="w"> </span>/mnt/system

<span class="c1"># Mount other partitions</span>
sudo<span class="w"> </span>mount<span class="w"> </span>/dev/sdX2<span class="w"> </span>/mnt/system/boot
sudo<span class="w"> </span>mount<span class="w"> </span>/dev/sdX3<span class="w"> </span>/mnt/system/home

<span class="c1"># Chroot into system</span>
sudo<span class="w"> </span>mount<span class="w"> </span>--bind<span class="w"> </span>/dev<span class="w"> </span>/mnt/system/dev
sudo<span class="w"> </span>mount<span class="w"> </span>--bind<span class="w"> </span>/proc<span class="w"> </span>/mnt/system/proc
sudo<span class="w"> </span>mount<span class="w"> </span>--bind<span class="w"> </span>/sys<span class="w"> </span>/mnt/system/sys
sudo<span class="w"> </span>chroot<span class="w"> </span>/mnt/system
</pre></div>
</div>
<p><strong>Backup Before Recovery:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create full system backup</span>
sudo<span class="w"> </span>dd<span class="w"> </span><span class="k">if</span><span class="o">=</span>/dev/sdX<span class="w"> </span><span class="nv">of</span><span class="o">=</span>/backup/full-disk.img<span class="w"> </span><span class="nv">bs</span><span class="o">=</span>64K<span class="w"> </span><span class="nv">conv</span><span class="o">=</span>noerror,sync

<span class="c1"># Create compressed backup</span>
sudo<span class="w"> </span>dd<span class="w"> </span><span class="k">if</span><span class="o">=</span>/dev/sdX<span class="w"> </span><span class="nv">bs</span><span class="o">=</span>64K<span class="w"> </span><span class="nv">conv</span><span class="o">=</span>noerror,sync<span class="w"> </span><span class="p">|</span><span class="w"> </span>gzip<span class="w"> </span>&gt;<span class="w"> </span>/backup/disk-backup.img.gz
</pre></div>
</div>
</section>
</section>
<section id="emergency-procedures">
<h3><a class="toc-backref" href="#id26" role="doc-backlink">Emergency Procedures</a><a class="headerlink" href="#emergency-procedures" title="Link to this heading"></a></h3>
<section id="read-only-filesystem-recovery">
<h4><a class="toc-backref" href="#id27" role="doc-backlink">Read-Only Filesystem Recovery</a><a class="headerlink" href="#read-only-filesystem-recovery" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check why filesystem is read-only</span>
dmesg<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-50

<span class="c1"># Try to remount read-write</span>
sudo<span class="w"> </span>mount<span class="w"> </span>-o<span class="w"> </span>remount,rw<span class="w"> </span>/

<span class="c1"># If that fails, check filesystem</span>
sudo<span class="w"> </span>fsck<span class="w"> </span>-f<span class="w"> </span>/dev/sdX1

<span class="c1"># Force filesystem check on next boot</span>
sudo<span class="w"> </span>touch<span class="w"> </span>/forcefsck
</pre></div>
</div>
</section>
<section id="disk-failure-emergency">
<h4><a class="toc-backref" href="#id28" role="doc-backlink">Disk Failure Emergency</a><a class="headerlink" href="#disk-failure-emergency" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Immediate data backup</span>
sudo<span class="w"> </span>dd<span class="w"> </span><span class="k">if</span><span class="o">=</span>/dev/failing_disk<span class="w"> </span><span class="nv">of</span><span class="o">=</span>/backup/emergency.img<span class="w"> </span><span class="nv">bs</span><span class="o">=</span><span class="m">4096</span><span class="w"> </span><span class="nv">conv</span><span class="o">=</span>noerror,sync

<span class="c1"># Monitor SMART status</span>
sudo<span class="w"> </span>smartctl<span class="w"> </span>-t<span class="w"> </span>short<span class="w"> </span>/dev/sdX
sudo<span class="w"> </span>smartctl<span class="w"> </span>-a<span class="w"> </span>/dev/sdX

<span class="c1"># Prepare replacement</span>
sudo<span class="w"> </span>fdisk<span class="w"> </span>-l<span class="w"> </span>/dev/new_disk
sudo<span class="w"> </span>dd<span class="w"> </span><span class="k">if</span><span class="o">=</span>/backup/emergency.img<span class="w"> </span><span class="nv">of</span><span class="o">=</span>/dev/new_disk<span class="w"> </span><span class="nv">bs</span><span class="o">=</span><span class="m">4096</span>
</pre></div>
</div>
</section>
</section>
<section id="preventive-measures">
<h3><a class="toc-backref" href="#id29" role="doc-backlink">Preventive Measures</a><a class="headerlink" href="#preventive-measures" title="Link to this heading"></a></h3>
<section id="regular-health-checks">
<h4><a class="toc-backref" href="#id30" role="doc-backlink">Regular Health Checks</a><a class="headerlink" href="#regular-health-checks" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create monitoring script</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>/usr/local/bin/storage-health.sh<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s">#!/bin/bash</span>

<span class="s"># Check disk usage</span>
<span class="s">df -h | awk &#39;$5+0 &gt; 80 {print &quot;WARNING: &quot; $0}&#39;</span>

<span class="s"># Check SMART status</span>
<span class="s">for disk in /dev/sd[a-z]; do</span>
<span class="s">    if [ -e &quot;$disk&quot; ]; then</span>
<span class="s">        smartctl -H &quot;$disk&quot; | grep -q &quot;PASSED&quot; || echo &quot;SMART FAILURE: $disk&quot;</span>
<span class="s">    fi</span>
<span class="s">done</span>

<span class="s"># Check RAID status</span>
<span class="s">if [ -f /proc/mdstat ]; then</span>
<span class="s">    grep -q &quot;_&quot; /proc/mdstat &amp;&amp; echo &quot;RAID DEGRADED&quot;</span>
<span class="s">fi</span>
<span class="s">EOF</span>

chmod<span class="w"> </span>+x<span class="w"> </span>/usr/local/bin/storage-health.sh

<span class="c1"># Add to crontab</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;0 6 * * * root /usr/local/bin/storage-health.sh&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/etc/crontab
</pre></div>
</div>
</section>
<section id="backup-verification">
<h4><a class="toc-backref" href="#id31" role="doc-backlink">Backup Verification</a><a class="headerlink" href="#backup-verification" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Verify backup integrity</span>
md5sum<span class="w"> </span>/backup/important-data.tar.gz<span class="w"> </span>&gt;<span class="w"> </span>/backup/checksums.md5

<span class="c1"># Test restore procedure</span>
tar<span class="w"> </span>-tzf<span class="w"> </span>/backup/important-data.tar.gz<span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Backup OK&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Backup CORRUPTED&quot;</span>
</pre></div>
</div>
</section>
<section id="log-monitoring">
<h4><a class="toc-backref" href="#id32" role="doc-backlink">Log Monitoring</a><a class="headerlink" href="#log-monitoring" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Monitor for storage errors</span>
tail<span class="w"> </span>-f<span class="w"> </span>/var/log/syslog<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;error\|fail\|critical&quot;</span>

<span class="c1"># Set up logwatch for storage events</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>logwatch
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;storage&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/logwatch/conf/services/storage.conf
</pre></div>
</div>
</section>
</section>
<section id="advanced-debugging">
<h3><a class="toc-backref" href="#id33" role="doc-backlink">Advanced Debugging</a><a class="headerlink" href="#advanced-debugging" title="Link to this heading"></a></h3>
<section id="kernel-debugging">
<h4><a class="toc-backref" href="#id34" role="doc-backlink">Kernel Debugging</a><a class="headerlink" href="#kernel-debugging" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Enable kernel debugging</span>
<span class="nb">echo</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/proc/sys/kernel/printk

<span class="c1"># Check kernel ring buffer</span>
dmesg<span class="w"> </span>-T<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;storage\|disk\|ata\|scsi&quot;</span>

<span class="c1"># Enable block device debugging</span>
<span class="nb">echo</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/sys/block/sdX/queue/iostats
</pre></div>
</div>
</section>
<section id="hardware-diagnostics">
<h4><a class="toc-backref" href="#id35" role="doc-backlink">Hardware Diagnostics</a><a class="headerlink" href="#hardware-diagnostics" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check hardware information</span>
sudo<span class="w"> </span>lshw<span class="w"> </span>-class<span class="w"> </span>disk
sudo<span class="w"> </span>lspci<span class="w"> </span>-v<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-A<span class="w"> </span><span class="m">10</span><span class="w"> </span>-i<span class="w"> </span>storage

<span class="c1"># Test memory</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>memtest86+
<span class="c1"># Reboot and select memtest from GRUB menu</span>

<span class="c1"># CPU stress test</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>stress-ng
stress-ng<span class="w"> </span>--cpu<span class="w"> </span><span class="m">4</span><span class="w"> </span>--timeout<span class="w"> </span>60s
</pre></div>
</div>
<p>This troubleshooting guide provides systematic approaches to diagnose and resolve storage issues on Ubuntu 22.04. Always backup critical data before attempting repairs, and consider professional data recovery services for valuable data on physically damaged drives.</p>
</section>
</section>
</section>
<span id="document-best-practices"></span><section id="best-practices-and-guidelines">
<h2>Best Practices and Guidelines<a class="headerlink" href="#best-practices-and-guidelines" title="Link to this heading"></a></h2>
<p>This section outlines industry best practices and proven guidelines for storage management on Ubuntu 22.04.</p>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#storage-planning-and-design" id="id1">Storage Planning and Design</a></p>
<ul>
<li><p><a class="reference internal" href="#capacity-planning" id="id2">Capacity Planning</a></p></li>
<li><p><a class="reference internal" href="#filesystem-selection-guidelines" id="id3">Filesystem Selection Guidelines</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#partitioning-best-practices" id="id4">Partitioning Best Practices</a></p>
<ul>
<li><p><a class="reference internal" href="#partition-layout-strategy" id="id5">Partition Layout Strategy</a></p></li>
<li><p><a class="reference internal" href="#alignment-and-performance" id="id6">Alignment and Performance</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#security-best-practices" id="id7">Security Best Practices</a></p>
<ul>
<li><p><a class="reference internal" href="#encryption-at-rest" id="id8">Encryption at Rest</a></p></li>
<li><p><a class="reference internal" href="#access-control-and-permissions" id="id9">Access Control and Permissions</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#backup-and-recovery-strategies" id="id10">Backup and Recovery Strategies</a></p>
<ul>
<li><p><a class="reference internal" href="#backup-strategy-framework" id="id11">Backup Strategy Framework</a></p></li>
<li><p><a class="reference internal" href="#recovery-planning" id="id12">Recovery Planning</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#performance-optimization" id="id13">Performance Optimization</a></p>
<ul>
<li><p><a class="reference internal" href="#i-o-optimization" id="id14">I/O Optimization</a></p></li>
<li><p><a class="reference internal" href="#memory-and-cache-optimization" id="id15">Memory and Cache Optimization</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#monitoring-and-alerting" id="id16">Monitoring and Alerting</a></p>
<ul>
<li><p><a class="reference internal" href="#proactive-monitoring" id="id17">Proactive Monitoring</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#maintenance-procedures" id="id18">Maintenance Procedures</a></p>
<ul>
<li><p><a class="reference internal" href="#regular-maintenance-tasks" id="id19">Regular Maintenance Tasks</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#documentation-and-change-management" id="id20">Documentation and Change Management</a></p>
<ul>
<li><p><a class="reference internal" href="#documentation-standards" id="id21">Documentation Standards</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="storage-planning-and-design">
<h3><a class="toc-backref" href="#id1" role="doc-backlink">Storage Planning and Design</a><a class="headerlink" href="#storage-planning-and-design" title="Link to this heading"></a></h3>
<section id="capacity-planning">
<h4><a class="toc-backref" href="#id2" role="doc-backlink">Capacity Planning</a><a class="headerlink" href="#capacity-planning" title="Link to this heading"></a></h4>
<p><strong>Growth Assessment:</strong></p>
<ul class="simple">
<li><p>Plan for 3-5 years of growth</p></li>
<li><p>Account for data growth rates: 20-40% annually for typical business environments</p></li>
<li><p>Include overhead for snapshots, backups, and temporary files</p></li>
<li><p>Reserve 10-15% free space for optimal performance</p></li>
</ul>
<p><strong>Performance Requirements:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Benchmark current workload</span>
iotop<span class="w"> </span>-a<span class="w"> </span>-o<span class="w"> </span>-d<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-20

<span class="c1"># Monitor I/O patterns</span>
iostat<span class="w"> </span>-x<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">60</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>io-analysis.log

<span class="c1"># Calculate IOPS requirements</span>
<span class="c1"># Sequential workloads: 100-500 IOPS</span>
<span class="c1"># Random workloads: 1000-10000+ IOPS</span>
<span class="c1"># Database workloads: 5000-50000+ IOPS</span>
</pre></div>
</div>
<p><strong>Storage Hierarchy Design:</strong></p>
<ol class="arabic simple">
<li><p><strong>Hot Data</strong> (frequently accessed)
- NVMe SSD for highest performance
- Direct attachment or high-speed SAN</p></li>
<li><p><strong>Warm Data</strong> (regularly accessed)
- SATA SSD or high-performance HDD
- Network storage with good connectivity</p></li>
<li><p><strong>Cold Data</strong> (archival/backup)
- High-capacity HDD
- Object storage or tape for long-term retention</p></li>
</ol>
</section>
<section id="filesystem-selection-guidelines">
<h4><a class="toc-backref" href="#id3" role="doc-backlink">Filesystem Selection Guidelines</a><a class="headerlink" href="#filesystem-selection-guidelines" title="Link to this heading"></a></h4>
<p><strong>Ext4 - General Purpose:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Optimal for most workloads</span>
sudo<span class="w"> </span>mkfs.ext4<span class="w"> </span>-E<span class="w"> </span><span class="nv">stride</span><span class="o">=</span><span class="m">32</span>,stripe-width<span class="o">=</span><span class="m">64</span><span class="w"> </span>/dev/sdX1

<span class="c1"># Mount options for performance</span>
mount<span class="w"> </span>-o<span class="w"> </span>noatime,nodiratime,data<span class="o">=</span>writeback<span class="w"> </span>/dev/sdX1<span class="w"> </span>/mnt
</pre></div>
</div>
<p><em>Use Cases:</em> Boot partitions, general file storage, databases with simple requirements</p>
<p><strong>XFS - High Performance:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create with optimal settings</span>
sudo<span class="w"> </span>mkfs.xfs<span class="w"> </span>-f<span class="w"> </span>-s<span class="w"> </span><span class="nv">size</span><span class="o">=</span><span class="m">4096</span><span class="w"> </span>-d<span class="w"> </span><span class="nv">agcount</span><span class="o">=</span><span class="m">8</span><span class="w"> </span>/dev/sdX1

<span class="c1"># Mount with performance options</span>
mount<span class="w"> </span>-o<span class="w"> </span>noatime,logbsize<span class="o">=</span>256k,largeio<span class="w"> </span>/dev/sdX1<span class="w"> </span>/mnt
</pre></div>
</div>
<p><em>Use Cases:</em> Large files, high-throughput applications, media streaming</p>
<p><strong>Btrfs - Advanced Features:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create with metadata redundancy</span>
sudo<span class="w"> </span>mkfs.btrfs<span class="w"> </span>-m<span class="w"> </span>raid1<span class="w"> </span>-d<span class="w"> </span>single<span class="w"> </span>/dev/sdX1<span class="w"> </span>/dev/sdX2

<span class="c1"># Enable compression</span>
mount<span class="w"> </span>-o<span class="w"> </span><span class="nv">compress</span><span class="o">=</span>zstd,noatime<span class="w"> </span>/dev/sdX1<span class="w"> </span>/mnt
</pre></div>
</div>
<p><em>Use Cases:</em> Development environments, systems requiring snapshots, data integrity critical applications</p>
<p><strong>ZFS - Enterprise Features:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install ZFS</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>zfsutils-linux

<span class="c1"># Create pool with redundancy</span>
sudo<span class="w"> </span>zpool<span class="w"> </span>create<span class="w"> </span>-o<span class="w"> </span><span class="nv">ashift</span><span class="o">=</span><span class="m">12</span><span class="w"> </span>tank<span class="w"> </span>raidz2<span class="w"> </span>/dev/sd<span class="o">[</span>abcd<span class="o">]</span><span class="m">1</span>

<span class="c1"># Create filesystem with compression</span>
sudo<span class="w"> </span>zfs<span class="w"> </span>create<span class="w"> </span>-o<span class="w"> </span><span class="nv">compression</span><span class="o">=</span>lz4<span class="w"> </span>tank/data
</pre></div>
</div>
<p><em>Use Cases:</em> Enterprise storage, virtualization, backup systems</p>
</section>
</section>
<section id="partitioning-best-practices">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">Partitioning Best Practices</a><a class="headerlink" href="#partitioning-best-practices" title="Link to this heading"></a></h3>
<section id="partition-layout-strategy">
<h4><a class="toc-backref" href="#id5" role="doc-backlink">Partition Layout Strategy</a><a class="headerlink" href="#partition-layout-strategy" title="Link to this heading"></a></h4>
<p><strong>Standard Desktop/Server Layout:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create GPT partition table</span>
sudo<span class="w"> </span>parted<span class="w"> </span>/dev/sdX<span class="w"> </span>mklabel<span class="w"> </span>gpt

<span class="c1"># UEFI boot partition (512MB)</span>
sudo<span class="w"> </span>parted<span class="w"> </span>/dev/sdX<span class="w"> </span>mkpart<span class="w"> </span>primary<span class="w"> </span>fat32<span class="w"> </span>1MiB<span class="w"> </span>513MiB
sudo<span class="w"> </span>parted<span class="w"> </span>/dev/sdX<span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>esp<span class="w"> </span>on

<span class="c1"># Root partition (20-50GB minimum)</span>
sudo<span class="w"> </span>parted<span class="w"> </span>/dev/sdX<span class="w"> </span>mkpart<span class="w"> </span>primary<span class="w"> </span>ext4<span class="w"> </span>513MiB<span class="w"> </span>50GiB

<span class="c1"># Home partition (remaining space)</span>
sudo<span class="w"> </span>parted<span class="w"> </span>/dev/sdX<span class="w"> </span>mkpart<span class="w"> </span>primary<span class="w"> </span>ext4<span class="w"> </span>50GiB<span class="w"> </span><span class="m">100</span>%
</pre></div>
</div>
<p><strong>Server Layout with Separate Partitions:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Boot partition (1GB)</span>
sudo<span class="w"> </span>parted<span class="w"> </span>/dev/sdX<span class="w"> </span>mkpart<span class="w"> </span>primary<span class="w"> </span>ext4<span class="w"> </span>1MiB<span class="w"> </span>1GiB

<span class="c1"># Root partition (20GB)</span>
sudo<span class="w"> </span>parted<span class="w"> </span>/dev/sdX<span class="w"> </span>mkpart<span class="w"> </span>primary<span class="w"> </span>ext4<span class="w"> </span>1GiB<span class="w"> </span>21GiB

<span class="c1"># Var partition (10GB minimum)</span>
sudo<span class="w"> </span>parted<span class="w"> </span>/dev/sdX<span class="w"> </span>mkpart<span class="w"> </span>primary<span class="w"> </span>ext4<span class="w"> </span>21GiB<span class="w"> </span>31GiB

<span class="c1"># Home partition (as needed)</span>
sudo<span class="w"> </span>parted<span class="w"> </span>/dev/sdX<span class="w"> </span>mkpart<span class="w"> </span>primary<span class="w"> </span>ext4<span class="w"> </span>31GiB<span class="w"> </span>131GiB

<span class="c1"># Tmp partition (5GB)</span>
sudo<span class="w"> </span>parted<span class="w"> </span>/dev/sdX<span class="w"> </span>mkpart<span class="w"> </span>primary<span class="w"> </span>ext4<span class="w"> </span>131GiB<span class="w"> </span>136GiB
</pre></div>
</div>
<p><strong>LVM-based Layout:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create LVM partition</span>
sudo<span class="w"> </span>parted<span class="w"> </span>/dev/sdX<span class="w"> </span>mkpart<span class="w"> </span>primary<span class="w"> </span>513MiB<span class="w"> </span><span class="m">100</span>%
sudo<span class="w"> </span>parted<span class="w"> </span>/dev/sdX<span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="m">2</span><span class="w"> </span>lvm<span class="w"> </span>on

<span class="c1"># Initialize LVM</span>
sudo<span class="w"> </span>pvcreate<span class="w"> </span>/dev/sdX2
sudo<span class="w"> </span>vgcreate<span class="w"> </span>vg0<span class="w"> </span>/dev/sdX2

<span class="c1"># Create logical volumes</span>
sudo<span class="w"> </span>lvcreate<span class="w"> </span>-L<span class="w"> </span>20G<span class="w"> </span>-n<span class="w"> </span>root<span class="w"> </span>vg0
sudo<span class="w"> </span>lvcreate<span class="w"> </span>-L<span class="w"> </span>10G<span class="w"> </span>-n<span class="w"> </span>var<span class="w"> </span>vg0
sudo<span class="w"> </span>lvcreate<span class="w"> </span>-L<span class="w"> </span>50G<span class="w"> </span>-n<span class="w"> </span>home<span class="w"> </span>vg0
sudo<span class="w"> </span>lvcreate<span class="w"> </span>-L<span class="w"> </span>4G<span class="w"> </span>-n<span class="w"> </span>swap<span class="w"> </span>vg0
</pre></div>
</div>
</section>
<section id="alignment-and-performance">
<h4><a class="toc-backref" href="#id6" role="doc-backlink">Alignment and Performance</a><a class="headerlink" href="#alignment-and-performance" title="Link to this heading"></a></h4>
<p><strong>Sector Alignment:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check disk sector size</span>
sudo<span class="w"> </span>fdisk<span class="w"> </span>-l<span class="w"> </span>/dev/sdX<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;Sector size&quot;</span>

<span class="c1"># For 4K sectors, align to 4096-byte boundaries</span>
sudo<span class="w"> </span>parted<span class="w"> </span>/dev/sdX<span class="w"> </span>mkpart<span class="w"> </span>primary<span class="w"> </span>4096s<span class="w"> </span><span class="m">100</span>%

<span class="c1"># For SSDs, align to 1MiB boundaries</span>
sudo<span class="w"> </span>parted<span class="w"> </span>/dev/sdX<span class="w"> </span>mkpart<span class="w"> </span>primary<span class="w"> </span>1MiB<span class="w"> </span><span class="m">100</span>%
</pre></div>
</div>
</section>
</section>
<section id="security-best-practices">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">Security Best Practices</a><a class="headerlink" href="#security-best-practices" title="Link to this heading"></a></h3>
<section id="encryption-at-rest">
<h4><a class="toc-backref" href="#id8" role="doc-backlink">Encryption at Rest</a><a class="headerlink" href="#encryption-at-rest" title="Link to this heading"></a></h4>
<p><strong>LUKS Full Disk Encryption:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Encrypt partition</span>
sudo<span class="w"> </span>cryptsetup<span class="w"> </span>luksFormat<span class="w"> </span>/dev/sdX1

<span class="c1"># Open encrypted device</span>
sudo<span class="w"> </span>cryptsetup<span class="w"> </span>luksOpen<span class="w"> </span>/dev/sdX1<span class="w"> </span>encrypted_root

<span class="c1"># Format encrypted device</span>
sudo<span class="w"> </span>mkfs.ext4<span class="w"> </span>/dev/mapper/encrypted_root

<span class="c1"># Add to crypttab</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;encrypted_root /dev/sdX1 none luks&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/crypttab
</pre></div>
</div>
<p><strong>Directory-level Encryption:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install eCryptfs</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>ecryptfs-utils

<span class="c1"># Encrypt home directory</span>
sudo<span class="w"> </span>ecryptfs-migrate-home<span class="w"> </span>-u<span class="w"> </span>username

<span class="c1"># Or encrypt specific directories</span>
sudo<span class="w"> </span>mount<span class="w"> </span>-t<span class="w"> </span>ecryptfs<span class="w"> </span>/secure<span class="w"> </span>/secure
</pre></div>
</div>
</section>
<section id="access-control-and-permissions">
<h4><a class="toc-backref" href="#id9" role="doc-backlink">Access Control and Permissions</a><a class="headerlink" href="#access-control-and-permissions" title="Link to this heading"></a></h4>
<p><strong>Principle of Least Privilege:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set restrictive default permissions</span>
<span class="nb">umask</span><span class="w"> </span><span class="m">027</span>

<span class="c1"># Use groups for shared access</span>
sudo<span class="w"> </span>groupadd<span class="w"> </span>storage-users
sudo<span class="w"> </span>usermod<span class="w"> </span>-a<span class="w"> </span>-G<span class="w"> </span>storage-users<span class="w"> </span>username

<span class="c1"># Set group ownership and permissions</span>
sudo<span class="w"> </span>chgrp<span class="w"> </span>-R<span class="w"> </span>storage-users<span class="w"> </span>/shared/storage
sudo<span class="w"> </span>chmod<span class="w"> </span>-R<span class="w"> </span><span class="m">750</span><span class="w"> </span>/shared/storage
</pre></div>
</div>
<p><strong>File System Extended Attributes:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Enable ACLs on filesystem</span>
sudo<span class="w"> </span>mount<span class="w"> </span>-o<span class="w"> </span>remount,acl<span class="w"> </span>/dev/sdX1

<span class="c1"># Set Access Control Lists</span>
setfacl<span class="w"> </span>-m<span class="w"> </span>u:username:rw<span class="w"> </span>/secure/file.txt
setfacl<span class="w"> </span>-m<span class="w"> </span>g:groupname:r<span class="w"> </span>/secure/directory

<span class="c1"># View ACLs</span>
getfacl<span class="w"> </span>/secure/file.txt
</pre></div>
</div>
<p><strong>Immutable Files:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make file immutable</span>
sudo<span class="w"> </span>chattr<span class="w"> </span>+i<span class="w"> </span>/critical/config.file

<span class="c1"># Make file append-only</span>
sudo<span class="w"> </span>chattr<span class="w"> </span>+a<span class="w"> </span>/var/log/audit.log

<span class="c1"># View attributes</span>
lsattr<span class="w"> </span>/critical/config.file
</pre></div>
</div>
</section>
</section>
<section id="backup-and-recovery-strategies">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">Backup and Recovery Strategies</a><a class="headerlink" href="#backup-and-recovery-strategies" title="Link to this heading"></a></h3>
<section id="backup-strategy-framework">
<h4><a class="toc-backref" href="#id11" role="doc-backlink">Backup Strategy Framework</a><a class="headerlink" href="#backup-strategy-framework" title="Link to this heading"></a></h4>
<p><strong>3-2-1 Rule Implementation:</strong></p>
<ul class="simple">
<li><p><strong>3</strong> copies of important data</p></li>
<li><p><strong>2</strong> different storage media types</p></li>
<li><p><strong>1</strong> copy stored off-site</p></li>
</ul>
<p><strong>Backup Types and Schedule:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Full backup (weekly)</span>
tar<span class="w"> </span>-czf<span class="w"> </span>/backup/full-<span class="k">$(</span>date<span class="w"> </span>+%Y%m%d<span class="k">)</span>.tar.gz<span class="w"> </span>/home<span class="w"> </span>/etc<span class="w"> </span>/var/log

<span class="c1"># Incremental backup (daily)</span>
rsync<span class="w"> </span>-av<span class="w"> </span>--link-dest<span class="o">=</span>/backup/last-backup<span class="w"> </span>/home/<span class="w"> </span>/backup/incremental-<span class="k">$(</span>date<span class="w"> </span>+%Y%m%d<span class="k">)</span>/

<span class="c1"># Differential backup (daily)</span>
tar<span class="w"> </span>-czf<span class="w"> </span>/backup/diff-<span class="k">$(</span>date<span class="w"> </span>+%Y%m%d<span class="k">)</span>.tar.gz<span class="w"> </span>--newer-mtime<span class="o">=</span><span class="s2">&quot;1 day ago&quot;</span><span class="w"> </span>/home
</pre></div>
</div>
<p><strong>Automated Backup Script:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1"># /usr/local/bin/backup-manager.sh</span>

<span class="nv">BACKUP_ROOT</span><span class="o">=</span><span class="s2">&quot;/backup&quot;</span>
<span class="nv">SOURCE_DIRS</span><span class="o">=</span><span class="s2">&quot;/home /etc /var/log&quot;</span>
<span class="nv">RETENTION_DAYS</span><span class="o">=</span><span class="m">30</span>
<span class="nv">LOG_FILE</span><span class="o">=</span><span class="s2">&quot;/var/log/backup.log&quot;</span>

log_message<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>date<span class="w"> </span><span class="s1">&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span class="k">)</span><span class="s2"> - </span><span class="nv">$1</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LOG_FILE</span><span class="s2">&quot;</span>
<span class="o">}</span>

perform_backup<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">backup_type</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">backup_dir</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$BACKUP_ROOT</span><span class="s2">/</span><span class="nv">$backup_type</span><span class="s2">-</span><span class="k">$(</span>date<span class="w"> </span>+%Y%m%d_%H%M%S<span class="k">)</span><span class="s2">&quot;</span>

<span class="w">    </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$backup_dir</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$backup_type</span><span class="s2">&quot;</span><span class="w"> </span><span class="k">in</span>
<span class="w">        </span><span class="s2">&quot;full&quot;</span><span class="o">)</span>
<span class="w">            </span>tar<span class="w"> </span>-czf<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$backup_dir</span><span class="s2">/system.tar.gz&quot;</span><span class="w"> </span><span class="nv">$SOURCE_DIRS</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">        </span><span class="s2">&quot;incremental&quot;</span><span class="o">)</span>
<span class="w">            </span><span class="nb">local</span><span class="w"> </span><span class="nv">last_backup</span><span class="o">=</span><span class="k">$(</span>find<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BACKUP_ROOT</span><span class="s2">&quot;</span><span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;incremental-*&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-1<span class="k">)</span>
<span class="w">            </span>rsync<span class="w"> </span>-av<span class="w"> </span>--link-dest<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$last_backup</span><span class="s2">&quot;</span><span class="w"> </span><span class="nv">$SOURCE_DIRS</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$backup_dir</span><span class="s2">/&quot;</span>
<span class="w">            </span><span class="p">;;</span>
<span class="w">    </span><span class="k">esac</span>

<span class="w">    </span><span class="c1"># Create checksum</span>
<span class="w">    </span>find<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$backup_dir</span><span class="s2">&quot;</span><span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-exec<span class="w"> </span>sha256sum<span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span><span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$backup_dir</span><span class="s2">/checksums.sha256&quot;</span>

<span class="w">    </span>log_message<span class="w"> </span><span class="s2">&quot;Backup completed: </span><span class="nv">$backup_dir</span><span class="s2">&quot;</span>
<span class="o">}</span>

cleanup_old_backups<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span>find<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BACKUP_ROOT</span><span class="s2">&quot;</span><span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-mtime<span class="w"> </span>+<span class="nv">$RETENTION_DAYS</span><span class="w"> </span>-exec<span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span>
<span class="w">    </span>log_message<span class="w"> </span><span class="s2">&quot;Cleaned up backups older than </span><span class="nv">$RETENTION_DAYS</span><span class="s2"> days&quot;</span>
<span class="o">}</span>

<span class="c1"># Run backup based on day of week</span>
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>date<span class="w"> </span>+%u<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span>perform_backup<span class="w"> </span><span class="s2">&quot;full&quot;</span>
<span class="k">else</span>
<span class="w">    </span>perform_backup<span class="w"> </span><span class="s2">&quot;incremental&quot;</span>
<span class="k">fi</span>

cleanup_old_backups
</pre></div>
</div>
<p><strong>Backup Verification:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Verify backup integrity</span>
<span class="c1">#!/bin/bash</span>
verify_backup<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">backup_dir</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="c1"># Check checksums</span>
<span class="w">    </span><span class="nb">cd</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$backup_dir</span><span class="s2">&quot;</span>
<span class="w">    </span>sha256sum<span class="w"> </span>-c<span class="w"> </span>checksums.sha256

<span class="w">    </span><span class="c1"># Test archive extraction</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-f<span class="w"> </span>system.tar.gz<span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span>tar<span class="w"> </span>-tzf<span class="w"> </span>system.tar.gz<span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Archive OK&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Archive CORRUPTED&quot;</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="c1"># Check file count</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">file_count</span><span class="o">=</span><span class="k">$(</span>find<span class="w"> </span>.<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l<span class="k">)</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Files in backup: </span><span class="nv">$file_count</span><span class="s2">&quot;</span>
<span class="o">}</span>
</pre></div>
</div>
</section>
<section id="recovery-planning">
<h4><a class="toc-backref" href="#id12" role="doc-backlink">Recovery Planning</a><a class="headerlink" href="#recovery-planning" title="Link to this heading"></a></h4>
<p><strong>Recovery Time Objective (RTO) and Recovery Point Objective (RPO):</strong></p>
<ul class="simple">
<li><p><strong>Critical Systems:</strong> RTO &lt; 4 hours, RPO &lt; 1 hour</p></li>
<li><p><strong>Important Systems:</strong> RTO &lt; 24 hours, RPO &lt; 4 hours</p></li>
<li><p><strong>Standard Systems:</strong> RTO &lt; 72 hours, RPO &lt; 24 hours</p></li>
</ul>
<p><strong>Disaster Recovery Procedures:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create disaster recovery documentation</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>/etc/disaster-recovery.md<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s"># Disaster Recovery Procedures</span>

<span class="s">## Critical Information</span>
<span class="s">- Backup Location: /backup and remote://backup-server/</span>
<span class="s">- Recovery Media: Ubuntu 22.04 Live USB</span>
<span class="s">- Key Personnel: admin@company.com, +1-555-0123</span>

<span class="s">## Recovery Steps</span>
<span class="s">1. Boot from recovery media</span>
<span class="s">2. Identify storage devices: `lsblk`</span>
<span class="s">3. Mount backup location</span>
<span class="s">4. Restore from most recent backup</span>
<span class="s">5. Verify system integrity</span>
<span class="s">6. Update disaster recovery log</span>
<span class="s">EOF</span>
</pre></div>
</div>
</section>
</section>
<section id="performance-optimization">
<h3><a class="toc-backref" href="#id13" role="doc-backlink">Performance Optimization</a><a class="headerlink" href="#performance-optimization" title="Link to this heading"></a></h3>
<section id="i-o-optimization">
<h4><a class="toc-backref" href="#id14" role="doc-backlink">I/O Optimization</a><a class="headerlink" href="#i-o-optimization" title="Link to this heading"></a></h4>
<p><strong>I/O Scheduler Tuning:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check current scheduler</span>
cat<span class="w"> </span>/sys/block/sdX/queue/scheduler

<span class="c1"># Set optimal scheduler per device type</span>
<span class="c1"># For SSDs</span>
<span class="nb">echo</span><span class="w"> </span>none<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/sys/block/nvme0n1/queue/scheduler

<span class="c1"># For HDDs</span>
<span class="nb">echo</span><span class="w"> </span>mq-deadline<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/sys/block/sda/queue/scheduler

<span class="c1"># Make permanent</span>
<span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;ACTION==&quot;add|change&quot;, KERNEL==&quot;sd[a-z]*&quot;, ATTR{queue/rotational}==&quot;0&quot;, ATTR{queue/scheduler}=&quot;none&quot;&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/udev/rules.d/60-ssd-scheduler.rules
</pre></div>
</div>
<p><strong>Read-ahead Optimization:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check current read-ahead</span>
sudo<span class="w"> </span>blockdev<span class="w"> </span>--getra<span class="w"> </span>/dev/sdX

<span class="c1"># Set read-ahead for sequential workloads</span>
sudo<span class="w"> </span>blockdev<span class="w"> </span>--setra<span class="w"> </span><span class="m">4096</span><span class="w"> </span>/dev/sdX<span class="w">  </span><span class="c1"># For large files</span>
sudo<span class="w"> </span>blockdev<span class="w"> </span>--setra<span class="w"> </span><span class="m">256</span><span class="w"> </span>/dev/sdX<span class="w">   </span><span class="c1"># For random access</span>
</pre></div>
</div>
<p><strong>Mount Options for Performance:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># High-performance mount options</span>
<span class="c1"># /etc/fstab entries:</span>

<span class="c1"># For databases (ext4)</span>
/dev/mapper/db-data<span class="w"> </span>/var/lib/mysql<span class="w"> </span>ext4<span class="w"> </span>noatime,nodiratime,data<span class="o">=</span>writeback,barrier<span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">2</span>

<span class="c1"># For web servers (ext4)</span>
/dev/mapper/web-data<span class="w"> </span>/var/www<span class="w"> </span>ext4<span class="w"> </span>noatime,nodiratime,data<span class="o">=</span>ordered<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">2</span>

<span class="c1"># For temporary files</span>
tmpfs<span class="w"> </span>/tmp<span class="w"> </span>tmpfs<span class="w"> </span>defaults,noatime,size<span class="o">=</span>2G<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span>
</pre></div>
</div>
</section>
<section id="memory-and-cache-optimization">
<h4><a class="toc-backref" href="#id15" role="doc-backlink">Memory and Cache Optimization</a><a class="headerlink" href="#memory-and-cache-optimization" title="Link to this heading"></a></h4>
<p><strong>File System Cache Tuning:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Adjust dirty page writeback</span>
<span class="nb">echo</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/proc/sys/vm/dirty_ratio
<span class="nb">echo</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/proc/sys/vm/dirty_background_ratio

<span class="c1"># Reduce swappiness for database servers</span>
<span class="nb">echo</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/proc/sys/vm/swappiness

<span class="c1"># Make changes permanent</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;vm.dirty_ratio = 5&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/sysctl.conf
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;vm.dirty_background_ratio = 2&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/sysctl.conf
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;vm.swappiness = 1&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/sysctl.conf
</pre></div>
</div>
</section>
</section>
<section id="monitoring-and-alerting">
<h3><a class="toc-backref" href="#id16" role="doc-backlink">Monitoring and Alerting</a><a class="headerlink" href="#monitoring-and-alerting" title="Link to this heading"></a></h3>
<section id="proactive-monitoring">
<h4><a class="toc-backref" href="#id17" role="doc-backlink">Proactive Monitoring</a><a class="headerlink" href="#proactive-monitoring" title="Link to this heading"></a></h4>
<p><strong>Key Metrics to Monitor:</strong></p>
<ol class="arabic simple">
<li><p><strong>Storage Capacity:</strong> Disk usage, inode usage, growth trends</p></li>
<li><p><strong>Performance:</strong> IOPS, throughput, latency, queue depth</p></li>
<li><p><strong>Health:</strong> SMART status, error rates, temperature</p></li>
<li><p><strong>Availability:</strong> Mount status, filesystem errors, RAID status</p></li>
</ol>
<p><strong>Monitoring Script:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1"># /usr/local/bin/storage-monitor.sh</span>

<span class="nv">ALERT_EMAIL</span><span class="o">=</span><span class="s2">&quot;admin@company.com&quot;</span>
<span class="nv">LOG_FILE</span><span class="o">=</span><span class="s2">&quot;/var/log/storage-monitor.log&quot;</span>

<span class="c1"># Thresholds</span>
<span class="nv">DISK_USAGE_WARN</span><span class="o">=</span><span class="m">80</span>
<span class="nv">DISK_USAGE_CRIT</span><span class="o">=</span><span class="m">90</span>
<span class="nv">INODE_USAGE_WARN</span><span class="o">=</span><span class="m">80</span>
<span class="nv">LOAD_WARN</span><span class="o">=</span><span class="m">2</span>.0

send_alert<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">subject</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">message</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$message</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>mail<span class="w"> </span>-s<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$subject</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ALERT_EMAIL</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>date<span class="k">)</span><span class="s2">: ALERT - </span><span class="nv">$subject</span><span class="s2"> - </span><span class="nv">$message</span><span class="s2">&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$LOG_FILE</span><span class="s2">&quot;</span>
<span class="o">}</span>

check_disk_usage<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span>df<span class="w"> </span>-h<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="nb">read</span><span class="w"> </span>filesystem<span class="w"> </span>size<span class="w"> </span>used<span class="w"> </span>avail<span class="w"> </span>percent<span class="w"> </span>mountpoint<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$percent</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span>~<span class="w"> </span><span class="o">([</span><span class="m">0</span>-9<span class="o">]</span>+<span class="o">)</span>%<span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span><span class="nv">usage</span><span class="o">=</span><span class="si">${</span><span class="nv">BASH_REMATCH</span><span class="p">[1]</span><span class="si">}</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$usage</span><span class="s2">&quot;</span><span class="w"> </span>-gt<span class="w"> </span><span class="nv">$DISK_USAGE_CRIT</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span>send_alert<span class="w"> </span><span class="s2">&quot;CRITICAL: Disk Usage&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$mountpoint</span><span class="s2"> is </span><span class="si">${</span><span class="nv">usage</span><span class="si">}</span><span class="s2">% full&quot;</span>
<span class="w">            </span><span class="k">elif</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$usage</span><span class="s2">&quot;</span><span class="w"> </span>-gt<span class="w"> </span><span class="nv">$DISK_USAGE_WARN</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span>send_alert<span class="w"> </span><span class="s2">&quot;WARNING: Disk Usage&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$mountpoint</span><span class="s2"> is </span><span class="si">${</span><span class="nv">usage</span><span class="si">}</span><span class="s2">% full&quot;</span>
<span class="w">            </span><span class="k">fi</span>
<span class="w">        </span><span class="k">fi</span>
<span class="w">    </span><span class="k">done</span>
<span class="o">}</span>

check_smart_status<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span>device<span class="w"> </span><span class="k">in</span><span class="w"> </span>/dev/sd<span class="o">[</span>a-z<span class="o">]</span><span class="w"> </span>/dev/nvme<span class="o">[</span><span class="m">0</span>-9<span class="o">]</span>n<span class="o">[</span><span class="m">0</span>-9<span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-b<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span>!<span class="w"> </span>smartctl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-q<span class="w"> </span><span class="s2">&quot;PASSED&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span>send_alert<span class="w"> </span><span class="s2">&quot;CRITICAL: SMART Failure&quot;</span><span class="w"> </span><span class="s2">&quot;Device </span><span class="nv">$device</span><span class="s2"> failed SMART test&quot;</span>
<span class="w">            </span><span class="k">fi</span>
<span class="w">        </span><span class="k">fi</span>
<span class="w">    </span><span class="k">done</span>
<span class="o">}</span>

check_raid_status<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-f<span class="w"> </span>/proc/mdstat<span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span>grep<span class="w"> </span>-q<span class="w"> </span><span class="s2">&quot;_&quot;</span><span class="w"> </span>/proc/mdstat<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span>send_alert<span class="w"> </span><span class="s2">&quot;WARNING: RAID Degraded&quot;</span><span class="w"> </span><span class="s2">&quot;Software RAID array is degraded&quot;</span>
<span class="w">        </span><span class="k">fi</span>
<span class="w">    </span><span class="k">fi</span>
<span class="o">}</span>

<span class="c1"># Run checks</span>
check_disk_usage
check_smart_status
check_raid_status
</pre></div>
</div>
<p><strong>Automated Health Reports:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1"># Daily storage health report</span>

<span class="nv">REPORT_FILE</span><span class="o">=</span><span class="s2">&quot;/tmp/daily-storage-report.txt&quot;</span>

<span class="o">{</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Daily Storage Health Report - </span><span class="k">$(</span>date<span class="k">)</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;===========================================&quot;</span>
<span class="w">    </span><span class="nb">echo</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;DISK USAGE:&quot;</span>
<span class="w">    </span>df<span class="w"> </span>-h
<span class="w">    </span><span class="nb">echo</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;INODE USAGE:&quot;</span>
<span class="w">    </span>df<span class="w"> </span>-i
<span class="w">    </span><span class="nb">echo</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;SYSTEM LOAD:&quot;</span>
<span class="w">    </span>uptime
<span class="w">    </span><span class="nb">echo</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;I/O STATISTICS (last hour):&quot;</span>
<span class="w">    </span>sar<span class="w"> </span>-d<span class="w"> </span>-s<span class="w"> </span><span class="k">$(</span>date<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;1 hour ago&#39;</span><span class="w"> </span><span class="s1">&#39;+%H:%M:%S&#39;</span><span class="k">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-20
<span class="w">    </span><span class="nb">echo</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;RAID STATUS:&quot;</span>
<span class="w">    </span>cat<span class="w"> </span>/proc/mdstat<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;No software RAID detected&quot;</span>
<span class="w">    </span><span class="nb">echo</span>

<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;SMART STATUS:&quot;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span>device<span class="w"> </span><span class="k">in</span><span class="w"> </span>/dev/sd<span class="o">[</span>a-z<span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-b<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">: </span><span class="k">$(</span>smartctl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>overall<span class="k">)</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="k">fi</span>
<span class="w">    </span><span class="k">done</span>

<span class="o">}</span><span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$REPORT_FILE</span><span class="s2">&quot;</span>

<span class="c1"># Email report</span>
mail<span class="w"> </span>-s<span class="w"> </span><span class="s2">&quot;Daily Storage Report - </span><span class="k">$(</span>hostname<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span>admin@company.com<span class="w"> </span>&lt;<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$REPORT_FILE</span><span class="s2">&quot;</span>
</pre></div>
</div>
</section>
</section>
<section id="maintenance-procedures">
<h3><a class="toc-backref" href="#id18" role="doc-backlink">Maintenance Procedures</a><a class="headerlink" href="#maintenance-procedures" title="Link to this heading"></a></h3>
<section id="regular-maintenance-tasks">
<h4><a class="toc-backref" href="#id19" role="doc-backlink">Regular Maintenance Tasks</a><a class="headerlink" href="#regular-maintenance-tasks" title="Link to this heading"></a></h4>
<p><strong>Weekly Tasks:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1"># Weekly maintenance script</span>

<span class="c1"># SMART tests</span>
<span class="k">for</span><span class="w"> </span>device<span class="w"> </span><span class="k">in</span><span class="w"> </span>/dev/sd<span class="o">[</span>a-z<span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-b<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span>smartctl<span class="w"> </span>-t<span class="w"> </span>long<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$device</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">fi</span>
<span class="k">done</span>

<span class="c1"># Filesystem checks</span>
find<span class="w"> </span>/var/log<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;*.log&quot;</span><span class="w"> </span>-size<span class="w"> </span>+100M<span class="w"> </span>-exec<span class="w"> </span>logrotate<span class="w"> </span>-f<span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span>

<span class="c1"># Clean temporary files</span>
find<span class="w"> </span>/tmp<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-atime<span class="w"> </span>+7<span class="w"> </span>-delete
find<span class="w"> </span>/var/tmp<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-atime<span class="w"> </span>+30<span class="w"> </span>-delete

<span class="c1"># Update package cache</span>
apt<span class="w"> </span>update
apt<span class="w"> </span>list<span class="w"> </span>--upgradable
</pre></div>
</div>
<p><strong>Monthly Tasks:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1"># Monthly maintenance script</span>

<span class="c1"># Full system backup verification</span>
/usr/local/bin/verify-backups.sh

<span class="c1"># Storage capacity planning</span>
/usr/local/bin/capacity-report.sh

<span class="c1"># Security updates</span>
apt<span class="w"> </span>upgrade<span class="w"> </span>-y

<span class="c1"># Performance baseline</span>
/usr/local/bin/performance-benchmark.sh
</pre></div>
</div>
</section>
</section>
<section id="documentation-and-change-management">
<h3><a class="toc-backref" href="#id20" role="doc-backlink">Documentation and Change Management</a><a class="headerlink" href="#documentation-and-change-management" title="Link to this heading"></a></h3>
<section id="documentation-standards">
<h4><a class="toc-backref" href="#id21" role="doc-backlink">Documentation Standards</a><a class="headerlink" href="#documentation-standards" title="Link to this heading"></a></h4>
<p><strong>Storage Configuration Documentation:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create storage inventory</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>/etc/storage-inventory.yaml<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s">storage_systems:</span>
<span class="s">  - name: &quot;Primary Storage&quot;</span>
<span class="s">    type: &quot;LVM on RAID1&quot;</span>
<span class="s">    devices: [&quot;/dev/sda&quot;, &quot;/dev/sdb&quot;]</span>
<span class="s">    capacity: &quot;2TB&quot;</span>
<span class="s">    filesystem: &quot;ext4&quot;</span>
<span class="s">    mount_points:</span>
<span class="s">      - &quot;/&quot;: &quot;50GB&quot;</span>
<span class="s">      - &quot;/home&quot;: &quot;1.5TB&quot;</span>
<span class="s">      - &quot;/var&quot;: &quot;200GB&quot;</span>
<span class="s">    backup_schedule: &quot;Daily incremental, Weekly full&quot;</span>

<span class="s">  - name: &quot;Database Storage&quot;</span>
<span class="s">    type: &quot;Direct attach NVMe&quot;</span>
<span class="s">    devices: [&quot;/dev/nvme0n1&quot;]</span>
<span class="s">    capacity: &quot;1TB&quot;</span>
<span class="s">    filesystem: &quot;xfs&quot;</span>
<span class="s">    mount_points:</span>
<span class="s">      - &quot;/var/lib/mysql&quot;: &quot;800GB&quot;</span>
<span class="s">    backup_schedule: &quot;Hourly snapshots, Daily backup&quot;</span>

<span class="s">network_storage:</span>
<span class="s">  - name: &quot;Archive NFS&quot;</span>
<span class="s">    server: &quot;nas.company.local&quot;</span>
<span class="s">    export: &quot;/export/archive&quot;</span>
<span class="s">    mount_point: &quot;/mnt/archive&quot;</span>
<span class="s">    options: &quot;rw,soft,intr&quot;</span>
<span class="s">EOF</span>
</pre></div>
</div>
<p><strong>Change Management Process:</strong></p>
<ol class="arabic simple">
<li><p><strong>Document all changes</strong> in <cite>/var/log/storage-changes.log</cite></p></li>
<li><p><strong>Test changes</strong> in development environment first</p></li>
<li><p><strong>Create rollback plan</strong> before implementing</p></li>
<li><p><strong>Monitor system</strong> after changes for 24-48 hours</p></li>
</ol>
<p>These best practices provide a solid foundation for reliable, secure, and high-performing storage systems on Ubuntu 22.04. Regular review and updates of these practices ensure continued effectiveness as technology and requirements evolve.</p>
</section>
</section>
</section>
</div>
<div class="toctree-wrapper compound">
<span id="document-glossary"></span><section id="glossary">
<h2>Glossary<a class="headerlink" href="#glossary" title="Link to this heading"></a></h2>
<p>This glossary provides definitions for storage-related terms and concepts used throughout this documentation.</p>
<dl class="simple glossary">
<dt id="term-AHCI">AHCI<a class="headerlink" href="#term-AHCI" title="Link to this term"></a></dt><dd><p>Advanced Host Controller Interface - A technical standard for SATA host controllers that allows software to communicate with storage devices.</p>
</dd>
<dt id="term-Block-Device">Block Device<a class="headerlink" href="#term-Block-Device" title="Link to this term"></a></dt><dd><p>A type of device that provides buffered access to hardware devices, allowing data to be read and written in fixed-size blocks (typically 512 bytes or 4096 bytes).</p>
</dd>
<dt id="term-Block-Size">Block Size<a class="headerlink" href="#term-Block-Size" title="Link to this term"></a></dt><dd><p>The minimum unit of data that a filesystem can allocate. Common block sizes are 4KB, 8KB, and 64KB. Larger block sizes are better for sequential access, while smaller block sizes are more efficient for random access.</p>
</dd>
<dt id="term-BTRFS">BTRFS<a class="headerlink" href="#term-BTRFS" title="Link to this term"></a></dt><dd><p>B-Tree File System - A modern filesystem for Linux that features snapshots, checksums, compression, and advanced volume management capabilities.</p>
</dd>
<dt id="term-Cache">Cache<a class="headerlink" href="#term-Cache" title="Link to this term"></a></dt><dd><p>High-speed storage used to temporarily store frequently accessed data to improve performance. Can be implemented in hardware (disk cache) or software (filesystem cache).</p>
</dd>
<dt id="term-CIFS">CIFS<a class="headerlink" href="#term-CIFS" title="Link to this term"></a></dt><dd><p>Common Internet File System - A network protocol used for sharing files, printers, and other resources between systems, primarily used with Windows networks.</p>
</dd>
<dt id="term-DAS">DAS<a class="headerlink" href="#term-DAS" title="Link to this term"></a></dt><dd><p>Direct-Attached Storage - Storage devices directly connected to a single computer without a network connection, such as internal hard drives or external USB drives.</p>
</dd>
<dt id="term-Defragmentation">Defragmentation<a class="headerlink" href="#term-Defragmentation" title="Link to this term"></a></dt><dd><p>The process of reorganizing data on a storage device to reduce fragmentation and improve performance. Less relevant for modern filesystems and SSDs.</p>
</dd>
<dt id="term-Device-Mapper">Device Mapper<a class="headerlink" href="#term-Device-Mapper" title="Link to this term"></a></dt><dd><p>A Linux kernel framework that provides a generic way to create virtual layers on top of block devices, used by LVM and device encryption.</p>
</dd>
<dt id="term-Dirty-Pages">Dirty Pages<a class="headerlink" href="#term-Dirty-Pages" title="Link to this term"></a></dt><dd><p>Memory pages that have been modified but not yet written to storage. The kernel manages when these pages are flushed to disk.</p>
</dd>
<dt id="term-DM-Crypt">DM-Crypt<a class="headerlink" href="#term-DM-Crypt" title="Link to this term"></a></dt><dd><p>Device-mapper crypt target - A Linux kernel module that provides transparent encryption of block devices using the device mapper infrastructure.</p>
</dd>
<dt id="term-ECC">ECC<a class="headerlink" href="#term-ECC" title="Link to this term"></a></dt><dd><p>Error-Correcting Code - Technology that detects and corrects data corruption errors in memory and storage systems.</p>
</dd>
<dt id="term-Ext4">Ext4<a class="headerlink" href="#term-Ext4" title="Link to this term"></a></dt><dd><p>Fourth Extended Filesystem - The default filesystem for many Linux distributions, offering journaling, large file support, and backward compatibility.</p>
</dd>
<dt id="term-Filesystem">Filesystem<a class="headerlink" href="#term-Filesystem" title="Link to this term"></a></dt><dd><p>A method of organizing and storing data on storage devices. Examples include ext4, XFS, NTFS, and APFS.</p>
</dd>
<dt id="term-FSTAB">FSTAB<a class="headerlink" href="#term-FSTAB" title="Link to this term"></a></dt><dd><p>File Systems Table - A configuration file (/etc/fstab) that defines how disk partitions and storage devices should be mounted at boot time.</p>
</dd>
<dt id="term-GPT">GPT<a class="headerlink" href="#term-GPT" title="Link to this term"></a></dt><dd><p>GUID Partition Table - A modern partitioning scheme that replaces MBR, supporting larger disks and more partitions.</p>
</dd>
<dt id="term-HDD">HDD<a class="headerlink" href="#term-HDD" title="Link to this term"></a></dt><dd><p>Hard Disk Drive - Traditional storage device using spinning magnetic disks and mechanical read/write heads.</p>
</dd>
<dt id="term-Hot-Spare">Hot Spare<a class="headerlink" href="#term-Hot-Spare" title="Link to this term"></a></dt><dd><p>A standby disk in a RAID array that automatically replaces a failed disk without manual intervention.</p>
</dd>
<dt id="term-I-O">I/O<a class="headerlink" href="#term-I-O" title="Link to this term"></a></dt><dd><p>Input/Output - Operations that transfer data between the computer and storage devices or other external systems.</p>
</dd>
<dt id="term-Inode">Inode<a class="headerlink" href="#term-Inode" title="Link to this term"></a></dt><dd><p>Index node - A data structure that stores metadata about files and directories in Unix-like filesystems, including permissions, timestamps, and pointers to data blocks.</p>
</dd>
<dt id="term-IOPS">IOPS<a class="headerlink" href="#term-IOPS" title="Link to this term"></a></dt><dd><p>Input/Output Operations Per Second - A performance measurement indicating how many read/write operations a storage device can perform per second.</p>
</dd>
<dt id="term-iSCSI">iSCSI<a class="headerlink" href="#term-iSCSI" title="Link to this term"></a></dt><dd><p>Internet Small Computer Systems Interface - A protocol that allows SCSI commands to be sent over IP networks, enabling network-attached storage.</p>
</dd>
<dt id="term-Journal">Journal<a class="headerlink" href="#term-Journal" title="Link to this term"></a></dt><dd><p>A log of filesystem changes used for crash recovery. Journaling filesystems can quickly recover from unexpected shutdowns by replaying the journal.</p>
</dd>
<dt id="term-JBOD">JBOD<a class="headerlink" href="#term-JBOD" title="Link to this term"></a></dt><dd><p>Just a Bunch of Disks - A storage configuration where multiple disks are used independently without RAID redundancy.</p>
</dd>
<dt id="term-LBA">LBA<a class="headerlink" href="#term-LBA" title="Link to this term"></a></dt><dd><p>Logical Block Addressing - A method of addressing data blocks on storage devices using a linear sequence of block numbers.</p>
</dd>
<dt id="term-Logical-Volume">Logical Volume<a class="headerlink" href="#term-Logical-Volume" title="Link to this term"></a></dt><dd><p>A virtual storage device created by LVM that can span multiple physical devices and be resized dynamically.</p>
</dd>
<dt id="term-LUKS">LUKS<a class="headerlink" href="#term-LUKS" title="Link to this term"></a></dt><dd><p>Linux Unified Key Setup - A disk encryption specification and reference implementation for Linux that provides a standard format for encrypted storage.</p>
</dd>
<dt id="term-LUN">LUN<a class="headerlink" href="#term-LUN" title="Link to this term"></a></dt><dd><p>Logical Unit Number - A number used to identify individual devices or logical units within a SCSI target.</p>
</dd>
<dt id="term-LVM">LVM<a class="headerlink" href="#term-LVM" title="Link to this term"></a></dt><dd><p>Logical Volume Manager - A system for managing disk space that provides volume management capabilities including resizing, snapshots, and spanning multiple devices.</p>
</dd>
<dt id="term-MBR">MBR<a class="headerlink" href="#term-MBR" title="Link to this term"></a></dt><dd><p>Master Boot Record - An older partitioning scheme limited to 2TB disks and 4 primary partitions.</p>
</dd>
<dt id="term-mdadm">mdadm<a class="headerlink" href="#term-mdadm" title="Link to this term"></a></dt><dd><p>Multiple Device Administration - A Linux utility for managing software RAID arrays.</p>
</dd>
<dt id="term-Mount-Point">Mount Point<a class="headerlink" href="#term-Mount-Point" title="Link to this term"></a></dt><dd><p>A directory in the filesystem hierarchy where a storage device or filesystem is attached and made accessible.</p>
</dd>
<dt id="term-NAS">NAS<a class="headerlink" href="#term-NAS" title="Link to this term"></a></dt><dd><p>Network-Attached Storage - File-level storage accessible over a network, typically using protocols like NFS or SMB/CIFS.</p>
</dd>
<dt id="term-NFS">NFS<a class="headerlink" href="#term-NFS" title="Link to this term"></a></dt><dd><p>Network File System - A protocol for sharing files over a network, allowing remote directories to be mounted as if they were local.</p>
</dd>
<dt id="term-NVME">NVME<a class="headerlink" href="#term-NVME" title="Link to this term"></a></dt><dd><p>Non-Volatile Memory Express - A high-performance interface for SSDs that connects directly to the CPU via PCIe lanes.</p>
</dd>
<dt id="term-Partition">Partition<a class="headerlink" href="#term-Partition" title="Link to this term"></a></dt><dd><p>A logical division of a storage device that appears to the operating system as a separate device.</p>
</dd>
<dt id="term-Physical-Extent">Physical Extent<a class="headerlink" href="#term-Physical-Extent" title="Link to this term"></a></dt><dd><p>The smallest unit of space allocation in LVM, typically 4MB in size.</p>
</dd>
<dt id="term-Physical-Volume">Physical Volume<a class="headerlink" href="#term-Physical-Volume" title="Link to this term"></a></dt><dd><p>A storage device or partition that has been initialized for use with LVM.</p>
</dd>
<dt id="term-RAID">RAID<a class="headerlink" href="#term-RAID" title="Link to this term"></a></dt><dd><p>Redundant Array of Independent Disks - A technology that combines multiple physical disks into logical units for redundancy, performance, or both.</p>
</dd>
<dt id="term-RAID-0">RAID 0<a class="headerlink" href="#term-RAID-0" title="Link to this term"></a></dt><dd><p>Disk striping without redundancy - improves performance but provides no fault tolerance.</p>
</dd>
<dt id="term-RAID-1">RAID 1<a class="headerlink" href="#term-RAID-1" title="Link to this term"></a></dt><dd><p>Disk mirroring - provides redundancy by maintaining identical copies of data on multiple disks.</p>
</dd>
<dt id="term-RAID-5">RAID 5<a class="headerlink" href="#term-RAID-5" title="Link to this term"></a></dt><dd><p>Distributed parity - requires minimum 3 disks, provides redundancy and improved read performance.</p>
</dd>
<dt id="term-RAID-6">RAID 6<a class="headerlink" href="#term-RAID-6" title="Link to this term"></a></dt><dd><p>Double distributed parity - requires minimum 4 disks, can tolerate failure of any two disks.</p>
</dd>
<dt id="term-RAID-10">RAID 10<a class="headerlink" href="#term-RAID-10" title="Link to this term"></a></dt><dd><p>Combination of RAID 1 and RAID 0 - provides both redundancy and performance improvements.</p>
</dd>
<dt id="term-RPO">RPO<a class="headerlink" href="#term-RPO" title="Link to this term"></a></dt><dd><p>Recovery Point Objective - The maximum acceptable amount of data loss measured in time (e.g., 1 hour RPO means losing at most 1 hour of data).</p>
</dd>
<dt id="term-RTO">RTO<a class="headerlink" href="#term-RTO" title="Link to this term"></a></dt><dd><p>Recovery Time Objective - The maximum acceptable time to restore service after a failure (e.g., 4 hour RTO means service must be restored within 4 hours).</p>
</dd>
<dt id="term-SAN">SAN<a class="headerlink" href="#term-SAN" title="Link to this term"></a></dt><dd><p>Storage Area Network - A dedicated high-speed network that provides block-level access to storage devices.</p>
</dd>
<dt id="term-SATA">SATA<a class="headerlink" href="#term-SATA" title="Link to this term"></a></dt><dd><p>Serial Advanced Technology Attachment - A computer bus interface for connecting storage devices like hard drives and SSDs.</p>
</dd>
<dt id="term-SCSI">SCSI<a class="headerlink" href="#term-SCSI" title="Link to this term"></a></dt><dd><p>Small Computer System Interface - A set of standards for connecting and transferring data between computers and storage devices.</p>
</dd>
<dt id="term-Sector">Sector<a class="headerlink" href="#term-Sector" title="Link to this term"></a></dt><dd><p>The smallest addressable unit on a storage device, traditionally 512 bytes but increasingly 4096 bytes (4K sectors).</p>
</dd>
<dt id="term-SMART">SMART<a class="headerlink" href="#term-SMART" title="Link to this term"></a></dt><dd><p>Self-Monitoring, Analysis and Reporting Technology - A monitoring system for storage devices that detects and reports various reliability indicators.</p>
</dd>
<dt id="term-Snapshot">Snapshot<a class="headerlink" href="#term-Snapshot" title="Link to this term"></a></dt><dd><p>A point-in-time copy of a filesystem or volume that captures the state of data at a specific moment, useful for backups and recovery.</p>
</dd>
<dt id="term-SSD">SSD<a class="headerlink" href="#term-SSD" title="Link to this term"></a></dt><dd><p>Solid State Drive - Storage device using NAND flash memory with no moving parts, offering better performance and reliability than HDDs.</p>
</dd>
<dt id="term-Swap">Swap<a class="headerlink" href="#term-Swap" title="Link to this term"></a></dt><dd><p>Virtual memory space on storage devices used when physical RAM is insufficient. Also called a page file.</p>
</dd>
<dt id="term-Throughput">Throughput<a class="headerlink" href="#term-Throughput" title="Link to this term"></a></dt><dd><p>The amount of data transferred per unit of time, typically measured in MB/s or GB/s.</p>
</dd>
<dt id="term-TRIM">TRIM<a class="headerlink" href="#term-TRIM" title="Link to this term"></a></dt><dd><p>A command that informs SSDs which data blocks are no longer needed, allowing the drive to optimize performance and wear leveling.</p>
</dd>
<dt id="term-UUID">UUID<a class="headerlink" href="#term-UUID" title="Link to this term"></a></dt><dd><p>Universally Unique Identifier - A 128-bit identifier used to uniquely identify storage devices and filesystems.</p>
</dd>
<dt id="term-Volume-Group">Volume Group<a class="headerlink" href="#term-Volume-Group" title="Link to this term"></a></dt><dd><p>A collection of physical volumes in LVM that provides a pool of storage space for creating logical volumes.</p>
</dd>
<dt id="term-Wear-Leveling">Wear Leveling<a class="headerlink" href="#term-Wear-Leveling" title="Link to this term"></a></dt><dd><p>A technique used in SSDs to distribute write operations evenly across memory cells to maximize device lifespan.</p>
</dd>
<dt id="term-XFS">XFS<a class="headerlink" href="#term-XFS" title="Link to this term"></a></dt><dd><p>A high-performance journaling filesystem originally developed for IRIX, known for excellent scalability and large file support.</p>
</dd>
<dt id="term-ZFS">ZFS<a class="headerlink" href="#term-ZFS" title="Link to this term"></a></dt><dd><p>Zettabyte File System - An advanced filesystem and volume manager that provides features like checksums, compression, snapshots, and data deduplication.</p>
</dd>
</dl>
</section>
<section id="common-command-abbreviations">
<h2>Common Command Abbreviations<a class="headerlink" href="#common-command-abbreviations" title="Link to this heading"></a></h2>
<dl class="simple glossary">
<dt id="term-blkid">blkid<a class="headerlink" href="#term-blkid" title="Link to this term"></a></dt><dd><p>Block device identifier - Command to display information about block devices and their attributes.</p>
</dd>
<dt id="term-dd">dd<a class="headerlink" href="#term-dd" title="Link to this term"></a></dt><dd><p>Data duplicator (historically “disk dump”) - Command for copying and converting raw data between devices.</p>
</dd>
<dt id="term-df">df<a class="headerlink" href="#term-df" title="Link to this term"></a></dt><dd><p>Disk free - Command to display filesystem disk space usage.</p>
</dd>
<dt id="term-du">du<a class="headerlink" href="#term-du" title="Link to this term"></a></dt><dd><p>Disk usage - Command to display directory space usage.</p>
</dd>
<dt id="term-fdisk">fdisk<a class="headerlink" href="#term-fdisk" title="Link to this term"></a></dt><dd><p>Fixed disk - Partition table manipulator for MBR partitions.</p>
</dd>
<dt id="term-fsck">fsck<a class="headerlink" href="#term-fsck" title="Link to this term"></a></dt><dd><p>File system check - Command to check and repair filesystem errors.</p>
</dd>
<dt id="term-gdisk">gdisk<a class="headerlink" href="#term-gdisk" title="Link to this term"></a></dt><dd><p>GPT fdisk - Partition table manipulator for GPT partitions.</p>
</dd>
<dt id="term-lsblk">lsblk<a class="headerlink" href="#term-lsblk" title="Link to this term"></a></dt><dd><p>List block devices - Command to display block device information in tree format.</p>
</dd>
<dt id="term-mount">mount<a class="headerlink" href="#term-mount" title="Link to this term"></a></dt><dd><p>Mount filesystem - Command to attach filesystems to the directory tree.</p>
</dd>
<dt id="term-parted">parted<a class="headerlink" href="#term-parted" title="Link to this term"></a></dt><dd><p>Partition editor - Command-line tool for creating and manipulating partition tables.</p>
</dd>
<dt id="term-rsync">rsync<a class="headerlink" href="#term-rsync" title="Link to this term"></a></dt><dd><p>Remote sync - Command for efficiently synchronizing files and directories.</p>
</dd>
<dt id="term-umount">umount<a class="headerlink" href="#term-umount" title="Link to this term"></a></dt><dd><p>Unmount filesystem - Command to detach filesystems from the directory tree.</p>
</dd>
</dl>
</section>
<section id="storage-unit-definitions">
<h2>Storage Unit Definitions<a class="headerlink" href="#storage-unit-definitions" title="Link to this heading"></a></h2>
<dl class="simple glossary">
<dt id="term-Byte">Byte<a class="headerlink" href="#term-Byte" title="Link to this term"></a></dt><dd><p>The basic unit of digital information, consisting of 8 bits.</p>
</dd>
<dt id="term-KB-Kilobyte">KB (Kilobyte)<a class="headerlink" href="#term-KB-Kilobyte" title="Link to this term"></a></dt><dd><p>1,000 bytes (decimal) or 1,024 bytes (binary, more precisely called KiB).</p>
</dd>
<dt id="term-MB-Megabyte">MB (Megabyte)<a class="headerlink" href="#term-MB-Megabyte" title="Link to this term"></a></dt><dd><p>1,000,000 bytes (decimal) or 1,048,576 bytes (binary, more precisely called MiB).</p>
</dd>
<dt id="term-GB-Gigabyte">GB (Gigabyte)<a class="headerlink" href="#term-GB-Gigabyte" title="Link to this term"></a></dt><dd><p>1,000,000,000 bytes (decimal) or 1,073,741,824 bytes (binary, more precisely called GiB).</p>
</dd>
<dt id="term-TB-Terabyte">TB (Terabyte)<a class="headerlink" href="#term-TB-Terabyte" title="Link to this term"></a></dt><dd><p>1,000,000,000,000 bytes (decimal) or 1,099,511,627,776 bytes (binary, more precisely called TiB).</p>
</dd>
<dt id="term-PB-Petabyte">PB (Petabyte)<a class="headerlink" href="#term-PB-Petabyte" title="Link to this term"></a></dt><dd><p>1,000,000,000,000,000 bytes (decimal) or 1,125,899,906,842,624 bytes (binary, more precisely called PiB).</p>
</dd>
</dl>
</section>
<section id="performance-metrics">
<h2>Performance Metrics<a class="headerlink" href="#performance-metrics" title="Link to this heading"></a></h2>
<dl class="simple glossary">
<dt id="term-Bandwidth">Bandwidth<a class="headerlink" href="#term-Bandwidth" title="Link to this term"></a></dt><dd><p>The maximum data transfer rate of a storage system, typically measured in MB/s or GB/s.</p>
</dd>
<dt id="term-Latency">Latency<a class="headerlink" href="#term-Latency" title="Link to this term"></a></dt><dd><p>The time delay between when a storage operation is requested and when it begins, typically measured in milliseconds.</p>
</dd>
<dt id="term-Queue-Depth">Queue Depth<a class="headerlink" href="#term-Queue-Depth" title="Link to this term"></a></dt><dd><p>The number of pending I/O operations that can be queued for processing by a storage device.</p>
</dd>
<dt id="term-Random-I-O">Random I/O<a class="headerlink" href="#term-Random-I-O" title="Link to this term"></a></dt><dd><p>Storage operations that access data at non-sequential locations, typically slower than sequential I/O.</p>
</dd>
<dt id="term-Sequential-I-O">Sequential I/O<a class="headerlink" href="#term-Sequential-I-O" title="Link to this term"></a></dt><dd><p>Storage operations that access data in a continuous, ordered manner, typically faster than random I/O.</p>
</dd>
<dt id="term-Sustained-Transfer-Rate">Sustained Transfer Rate<a class="headerlink" href="#term-Sustained-Transfer-Rate" title="Link to this term"></a></dt><dd><p>The average data transfer rate over an extended period, excluding burst performance.</p>
</dd>
</dl>
</section>
<section id="raid-levels-reference">
<h2>RAID Levels Reference<a class="headerlink" href="#raid-levels-reference" title="Link to this heading"></a></h2>
<dl class="simple glossary">
<dt id="term-0">RAID 0<a class="headerlink" href="#term-0" title="Link to this term"></a></dt><dd><p>Striping - Data is split across multiple drives for improved performance. No redundancy. Minimum 2 drives.</p>
</dd>
<dt id="term-1">RAID 1<a class="headerlink" href="#term-1" title="Link to this term"></a></dt><dd><p>Mirroring - Data is duplicated across drives for redundancy. 50% storage efficiency. Minimum 2 drives.</p>
</dd>
<dt id="term-2">RAID 5<a class="headerlink" href="#term-2" title="Link to this term"></a></dt><dd><p>Distributed parity - Data and parity information spread across all drives. Can lose 1 drive. Minimum 3 drives.</p>
</dd>
<dt id="term-3">RAID 6<a class="headerlink" href="#term-3" title="Link to this term"></a></dt><dd><p>Double parity - Two parity blocks per stripe. Can lose 2 drives. Minimum 4 drives.</p>
</dd>
<dt id="term-4">RAID 10<a class="headerlink" href="#term-4" title="Link to this term"></a></dt><dd><p>Mirror of stripes - Combines RAID 1 and RAID 0. High performance and redundancy. Minimum 4 drives.</p>
</dd>
<dt id="term-RAID-50">RAID 50<a class="headerlink" href="#term-RAID-50" title="Link to this term"></a></dt><dd><p>Striped RAID 5 - Multiple RAID 5 arrays striped together. Minimum 6 drives.</p>
</dd>
<dt id="term-RAID-60">RAID 60<a class="headerlink" href="#term-RAID-60" title="Link to this term"></a></dt><dd><p>Striped RAID 6 - Multiple RAID 6 arrays striped together. Minimum 8 drives.</p>
</dd>
</dl>
</section>
<section id="network-storage-protocols">
<h2>Network Storage Protocols<a class="headerlink" href="#network-storage-protocols" title="Link to this heading"></a></h2>
<dl class="simple glossary">
<dt id="term-AFP">AFP<a class="headerlink" href="#term-AFP" title="Link to this term"></a></dt><dd><p>Apple Filing Protocol - Network protocol for file sharing used primarily by Apple devices.</p>
</dd>
<dt id="term-FTP">FTP<a class="headerlink" href="#term-FTP" title="Link to this term"></a></dt><dd><p>File Transfer Protocol - Standard protocol for transferring files over networks.</p>
</dd>
<dt id="term-HTTP-HTTPS">HTTP/HTTPS<a class="headerlink" href="#term-HTTP-HTTPS" title="Link to this term"></a></dt><dd><p>Hypertext Transfer Protocol - Web protocol that can also be used for file access via WebDAV.</p>
</dd>
<dt id="term-NFS-v3">NFS v3<a class="headerlink" href="#term-NFS-v3" title="Link to this term"></a></dt><dd><p>Network File System version 3 - Stateless file sharing protocol, widely supported.</p>
</dd>
<dt id="term-NFS-v4">NFS v4<a class="headerlink" href="#term-NFS-v4" title="Link to this term"></a></dt><dd><p>Network File System version 4 - Stateful protocol with improved security and features.</p>
</dd>
<dt id="term-SFTP">SFTP<a class="headerlink" href="#term-SFTP" title="Link to this term"></a></dt><dd><p>SSH File Transfer Protocol - Secure file transfer protocol that operates over SSH.</p>
</dd>
<dt id="term-SMB-CIFS">SMB/CIFS<a class="headerlink" href="#term-SMB-CIFS" title="Link to this term"></a></dt><dd><p>Server Message Block / Common Internet File System - File sharing protocol used primarily in Windows environments.</p>
</dd>
<dt id="term-WebDAV">WebDAV<a class="headerlink" href="#term-WebDAV" title="Link to this term"></a></dt><dd><p>Web Distributed Authoring and Versioning - Extension to HTTP for collaborative file management.</p>
</dd>
</dl>
</section>
<section id="file-system-features">
<h2>File System Features<a class="headerlink" href="#file-system-features" title="Link to this heading"></a></h2>
<dl class="simple glossary">
<dt id="term-Compression">Compression<a class="headerlink" href="#term-Compression" title="Link to this term"></a></dt><dd><p>Feature that reduces file size by encoding data more efficiently, saving storage space at the cost of CPU overhead.</p>
</dd>
<dt id="term-Copy-on-Write">Copy-on-Write<a class="headerlink" href="#term-Copy-on-Write" title="Link to this term"></a></dt><dd><p>Technique where data is not physically copied until it is modified, used in snapshots and some filesystems.</p>
</dd>
<dt id="term-Deduplication">Deduplication<a class="headerlink" href="#term-Deduplication" title="Link to this term"></a></dt><dd><p>Process of eliminating duplicate data to reduce storage requirements.</p>
</dd>
<dt id="term-Encryption">Encryption<a class="headerlink" href="#term-Encryption" title="Link to this term"></a></dt><dd><p>Process of encoding data to prevent unauthorized access, can be implemented at filesystem or block device level.</p>
</dd>
<dt id="term-Journaling">Journaling<a class="headerlink" href="#term-Journaling" title="Link to this term"></a></dt><dd><p>Technique that logs filesystem changes before committing them, enabling fast recovery after crashes.</p>
</dd>
<dt id="term-Quotas">Quotas<a class="headerlink" href="#term-Quotas" title="Link to this term"></a></dt><dd><p>Limits placed on storage usage by users or groups to prevent overconsumption of disk space.</p>
</dd>
<dt id="term-Snapshots">Snapshots<a class="headerlink" href="#term-Snapshots" title="Link to this term"></a></dt><dd><p>Point-in-time copies of filesystem state that can be used for backups or recovery.</p>
</dd>
<dt id="term-Sparse-Files">Sparse Files<a class="headerlink" href="#term-Sparse-Files" title="Link to this term"></a></dt><dd><p>Files that contain large blocks of zero bytes that are not actually stored on disk, saving space.</p>
</dd>
</dl>
<p>This glossary provides essential terminology for understanding storage concepts in Ubuntu 22.04 and serves as a quick reference for technical terms used throughout the documentation.</p>
</section>
<span id="document-faq"></span><section id="frequently-asked-questions">
<h2>Frequently Asked Questions<a class="headerlink" href="#frequently-asked-questions" title="Link to this heading"></a></h2>
<section id="storage-fundamentals">
<h3>Storage Fundamentals<a class="headerlink" href="#storage-fundamentals" title="Link to this heading"></a></h3>
<section id="q-what-s-the-difference-between-storage-and-memory">
<h4>Q: What’s the difference between storage and memory?<a class="headerlink" href="#q-what-s-the-difference-between-storage-and-memory" title="Link to this heading"></a></h4>
<p><strong>A:</strong> Memory (RAM) is volatile storage that loses data when power is removed, while storage is non-volatile and retains data permanently. Memory provides temporary workspace for active programs, while storage provides long-term data retention.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check memory usage</span>
free<span class="w"> </span>-h

<span class="c1"># Check storage usage</span>
df<span class="w"> </span>-h

<span class="c1"># Show memory and storage together</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Memory:&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>free<span class="w"> </span>-h<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;\\nStorage:&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>df<span class="w"> </span>-h
</pre></div>
</div>
</section>
<section id="q-how-do-i-determine-what-type-of-storage-device-i-have">
<h4>Q: How do I determine what type of storage device I have?<a class="headerlink" href="#q-how-do-i-determine-what-type-of-storage-device-i-have" title="Link to this heading"></a></h4>
<p><strong>A:</strong> Use these commands to identify your storage devices:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># List all block devices</span>
lsblk

<span class="c1"># Check if SSD or HDD</span>
cat<span class="w"> </span>/sys/block/sda/queue/rotational
<span class="c1"># 0 = SSD, 1 = HDD</span>

<span class="c1"># Get detailed device information</span>
sudo<span class="w"> </span>lshw<span class="w"> </span>-class<span class="w"> </span>disk

<span class="c1"># Check device specifications</span>
sudo<span class="w"> </span>hdparm<span class="w"> </span>-I<span class="w"> </span>/dev/sda<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;(Model|Serial|LBA)&quot;</span>
</pre></div>
</div>
</section>
<section id="q-what-filesystem-should-i-use-for-different-purposes">
<h4>Q: What filesystem should I use for different purposes?<a class="headerlink" href="#q-what-filesystem-should-i-use-for-different-purposes" title="Link to this heading"></a></h4>
<p><strong>A:</strong> Choose based on your specific needs:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Purpose                | Recommended Filesystem | Reason
-----------------------|------------------------|------------------
Ubuntu root partition | ext4                   | Stable, well-tested
Large files (&gt;4GB)    | XFS or ext4           | Better large file support
Snapshots needed       | Btrfs                 | Built-in snapshot capability
Windows compatibility  | NTFS                  | Cross-platform support
USB drives            | exFAT                 | Universal compatibility
Network shares        | ext4 or XFS           | Good network performance
</pre></div>
</div>
</section>
</section>
<section id="file-system-management">
<h3>File System Management<a class="headerlink" href="#file-system-management" title="Link to this heading"></a></h3>
<section id="q-how-do-i-safely-resize-a-partition-without-losing-data">
<h4>Q: How do I safely resize a partition without losing data?<a class="headerlink" href="#q-how-do-i-safely-resize-a-partition-without-losing-data" title="Link to this heading"></a></h4>
<p><strong>A:</strong> Follow these steps (ALWAYS backup first):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. BACKUP YOUR DATA FIRST!</span>

<span class="c1"># 2. Unmount the partition</span>
sudo<span class="w"> </span>umount<span class="w"> </span>/dev/sda2

<span class="c1"># 3. Check filesystem integrity</span>
sudo<span class="w"> </span>fsck<span class="w"> </span>-f<span class="w"> </span>/dev/sda2

<span class="c1"># 4. Resize partition (using parted)</span>
sudo<span class="w"> </span>parted<span class="w"> </span>/dev/sda<span class="w"> </span>resizepart<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">100</span>%

<span class="c1"># 5. Resize filesystem to match partition</span>
sudo<span class="w"> </span>resize2fs<span class="w"> </span>/dev/sda2

<span class="c1"># 6. Mount and verify</span>
sudo<span class="w"> </span>mount<span class="w"> </span>/dev/sda2<span class="w"> </span>/mnt/test
df<span class="w"> </span>-h<span class="w"> </span>/mnt/test
</pre></div>
</div>
</section>
<section id="q-how-can-i-recover-deleted-files">
<h4>Q: How can I recover deleted files?<a class="headerlink" href="#q-how-can-i-recover-deleted-files" title="Link to this heading"></a></h4>
<p><strong>A:</strong> Recovery depends on how quickly you act and the filesystem type:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install recovery tools</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>testdisk<span class="w"> </span>photorec<span class="w"> </span>extundelete

<span class="c1"># For ext4 filesystems (must act quickly)</span>
sudo<span class="w"> </span>extundelete<span class="w"> </span>/dev/sda1<span class="w"> </span>--restore-file<span class="w"> </span>/path/to/deleted/file

<span class="c1"># For general file recovery</span>
sudo<span class="w"> </span>photorec<span class="w"> </span>/dev/sda1

<span class="c1"># For partition recovery</span>
sudo<span class="w"> </span>testdisk<span class="w"> </span>/dev/sda

<span class="c1"># Emergency: Stop using the drive immediately</span>
sudo<span class="w"> </span>mount<span class="w"> </span>-o<span class="w"> </span>remount,ro<span class="w"> </span>/dev/sda1
</pre></div>
</div>
</section>
<section id="q-how-do-i-check-and-repair-filesystem-errors">
<h4>Q: How do I check and repair filesystem errors?<a class="headerlink" href="#q-how-do-i-check-and-repair-filesystem-errors" title="Link to this heading"></a></h4>
<p><strong>A:</strong> Use appropriate tools for each filesystem type:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># For ext4 filesystems</span>
sudo<span class="w"> </span>fsck.ext4<span class="w"> </span>-f<span class="w"> </span>/dev/sda1<span class="w">     </span><span class="c1"># Force check</span>
sudo<span class="w"> </span>fsck.ext4<span class="w"> </span>-p<span class="w"> </span>/dev/sda1<span class="w">     </span><span class="c1"># Automatic repair</span>

<span class="c1"># For XFS filesystems</span>
sudo<span class="w"> </span>xfs_check<span class="w"> </span>/dev/sda1<span class="w">        </span><span class="c1"># Check only</span>
sudo<span class="w"> </span>xfs_repair<span class="w"> </span>/dev/sda1<span class="w">       </span><span class="c1"># Repair</span>

<span class="c1"># For Btrfs filesystems</span>
sudo<span class="w"> </span>btrfs<span class="w"> </span>check<span class="w"> </span>/dev/sda1<span class="w">      </span><span class="c1"># Check</span>
sudo<span class="w"> </span>btrfs<span class="w"> </span>check<span class="w"> </span>--repair<span class="w"> </span>/dev/sda1<span class="w">  </span><span class="c1"># Repair</span>

<span class="c1"># Check all filesystems in fstab</span>
sudo<span class="w"> </span>fsck<span class="w"> </span>-A<span class="w"> </span>-f
</pre></div>
</div>
</section>
</section>
<section id="disk-management">
<h3>Disk Management<a class="headerlink" href="#disk-management" title="Link to this heading"></a></h3>
<section id="q-how-do-i-add-a-new-hard-drive-to-my-ubuntu-system">
<h4>Q: How do I add a new hard drive to my Ubuntu system?<a class="headerlink" href="#q-how-do-i-add-a-new-hard-drive-to-my-ubuntu-system" title="Link to this heading"></a></h4>
<p><strong>A:</strong> Follow this complete process:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. Identify the new drive</span>
sudo<span class="w"> </span>fdisk<span class="w"> </span>-l
lsblk

<span class="c1"># 2. Create partition table</span>
sudo<span class="w"> </span>parted<span class="w"> </span>/dev/sdb<span class="w"> </span>mklabel<span class="w"> </span>gpt

<span class="c1"># 3. Create partition</span>
sudo<span class="w"> </span>parted<span class="w"> </span>/dev/sdb<span class="w"> </span>mkpart<span class="w"> </span>primary<span class="w"> </span>ext4<span class="w"> </span><span class="m">0</span>%<span class="w"> </span><span class="m">100</span>%

<span class="c1"># 4. Format the partition</span>
sudo<span class="w"> </span>mkfs.ext4<span class="w"> </span>/dev/sdb1

<span class="c1"># 5. Create mount point</span>
sudo<span class="w"> </span>mkdir<span class="w"> </span>/mnt/newdrive

<span class="c1"># 6. Mount temporarily</span>
sudo<span class="w"> </span>mount<span class="w"> </span>/dev/sdb1<span class="w"> </span>/mnt/newdrive

<span class="c1"># 7. Add to fstab for permanent mounting</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;UUID=</span><span class="k">$(</span>sudo<span class="w"> </span>blkid<span class="w"> </span>-s<span class="w"> </span>UUID<span class="w"> </span>-o<span class="w"> </span>value<span class="w"> </span>/dev/sdb1<span class="k">)</span><span class="s2"> /mnt/newdrive ext4 defaults 0 2&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/fstab

<span class="c1"># 8. Test fstab entry</span>
sudo<span class="w"> </span>umount<span class="w"> </span>/mnt/newdrive
sudo<span class="w"> </span>mount<span class="w"> </span>-a
</pre></div>
</div>
</section>
<section id="q-how-can-i-improve-disk-performance">
<h4>Q: How can I improve disk performance?<a class="headerlink" href="#q-how-can-i-improve-disk-performance" title="Link to this heading"></a></h4>
<p><strong>A:</strong> Several optimization techniques:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Enable TRIM for SSDs</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>fstrim.timer

<span class="c1"># Optimize I/O scheduler</span>
<span class="c1"># For SSDs</span>
<span class="nb">echo</span><span class="w"> </span>none<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/sys/block/sda/queue/scheduler

<span class="c1"># For HDDs</span>
<span class="nb">echo</span><span class="w"> </span>mq-deadline<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/sys/block/sda/queue/scheduler

<span class="c1"># Optimize mount options</span>
sudo<span class="w"> </span>mount<span class="w"> </span>-o<span class="w"> </span>remount,noatime,discard<span class="w"> </span>/dev/sda1

<span class="c1"># Disable swap if you have enough RAM</span>
sudo<span class="w"> </span>swapoff<span class="w"> </span>-a
<span class="c1"># Comment out swap in /etc/fstab</span>

<span class="c1"># Optimize filesystem</span>
sudo<span class="w"> </span>tune2fs<span class="w"> </span>-o<span class="w"> </span>discard<span class="w"> </span>/dev/sda1
</pre></div>
</div>
</section>
<section id="q-what-should-i-do-if-my-disk-is-failing">
<h4>Q: What should I do if my disk is failing?<a class="headerlink" href="#q-what-should-i-do-if-my-disk-is-failing" title="Link to this heading"></a></h4>
<p><strong>A:</strong> Take immediate action to protect your data:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. Check SMART status</span>
sudo<span class="w"> </span>smartctl<span class="w"> </span>-a<span class="w"> </span>/dev/sda

<span class="c1"># 2. If drive is still accessible, backup immediately</span>
sudo<span class="w"> </span>dd<span class="w"> </span><span class="k">if</span><span class="o">=</span>/dev/sda<span class="w"> </span><span class="nv">of</span><span class="o">=</span>/backup/disk_image.img<span class="w"> </span><span class="nv">bs</span><span class="o">=</span>1M<span class="w"> </span><span class="nv">status</span><span class="o">=</span>progress

<span class="c1"># 3. Or use ddrescue for damaged drives</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>gddrescue
sudo<span class="w"> </span>ddrescue<span class="w"> </span>/dev/sda<span class="w"> </span>/backup/disk_image.img<span class="w"> </span>/backup/rescue.log

<span class="c1"># 4. Stop using the drive immediately</span>
sudo<span class="w"> </span>umount<span class="w"> </span>/dev/sda1

<span class="c1"># 5. Replace the drive and restore from backup</span>
</pre></div>
</div>
</section>
</section>
<section id="raid-configuration">
<h3>RAID Configuration<a class="headerlink" href="#raid-configuration" title="Link to this heading"></a></h3>
<section id="q-which-raid-level-should-i-choose">
<h4>Q: Which RAID level should I choose?<a class="headerlink" href="#q-which-raid-level-should-i-choose" title="Link to this heading"></a></h4>
<p><strong>A:</strong> Choose based on your priorities:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Priority              | RAID Level | Min Disks | Capacity Loss | Performance
----------------------|------------|-----------|---------------|-------------
Performance Only      | RAID 0     | 2         | None          | Excellent
Basic Redundancy      | RAID 1     | 2         | 50%           | Good Read
Balanced Performance  | RAID 5     | 3         | 1 disk        | Good
High Fault Tolerance  | RAID 6     | 4         | 2 disks       | Moderate
Performance + Safety  | RAID 10    | 4         | 50%           | Excellent
</pre></div>
</div>
</section>
<section id="q-how-do-i-replace-a-failed-disk-in-a-raid-array">
<h4>Q: How do I replace a failed disk in a RAID array?<a class="headerlink" href="#q-how-do-i-replace-a-failed-disk-in-a-raid-array" title="Link to this heading"></a></h4>
<p><strong>A:</strong> Steps for replacing a failed RAID disk:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. Identify failed disk</span>
cat<span class="w"> </span>/proc/mdstat
sudo<span class="w"> </span>mdadm<span class="w"> </span>--detail<span class="w"> </span>/dev/md0

<span class="c1"># 2. Mark disk as failed (if not auto-detected)</span>
sudo<span class="w"> </span>mdadm<span class="w"> </span>--fail<span class="w"> </span>/dev/md0<span class="w"> </span>/dev/sdb

<span class="c1"># 3. Remove failed disk from array</span>
sudo<span class="w"> </span>mdadm<span class="w"> </span>--remove<span class="w"> </span>/dev/md0<span class="w"> </span>/dev/sdb

<span class="c1"># 4. Physically replace the disk</span>
<span class="c1"># Power down system if hot-swap not supported</span>

<span class="c1"># 5. Add new disk to array</span>
sudo<span class="w"> </span>mdadm<span class="w"> </span>--add<span class="w"> </span>/dev/md0<span class="w"> </span>/dev/sdb

<span class="c1"># 6. Monitor rebuild progress</span>
watch<span class="w"> </span>cat<span class="w"> </span>/proc/mdstat
</pre></div>
</div>
</section>
<section id="q-can-i-convert-between-raid-levels">
<h4>Q: Can I convert between RAID levels?<a class="headerlink" href="#q-can-i-convert-between-raid-levels" title="Link to this heading"></a></h4>
<p><strong>A:</strong> Yes, but with limitations and requirements:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># RAID 1 to RAID 5 (requires adding a disk first)</span>
sudo<span class="w"> </span>mdadm<span class="w"> </span>--add<span class="w"> </span>/dev/md0<span class="w"> </span>/dev/sdd
sudo<span class="w"> </span>mdadm<span class="w"> </span>--grow<span class="w"> </span>/dev/md0<span class="w"> </span>--level<span class="o">=</span><span class="m">5</span><span class="w"> </span>--raid-devices<span class="o">=</span><span class="m">3</span>

<span class="c1"># RAID 5 to RAID 6 (requires adding a disk)</span>
sudo<span class="w"> </span>mdadm<span class="w"> </span>--add<span class="w"> </span>/dev/md0<span class="w"> </span>/dev/sde
sudo<span class="w"> </span>mdadm<span class="w"> </span>--grow<span class="w"> </span>/dev/md0<span class="w"> </span>--level<span class="o">=</span><span class="m">6</span><span class="w"> </span>--raid-devices<span class="o">=</span><span class="m">4</span>

<span class="c1"># Note: ALWAYS backup data before conversion</span>
<span class="c1"># Some conversions may not be possible</span>

<span class="c1"># Check conversion progress</span>
cat<span class="w"> </span>/proc/mdstat
</pre></div>
</div>
</section>
</section>
<section id="network-storage">
<h3>Network Storage<a class="headerlink" href="#network-storage" title="Link to this heading"></a></h3>
<section id="q-should-i-use-nfs-or-smb-for-file-sharing">
<h4>Q: Should I use NFS or SMB for file sharing?<a class="headerlink" href="#q-should-i-use-nfs-or-smb-for-file-sharing" title="Link to this heading"></a></h4>
<p><strong>A:</strong> Choose based on your environment:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Scenario                    | Recommended | Reason
----------------------------|-------------|------------------
Linux-only environment     | NFS         | Better performance, native
Mixed OS (Linux/Windows/Mac)| SMB/CIFS    | Universal compatibility
High-performance computing  | NFS         | Lower overhead
Simple file sharing         | SMB/CIFS    | Easier to configure
Security-critical          | NFS + Kerberos | Better authentication
</pre></div>
</div>
</section>
<section id="q-how-do-i-troubleshoot-slow-network-storage">
<h4>Q: How do I troubleshoot slow network storage?<a class="headerlink" href="#q-how-do-i-troubleshoot-slow-network-storage" title="Link to this heading"></a></h4>
<p><strong>A:</strong> Diagnose and optimize network storage performance:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check network connectivity</span>
ping<span class="w"> </span>storage-server
traceroute<span class="w"> </span>storage-server

<span class="c1"># Test network bandwidth</span>
iperf3<span class="w"> </span>-c<span class="w"> </span>storage-server

<span class="c1"># Check mount options</span>
mount<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;(nfs|cifs)&quot;</span>

<span class="c1"># Optimize NFS mount options</span>
sudo<span class="w"> </span>mount<span class="w"> </span>-o<span class="w"> </span>remount,rsize<span class="o">=</span><span class="m">32768</span>,wsize<span class="o">=</span><span class="m">32768</span>,hard,intr<span class="w"> </span>/mnt/nfs

<span class="c1"># Monitor network I/O</span>
iftop<span class="w"> </span>-i<span class="w"> </span>eth0
nethogs

<span class="c1"># Check for packet loss</span>
mtr<span class="w"> </span>storage-server
</pre></div>
</div>
</section>
<section id="q-how-do-i-set-up-automatic-mounting-for-network-drives">
<h4>Q: How do I set up automatic mounting for network drives?<a class="headerlink" href="#q-how-do-i-set-up-automatic-mounting-for-network-drives" title="Link to this heading"></a></h4>
<p><strong>A:</strong> Configure persistent network mounts:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># For NFS shares</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;nfs-server:/path/to/share /mnt/nfs nfs defaults,_netdev 0 0&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/fstab

<span class="c1"># For SMB/CIFS shares with credentials</span>
<span class="c1"># Create credentials file</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>~/.smbcredentials<span class="w"> </span><span class="s">&lt;&lt; EOF</span>
<span class="s">username=myuser</span>
<span class="s">password=mypassword</span>
<span class="s">domain=mydomain</span>
<span class="s">EOF</span>
chmod<span class="w"> </span><span class="m">600</span><span class="w"> </span>~/.smbcredentials

<span class="c1"># Add to fstab</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;//server/share /mnt/smb cifs credentials=/home/user/.smbcredentials,uid=1000,gid=1000,_netdev 0 0&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/fstab

<span class="c1"># Test automatic mounting</span>
sudo<span class="w"> </span>mount<span class="w"> </span>-a
</pre></div>
</div>
</section>
</section>
<section id="backup-and-recovery">
<h3>Backup and Recovery<a class="headerlink" href="#backup-and-recovery" title="Link to this heading"></a></h3>
<section id="q-what-s-the-best-backup-strategy-for-ubuntu">
<h4>Q: What’s the best backup strategy for Ubuntu?<a class="headerlink" href="#q-what-s-the-best-backup-strategy-for-ubuntu" title="Link to this heading"></a></h4>
<p><strong>A:</strong> Implement the 3-2-1 backup rule:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 3-2-1 Rule: 3 copies, 2 different media types, 1 offsite</span>

<span class="c1"># Local backup with rsync</span>
rsync<span class="w"> </span>-av<span class="w"> </span>--delete<span class="w"> </span>/home/user/<span class="w"> </span>/backup/local/

<span class="c1"># External drive backup</span>
rsync<span class="w"> </span>-av<span class="w"> </span>--delete<span class="w"> </span>/home/user/<span class="w"> </span>/media/external/backup/

<span class="c1"># Cloud backup with rclone</span>
rclone<span class="w"> </span>sync<span class="w"> </span>/home/user/<span class="w"> </span>cloud:backup/

<span class="c1"># System backup script</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>/usr/local/bin/backup.sh<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s">#!/bin/bash</span>
<span class="s"># Comprehensive backup script</span>

<span class="s"># Backup user data</span>
<span class="s">rsync -av /home/ /backup/home/</span>

<span class="s"># Backup system configuration</span>
<span class="s">tar -czf /backup/system-$(date +%Y%m%d).tar.gz /etc /var/lib/dpkg</span>

<span class="s"># Create disk image of root partition</span>
<span class="s">dd if=/dev/sda1 of=/backup/root-$(date +%Y%m%d).img bs=1M</span>
<span class="s">EOF</span>
</pre></div>
</div>
</section>
<section id="q-how-do-i-restore-from-a-backup">
<h4>Q: How do I restore from a backup?<a class="headerlink" href="#q-how-do-i-restore-from-a-backup" title="Link to this heading"></a></h4>
<p><strong>A:</strong> Restoration process depends on backup type:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Restore from rsync backup</span>
rsync<span class="w"> </span>-av<span class="w"> </span>/backup/home/<span class="w"> </span>/home/

<span class="c1"># Restore from tar archive</span>
<span class="nb">cd</span><span class="w"> </span>/
sudo<span class="w"> </span>tar<span class="w"> </span>-xzf<span class="w"> </span>/backup/system-20240101.tar.gz

<span class="c1"># Restore from disk image</span>
sudo<span class="w"> </span>dd<span class="w"> </span><span class="k">if</span><span class="o">=</span>/backup/root-20240101.img<span class="w"> </span><span class="nv">of</span><span class="o">=</span>/dev/sda1<span class="w"> </span><span class="nv">bs</span><span class="o">=</span>1M<span class="w"> </span><span class="nv">status</span><span class="o">=</span>progress

<span class="c1"># Restore specific files</span>
sudo<span class="w"> </span>tar<span class="w"> </span>-xzf<span class="w"> </span>/backup/system.tar.gz<span class="w"> </span>-C<span class="w"> </span>/<span class="w"> </span>specific/file/path
</pre></div>
</div>
</section>
</section>
<section id="troubleshooting">
<h3>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Link to this heading"></a></h3>
<section id="q-my-system-won-t-boot-after-storage-changes-how-do-i-fix-it">
<h4>Q: My system won’t boot after storage changes. How do I fix it?<a class="headerlink" href="#q-my-system-won-t-boot-after-storage-changes-how-do-i-fix-it" title="Link to this heading"></a></h4>
<p><strong>A:</strong> Boot from Ubuntu live USB and repair:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Boot from Ubuntu live USB</span>

<span class="c1"># Mount root partition</span>
sudo<span class="w"> </span>mount<span class="w"> </span>/dev/sda2<span class="w"> </span>/mnt

<span class="c1"># Mount other partitions</span>
sudo<span class="w"> </span>mount<span class="w"> </span>/dev/sda1<span class="w"> </span>/mnt/boot/efi<span class="w">  </span><span class="c1"># EFI partition</span>

<span class="c1"># Bind mount system directories</span>
sudo<span class="w"> </span>mount<span class="w"> </span>--bind<span class="w"> </span>/dev<span class="w"> </span>/mnt/dev
sudo<span class="w"> </span>mount<span class="w"> </span>--bind<span class="w"> </span>/proc<span class="w"> </span>/mnt/proc
sudo<span class="w"> </span>mount<span class="w"> </span>--bind<span class="w"> </span>/sys<span class="w"> </span>/mnt/sys

<span class="c1"># Chroot into system</span>
sudo<span class="w"> </span>chroot<span class="w"> </span>/mnt

<span class="c1"># Repair GRUB</span>
grub-install<span class="w"> </span>/dev/sda
update-grub

<span class="c1"># Fix fstab if needed</span>
nano<span class="w"> </span>/etc/fstab

<span class="c1"># Exit and reboot</span>
<span class="nb">exit</span>
sudo<span class="w"> </span>reboot
</pre></div>
</div>
</section>
<section id="q-how-do-i-diagnose-storage-performance-issues">
<h4>Q: How do I diagnose storage performance issues?<a class="headerlink" href="#q-how-do-i-diagnose-storage-performance-issues" title="Link to this heading"></a></h4>
<p><strong>A:</strong> Use these diagnostic tools:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Monitor I/O in real-time</span>
sudo<span class="w"> </span>iotop<span class="w"> </span>-o

<span class="c1"># Check I/O statistics</span>
iostat<span class="w"> </span>-x<span class="w"> </span><span class="m">1</span>

<span class="c1"># Monitor disk usage</span>
watch<span class="w"> </span>df<span class="w"> </span>-h

<span class="c1"># Check for high I/O wait</span>
top<span class="w">  </span><span class="c1"># Look for high %wa (I/O wait)</span>

<span class="c1"># Test disk speed</span>
sudo<span class="w"> </span>hdparm<span class="w"> </span>-Tt<span class="w"> </span>/dev/sda

<span class="c1"># Check for filesystem errors</span>
dmesg<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span>error

<span class="c1"># Monitor SMART attributes</span>
sudo<span class="w"> </span>smartctl<span class="w"> </span>-A<span class="w"> </span>/dev/sda
</pre></div>
</div>
</section>
<section id="q-what-should-i-do-if-i-m-running-out-of-disk-space">
<h4>Q: What should I do if I’m running out of disk space?<a class="headerlink" href="#q-what-should-i-do-if-i-m-running-out-of-disk-space" title="Link to this heading"></a></h4>
<p><strong>A:</strong> Free up space systematically:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find large files</span>
sudo<span class="w"> </span>find<span class="w"> </span>/<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-size<span class="w"> </span>+100M<span class="w"> </span>-exec<span class="w"> </span>ls<span class="w"> </span>-lh<span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\\</span><span class="p">;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null

<span class="c1"># Check directory sizes</span>
sudo<span class="w"> </span>du<span class="w"> </span>-h<span class="w"> </span>--max-depth<span class="o">=</span><span class="m">1</span><span class="w"> </span>/<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-hr

<span class="c1"># Clean package cache</span>
sudo<span class="w"> </span>apt<span class="w"> </span>autoclean
sudo<span class="w"> </span>apt<span class="w"> </span>autoremove

<span class="c1"># Clean system logs</span>
sudo<span class="w"> </span>journalctl<span class="w"> </span>--vacuum-time<span class="o">=</span>3d

<span class="c1"># Clean user caches</span>
rm<span class="w"> </span>-rf<span class="w"> </span>~/.cache/*
rm<span class="w"> </span>-rf<span class="w"> </span>~/.thumbnails/*

<span class="c1"># Find and remove duplicate files</span>
fdupes<span class="w"> </span>-r<span class="w"> </span>/home/user<span class="w"> </span>-d

<span class="c1"># Move large files to external storage</span>
mv<span class="w"> </span>/home/user/large_files/<span class="w"> </span>/mnt/external/
</pre></div>
</div>
</section>
</section>
<section id="performance-optimization">
<h3>Performance Optimization<a class="headerlink" href="#performance-optimization" title="Link to this heading"></a></h3>
<section id="q-how-can-i-optimize-ubuntu-for-ssd-storage">
<h4>Q: How can I optimize Ubuntu for SSD storage?<a class="headerlink" href="#q-how-can-i-optimize-ubuntu-for-ssd-storage" title="Link to this heading"></a></h4>
<p><strong>A:</strong> Apply SSD-specific optimizations:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Enable TRIM</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>fstrim.timer

<span class="c1"># Set I/O scheduler to none</span>
<span class="nb">echo</span><span class="w"> </span>none<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/sys/block/sda/queue/scheduler

<span class="c1"># Update fstab with SSD-optimized options</span>
<span class="c1"># Add noatime,discard to mount options</span>
sudo<span class="w"> </span>nano<span class="w"> </span>/etc/fstab
<span class="c1"># Example: UUID=xxx / ext4 defaults,noatime,discard 0 1</span>

<span class="c1"># Reduce swappiness</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;vm.swappiness=1&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/sysctl.conf

<span class="c1"># Move temporary files to RAM</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;tmpfs /tmp tmpfs defaults,noatime,mode=1777 0 0&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/fstab
</pre></div>
</div>
</section>
<section id="q-how-do-i-monitor-storage-health-proactively">
<h4>Q: How do I monitor storage health proactively?<a class="headerlink" href="#q-how-do-i-monitor-storage-health-proactively" title="Link to this heading"></a></h4>
<p><strong>A:</strong> Set up comprehensive monitoring:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install monitoring tools</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>smartmontools<span class="w"> </span>sysstat

<span class="c1"># Enable SMART monitoring</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>smartd

<span class="c1"># Configure email alerts</span>
sudo<span class="w"> </span>nano<span class="w"> </span>/etc/smartd.conf
<span class="c1"># Add: /dev/sda -a -o on -S on -s (S/../.././02|L/../../6/03) -m admin@example.com</span>

<span class="c1"># Create monitoring script</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>/usr/local/bin/storage_health.sh<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
<span class="s">#!/bin/bash</span>

<span class="s"># Check disk usage</span>
<span class="s">df -h | awk &#39;NR&gt;1 {if($5+0 &gt; 85) print $0}&#39; | mail -s &quot;Disk Usage Alert&quot; admin@example.com</span>

<span class="s"># Check SMART status</span>
<span class="s">for disk in /dev/sd[a-z]; do</span>
<span class="s">    if [ -b &quot;$disk&quot; ]; then</span>
<span class="s">        if ! smartctl -H &quot;$disk&quot; | grep -q PASSED; then</span>
<span class="s">            echo &quot;SMART failure on $disk&quot; | mail -s &quot;SMART Alert&quot; admin@example.com</span>
<span class="s">        fi</span>
<span class="s">    fi</span>
<span class="s">done</span>
<span class="s">EOF</span>

chmod<span class="w"> </span>+x<span class="w"> </span>/usr/local/bin/storage_health.sh

<span class="c1"># Schedule regular checks</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;0 6 * * * /usr/local/bin/storage_health.sh&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>crontab<span class="w"> </span>-
</pre></div>
</div>
</section>
</section>
</section>
<span id="document-downloads"></span><section id="downloads-and-resources">
<h2>Downloads and Resources<a class="headerlink" href="#downloads-and-resources" title="Link to this heading"></a></h2>
<p>This section provides information on how to generate and download the documentation in various formats, along with additional resources for storage management on Ubuntu 22.04.</p>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#documentation-formats" id="id1">Documentation Formats</a></p>
<ul>
<li><p><a class="reference internal" href="#building-the-documentation" id="id2">Building the Documentation</a></p></li>
<li><p><a class="reference internal" href="#download-instructions" id="id3">Download Instructions</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#automation-scripts" id="id4">Automation Scripts</a></p>
<ul>
<li><p><a class="reference internal" href="#automated-build-script" id="id5">Automated Build Script</a></p></li>
<li><p><a class="reference internal" href="#continuous-integration-script" id="id6">Continuous Integration Script</a></p></li>
<li><p><a class="reference internal" href="#docker-build-environment" id="id7">Docker Build Environment</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#additional-resources" id="id8">Additional Resources</a></p>
<ul>
<li><p><a class="reference internal" href="#official-documentation-links" id="id9">Official Documentation Links</a></p></li>
<li><p><a class="reference internal" href="#useful-tools-and-utilities" id="id10">Useful Tools and Utilities</a></p></li>
<li><p><a class="reference internal" href="#scripts-and-templates" id="id11">Scripts and Templates</a></p></li>
<li><p><a class="reference internal" href="#community-resources" id="id12">Community Resources</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#getting-help-and-support" id="id13">Getting Help and Support</a></p>
<ul>
<li><p><a class="reference internal" href="#issue-reporting" id="id14">Issue Reporting</a></p></li>
<li><p><a class="reference internal" href="#contributing-to-documentation" id="id15">Contributing to Documentation</a></p></li>
<li><p><a class="reference internal" href="#contact-information" id="id16">Contact Information</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="documentation-formats">
<h3><a class="toc-backref" href="#id1" role="doc-backlink">Documentation Formats</a><a class="headerlink" href="#documentation-formats" title="Link to this heading"></a></h3>
<section id="building-the-documentation">
<h4><a class="toc-backref" href="#id2" role="doc-backlink">Building the Documentation</a><a class="headerlink" href="#building-the-documentation" title="Link to this heading"></a></h4>
<p>This documentation is built using Sphinx and can be generated in multiple formats. Follow these steps to build the documentation locally:</p>
<p><strong>Prerequisites:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install Sphinx and required dependencies</span>
sudo<span class="w"> </span>apt<span class="w"> </span>update
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>python3-pip
pip3<span class="w"> </span>install<span class="w"> </span>sphinx<span class="w"> </span>sphinx-rtd-theme

<span class="c1"># Install additional packages for PDF generation</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>texlive-latex-recommended<span class="w"> </span>texlive-fonts-recommended<span class="w"> </span>texlive-latex-extra

<span class="c1"># Install packages for EPUB generation</span>
pip3<span class="w"> </span>install<span class="w"> </span>sphinx-epub
</pre></div>
</div>
<p><strong>Building HTML Documentation:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Navigate to the documentation directory</span>
<span class="nb">cd</span><span class="w"> </span>/path/to/sphinx/source

<span class="c1"># Build HTML documentation</span>
sphinx-build<span class="w"> </span>-b<span class="w"> </span>html<span class="w"> </span>.<span class="w"> </span>_build/html

<span class="c1"># Open in browser</span>
firefox<span class="w"> </span>_build/html/index.html
</pre></div>
</div>
<p><strong>Building PDF Documentation:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Build LaTeX files first</span>
sphinx-build<span class="w"> </span>-b<span class="w"> </span>latex<span class="w"> </span>.<span class="w"> </span>_build/latex

<span class="c1"># Generate PDF from LaTeX</span>
<span class="nb">cd</span><span class="w"> </span>_build/latex
make

<span class="c1"># The PDF will be available as storage-guide.pdf</span>
</pre></div>
</div>
<p><strong>Building EPUB Documentation:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Build EPUB format</span>
sphinx-build<span class="w"> </span>-b<span class="w"> </span>epub<span class="w"> </span>.<span class="w"> </span>_build/epub

<span class="c1"># The EPUB file will be in _build/epub/</span>
</pre></div>
</div>
<p><strong>Building All Formats:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1"># build-docs.sh - Complete documentation build script</span>

<span class="nb">set</span><span class="w"> </span>-e

<span class="nv">SOURCE_DIR</span><span class="o">=</span><span class="s2">&quot;.&quot;</span>
<span class="nv">BUILD_DIR</span><span class="o">=</span><span class="s2">&quot;_build&quot;</span>
<span class="nv">PROJECT_NAME</span><span class="o">=</span><span class="s2">&quot;Ubuntu-Storage-Guide&quot;</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Building Ubuntu 22.04 Storage Documentation...&quot;</span>

<span class="c1"># Clean previous builds</span>
rm<span class="w"> </span>-rf<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BUILD_DIR</span><span class="s2">&quot;</span>
mkdir<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BUILD_DIR</span><span class="s2">&quot;</span>

<span class="c1"># Build HTML</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Building HTML documentation...&quot;</span>
sphinx-build<span class="w"> </span>-b<span class="w"> </span>html<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$SOURCE_DIR</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BUILD_DIR</span><span class="s2">/html&quot;</span>

<span class="c1"># Build PDF</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Building PDF documentation...&quot;</span>
sphinx-build<span class="w"> </span>-b<span class="w"> </span>latex<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$SOURCE_DIR</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BUILD_DIR</span><span class="s2">/latex&quot;</span>
<span class="nb">cd</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BUILD_DIR</span><span class="s2">/latex&quot;</span>
make
cp<span class="w"> </span>*.pdf<span class="w"> </span><span class="s2">&quot;../</span><span class="si">${</span><span class="nv">PROJECT_NAME</span><span class="si">}</span><span class="s2">.pdf&quot;</span>
<span class="nb">cd</span><span class="w"> </span>-<span class="w"> </span>&gt;<span class="w"> </span>/dev/null

<span class="c1"># Build EPUB</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Building EPUB documentation...&quot;</span>
sphinx-build<span class="w"> </span>-b<span class="w"> </span>epub<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$SOURCE_DIR</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BUILD_DIR</span><span class="s2">/epub&quot;</span>
cp<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BUILD_DIR</span><span class="s2">/epub/</span><span class="si">${</span><span class="nv">PROJECT_NAME</span><span class="si">}</span><span class="s2">.epub&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BUILD_DIR</span><span class="s2">/&quot;</span>

<span class="c1"># Create downloadable archive</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Creating download archive...&quot;</span>
<span class="nb">cd</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BUILD_DIR</span><span class="s2">&quot;</span>
tar<span class="w"> </span>-czf<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PROJECT_NAME</span><span class="si">}</span><span class="s2">-docs.tar.gz&quot;</span><span class="w"> </span>html/<span class="w"> </span>*.pdf<span class="w"> </span>*.epub
<span class="nb">cd</span><span class="w"> </span>-<span class="w"> </span>&gt;<span class="w"> </span>/dev/null

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Documentation build complete!&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Available formats:&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  HTML: </span><span class="nv">$BUILD_DIR</span><span class="s2">/html/index.html&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  PDF:  </span><span class="nv">$BUILD_DIR</span><span class="s2">/</span><span class="si">${</span><span class="nv">PROJECT_NAME</span><span class="si">}</span><span class="s2">.pdf&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  EPUB: </span><span class="nv">$BUILD_DIR</span><span class="s2">/</span><span class="si">${</span><span class="nv">PROJECT_NAME</span><span class="si">}</span><span class="s2">.epub&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;  Archive: </span><span class="nv">$BUILD_DIR</span><span class="s2">/</span><span class="si">${</span><span class="nv">PROJECT_NAME</span><span class="si">}</span><span class="s2">-docs.tar.gz&quot;</span>
</pre></div>
</div>
</section>
<section id="download-instructions">
<h4><a class="toc-backref" href="#id3" role="doc-backlink">Download Instructions</a><a class="headerlink" href="#download-instructions" title="Link to this heading"></a></h4>
<p><strong>📥 Available Download Formats:</strong></p>
<div style="background-color: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;">
<h3 style="color: #2c3e50;">📋 Quick Downloads</h3>
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">

<div style="background: white; padding: 15px; border-radius: 6px; border-left: 4px solid #e74c3c;">
<h4 style="margin: 0 0 10px 0; color: #e74c3c;">📄 PDF Format</h4>
<p style="margin: 0 0 10px 0; font-size: 14px;">Complete guide in PDF format<br>Perfect for offline reading</p>
<a href="downloads/Ubuntu-Storage-Guide.pdf" style="background: #e74c3c; color: white; padding: 8px 16px; text-decoration: none; border-radius: 4px; font-size: 14px;">Download PDF</a>
</div>

<div style="background: white; padding: 15px; border-radius: 6px; border-left: 4px solid #3498db;">
<h4 style="margin: 0 0 10px 0; color: #3498db;">📱 EPUB Format</h4>
<p style="margin: 0 0 10px 0; font-size: 14px;">E-book format for e-readers<br>Mobile-friendly reading</p>
<a href="downloads/Ubuntu-Storage-Guide.epub" style="background: #3498db; color: white; padding: 8px 16px; text-decoration: none; border-radius: 4px; font-size: 14px;">Download EPUB</a>
</div>

<div style="background: white; padding: 15px; border-radius: 6px; border-left: 4px solid #27ae60;">
<h4 style="margin: 0 0 10px 0; color: #27ae60;">🌐 Single HTML</h4>
<p style="margin: 0 0 10px 0; font-size: 14px;">Complete guide in one HTML file<br>Easy sharing and archiving</p>
<a href="downloads/Ubuntu-Storage-Guide-Complete.html" style="background: #27ae60; color: white; padding: 8px 16px; text-decoration: none; border-radius: 4px; font-size: 14px;">Download HTML</a>
</div>

<div style="background: white; padding: 15px; border-radius: 6px; border-left: 4px solid #f39c12;">
<h4 style="margin: 0 0 10px 0; color: #f39c12;">📦 Complete Archive</h4>
<p style="margin: 0 0 10px 0; font-size: 14px;">All formats in one ZIP<br>HTML, PDF, EPUB & Text</p>
<a href="downloads/Ubuntu-Storage-Guide-All-Formats.zip" style="background: #f39c12; color: white; padding: 8px 16px; text-decoration: none; border-radius: 4px; font-size: 14px;">Download All</a>
</div>

</div>
</div><p><strong>For End Users:</strong></p>
<ol class="arabic simple">
<li><p><strong>📄 PDF Version:</strong>
- Complete documentation in a single PDF file
- Best for offline reading and printing
- Preserves formatting and includes bookmarks
- Professional layout with headers and page numbers</p></li>
<li><p><strong>📱 EPUB Version:</strong>
- E-book format compatible with most e-readers
- Best for mobile devices and e-reader applications
- Supports reflowable text and adjustable font sizes
- Works with Kindle, Apple Books, Adobe Digital Editions</p></li>
<li><p><strong>🌐 HTML Version:</strong>
- Complete website version with navigation and search
- Best for online reading and reference
- Includes interactive elements and cross-references
- Available as single file or complete website archive</p></li>
<li><p><strong>📝 Text Version:</strong>
- Plain text format for maximum compatibility
- Accessible for screen readers and text processing
- Lightweight and universally readable</p></li>
</ol>
<p><strong>Quick Download Commands:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download specific formats using wget or curl</span>

<span class="c1"># PDF version</span>
wget<span class="w"> </span>/downloads/Ubuntu-Storage-Guide.pdf

<span class="c1"># EPUB version</span>
wget<span class="w"> </span>/downloads/Ubuntu-Storage-Guide.epub

<span class="c1"># Complete archive with all formats</span>
wget<span class="w"> </span>/downloads/Ubuntu-Storage-Guide-All-Formats.zip

<span class="c1"># Extract complete archive</span>
unzip<span class="w"> </span>Ubuntu-Storage-Guide-All-Formats.zip
</pre></div>
</div>
</section>
</section>
<section id="automation-scripts">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">Automation Scripts</a><a class="headerlink" href="#automation-scripts" title="Link to this heading"></a></h3>
<section id="automated-build-script">
<h4><a class="toc-backref" href="#id5" role="doc-backlink">Automated Build Script</a><a class="headerlink" href="#automated-build-script" title="Link to this heading"></a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1"># auto-build-docs.sh - Automated documentation builder with CI/CD integration</span>

<span class="nb">set</span><span class="w"> </span>-euo<span class="w"> </span>pipefail

<span class="c1"># Configuration</span>
<span class="nv">PROJECT_ROOT</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span><span class="nb">cd</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>dirname<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BASH_SOURCE</span><span class="p">[0]</span><span class="si">}</span><span class="s2">&quot;</span><span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">pwd</span><span class="k">)</span><span class="s2">&quot;</span>
<span class="nv">SOURCE_DIR</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$PROJECT_ROOT</span><span class="s2">/source&quot;</span>
<span class="nv">BUILD_DIR</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$PROJECT_ROOT</span><span class="s2">/_build&quot;</span>
<span class="nv">OUTPUT_DIR</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$PROJECT_ROOT</span><span class="s2">/dist&quot;</span>
<span class="nv">VERSION</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>+%Y.%m.%d<span class="k">)</span>

<span class="c1"># Colors for output</span>
<span class="nv">RED</span><span class="o">=</span><span class="s1">&#39;\033[0;31m&#39;</span>
<span class="nv">GREEN</span><span class="o">=</span><span class="s1">&#39;\033[0;32m&#39;</span>
<span class="nv">YELLOW</span><span class="o">=</span><span class="s1">&#39;\033[1;33m&#39;</span>
<span class="nv">NC</span><span class="o">=</span><span class="s1">&#39;\033[0m&#39;</span><span class="w"> </span><span class="c1"># No Color</span>

log_info<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="s2">[INFO]</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2"> </span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="o">}</span>

log_warn<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">YELLOW</span><span class="si">}</span><span class="s2">[WARN]</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2"> </span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="o">}</span>

log_error<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">RED</span><span class="si">}</span><span class="s2">[ERROR]</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2"> </span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="o">}</span>

check_dependencies<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span>log_info<span class="w"> </span><span class="s2">&quot;Checking dependencies...&quot;</span>

<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">missing_deps</span><span class="o">=()</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span>!<span class="w"> </span><span class="nb">command</span><span class="w"> </span>-v<span class="w"> </span>sphinx-build<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nv">missing_deps</span><span class="o">+=(</span><span class="s2">&quot;sphinx&quot;</span><span class="o">)</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span>!<span class="w"> </span><span class="nb">command</span><span class="w"> </span>-v<span class="w"> </span>pdflatex<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nv">missing_deps</span><span class="o">+=(</span><span class="s2">&quot;texlive-latex-recommended&quot;</span><span class="o">)</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="si">${#</span><span class="nv">missing_deps</span><span class="p">[@]</span><span class="si">}</span><span class="w"> </span>-ne<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span>log_error<span class="w"> </span><span class="s2">&quot;Missing dependencies: </span><span class="si">${</span><span class="nv">missing_deps</span><span class="p">[*]</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">        </span>log_info<span class="w"> </span><span class="s2">&quot;Install with: sudo apt install python3-sphinx texlive-latex-recommended&quot;</span>
<span class="w">        </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>

<span class="w">    </span>log_info<span class="w"> </span><span class="s2">&quot;All dependencies satisfied&quot;</span>
<span class="o">}</span>

clean_build<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span>log_info<span class="w"> </span><span class="s2">&quot;Cleaning previous builds...&quot;</span>
<span class="w">    </span>rm<span class="w"> </span>-rf<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BUILD_DIR</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$OUTPUT_DIR</span><span class="s2">&quot;</span>
<span class="w">    </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BUILD_DIR</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$OUTPUT_DIR</span><span class="s2">&quot;</span>
<span class="o">}</span>

build_html<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span>log_info<span class="w"> </span><span class="s2">&quot;Building HTML documentation...&quot;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span>sphinx-build<span class="w"> </span>-b<span class="w"> </span>html<span class="w"> </span>-W<span class="w"> </span>--keep-going<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$SOURCE_DIR</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BUILD_DIR</span><span class="s2">/html&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span>log_info<span class="w"> </span><span class="s2">&quot;HTML build successful&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">0</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span>log_error<span class="w"> </span><span class="s2">&quot;HTML build failed&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>
<span class="o">}</span>

build_pdf<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span>log_info<span class="w"> </span><span class="s2">&quot;Building PDF documentation...&quot;</span>

<span class="w">    </span><span class="c1"># Build LaTeX first</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span>sphinx-build<span class="w"> </span>-b<span class="w"> </span>latex<span class="w"> </span>-W<span class="w"> </span>--keep-going<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$SOURCE_DIR</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BUILD_DIR</span><span class="s2">/latex&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nb">cd</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BUILD_DIR</span><span class="s2">/latex&quot;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span>make<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span>log_info<span class="w"> </span><span class="s2">&quot;PDF build successful&quot;</span>
<span class="w">            </span>cp<span class="w"> </span>*.pdf<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$OUTPUT_DIR</span><span class="s2">/Ubuntu-Storage-Guide-</span><span class="si">${</span><span class="nv">VERSION</span><span class="si">}</span><span class="s2">.pdf&quot;</span>
<span class="w">            </span><span class="nb">cd</span><span class="w"> </span>-<span class="w"> </span>&gt;<span class="w"> </span>/dev/null
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="m">0</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">            </span>log_error<span class="w"> </span><span class="s2">&quot;PDF compilation failed&quot;</span>
<span class="w">            </span><span class="nb">cd</span><span class="w"> </span>-<span class="w"> </span>&gt;<span class="w"> </span>/dev/null
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">        </span><span class="k">fi</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span>log_error<span class="w"> </span><span class="s2">&quot;LaTeX build failed&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>
<span class="o">}</span>

build_epub<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span>log_info<span class="w"> </span><span class="s2">&quot;Building EPUB documentation...&quot;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span>sphinx-build<span class="w"> </span>-b<span class="w"> </span>epub<span class="w"> </span>-W<span class="w"> </span>--keep-going<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$SOURCE_DIR</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BUILD_DIR</span><span class="s2">/epub&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span>cp<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BUILD_DIR</span><span class="s2">/epub&quot;</span>/*.epub<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$OUTPUT_DIR</span><span class="s2">/Ubuntu-Storage-Guide-</span><span class="si">${</span><span class="nv">VERSION</span><span class="si">}</span><span class="s2">.epub&quot;</span>
<span class="w">        </span>log_info<span class="w"> </span><span class="s2">&quot;EPUB build successful&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">0</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span>log_error<span class="w"> </span><span class="s2">&quot;EPUB build failed&quot;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
<span class="w">    </span><span class="k">fi</span>
<span class="o">}</span>

create_archives<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span>log_info<span class="w"> </span><span class="s2">&quot;Creating distribution archives...&quot;</span>

<span class="w">    </span><span class="nb">cd</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$BUILD_DIR</span><span class="s2">&quot;</span>

<span class="w">    </span><span class="c1"># Create HTML archive</span>
<span class="w">    </span>tar<span class="w"> </span>-czf<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$OUTPUT_DIR</span><span class="s2">/Ubuntu-Storage-Guide-HTML-</span><span class="si">${</span><span class="nv">VERSION</span><span class="si">}</span><span class="s2">.tar.gz&quot;</span><span class="w"> </span>html/

<span class="w">    </span><span class="c1"># Create complete archive</span>
<span class="w">    </span>tar<span class="w"> </span>-czf<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$OUTPUT_DIR</span><span class="s2">/Ubuntu-Storage-Guide-Complete-</span><span class="si">${</span><span class="nv">VERSION</span><span class="si">}</span><span class="s2">.tar.gz&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>html/<span class="w"> </span>latex/<span class="w"> </span>epub/

<span class="w">    </span><span class="nb">cd</span><span class="w"> </span>-<span class="w"> </span>&gt;<span class="w"> </span>/dev/null

<span class="w">    </span>log_info<span class="w"> </span><span class="s2">&quot;Archives created successfully&quot;</span>
<span class="o">}</span>

generate_checksums<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span>log_info<span class="w"> </span><span class="s2">&quot;Generating checksums...&quot;</span>
<span class="w">    </span><span class="nb">cd</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$OUTPUT_DIR</span><span class="s2">&quot;</span>
<span class="w">    </span>sha256sum<span class="w"> </span>*<span class="w"> </span>&gt;<span class="w"> </span><span class="s2">&quot;checksums-</span><span class="si">${</span><span class="nv">VERSION</span><span class="si">}</span><span class="s2">.sha256&quot;</span>
<span class="w">    </span><span class="nb">cd</span><span class="w"> </span>-<span class="w"> </span>&gt;<span class="w"> </span>/dev/null
<span class="o">}</span>

show_summary<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span>log_info<span class="w"> </span><span class="s2">&quot;Build Summary:&quot;</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;======================================&quot;</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Version: </span><span class="nv">$VERSION</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Build Directory: </span><span class="nv">$BUILD_DIR</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Output Directory: </span><span class="nv">$OUTPUT_DIR</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Generated Files:&quot;</span>
<span class="w">    </span>ls<span class="w"> </span>-lh<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$OUTPUT_DIR</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Total Size: </span><span class="k">$(</span>du<span class="w"> </span>-sh<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$OUTPUT_DIR</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-f1<span class="k">)</span><span class="s2">&quot;</span>
<span class="o">}</span>

<span class="c1"># Main execution</span>
main<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span>log_info<span class="w"> </span><span class="s2">&quot;Starting automated documentation build (Version: </span><span class="nv">$VERSION</span><span class="s2">)&quot;</span>

<span class="w">    </span>check_dependencies
<span class="w">    </span>clean_build

<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">build_errors</span><span class="o">=</span><span class="m">0</span>

<span class="w">    </span><span class="c1"># Build all formats</span>
<span class="w">    </span>build_html<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">((</span>build_errors++<span class="o">))</span>
<span class="w">    </span>build_pdf<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">((</span>build_errors++<span class="o">))</span>
<span class="w">    </span>build_epub<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">((</span>build_errors++<span class="o">))</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$build_errors</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span>create_archives
<span class="w">        </span>generate_checksums
<span class="w">        </span>show_summary
<span class="w">        </span>log_info<span class="w"> </span><span class="s2">&quot;All builds completed successfully!&quot;</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span>log_warn<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$build_errors</span><span class="s2"> build(s) failed, but continuing with available outputs&quot;</span>
<span class="w">    </span><span class="k">fi</span>
<span class="o">}</span>

<span class="c1"># Handle command line arguments</span>
<span class="k">case</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">1</span><span class="k">:-</span><span class="nv">all</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="k">in</span>
<span class="w">    </span><span class="s2">&quot;html&quot;</span><span class="o">)</span>
<span class="w">        </span>check_dependencies
<span class="w">        </span>clean_build
<span class="w">        </span>build_html
<span class="w">        </span><span class="p">;;</span>
<span class="w">    </span><span class="s2">&quot;pdf&quot;</span><span class="o">)</span>
<span class="w">        </span>check_dependencies
<span class="w">        </span>clean_build
<span class="w">        </span>build_pdf
<span class="w">        </span><span class="p">;;</span>
<span class="w">    </span><span class="s2">&quot;epub&quot;</span><span class="o">)</span>
<span class="w">        </span>check_dependencies
<span class="w">        </span>clean_build
<span class="w">        </span>build_epub
<span class="w">        </span><span class="p">;;</span>
<span class="w">    </span><span class="s2">&quot;all&quot;</span><span class="p">|</span><span class="s2">&quot;&quot;</span><span class="o">)</span>
<span class="w">        </span>main
<span class="w">        </span><span class="p">;;</span>
<span class="w">    </span>*<span class="o">)</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Usage: </span><span class="nv">$0</span><span class="s2"> [html|pdf|epub|all]&quot;</span>
<span class="w">        </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<span class="w">        </span><span class="p">;;</span>
<span class="k">esac</span>
</pre></div>
</div>
</section>
<section id="continuous-integration-script">
<h4><a class="toc-backref" href="#id6" role="doc-backlink">Continuous Integration Script</a><a class="headerlink" href="#continuous-integration-script" title="Link to this heading"></a></h4>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># .github/workflows/build-docs.yml - GitHub Actions workflow</span>
<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Build Documentation</span>

<span class="nt">on</span><span class="p">:</span>
<span class="w">  </span><span class="nt">push</span><span class="p">:</span>
<span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">main</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">develop</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">pull_request</span><span class="p">:</span>
<span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">main</span><span class="w"> </span><span class="p p-Indicator">]</span>

<span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">build</span><span class="p">:</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-22.04</span>

<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Set up Python</span>
<span class="w">      </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/setup-python@v4</span>
<span class="w">      </span><span class="nt">with</span><span class="p">:</span>
<span class="w">        </span><span class="nt">python-version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.10&#39;</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install dependencies</span>
<span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">        </span><span class="no">sudo apt-get update</span>
<span class="w">        </span><span class="no">sudo apt-get install -y texlive-latex-recommended texlive-fonts-recommended texlive-latex-extra</span>
<span class="w">        </span><span class="no">pip install sphinx sphinx-rtd-theme</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Build documentation</span>
<span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">        </span><span class="no">chmod +x auto-build-docs.sh</span>
<span class="w">        </span><span class="no">./auto-build-docs.sh</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Upload artifacts</span>
<span class="w">      </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/upload-artifact@v3</span>
<span class="w">      </span><span class="nt">with</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">documentation</span>
<span class="w">        </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dist/</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy to GitHub Pages</span>
<span class="w">      </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">github.ref == &#39;refs/heads/main&#39;</span>
<span class="w">      </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">peaceiris/actions-gh-pages@v3</span>
<span class="w">      </span><span class="nt">with</span><span class="p">:</span>
<span class="w">        </span><span class="nt">github_token</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.GITHUB_TOKEN }}</span>
<span class="w">        </span><span class="nt">publish_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_build/html</span>
</pre></div>
</div>
</section>
<section id="docker-build-environment">
<h4><a class="toc-backref" href="#id7" role="doc-backlink">Docker Build Environment</a><a class="headerlink" href="#docker-build-environment" title="Link to this heading"></a></h4>
<div class="highlight-dockerfile notranslate"><div class="highlight"><pre><span></span><span class="c"># Dockerfile for documentation building</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">ubuntu:22.04</span>

<span class="k">ENV</span><span class="w"> </span><span class="nv">DEBIAN_FRONTEND</span><span class="o">=</span>noninteractive

<span class="c"># Install dependencies</span>
<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>python3<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>python3-pip<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>texlive-latex-recommended<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>texlive-fonts-recommended<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>texlive-latex-extra<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>make<span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>/var/lib/apt/lists/*

<span class="c"># Install Python packages</span>
<span class="k">RUN</span><span class="w"> </span>pip3<span class="w"> </span>install<span class="w"> </span>sphinx<span class="w"> </span>sphinx-rtd-theme

<span class="c"># Set working directory</span>
<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/docs</span>

<span class="c"># Copy build script</span>
<span class="k">COPY</span><span class="w"> </span>auto-build-docs.sh<span class="w"> </span>/usr/local/bin/
<span class="k">RUN</span><span class="w"> </span>chmod<span class="w"> </span>+x<span class="w"> </span>/usr/local/bin/auto-build-docs.sh

<span class="c"># Default command</span>
<span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;/usr/local/bin/auto-build-docs.sh&quot;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Docker build and run commands</span>

<span class="c1"># Build the Docker image</span>
docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>storage-docs-builder<span class="w"> </span>.

<span class="c1"># Run documentation build</span>
docker<span class="w"> </span>run<span class="w"> </span>-v<span class="w"> </span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>:/docs<span class="w"> </span>storage-docs-builder

<span class="c1"># Extract built documentation</span>
docker<span class="w"> </span>run<span class="w"> </span>-v<span class="w"> </span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>:/docs<span class="w"> </span>-v<span class="w"> </span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/output:/output<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>storage-docs-builder<span class="w"> </span>cp<span class="w"> </span>-r<span class="w"> </span>/docs/dist/*<span class="w"> </span>/output/
</pre></div>
</div>
</section>
</section>
<section id="additional-resources">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">Additional Resources</a><a class="headerlink" href="#additional-resources" title="Link to this heading"></a></h3>
<section id="official-documentation-links">
<h4><a class="toc-backref" href="#id9" role="doc-backlink">Official Documentation Links</a><a class="headerlink" href="#official-documentation-links" title="Link to this heading"></a></h4>
<p><strong>Ubuntu Documentation:</strong></p>
<ul class="simple">
<li><p><a class="reference external" href="https://ubuntu.com/server/docs">Ubuntu Server Guide</a> - Official Ubuntu Server documentation</p></li>
<li><p><a class="reference external" href="https://help.ubuntu.com/community/LinuxFilesystemsExplained">Ubuntu Storage Guide</a> - Community filesystem documentation</p></li>
<li><p><a class="reference external" href="https://help.ubuntu.com/community/LVM">Ubuntu LVM Guide</a> - Logical Volume Management</p></li>
</ul>
<p><strong>Filesystem Documentation:</strong></p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.kernel.org/doc/Documentation/filesystems/ext4.txt">Ext4 Documentation</a> - Kernel documentation for ext4</p></li>
<li><p><a class="reference external" href="https://xfs.wiki.kernel.org/">XFS Documentation</a> - XFS filesystem wiki</p></li>
<li><p><a class="reference external" href="https://btrfs.wiki.kernel.org/">Btrfs Documentation</a> - Btrfs filesystem wiki</p></li>
<li><p><a class="reference external" href="https://openzfs.github.io/openzfs-docs/">ZFS on Linux</a> - OpenZFS documentation</p></li>
</ul>
<p><strong>RAID and Storage:</strong></p>
<ul class="simple">
<li><p><a class="reference external" href="https://raid.wiki.kernel.org/">Linux RAID Wiki</a> - Comprehensive RAID documentation</p></li>
<li><p><a class="reference external" href="https://tldp.org/HOWTO/LVM-HOWTO/">LVM HOWTO</a> - Linux Documentation Project LVM guide</p></li>
<li><p><a class="reference external" href="https://www.kernel.org/doc/Documentation/block/">Storage Performance</a> - Kernel block layer documentation</p></li>
</ul>
</section>
<section id="useful-tools-and-utilities">
<h4><a class="toc-backref" href="#id10" role="doc-backlink">Useful Tools and Utilities</a><a class="headerlink" href="#useful-tools-and-utilities" title="Link to this heading"></a></h4>
<p><strong>System Information:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Essential storage tools installation</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>lvm2<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>mdadm<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>smartmontools<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>parted<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>gparted<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>hdparm<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>iotop<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>sysstat<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>tree<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>ncdu<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>htop
</pre></div>
</div>
<p><strong>Monitoring Tools:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Advanced monitoring tools</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>nagios-plugins-basic<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>zabbix-agent<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>collectd<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>grafana<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>prometheus-node-exporter
</pre></div>
</div>
<p><strong>Backup Tools:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Backup and recovery tools</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>rsync<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>rdiff-backup<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>duplicity<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>borgbackup<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>testdisk<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>photorec<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>ddrescue
</pre></div>
</div>
</section>
<section id="scripts-and-templates">
<h4><a class="toc-backref" href="#id11" role="doc-backlink">Scripts and Templates</a><a class="headerlink" href="#scripts-and-templates" title="Link to this heading"></a></h4>
<p><strong>Makefile for Documentation:</strong></p>
<div class="highlight-makefile notranslate"><div class="highlight"><pre><span></span><span class="c"># Makefile for Ubuntu Storage Documentation</span>

<span class="nv">SOURCEDIR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">source</span>
<span class="nv">BUILDDIR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>_build
<span class="nv">OUTPUTDIR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>dist
<span class="nv">VERSION</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">$(</span>shell<span class="w"> </span>date<span class="w"> </span>+%Y.%m.%d<span class="k">)</span>
<span class="nv">PROJECT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Ubuntu-Storage-Guide

<span class="nf">.PHONY</span><span class="o">:</span><span class="w"> </span><span class="n">help</span> <span class="n">clean</span> <span class="n">html</span> <span class="n">pdf</span> <span class="n">epub</span> <span class="n">all</span> <span class="n">archive</span>

<span class="nf">help</span><span class="o">:</span>
<span class="w">     </span>@echo<span class="w"> </span><span class="s2">&quot;Ubuntu Storage Documentation Build System&quot;</span>
<span class="w">     </span>@echo<span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="w">     </span>@echo<span class="w"> </span><span class="s2">&quot;Available targets:&quot;</span>
<span class="w">     </span>@echo<span class="w"> </span><span class="s2">&quot;  html     Build HTML documentation&quot;</span>
<span class="w">     </span>@echo<span class="w"> </span><span class="s2">&quot;  pdf      Build PDF documentation&quot;</span>
<span class="w">     </span>@echo<span class="w"> </span><span class="s2">&quot;  epub     Build EPUB documentation&quot;</span>
<span class="w">     </span>@echo<span class="w"> </span><span class="s2">&quot;  all      Build all formats&quot;</span>
<span class="w">     </span>@echo<span class="w"> </span><span class="s2">&quot;  archive  Create distribution archives&quot;</span>
<span class="w">     </span>@echo<span class="w"> </span><span class="s2">&quot;  clean    Remove build artifacts&quot;</span>
<span class="w">     </span>@echo<span class="w"> </span><span class="s2">&quot;  install  Install dependencies&quot;</span>

<span class="nf">clean</span><span class="o">:</span>
<span class="w">     </span>rm<span class="w"> </span>-rf<span class="w"> </span><span class="k">$(</span>BUILDDIR<span class="k">)</span><span class="w"> </span><span class="k">$(</span>OUTPUTDIR<span class="k">)</span>
<span class="w">     </span>@echo<span class="w"> </span><span class="s2">&quot;Build artifacts cleaned&quot;</span>

<span class="nf">install</span><span class="o">:</span>
<span class="w">     </span>sudo<span class="w"> </span>apt<span class="w"> </span>update
<span class="w">     </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>python3-sphinx<span class="w"> </span>texlive-latex-recommended
<span class="w">     </span>pip3<span class="w"> </span>install<span class="w"> </span>sphinx-rtd-theme
<span class="w">     </span>@echo<span class="w"> </span><span class="s2">&quot;Dependencies installed&quot;</span>

<span class="nf">html</span><span class="o">:</span>
<span class="w">     </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="k">$(</span>BUILDDIR<span class="k">)</span>
<span class="w">     </span>sphinx-build<span class="w"> </span>-b<span class="w"> </span>html<span class="w"> </span><span class="k">$(</span>SOURCEDIR<span class="k">)</span><span class="w"> </span><span class="k">$(</span>BUILDDIR<span class="k">)</span>/html
<span class="w">     </span>@echo<span class="w"> </span><span class="s2">&quot;HTML documentation built in </span><span class="k">$(</span>BUILDDIR<span class="k">)</span><span class="s2">/html&quot;</span>

<span class="nf">pdf</span><span class="o">:</span>
<span class="w">     </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="k">$(</span>BUILDDIR<span class="k">)</span><span class="w"> </span><span class="k">$(</span>OUTPUTDIR<span class="k">)</span>
<span class="w">     </span>sphinx-build<span class="w"> </span>-b<span class="w"> </span>latex<span class="w"> </span><span class="k">$(</span>SOURCEDIR<span class="k">)</span><span class="w"> </span><span class="k">$(</span>BUILDDIR<span class="k">)</span>/latex
<span class="w">     </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>BUILDDIR<span class="k">)</span>/latex<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make
<span class="w">     </span>cp<span class="w"> </span><span class="k">$(</span>BUILDDIR<span class="k">)</span>/latex/*.pdf<span class="w"> </span><span class="k">$(</span>OUTPUTDIR<span class="k">)</span>/<span class="k">$(</span>PROJECT<span class="k">)</span>-<span class="k">$(</span>VERSION<span class="k">)</span>.pdf
<span class="w">     </span>@echo<span class="w"> </span><span class="s2">&quot;PDF documentation built: </span><span class="k">$(</span>OUTPUTDIR<span class="k">)</span><span class="s2">/</span><span class="k">$(</span>PROJECT<span class="k">)</span><span class="s2">-</span><span class="k">$(</span>VERSION<span class="k">)</span><span class="s2">.pdf&quot;</span>

<span class="nf">epub</span><span class="o">:</span>
<span class="w">     </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="k">$(</span>BUILDDIR<span class="k">)</span><span class="w"> </span><span class="k">$(</span>OUTPUTDIR<span class="k">)</span>
<span class="w">     </span>sphinx-build<span class="w"> </span>-b<span class="w"> </span>epub<span class="w"> </span><span class="k">$(</span>SOURCEDIR<span class="k">)</span><span class="w"> </span><span class="k">$(</span>BUILDDIR<span class="k">)</span>/epub
<span class="w">     </span>cp<span class="w"> </span><span class="k">$(</span>BUILDDIR<span class="k">)</span>/epub/*.epub<span class="w"> </span><span class="k">$(</span>OUTPUTDIR<span class="k">)</span>/<span class="k">$(</span>PROJECT<span class="k">)</span>-<span class="k">$(</span>VERSION<span class="k">)</span>.epub
<span class="w">     </span>@echo<span class="w"> </span><span class="s2">&quot;EPUB documentation built: </span><span class="k">$(</span>OUTPUTDIR<span class="k">)</span><span class="s2">/</span><span class="k">$(</span>PROJECT<span class="k">)</span><span class="s2">-</span><span class="k">$(</span>VERSION<span class="k">)</span><span class="s2">.epub&quot;</span>

<span class="nf">all</span><span class="o">:</span><span class="w"> </span><span class="n">html</span> <span class="n">pdf</span> <span class="n">epub</span>
<span class="w">     </span>@echo<span class="w"> </span><span class="s2">&quot;All documentation formats built successfully&quot;</span>

<span class="nf">archive</span><span class="o">:</span><span class="w"> </span><span class="n">all</span>
<span class="w">     </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="k">$(</span>OUTPUTDIR<span class="k">)</span>
<span class="w">     </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>BUILDDIR<span class="k">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>tar<span class="w"> </span>-czf<span class="w"> </span>../<span class="k">$(</span>OUTPUTDIR<span class="k">)</span>/<span class="k">$(</span>PROJECT<span class="k">)</span>-HTML-<span class="k">$(</span>VERSION<span class="k">)</span>.tar.gz<span class="w"> </span>html/
<span class="w">     </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>OUTPUTDIR<span class="k">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>tar<span class="w"> </span>-czf<span class="w"> </span><span class="k">$(</span>PROJECT<span class="k">)</span>-Complete-<span class="k">$(</span>VERSION<span class="k">)</span>.tar.gz<span class="w"> </span>*.pdf<span class="w"> </span>*.epub<span class="w"> </span>*.tar.gz
<span class="w">     </span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>OUTPUTDIR<span class="k">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sha256sum<span class="w"> </span>*<span class="w"> </span>&gt;<span class="w"> </span>checksums-<span class="k">$(</span>VERSION<span class="k">)</span>.sha256
<span class="w">     </span>@echo<span class="w"> </span><span class="s2">&quot;Distribution archives created in </span><span class="k">$(</span>OUTPUTDIR<span class="k">)</span><span class="s2">&quot;</span>
</pre></div>
</div>
</section>
<section id="community-resources">
<h4><a class="toc-backref" href="#id12" role="doc-backlink">Community Resources</a><a class="headerlink" href="#community-resources" title="Link to this heading"></a></h4>
<p><strong>Forums and Communities:</strong></p>
<ul class="simple">
<li><p><a class="reference external" href="https://ubuntuforums.org/forumdisplay.php?f=35">Ubuntu Forums - Storage Section</a></p></li>
<li><p><a class="reference external" href="https://askubuntu.com/questions/tagged/storage">Ask Ubuntu - Storage Questions</a></p></li>
<li><p><a class="reference external" href="https://reddit.com/r/Ubuntu">Reddit r/Ubuntu</a></p></li>
<li><p><a class="reference external" href="https://discourse.ubuntu.com/">Ubuntu Discourse</a></p></li>
</ul>
<p><strong>Professional Resources:</strong></p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.lpi.org/">Linux Professional Institute (LPI)</a> - Linux certification</p></li>
<li><p><a class="reference external" href="https://www.redhat.com/en/services/training">Red Hat Training</a> - Enterprise Linux training</p></li>
<li><p><a class="reference external" href="https://www.suse.com/training/">SUSE Training</a> - SUSE Linux Enterprise training</p></li>
</ul>
<p><strong>Books and Publications:</strong></p>
<ul class="simple">
<li><p>“Linux System Administration” by Tom Adelstein</p></li>
<li><p>“UNIX and Linux System Administration Handbook” by Evi Nemeth</p></li>
<li><p>“Linux Storage Best Practices” by various authors</p></li>
<li><p>“ZFS Administration Guide” by Oracle</p></li>
</ul>
</section>
</section>
<section id="getting-help-and-support">
<h3><a class="toc-backref" href="#id13" role="doc-backlink">Getting Help and Support</a><a class="headerlink" href="#getting-help-and-support" title="Link to this heading"></a></h3>
<section id="issue-reporting">
<h4><a class="toc-backref" href="#id14" role="doc-backlink">Issue Reporting</a><a class="headerlink" href="#issue-reporting" title="Link to this heading"></a></h4>
<p>If you find errors in this documentation or have suggestions for improvement:</p>
<ol class="arabic simple">
<li><p><strong>Documentation Issues:</strong>
- Create an issue on the project repository
- Include specific page/section references
- Provide detailed description of the problem</p></li>
<li><p><strong>Technical Issues:</strong>
- Check the troubleshooting section first
- Search existing forums and documentation
- Provide system information and error messages</p></li>
<li><p><strong>Feature Requests:</strong>
- Suggest new topics or sections
- Provide use cases and justification
- Consider contributing content yourself</p></li>
</ol>
</section>
<section id="contributing-to-documentation">
<h4><a class="toc-backref" href="#id15" role="doc-backlink">Contributing to Documentation</a><a class="headerlink" href="#contributing-to-documentation" title="Link to this heading"></a></h4>
<p>This documentation is open source and welcomes contributions:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fork the repository</span>
git<span class="w"> </span>clone<span class="w"> </span>https://github.com/username/ubuntu-storage-docs.git
<span class="nb">cd</span><span class="w"> </span>ubuntu-storage-docs

<span class="c1"># Create a new branch</span>
git<span class="w"> </span>checkout<span class="w"> </span>-b<span class="w"> </span>feature/new-content

<span class="c1"># Make your changes</span>
<span class="c1"># Edit .rst files in the source/ directory</span>

<span class="c1"># Build and test</span>
make<span class="w"> </span>html

<span class="c1"># Commit and push</span>
git<span class="w"> </span>add<span class="w"> </span>.
git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;Add new storage topic: XYZ&quot;</span>
git<span class="w"> </span>push<span class="w"> </span>origin<span class="w"> </span>feature/new-content

<span class="c1"># Create a pull request</span>
</pre></div>
</div>
<p><strong>Contribution Guidelines:</strong></p>
<ul class="simple">
<li><p>Follow the existing documentation style</p></li>
<li><p>Include practical examples and code snippets</p></li>
<li><p>Test all commands on Ubuntu 22.04</p></li>
<li><p>Update the table of contents if adding new sections</p></li>
<li><p>Include relevant cross-references</p></li>
</ul>
</section>
<section id="contact-information">
<h4><a class="toc-backref" href="#id16" role="doc-backlink">Contact Information</a><a class="headerlink" href="#contact-information" title="Link to this heading"></a></h4>
<p>For questions, suggestions, or support:</p>
<ul class="simple">
<li><p><strong>Email:</strong> <a class="reference external" href="mailto:docs&#37;&#52;&#48;storage-guide&#46;org">docs<span>&#64;</span>storage-guide<span>&#46;</span>org</a></p></li>
<li><p><strong>IRC:</strong> #ubuntu-storage on Libera.Chat</p></li>
<li><p><strong>Matrix:</strong> #ubuntu-storage:matrix.org</p></li>
<li><p><strong>GitHub:</strong> <a class="reference external" href="https://github.com/ubuntu-storage-docs">https://github.com/ubuntu-storage-docs</a></p></li>
</ul>
<p>This comprehensive documentation package provides everything needed to understand and manage storage systems on Ubuntu 22.04, available in multiple formats for different use cases and preferences.</p>
</section>
</section>
</section>
</div>
</section>
<section id="quick-start-guide">
<h1>Quick Start Guide<a class="headerlink" href="#quick-start-guide" title="Link to this heading"></a></h1>
<p>This documentation is designed for:</p>
<ul class="simple">
<li><p>System administrators managing storage on Ubuntu 22.04 LTS</p></li>
<li><p>Developers working with storage APIs and file systems</p></li>
<li><p>Students learning about storage technologies</p></li>
<li><p>IT professionals preparing for storage-related certifications</p></li>
</ul>
<p><strong>Download Options:</strong></p>
<ul class="simple">
<li><p>HTML Documentation (browsable online)</p></li>
<li><p>PDF Version (for offline reading)</p></li>
<li><p>EPUB Format (for e-readers)</p></li>
</ul>
</section>
<section id="navigation-tips">
<h1>Navigation Tips<a class="headerlink" href="#navigation-tips" title="Link to this heading"></a></h1>
<p>Use the sidebar to navigate through different sections. Each chapter includes:</p>
<ul class="simple">
<li><p>Theoretical concepts and explanations</p></li>
<li><p>Practical examples with Ubuntu 22.04 commands</p></li>
<li><p>Code samples and scripts</p></li>
<li><p>Common questions and answers</p></li>
<li><p>Troubleshooting guides</p></li>
</ul>
</section>
<section id="indices-and-tables">
<h1>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Link to this heading"></a></h1>
<ul class="simple">
<li><p><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></p></li>
<li><p><a class="reference internal" href="py-modindex.html"><span class="std std-ref">Module Index</span></a></p></li>
<li><p><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></p></li>
</ul>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Rameshkumar T S.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>